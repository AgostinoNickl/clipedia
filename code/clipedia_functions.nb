(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    736372,      16376]
NotebookOptionsPosition[    721766,      16121]
NotebookOutlinePosition[    722178,      16138]
CellTagsIndexPosition[    722135,      16135]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"NotebookClose", "[", "]"}]], "Input",
 CellChangeTimes->{{3.908877767563973*^9, 3.908877774415114*^9}, {
  3.921658965448513*^9, 
  3.921658971303772*^9}},ExpressionUUID->"482df6d1-6718-4995-83cd-\
83f6b39aaf6e"],

Cell[CellGroupData[{

Cell[TextData[StyleBox["CLIPedia Functions\nClick on Yes to run all \
Initialization Cells.\nDon\[CloseCurlyQuote]t save,  it should close \
automatically.",
 FontSize->36,
 FontWeight->"Bold",
 FontColor->RGBColor[0., 0., 0.]]], "Subtitle",
 CellChangeTimes->{{3.899963859343124*^9, 3.899963864923728*^9}, {
   3.899987107019384*^9, 3.8999871160106163`*^9}, {3.900384093368415*^9, 
   3.9003840936376143`*^9}, 3.900384129286695*^9, {3.9003841714232264`*^9, 
   3.900384182613977*^9}, {3.904202416313595*^9, 3.9042024206895037`*^9}, {
   3.904413435317566*^9, 3.904413437719654*^9}, {3.907652437424941*^9, 
   3.90765243926243*^9}, {3.9088833618210907`*^9, 3.908883395385623*^9}, {
   3.9088844162491426`*^9, 3.9088844339067383`*^9}, {3.919525278870569*^9, 
   3.9195252887842083`*^9}, {3.921659149982774*^9, 3.921659219524087*^9}, {
   3.935499852923112*^9, 3.935499854263545*^9}, 3.935987798587953*^9, {
   3.961252901133298*^9, 3.961252902829485*^9}},
 FontSize->25,ExpressionUUID->"1c7df667-3ad4-415a-bca4-612f59ef41f7"],

Cell["\<\
Published by Agostino Nickl, 2025, under the MIT License, in tandem with the \
paper Nickl, Agostino, \[OpenCurlyDoubleQuote]Navigating CLIPedia: \
Architectonic Instruments for Querying and Questing a Latent Encyclopedia,\
\[CloseCurlyDoubleQuote] Frontiers of Architectural Research (forthcoming). \
CLIPedia was written and tested in Mathematica 13.2 on Mac. The functions in \
this file rely on external files, which are accessed relative to $repoFolder. \
This variable is set and managed by the main inference notebook of CLIPedia, \
ensuring that all file paths resolve correctly. For more information, refer \
to the paper and the README.md.\
\>", "Text",
 CellChangeTimes->{{3.96125194944234*^9, 3.9612521572845*^9}, {
  3.961252388025564*^9, 3.961252390569215*^9}, {3.961252541877954*^9, 
  3.961252626284953*^9}},ExpressionUUID->"b1691db3-b98d-4e99-94cd-\
dc9182a0b0d3"]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[StyleBox["Functions",
 FontColor->RGBColor[0., 0., 0.]]], "Title",
 CellFrame->{{0, 0}, {0, 0}},
 CellChangeTimes->{{3.8986890518721814`*^9, 
  3.898689122376096*^9}},ExpressionUUID->"9816041d-7eea-4fca-ba1b-\
6851b1373bc7"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.904204341985561*^9, 3.904204343726047*^9}, 
   3.961251698546061*^9},ExpressionUUID->"3f0b3048-b73a-4be4-9941-\
16ae5a07ab58"],

Cell[CellGroupData[{

Cell["SOM Evaluation Functions", "Subtitle",
 CellChangeTimes->{{3.873539554198429*^9, 3.87353956385848*^9}, {
  3.873539727707151*^9, 
  3.873539729825041*^9}},ExpressionUUID->"0f4777f8-7495-4237-8c01-\
3ebb7d0374c2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "cell"}], " ", "cell", " ", "index"}]}], ",", " ", 
    RowBox[{"-", "maxX"}], ",", 
    RowBox[{"maxY", " ", "grid", " ", "dimensions"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "order"}], " ", "neighborhood", " ", "order"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "neighbor", " ", "indices", " ",
        "including", " ", "the", " ", "cell", " ", "itself"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Recursively", " ", "finds", " ", "all", " ", "neighboring", " ", 
       "cells", " ", "up", " ", "to", " ", "the", " ", "given", " ", 
       RowBox[{"order", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"FindNeighboursRecursively", "[", 
    RowBox[{"cell_", ",", "maxX_", ",", "maxY_", ",", "order_"}], "]"}], ":=",
    "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "directNeighbours", ",", "allNeighbours", ",", "uniqueNeighbours"}], 
      "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{
      "Return", " ", "the", " ", "cell", " ", "itself", " ", "if", " ", 
       "order", " ", "is", " ", "0"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"order", "==", "0"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"{", "cell", "}"}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Base", " ", 
        RowBox[{"case", ":", 
         RowBox[{"immediate", " ", "neighbours"}]}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"directNeighbours", "=", 
       RowBox[{"FindNeighboursInGrid", "[", 
        RowBox[{"cell", ",", "maxX", ",", "maxY"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Recursive", " ", "case"}], "*)"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"order", ">", "1"}], ",", 
        RowBox[{"allNeighbours", "=", 
         RowBox[{"Join", "[", 
          RowBox[{"directNeighbours", ",", 
           RowBox[{"Flatten", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"FindNeighboursRecursively", "[", 
                RowBox[{"#", ",", "maxX", ",", "maxY", ",", 
                 RowBox[{"order", "-", "1"}]}], "]"}], "&"}], "/@", 
              "directNeighbours"}], ",", "1"}], "]"}]}], "]"}]}], ",", 
        RowBox[{"allNeighbours", "=", "directNeighbours"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Remove", " ", "duplicates", " ", "and", " ", "original", " ", 
        "cell"}], "*)"}], 
      RowBox[{"uniqueNeighbours", "=", 
       RowBox[{"DeleteDuplicates", "[", "allNeighbours", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Flatten", "@", 
       RowBox[{"Join", "[", 
        RowBox[{"{", 
         RowBox[{"cell", ",", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{"uniqueNeighbours", ",", "cell"}], "]"}]}], "}"}], 
        "]"}]}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.910872019300992*^9, 3.910872045628433*^9}, {
  3.910873869959126*^9, 3.910873926177333*^9}, {3.961232175081295*^9, 
  3.961232186582953*^9}, {3.96123276526276*^9, 3.9612327705845346`*^9}},
 CellLabel->"In[29]:=",ExpressionUUID->"e6de6d9e-4a15-4682-9603-9588fe2a8cd9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "index"}], " ", "cell", " ", "index"}]}], ",", 
    RowBox[{"-", "x"}], ",", 
    RowBox[{
     RowBox[{"y", " ", "grid", " ", "dimensions"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "neighboring", " ", "cell", " ",
        "indices"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{"Returns", " ", "indices", " ", "of", " ", "direct", " ", 
       RowBox[{"(", 
        RowBox[{"8", "-", "connected"}], ")"}], " ", "neighbors", " ", "in", 
       " ", "the", " ", "SOM", " ", 
       RowBox[{"grid", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"FindNeighboursInGrid", "[", 
    RowBox[{"index_", ",", "x_", ",", "y_"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "cell", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cell", "=", 
       RowBox[{"FindCellFromIndex", "[", 
        RowBox[{"index", ",", "x"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Cases", "[", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Find", " ", "Left", " ", "Neighbour"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"cell", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "==", "1"}], ",", "0", ",", 
            RowBox[{
             RowBox[{"FindIndexFromCell", "[", 
              RowBox[{"cell", ",", "x"}], "]"}], "-", "1"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Find", " ", "Right", " ", "Neighbour"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"cell", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "==", "x"}], ",", "0", ",", 
            RowBox[{
             RowBox[{"FindIndexFromCell", "[", 
              RowBox[{"cell", ",", "x"}], "]"}], "+", "1"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Find", " ", "Top", " ", "Neighbour"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"cell", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "==", "1"}], ",", "0", ",", 
            RowBox[{
             RowBox[{"FindIndexFromCell", "[", 
              RowBox[{"cell", ",", "x"}], "]"}], "-", "x"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Find", " ", "Bottom", " ", "Neighbour"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"cell", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "==", "y"}], ",", "0", ",", 
            RowBox[{
             RowBox[{"FindIndexFromCell", "[", 
              RowBox[{"cell", ",", "x"}], "]"}], "+", "x"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Find", " ", "TopLeft", " ", "Neighbour"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"cell", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "==", "1"}], "||", 
             RowBox[{
              RowBox[{"cell", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "==", "1"}]}], ",", "0", ",", 
            RowBox[{
             RowBox[{"FindIndexFromCell", "[", 
              RowBox[{"cell", ",", "x"}], "]"}], "-", "1", "-", "x"}]}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Find", " ", "TopRight", " ", "Neighbour"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"cell", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "==", "x"}], "||", 
             RowBox[{
              RowBox[{"cell", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "==", "1"}]}], ",", "0", ",", 
            RowBox[{
             RowBox[{"FindIndexFromCell", "[", 
              RowBox[{"cell", ",", "x"}], "]"}], "+", "1", "-", "x"}]}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Find", " ", "BottomLeft", " ", "Neighbour"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"cell", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "==", "y"}], "||", 
             RowBox[{
              RowBox[{"cell", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "==", "1"}]}], ",", "0", ",", 
            RowBox[{
             RowBox[{"FindIndexFromCell", "[", 
              RowBox[{"cell", ",", "x"}], "]"}], "-", "1", "+", "x"}]}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Find", " ", "BottomRight", " ", "Neighbour"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"cell", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "==", "y"}], "||", 
             RowBox[{
              RowBox[{"cell", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "==", "x"}]}], ",", "0", ",", 
            RowBox[{
             RowBox[{"FindIndexFromCell", "[", 
              RowBox[{"cell", ",", "x"}], "]"}], "+", "1", "+", "x"}]}], 
           "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Except", "[", "0", "]"}]}], "]"}]}]}], "\[IndentingNewLine]",
     "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8726712833135805`*^9, 3.8726713235035796`*^9}, {
   3.8727601267408304`*^9, 3.8727601384934216`*^9}, 3.872760172100008*^9, {
   3.8729136383499813`*^9, 3.8729136947737875`*^9}, {3.8729137602220235`*^9, 
   3.8729137807335844`*^9}, {3.8729138708858786`*^9, 
   3.8729138839421988`*^9}, {3.872913919869743*^9, 3.8729140269422283`*^9}, {
   3.872914063111035*^9, 3.8729141161745434`*^9}, 3.8729150107929897`*^9, {
   3.9612321965824327`*^9, 3.961232203523203*^9}, {3.961232754770063*^9, 
   3.961232757999065*^9}},
 CellLabel->"In[30]:=",ExpressionUUID->"e29c5b91-4016-4420-8681-62b31c4606c5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "som"}], " ", "SOM", " ", "grid", " ", "structure"}]}], 
    ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "vec"}], " ", "input", " ", "vector"}], ";", " ", "\n", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "BMU", " ", "indices"}]}], ";", 
     " ", "\n", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Finds", " ", "the", " ", "index", " ", "of", " ", "the", " ", "best", 
       " ", "matching", " ", "unit", " ", 
       RowBox[{"(", "BMU", ")"}], " ", "for", " ", "the", " ", "given", " ", 
       "input", " ", 
       RowBox[{"vector", "."}]}]}]}]}], "*)"}], "\n", "\n", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Informed", " ", "by", " ", "code", " ", "from", " ", "ETHZ", " ", 
     "CAAD"}], ",", " ", 
    RowBox[{"Salda\[NTilde]a", " ", "Ochoa"}], ",", " ", 
    RowBox[{
     RowBox[{"Karla", " ", "&"}], " ", "Zifeng"}], ",", " ", 
    RowBox[{"Guo", " ", 
     RowBox[{"(", "2020", ")"}]}], ",", 
    "\"\<Map & Models \[Dash] Self Organizing Maps\>\""}], "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{"FindBMUs", "[", 
    RowBox[{"som_", ",", "vec_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Map", "[", 
    RowBox[{"First", ",", " ", 
     RowBox[{"Nearest", "[", 
      RowBox[{
       RowBox[{"MapIndexed", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#1", "->", 
           RowBox[{"#2", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", " ", 
         RowBox[{"som", "[", "\"\<weights\>\"", "]"}]}], "]"}], ",", " ", 
       "vec"}], "]"}]}], "]"}]}]}]], "Code",
 CellChangeTimes->{{3.6649612958373957`*^9, 3.664961318079955*^9}, {
   3.664961348697054*^9, 3.66496137323141*^9}, {3.66496144003706*^9, 
   3.6649614636369047`*^9}, {3.664962084249435*^9, 3.664962123722329*^9}, {
   3.665998796509615*^9, 3.665998813220433*^9}, {3.665998893894999*^9, 
   3.66599890011187*^9}, 3.782448600564476*^9, {3.8735367726399307`*^9, 
   3.8735368068167763`*^9}, {3.961219640502307*^9, 3.961219671114933*^9}, {
   3.961219771683165*^9, 3.961219772502812*^9}, {3.9612202442781754`*^9, 
   3.9612202883691883`*^9}, {3.961224559136401*^9, 3.9612245608264313`*^9}, {
   3.961232134818783*^9, 3.961232149230523*^9}, {3.9612327375046177`*^9, 
   3.961232746501471*^9}},
 CellLabel->"In[31]:=",
 CellID->1455332261,ExpressionUUID->"f22eacac-6f2d-402c-97ca-2b6fa2227c6f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "cell"}], " ", 
      RowBox[{"{", 
       RowBox[{"row", ",", "column"}], "}"}], " ", "pair"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "x"}], " ", "number", " ", "of", " ", "columns"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Linear"}], " ", "index"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Converts", " ", "a", " ", "2", "D", " ", "cell", " ", "coordinate", 
       " ", "to", " ", "a", " ", "linear", " ", "index", " ", "in", " ", 
       "the", " ", "SOM", " ", 
       RowBox[{"grid", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"FindIndexFromCell", "[", 
    RowBox[{"cell_", ",", "x_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"cell", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "-", "1"}], ")"}], "*", "x"}], ")"}],
     "+", 
    RowBox[{"cell", "[", 
     RowBox[{"[", "2", "]"}], "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.961248787721839*^9, 3.961248790619563*^9}},
 CellLabel->"In[32]:=",ExpressionUUID->"40138036-9f5e-4781-a93c-201476f420cd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "index"}], " ", "linear", " ", "cell", " ", "index"}]}], 
    ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "rowWidth"}], " ", "number", " ", "of", " ", "columns"}], 
     ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"{", 
         RowBox[{"row", ",", "column"}], "}"}]}], " ", "pair"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Converts", " ", "a", " ", "linear", " ", "cell", " ", "index", " ", 
       "to", " ", "a", " ", "2", "D", " ", "coordinate", " ", "in", " ", 
       "the", " ", "SOM", " ", 
       RowBox[{"grid", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"FindCellFromIndex", "[", 
    RowBox[{"index_", ",", "rowWidth_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"Ceiling", "[", 
      RowBox[{
       RowBox[{"N", "[", 
        RowBox[{"index", "/", 
         RowBox[{"(", "rowWidth", ")"}]}], "]"}], ",", "1"}], "]"}], ",", 
     RowBox[{"rowWidth", "+", 
      RowBox[{"(", 
       RowBox[{"index", "-", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"Ceiling", "[", 
           RowBox[{
            RowBox[{"N", "[", 
             RowBox[{"index", "/", 
              RowBox[{"(", "rowWidth", ")"}]}], "]"}], ",", "1"}], "]"}], 
          ")"}], "*", "rowWidth"}]}], ")"}]}]}], "}"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8725093402336817`*^9, 3.872509426208577*^9}, {
  3.96124880567654*^9, 3.961248806561611*^9}},
 CellLabel->"In[33]:=",ExpressionUUID->"a4429225-38ff-4b50-be44-95af04474eb0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "weights"}], " ", "list", " ", "of", " ", "SOM", " ", 
      "weight", " ", "vectors"}]}], ";", 
    RowBox[{
    "bmus", " ", "list", " ", "of", " ", "best", " ", "matching", " ", "unit",
      " ", "indices"}], ";", 
    RowBox[{"inputN", " ", "list", " ", "of", " ", "input", " ", "vectors"}], 
    ";", 
    RowBox[{"Output", ":", 
     RowBox[{
      RowBox[{"-", "Average"}], " ", "quantization", " ", "error"}]}], ";", 
    RowBox[{"Description", ":", 
     RowBox[{
     "Computes", " ", "the", " ", "mean", " ", "squared", " ", "distance", 
      " ", "between", " ", "input", " ", "vectors", " ", "and", " ", "their", 
      " ", 
      RowBox[{"BMUs", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Informed", " ", "by", " ", "formula", " ", "found", " ", "in", " ", 
     RowBox[{"https", ":"}]}], "//", 
    RowBox[{
     RowBox[{
      RowBox[{"www", ".", "intechopen", ".", "com"}], "/", "chapters"}], "/", 
     "69305"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"CalculateQuantizationError", "[", 
     RowBox[{"weights_", ",", "bmus_", ",", "inputN_"}], "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"N", "[", 
     RowBox[{
      RowBox[{"Mean", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"SquaredEuclideanDistance", "[", 
          RowBox[{
           RowBox[{"weights", "[", 
            RowBox[{"[", 
             RowBox[{"bmus", "[", 
              RowBox[{"[", "#", "]"}], "]"}], "]"}], "]"}], ",", 
           RowBox[{"inputN", "[", 
            RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "@", "inputN"}], "]"}]}], "]"}], ",", "6"}], 
     "]"}]}], "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8727396922829723`*^9, 3.8727396926030574`*^9}, {
   3.872739730274585*^9, 3.8727397334108143`*^9}, {3.8727398213308077`*^9, 
   3.8727398362900743`*^9}, {3.8727401827288446`*^9, 
   3.8727401948742666`*^9}, {3.8727443645788984`*^9, 
   3.8727444033060875`*^9}, {3.872752833028266*^9, 3.872752892971795*^9}, {
   3.8729221447664995`*^9, 3.8729221502455945`*^9}, 3.8729229512306337`*^9, {
   3.8729230111295195`*^9, 3.8729230189346895`*^9}, {3.8729232254265327`*^9, 
   3.8729232321662493`*^9}, {3.8729308580112343`*^9, 3.8729308703516736`*^9}, 
   3.872936990310285*^9, 3.874903498961065*^9, 3.875248729886438*^9, {
   3.961220345089582*^9, 3.9612203554060507`*^9}, {3.96123158914826*^9, 
   3.9612316188495626`*^9}, {3.961231658135343*^9, 3.96123166300622*^9}, {
   3.961232710433241*^9, 3.961232721446492*^9}},
 CellLabel->"In[34]:=",ExpressionUUID->"9415f2a2-fe80-4ded-a006-e14d5dd97aa4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "weights"}], " ", "SOM", " ", "weight", " ", 
       "vectors"}]}], ";", 
     RowBox[{"somDis", " ", "SOM", " ", "distance", " ", "matrix"}], ";", 
     RowBox[{"inputN", " ", "input", " ", "vectors"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Average"}], " ", "topographic", " ", "error", " ", 
       RowBox[{"(", "numeric", ")"}]}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Measures", " ", "how", " ", "often", " ", "first", " ", "and", " ", 
       "second", " ", "BMUs", " ", "are", " ", "not", " ", "neighbors"}]}]}], 
    ",", 
    RowBox[{"indicating", " ", "map", " ", "topology", " ", 
     RowBox[{"preservation", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"Informed", " ", "by", " ", 
      RowBox[{"https", ":"}]}], "//", 
     RowBox[{
      RowBox[{
       RowBox[{"digitalcommons", ".", "uri", ".", "edu"}], "/", "cgi"}], "/", 
      RowBox[{"viewcontent", ".", 
       RowBox[{"cgi", "?", "article"}]}]}]}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{"2013", "&"}], "context"}], "=", "theses"}]}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"CalculateTopographicError", "[", 
      RowBox[{"weights_", ",", "somDis_", ",", "inputN_"}], "]"}], ":=", "\n", 
     RowBox[{"N", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Count", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"TopographicDistanceBetweenBMUs", "[", 
             RowBox[{"weights", ",", "somDis", ",", "#"}], "]"}], "&"}], "/@",
            "inputN"}], ",", 
          RowBox[{"x_", "/;", 
           RowBox[{"x", ">", "1.5"}]}]}], "]"}], "/", 
        RowBox[{"Length", "@", "inputN"}]}], ",", "6"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TopographicDistanceBetweenBMUs", "[", 
     RowBox[{"somWeights_", ",", "somDis_", ",", "vecInput_"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"bmus", ",", "firstBMU", ",", "secondBMU"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"bmus", "=", 
        RowBox[{"Ordering", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"EuclideanDistance", "[", 
            RowBox[{"vecInput", ",", "#"}], "]"}], "&"}], "/@", 
          "somWeights"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"somDis", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"bmus", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"bmus", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "]"}]}]}], 
     "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.872739867042658*^9, 3.8727398803066874`*^9}, {
   3.8727401990746174`*^9, 3.872740201362303*^9}, {3.8727532101869507`*^9, 
   3.872753216315598*^9}, {3.8727538232273865`*^9, 3.872753908660369*^9}, {
   3.8727539842039356`*^9, 3.8727539915565014`*^9}, {3.872754412068033*^9, 
   3.8727544223639174`*^9}, {3.872756074211093*^9, 3.8727560852680025`*^9}, {
   3.87291573323816*^9, 3.872915748053485*^9}, {3.8729308414278593`*^9, 
   3.872930854175527*^9}, 3.872936989038921*^9, {3.873446475304462*^9, 
   3.87344648447641*^9}, {3.873539585882222*^9, 3.8735395863861227`*^9}, {
   3.875172842037156*^9, 3.8751728446639843`*^9}, {3.875186145958517*^9, 
   3.875186172902259*^9}, 3.8752487472785473`*^9, {3.875254842827591*^9, 
   3.875254861570425*^9}, {3.923139414302705*^9, 3.9231394479360437`*^9}, {
   3.92313951699363*^9, 3.9231395388673143`*^9}, 3.923139591736579*^9, {
   3.9231398035724916`*^9, 3.923139826795508*^9}, 3.923140073806322*^9, {
   3.9612203224787407`*^9, 3.9612203418071938`*^9}, {3.9612316807260103`*^9, 
   3.961231685957549*^9}, {3.961232692225954*^9, 3.9612327018822927`*^9}},
 CellLabel->"In[35]:=",ExpressionUUID->"91c517a3-170b-48bb-a45a-b3a2bc37f80f"]
}, Closed]],

Cell[CellGroupData[{

Cell["SOM Rendering Functions", "Subtitle",
 CellChangeTimes->{{3.873539554198429*^9, 3.87353956385848*^9}, {
  3.873539721581253*^9, 
  3.873539733853113*^9}},ExpressionUUID->"566d8e90-1ae4-48d2-8dc2-\
b750e5361f06"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "som"}], " ", "SOM", " ", "grid", " ", "structure"}]}], 
    ",", " ", 
    RowBox[{
     RowBox[{"-", "weights"}], " ", "weight", " ", "vectors"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "colorScheme"}], " ", "color", " ", "scheme", " ", 
      "name"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{"-", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"u", "-", 
          RowBox[{"matrix", " ", "image"}]}], ",", 
         RowBox[{"numeric", " ", "matrix", " ", "of", " ", "distances"}]}], 
        "}"}]}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
       RowBox[{"Calculates", " ", "the", " ", "U"}], "-", 
       RowBox[{"Matrix", " ", 
        RowBox[{"(", 
         RowBox[{"average", " ", "neighbor", " ", "distances"}], ")"}], " ", 
        "and", " ", "returns", " ", "a", " ", "visual", " ", 
        RowBox[{"representation", "."}]}]}]}]}]}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CalculateUMatrix", "[", 
    RowBox[{"som_", ",", "weights_", ",", "colorScheme_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "differences", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"differences", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Mean", "[", "\[IndentingNewLine]", 
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"EuclideanDistance", "[", 
              RowBox[{
               RowBox[{"weights", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "#"}], "]"}], "&"}], "/@", 
            RowBox[{"weights", "[", 
             RowBox[{"[", 
              RowBox[{"FindNeighboursInGrid", "[", 
               RowBox[{"i", ",", 
                RowBox[{"som", "[", 
                 RowBox[{"\"\<dimensions\>\"", ",", "\"\<x\>\""}], "]"}], ",", 
                RowBox[{"som", "[", 
                 RowBox[{"\"\<dimensions\>\"", ",", "\"\<y\>\""}], "]"}]}], 
               "]"}], "]"}], "]"}]}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "weights"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Image", "[", 
         RowBox[{
          RowBox[{"ArrayReshape", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"ColorData", "[", "colorScheme", "]"}], "[", "#", 
               "]"}], "&"}], "/@", "differences"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"som", "[", 
               RowBox[{"\"\<dimensions\>\"", ",", "\"\<y\>\""}], "]"}], ",", 
              RowBox[{"som", "[", 
               RowBox[{"\"\<dimensions\>\"", ",", "\"\<x\>\""}], "]"}]}], 
             "}"}]}], "]"}], ",", 
          RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
          RowBox[{"ColorSpace", "\[Rule]", "\"\<RGB\>\""}]}], "]"}], ",", 
        "differences"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8727640612640924`*^9, 3.8727640801804266`*^9}, {
   3.8727649475085573`*^9, 3.872764961933958*^9}, {3.87276502334156*^9, 
   3.872765044118058*^9}, {3.8727651388130517`*^9, 3.8727651475810547`*^9}, {
   3.872765321922928*^9, 3.8727653327015004`*^9}, {3.8727655009342327`*^9, 
   3.8727655077583165`*^9}, {3.872765687112363*^9, 3.8727657232932205`*^9}, {
   3.8727657574370537`*^9, 3.8727657643023224`*^9}, {3.8727657966860094`*^9, 
   3.872765802461219*^9}, {3.8727675070703382`*^9, 3.872767517853698*^9}, {
   3.872768872502495*^9, 3.8727688756379285`*^9}, {3.8727689641989293`*^9, 
   3.872768983961961*^9}, {3.872770166133971*^9, 3.8727701665493355`*^9}, {
   3.8727702769657593`*^9, 3.872770277837845*^9}, {3.8727707241107025`*^9, 
   3.872770824454793*^9}, {3.872771315207159*^9, 3.872771374318795*^9}, {
   3.872780364729642*^9, 3.872780366205187*^9}, {3.8727804240648828`*^9, 
   3.8727804257992167`*^9}, {3.8727806961695633`*^9, 
   3.8727807009455996`*^9}, {3.8727807832661405`*^9, 3.872780784650275*^9}, {
   3.872780833500513*^9, 3.8727808344198227`*^9}, {3.872915216407728*^9, 
   3.872915248782443*^9}, {3.872921396912507*^9, 3.872921403582509*^9}, 
   3.8729284535554066`*^9, {3.872928590095725*^9, 3.872928604720209*^9}, {
   3.8990971503555813`*^9, 3.899097165774181*^9}, {3.961219432285305*^9, 
   3.961219436594092*^9}, {3.961232094338337*^9, 3.961232117760125*^9}, {
   3.961232678746992*^9, 3.96123268234661*^9}},
 CellLabel->"In[37]:=",ExpressionUUID->"3a10b1e4-5254-4dc0-a1e1-39b8c82b01ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "w"}], " ", "Association", " ", "of", " ", "words"}], "-",
       "counts"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"Output", ":", 
     RowBox[{
      RowBox[{"-", "List"}], " ", "of", " ", 
      RowBox[{"{", 
       RowBox[{"word", ",", " ", 
        RowBox[{"normalized", " ", "weight"}]}], "}"}], " ", "pairs"}]}], ";",
     "\[IndentingNewLine]", 
    RowBox[{"Description", ":", 
     RowBox[{
     "Normalizes", " ", "word", " ", "counts", " ", "for", " ", "visual", " ",
       "display", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"e", ".", "g", "."}], ",", 
        RowBox[{
        "font", " ", "scaling", " ", "in", " ", "word", " ", "clouds"}]}], 
       ")"}]}]}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Informed", " ", "by", " ", "code", " ", "from", " ", "ETHZ", " ", 
     "CAAD"}], ",", " ", 
    RowBox[{"Salda\[NTilde]a", " ", "Ochoa"}], ",", " ", 
    RowBox[{
     RowBox[{"Karla", " ", "&"}], " ", "Zifeng"}], ",", " ", 
    RowBox[{"Guo", " ", 
     RowBox[{"(", "2020", ")"}]}], ",", 
    "\"\<Map & Models \[Dash] Self Organizing Maps\>\""}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ScaleWords", "[", "w_", "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"k", "=", 
        RowBox[{"Keys", "[", "w", "]"}]}], ",", 
       RowBox[{"v", "=", 
        RowBox[{"Values", "[", "w", "]"}]}], ",", "r"}], "}"}], ",", 
     RowBox[{
      RowBox[{"r", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Min", "[", "v", "]"}], "==", 
          RowBox[{"Max", "[", "v", "]"}]}], ",", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"1", ",", 
           RowBox[{"Length", "[", "v", "]"}]}], "]"}], ",", 
         RowBox[{"Rescale", "[", 
          RowBox[{"v", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Min", "[", "v", "]"}], ",", 
             RowBox[{"Max", "[", "v", "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0.5", ",", "1"}], "}"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Transpose", "[", 
       RowBox[{"{", 
        RowBox[{"k", ",", "r"}], "}"}], "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.961224225609509*^9, 3.961224265117186*^9}, {
  3.961231378380492*^9, 3.961231443239831*^9}, {3.96123264866413*^9, 
  3.961232667851128*^9}},
 CellLabel->"In[38]:=",ExpressionUUID->"db400bc0-e6aa-4438-8935-df57ac71c151"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "somStats"}], " ", "SOM", " ", "statistics", " ", 
       "association"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Rendered"}], " ", "summary", " ", "row", " ", "with", 
       " ", "stats"}]}]}], ",", "renders", ",", 
    RowBox[{
     RowBox[{"and", " ", "plots"}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Displays", " ", "SOM", " ", "training", " ", "statistics", " ", 
       "including", " ", "renders", " ", "and", " ", "metric", " ", "plots", 
       " ", "in", " ", "a", " ", "compact", " ", "row", " ", "layout", " ", 
       "during", " ", "training", " ", "or", " ", "for", " ", "evaluation", 
       " ", "after", " ", 
       RowBox[{"training", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ShowSOMStats", "[", "somStats_", "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Row", "[", 
      RowBox[{
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Text", "[", 
          RowBox[{"Style", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ToString", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{
                "\"\<info\>\"", ",", " ", "\"\<infoIte\>\"", ",", "1"}], 
                "]"}], "]"}], "]"}], "<>", "\"\<\\n\>\"", "<>", 
             RowBox[{"ToString", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{
                "\"\<info\>\"", ",", " ", "\"\<infoIte\>\"", ",", "2"}], 
                "]"}], "]"}], "]"}]}], ",", "Black", ",", "12", ",", 
            RowBox[{"FontWeight", "->", "Bold"}], ",", 
            RowBox[{"TextAlignment", "->", "Center"}]}], "]"}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Column", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<renderRGB\>\"", ",", "Black", ",", "8"}], "]"}], 
             "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"\"\<renders\>\"", ",", " ", "\"\<renderRGB\>\""}], 
              "]"}], "]"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"Column", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<renderPCA\>\"", ",", "Black", ",", "8"}], "]"}], 
             "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"\"\<renders\>\"", ",", " ", "\"\<renderPCA\>\""}], 
              "]"}], "]"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"Column", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<renderTSNE\>\"", ",", "Black", ",", "8"}], "]"}], 
             "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"\"\<renders\>\"", ",", " ", "\"\<renderTSNE\>\""}], 
              "]"}], "]"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"Column", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
               RowBox[{"\"\<plotQE: \>\"", "<>", 
                RowBox[{"ToString", "@", 
                 RowBox[{"N", "[", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<info\>\"", ",", " ", "\"\<infoQE\>\""}], 
                    "]"}], "]"}], ",", "5"}], "]"}]}]}], ",", "Black", ",", 
               "8"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"\"\<plots\>\"", ",", " ", "\"\<plotQE\>\""}], "]"}], 
             "]"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"Column", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
               RowBox[{"\"\<plotQEN: \>\"", "<>", 
                RowBox[{"ToString", "@", 
                 RowBox[{"N", "[", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<info\>\"", ",", " ", "\"\<infoQEN\>\""}], 
                    "]"}], "]"}], ",", "5"}], "]"}]}]}], ",", "Black", ",", 
               "8"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"\"\<plots\>\"", ",", " ", "\"\<plotQEN\>\""}], "]"}], 
             "]"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"Column", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
               RowBox[{"\"\<plotTR: \>\"", "<>", 
                RowBox[{"ToString", "@", 
                 RowBox[{"N", "[", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<info\>\"", ",", " ", "\"\<infoTE\>\""}], 
                    "]"}], "]"}], ",", "5"}], "]"}]}]}], ",", "Black", ",", 
               "8"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"\"\<plots\>\"", ",", " ", "\"\<plotTE\>\""}], "]"}], 
             "]"}]}], "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"Column", "@", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Text", "[", 
             RowBox[{"Style", "[", 
              RowBox[{
               RowBox[{"\"\<plotLR: \>\"", "<>", 
                RowBox[{"ToString", "@", 
                 RowBox[{"N", "[", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<info\>\"", ",", " ", "\"\<infoLR\>\""}], 
                    "]"}], "]"}], ",", "5"}], "]"}]}]}], ",", "Black", ",", 
               "8"}], "]"}], "]"}], ",", 
            RowBox[{"#", "[", 
             RowBox[{"[", 
              RowBox[{"\"\<plots\>\"", ",", " ", "\"\<plotLR\>\""}], "]"}], 
             "]"}]}], "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Spacer", "[", "5", "]"}]}], "]"}], "&"}], "@", 
    "somStats"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.883122375092043*^9, 3.883122440162059*^9}, {
   3.883122508259115*^9, 3.8831225208722334`*^9}, {3.88312255734097*^9, 
   3.883122679363769*^9}, {3.883122732457196*^9, 3.883122830756426*^9}, {
   3.8831238297988076`*^9, 3.883123876219016*^9}, {3.8831239094424877`*^9, 
   3.883124070740997*^9}, {3.883124114783856*^9, 3.8831242264593782`*^9}, 
   3.883124446359984*^9, {3.900183640003104*^9, 3.9001837088131027`*^9}, {
   3.90018383764814*^9, 3.900183888580206*^9}, {3.900183918976533*^9, 
   3.900183936675662*^9}, {3.961219570345858*^9, 3.9612195707662363`*^9}, {
   3.961248747383275*^9, 3.96124877306269*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"4d950cc4-6ad2-4885-a479-b005b19dbfe7"]
}, Closed]],

Cell[CellGroupData[{

Cell["SOM Initialization Functions", "Subtitle",
 CellChangeTimes->{{3.873539554198429*^9, 3.87353956385848*^9}, {
  3.873539721581253*^9, 
  3.873539766342341*^9}},ExpressionUUID->"ebeba433-7b44-474f-83b9-\
a1b40c702a03"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\n", 
   RowBox[{
    RowBox[{"Input", " ", ":", " ", 
     RowBox[{
      RowBox[{"-", "data"}], " ", "list", " ", "of", " ", "input", " ", 
      "vectors"}]}], ",", " ", 
    RowBox[{
     RowBox[{"-", "y"}], " ", "number", " ", "of", " ", "rows"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "x"}], " ", "number", " ", "of", " ", "columns"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "dim"}], " ", "dimensionality", " ", "of", " ", "input", 
     " ", "vectors"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"-", "periodicity"}], " ", "optional", " ", "boolean", " ", 
       "for", " ", "grid", " ", "periodicity"}], ";"}], " ", "\\\n", 
     RowBox[{"Output", " ", ":", " ", 
      RowBox[{
       RowBox[{"-", "SOM"}], " ", "grid", " ", "association", " ", "with", 
       " ", "dimensions"}]}]}], ",", " ", "weights", ",", " ", "coordinates", 
    ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"and", " ", "distance", " ", "matrix"}], ";"}], " ", "\\\n", 
     RowBox[{"Description", " ", ":", " ", 
      RowBox[{
       RowBox[{"Creates", " ", "a", " ", "random"}], "-", 
       RowBox[{
       "initialized", " ", "SOM", " ", "grid", " ", "with", " ", "specified", 
        " ", "dimensions"}]}]}]}], ",", " ", 
    RowBox[{
    "sampling", " ", "weights", " ", "from", " ", "data", " ", "and", " ", 
     "computing", " ", "pairwise", " ", "distances", " ", "using", " ", 
     "Euclidean"}], ",", " ", "ring", ",", " ", 
    RowBox[{
    "or", " ", "toroidal", " ", "distance", " ", "depending", " ", "on", " ", 
     RowBox[{"periodicity", "."}]}]}], "*)"}], "\n", "\n", 
  RowBox[{
   RowBox[{"CreateSomGridRandomSample", "[", 
    RowBox[{"data_", ",", "y_", ",", "x_", ",", "dim_", ",", 
     RowBox[{"periodicity_", ":", "False"}]}], "]"}], ":=", "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Informed", " ", "by", " ", "code", " ", "from", " ", "ETHZ", " ", 
      "CAAD"}], ",", " ", 
     RowBox[{"Salda\[NTilde]a", " ", "Ochoa"}], ",", " ", 
     RowBox[{
      RowBox[{"Karla", " ", "&"}], " ", "Zifeng"}], ",", " ", 
     RowBox[{"Guo", " ", 
      RowBox[{"(", "2020", ")"}]}], ",", 
     "\"\<Map & Models \[Dash] Self Organizing Maps\>\""}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "somCoords", ",", "somLengths", ",", "somWeights", ",", "somDis"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"somCoords", "=", 
       RowBox[{"Tuples", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Range", "[", "y", "]"}], ",", 
          RowBox[{"Range", "[", "x", "]"}]}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"somLengths", "=", 
       RowBox[{"x", "*", "y"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"somWeights", "=", 
       RowBox[{"RandomSample", "[", 
        RowBox[{"data", ",", "somLengths"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"somDis", "=", 
       RowBox[{"N", "[", 
        RowBox[{"DistanceMatrix", "[", 
         RowBox[{"somCoords", ",", 
          RowBox[{"DistanceFunction", "->", "\n", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"periodicity", "==", "True"}], ",", "\n", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"MemberQ", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"y", "==", "1"}], ",", 
                   RowBox[{"x", "==", "1"}]}], "}"}], ",", "True"}], "]"}], 
               ",", "\n", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"RingDistance", "[", 
                  RowBox[{"#1", ",", "#2", ",", 
                   RowBox[{"{", 
                    RowBox[{"y", ",", "x"}], "}"}]}], "]"}], "&"}], ")"}], 
               ",", "\n", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"ToroidalDistance", "[", 
                  RowBox[{"#1", ",", "#2", ",", 
                   RowBox[{"{", 
                    RowBox[{"y", ",", "x"}], "}"}]}], "]"}], "&"}], ")"}]}], 
              "]"}], ",", "\[IndentingNewLine]", "EuclideanDistance"}], 
            "]"}]}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\"\<dimensions\>\"", "\[Rule]", " ", 
         RowBox[{"<|", 
          RowBox[{
           RowBox[{"\"\<x\>\"", "\[Rule]", " ", "x"}], ",", 
           RowBox[{"\"\<y\>\"", "\[Rule]", " ", "y"}], ",", 
           RowBox[{"\"\<dim\>\"", "\[Rule]", " ", "dim"}], ",", " ", 
           RowBox[{"\"\<len\>\"", "\[Rule]", " ", "somLengths"}]}], "|>"}]}], 
        ",", 
        RowBox[{"\"\<weights\>\"", "\[Rule]", " ", "somWeights"}], ",", " ", 
        RowBox[{"\"\<coordinates\>\"", "\[Rule]", " ", "somCoords"}], ",", 
        RowBox[{"\"\<distances\>\"", "\[Rule]", " ", "somDis"}]}], "]"}]}]}], 
    "]"}]}]}]], "Code",
 CellChangeTimes->{{3.664956846177367*^9, 3.6649568572608833`*^9}, {
   3.664956946370016*^9, 3.664957104677999*^9}, {3.664957337072308*^9, 
   3.664957338895629*^9}, {3.664957392882971*^9, 3.6649574371763763`*^9}, {
   3.664957551330434*^9, 3.6649575542650757`*^9}, {3.664957612848022*^9, 
   3.664957634846671*^9}, {3.6649576726580667`*^9, 3.6649576908003902`*^9}, {
   3.6649590183025084`*^9, 3.6649590211894083`*^9}, {3.664959143543198*^9, 
   3.66495923006723*^9}, {3.6649592689901133`*^9, 3.6649592781566772`*^9}, {
   3.664959971722452*^9, 3.664959980961097*^9}, {3.6649606524203587`*^9, 
   3.664960658329809*^9}, {3.664962397451435*^9, 3.664962398912627*^9}, {
   3.66503817598018*^9, 3.665038177043948*^9}, {3.665998736744738*^9, 
   3.66599873776033*^9}, 3.782448590733837*^9, {3.855920881002215*^9, 
   3.855920882158733*^9}, {3.8643728627484255`*^9, 3.8643728639826946`*^9}, {
   3.871974327671714*^9, 3.8719743297029424`*^9}, {3.871974361545046*^9, 
   3.871974465454938*^9}, 3.871974518370691*^9, {3.8719958351132994`*^9, 
   3.8719958352695303`*^9}, {3.8719972846541843`*^9, 
   3.8719972960353684`*^9}, {3.8722401957313643`*^9, 3.872240221214014*^9}, {
   3.8725665516648693`*^9, 3.872566551745636*^9}, {3.872566582946474*^9, 
   3.8725666455844154`*^9}, {3.873522916379847*^9, 3.873522946326741*^9}, {
   3.873528321110774*^9, 3.873528324776319*^9}, {3.873528898334968*^9, 
   3.87352889964561*^9}, {3.873536254852353*^9, 3.8735362648295603`*^9}, {
   3.8752580882179995`*^9, 3.875258088737974*^9}, {3.875258243617193*^9, 
   3.8752582450021925`*^9}, 3.8752584223692303`*^9, {3.8752589486978207`*^9, 
   3.8752589490088882`*^9}, 3.875259024353141*^9, 3.8824595113140907`*^9, {
   3.899060213512117*^9, 3.899060216363412*^9}, {3.8990959556145487`*^9, 
   3.899095959228345*^9}, {3.8990966434540596`*^9, 3.89909665115464*^9}, {
   3.8990971215018263`*^9, 3.8990971217012134`*^9}, {3.923129492767297*^9, 
   3.923129552377961*^9}, {3.923129902533557*^9, 3.923129906092926*^9}, {
   3.92313092210964*^9, 3.923130926972138*^9}, {3.923130981266313*^9, 
   3.92313098627346*^9}, {3.923131115921013*^9, 3.923131116920601*^9}, {
   3.923131154073022*^9, 3.923131177961206*^9}, {3.923133241312358*^9, 
   3.9231332446580687`*^9}, {3.961219376465034*^9, 3.961219379641554*^9}, {
   3.961227580328456*^9, 3.961227793385427*^9}, {3.961227890110484*^9, 
   3.961227935716075*^9}, {3.96124933947886*^9, 3.9612493495489492`*^9}},
 CellLabel->"In[40]:=",
 CellID->95479515,ExpressionUUID->"986a9ceb-b980-46b8-b8a9-ba94d902d917"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{"-", "coord1"}]}], ",", 
    RowBox[{"coord2", " ", "cell", " ", "coordinates"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "gridSize"}], " ", "grid", " ", "dimensions"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Ring"}], " ", "distance", " ", "between", " ", "two", 
       " ", "coordinates"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Computes", " ", "minimal", " ", "distance", " ", "along", " ", "a", 
       " ", "periodic", " ", 
       RowBox[{"(", "ring", ")"}], " ", "axis", " ", "for", " ", "periodic", 
       " ", "1", "D", " ", 
       RowBox[{"SOMs", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"RingDistance", "[", 
     RowBox[{"coord1_", ",", "coord2_", ",", "gridSize_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"d", ",", "activeAxis"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"activeAxis", "=", 
        RowBox[{"activeAxis", "=", 
         RowBox[{"First", "@", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"gridSize", ",", 
             RowBox[{"_", "?", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"#", "!=", "1"}], "&"}], ")"}]}]}], "]"}], 
           "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"d", "=", 
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{
            RowBox[{"coord1", "[", 
             RowBox[{"[", "activeAxis", "]"}], "]"}], "-", 
            RowBox[{"coord2", "[", 
             RowBox[{"[", "activeAxis", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"gridSize", "[", 
            RowBox[{"[", "activeAxis", "]"}], "]"}], "-", 
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{"coord1", "[", 
              RowBox[{"[", "activeAxis", "]"}], "]"}], "-", 
             RowBox[{"coord2", "[", 
              RowBox[{"[", "activeAxis", "]"}], "]"}]}], "]"}]}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", "d"}]}], "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.923127094438159*^9, 3.923127094439996*^9}, 
   3.923127188531652*^9, {3.923128774318282*^9, 3.923128779098722*^9}, {
   3.923129280095117*^9, 3.923129302804453*^9}, {3.923129382555006*^9, 
   3.923129386050815*^9}, {3.923131382503726*^9, 3.923131388446826*^9}, {
   3.923131642532598*^9, 3.9231316459189053`*^9}, {3.923131842543189*^9, 
   3.923131857678338*^9}, 3.923132545946698*^9, {3.9231330863613377`*^9, 
   3.923133086784163*^9}, {3.961248821289814*^9, 3.961248845869169*^9}},
 CellLabel->"In[41]:=",ExpressionUUID->"bc215893-f1c7-47dc-93b1-7c782e6b41ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{"-", "coord1"}]}], ",", 
    RowBox[{"coord2", " ", "cell", " ", "coordinates"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "gridSize"}], " ", "grid", " ", "dimensions"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Toroidal"}], " ", "distance", " ", "between", " ", "two",
        " ", "coordinates"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Computes", " ", "minimal", " ", "2", "D", " ", "distance", " ", "on", 
       " ", "a", " ", "toroidal", " ", "periodic", " ", "2", "D", " ", 
       RowBox[{"SOM", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ToroidalDistance", "[", 
     RowBox[{"coord1_", ",", "coord2_", ",", "gridSize_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"dx", ",", "dy"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"dx", "=", 
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{
            RowBox[{"coord1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "-", 
            RowBox[{"coord2", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"gridSize", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "-", 
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{"coord1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "-", 
             RowBox[{"coord2", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dy", "=", 
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{"Abs", "[", 
           RowBox[{
            RowBox[{"coord1", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "-", 
            RowBox[{"coord2", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"gridSize", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "-", 
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{"coord1", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "-", 
             RowBox[{"coord2", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Sqrt", "[", 
        RowBox[{
         RowBox[{"dx", "^", "2"}], "+", 
         RowBox[{"dy", "^", "2"}]}], "]"}]}]}], "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.923127094438159*^9, 3.923127094439996*^9}, 
   3.923127188531652*^9, {3.923128774318282*^9, 3.923128779098722*^9}, {
   3.961248848003379*^9, 3.961248869214842*^9}},
 CellLabel->"In[42]:=",ExpressionUUID->"e2c880a9-b33c-44bd-b370-1e0de18a8bb0"]
}, Closed]],

Cell[CellGroupData[{

Cell["SOM Training Functions", "Subtitle",
 CellChangeTimes->{{3.873539554198429*^9, 3.87353956385848*^9}, {
  3.873539721581253*^9, 3.873539766342341*^9}, {3.873539854615657*^9, 
  3.87353985673792*^9}},ExpressionUUID->"ea2036d9-9454-4c64-8ed5-\
fe4426ceca3d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "somGrid"}], " ", "SOM", " ", "grid", " ", "structure"}]}],
     ",", " ", 
    RowBox[{
     RowBox[{"-", "vecInput"}], " ", "input", " ", "data", " ", "vectors"}], 
    ",", " ", 
    RowBox[{
     RowBox[{"-", "sampleLength"}], " ", "samplesize", " ", "per", " ", 
     "training", " ", "iteration"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "qeCondition"}], " ", "a", " ", "QE", " ", "where", " ", 
     "training", " ", "should", " ", "be", " ", "stopped"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "ite"}], " ", "number", " ", "of", " ", "iterations"}], ",",
     " ", 
    RowBox[{
     RowBox[{"-", "statMode"}], " ", "whether", " ", "stats", " ", "should", 
     " ", "be", " ", "included", " ", "or", " ", "not", " ", "per", " ", 
     "iteration"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "statVisibility"}], " ", "whether", " ", "stats", " ", 
     "are", " ", "displayed", " ", "during", " ", "training"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "learnMode"}], " ", "which", " ", "learning", " ", "rate", 
     " ", "regime", " ", "is", " ", "chosen"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "distMode"}], " ", "which", " ", "distance", " ", "metric", 
     " ", "is", " ", "used", " ", "during", " ", "training"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "colorScheme"}], " ", "how", " ", "the", " ", "SOM", " ", 
     "should", " ", "be", " ", "rendered", " ", "for", " ", "preview"}], ",", 
    " ", 
    RowBox[{
     RowBox[{"-", "somFolder"}], " ", "where", " ", "SOM", " ", "iterations", 
     " ", "are", " ", "saved"}], ",", " ", 
    RowBox[{
     RowBox[{"for", " ", "large", " ", "SOMs"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Trained"}], " ", "SOM", " ", "or", " ", "list", " ", 
       "of", " ", "SOMs"}]}], ";", 
     RowBox[{"Description", ":", " ", 
      RowBox[{
      "Runs", " ", "batch", " ", "SOM", " ", "training", " ", "with", " ", 
       "different", " ", "learning", " ", "regimes"}]}]}], ",", " ", 
    RowBox[{
    "monitoring", " ", "quantization", " ", "and", " ", "topographic", " ", 
     "errors"}], ",", 
    RowBox[{"and", " ", "optional", " ", "stat", " ", 
     RowBox[{"visualization", "/", 
      RowBox[{"export", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Informed", " ", "by", " ", "code", " ", "from", " ", "ETHZ", " ", 
     "CAAD"}], ",", " ", 
    RowBox[{"Salda\[NTilde]a", " ", "Ochoa"}], ",", " ", 
    RowBox[{
     RowBox[{"Karla", " ", "&"}], " ", "Zifeng"}], ",", " ", 
    RowBox[{"Guo", " ", 
     RowBox[{"(", "2020", ")"}]}], ",", 
    "\"\<Map & Models \[Dash] Self Organizing Maps\>\"", ",", " ", 
    RowBox[{"and", " ", "\[IndentingNewLine]", "numbaSom"}], ",", " ", 
    RowBox[{"Nikola", " ", "Marincic", " ", 
     RowBox[{"(", "2021", ")"}]}], ",", " ", 
    RowBox[{"Apalache", " ", "2.0"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"nmarincic", ".", "github", ".", "io"}], "/", "numbasom"}], 
     "/"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"BatchSOM", "[", 
    RowBox[{
    "somGrid_", ",", "vecInput_", ",", "sampleLength_", ",", "qeCondition_", 
     ",", "ite_", ",", "statMode_", ",", "statVisibility_", ",", "learnMode_",
      ",", "distMode_", ",", "colorScheme_", ",", "somFolder_"}], "]"}], ":=",
    "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "somX", ",", "somY", ",", "somWeights", ",", "somCoords", ",", 
       "somDist", ",", "somLen", ",", "somDim", ",", "radius", ",", 
       "vecSamples", ",", "update", ",", "updateTotal", ",", "updateTrans", 
       ",", "bmus", ",", "quantError", ",", "quantErrors", ",", 
       "quantErrorNorm", ",", "quantErrorNorms", ",", "learnRate", ",", 
       "learnRates", ",", "learnRateMax", ",", "learnRateMin", ",", 
       "topoError", ",", "topoErrors", ",", "plateauChecks", ",", "som", ",", 
       "soms", ",", "date", ",", "stats", ",", "quantErrorMax", ",", 
       "quantErrorNormOld", ",", "flag"}], "}"}], ",", 
     RowBox[{
      RowBox[{"somX", "=", 
       RowBox[{"somGrid", "[", 
        RowBox[{"\"\<dimensions\>\"", ",", "\"\<x\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"somY", "=", 
       RowBox[{"somGrid", "[", 
        RowBox[{"\"\<dimensions\>\"", ",", "\"\<y\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"somDim", "=", 
       RowBox[{"somGrid", "[", 
        RowBox[{"\"\<dimensions\>\"", ",", "\"\<dim\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"somLen", "=", 
       RowBox[{"somGrid", "[", 
        RowBox[{"\"\<dimensions\>\"", ",", "\"\<len\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"somCoords", "=", 
       RowBox[{"somGrid", "[", "\"\<coordinates\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"somDist", "=", 
       RowBox[{"somGrid", "[", "\"\<distances\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"somWeights", "=", 
       RowBox[{"somGrid", "[", "\"\<weights\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"soms", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"learnRateMax", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"learnRateMin", "=", "0.0001"}], ";", "\[IndentingNewLine]", 
      RowBox[{"learnRate", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"quantError", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"quantErrorNorm", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"radius", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"somX", ",", "somY"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"plateauChecks", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Floor", "[", 
           RowBox[{"ite", "/", "16"}], "]"}], ",", "2"}], "}"}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"quantErrors", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"quantErrorNorms", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"topoErrors", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"learnRates", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Catch", "[", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"quantError", ">", "qeCondition"}], "&&", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Length", "@", "quantErrors"}], ">", 
                "plateauChecks"}], "&&", 
               RowBox[{"learnRate", "<", "0.1"}], "&&", 
               RowBox[{"flag", "=!=", "\"\<stop\>\""}]}], ",", 
              RowBox[{
               RowBox[{"Subtract", "[", 
                RowBox[{
                 RowBox[{"Max", "[", 
                  RowBox[{"quantErrors", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"-", "plateauChecks"}], ";;"}], "]"}], "]"}], 
                  "]"}], ",", 
                 RowBox[{"Min", "[", 
                  RowBox[{"quantErrors", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"-", "plateauChecks"}], ";;"}], "]"}], "]"}], 
                  "]"}]}], "]"}], ">", "0.001"}], ",", "True"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"vecSamples", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"somFolder", "==", "\"\<\>\""}], ",", 
               RowBox[{"RandomSample", "[", 
                RowBox[{"vecInput", ",", "sampleLength"}], "]"}], ",", 
               RowBox[{"Import", "[", 
                RowBox[{"FileNameJoin", "[", 
                 RowBox[{"{", 
                  RowBox[{
                  "somFolder", ",", "\"\<training\>\"", ",", 
                   "\"\<samples\>\"", ",", 
                   RowBox[{
                    RowBox[{"ToString", "@", "u"}], "<>", "\"\<.wxf\>\""}]}], 
                  "}"}], "]"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"bmus", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"distMode", "==", "\"\<CosineDistance\>\""}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Ordering", "[", 
                   RowBox[{
                    RowBox[{"ToExpression", "[", 
                    RowBox[{"distMode", "<>", "\"\<Fast\>\""}], "]"}], "[", 
                    RowBox[{"#", ",", "somWeights"}], "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "vecSamples"}],
                ",", 
               RowBox[{"First", "/@", 
                RowBox[{"Nearest", "[", 
                 RowBox[{
                  RowBox[{"MapIndexed", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#1", "->", 
                    RowBox[{"#2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "&"}], ",", 
                    "somWeights"}], "]"}], ",", "vecSamples", ",", 
                  RowBox[{"DistanceFunction", "->", 
                   RowBox[{"ToExpression", "[", "distMode", "]"}]}]}], 
                 "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"update", "=", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Exp", "[", 
                 RowBox[{"-", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"somDist", "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "^", "2"}], ")"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"2", " ", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"learnRate", "*", "radius"}], ")"}], "^", "2"}]}],
                     ")"}]}], ")"}]}], "]"}], " ", "0.1"}], "&"}], "/@", 
              "bmus"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"updateTotal", "=", 
             RowBox[{"Total", "@", "update"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"updateTrans", "=", 
             RowBox[{"Transpose", "@", "update"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"somWeights", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Quiet", "@", 
                RowBox[{"Check", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"vecSamples", "*", 
                    RowBox[{"updateTrans", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "/", 
                   RowBox[{"updateTotal", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{"flag", "=", "\"\<stop\>\""}], ";", " ", 
                   RowBox[{"Throw", "[", "Null", "]"}], ";"}]}], "]"}]}], 
               "&"}], "/@", 
              RowBox[{"Range", "[", 
               RowBox[{"1", ",", "somLen"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"u", "==", "1"}], ",", 
              RowBox[{"quantErrorMax", "=", 
               RowBox[{"Mean", "[", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"ToExpression", "[", "distMode", "]"}], "[", 
                    RowBox[{
                    RowBox[{"somWeights", "[", 
                    RowBox[{"[", 
                    RowBox[{"bmus", "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"vecSamples", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                  RowBox[{"Range", "[", 
                   RowBox[{"Length", "@", "vecSamples"}], "]"}]}], ")"}], 
                "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"quantError", "=", 
             RowBox[{"Mean", "[", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"ToExpression", "[", "distMode", "]"}], "[", 
                  RowBox[{
                   RowBox[{"somWeights", "[", 
                    RowBox[{"[", 
                    RowBox[{"bmus", "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "]"}], "]"}], ",", 
                   RowBox[{"vecSamples", "[", 
                    RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
                RowBox[{"Range", "[", 
                 RowBox[{"Length", "@", "vecSamples"}], "]"}]}], ")"}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"quantErrorNormOld", "=", "quantErrorNorm"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"quantErrorNorm", "=", 
             RowBox[{"quantError", "/", "quantErrorMax"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"topoError", "=", 
             RowBox[{"CalculateTopographicError", "[", 
              RowBox[{"somWeights", ",", "somDist", ",", 
               RowBox[{"RandomSample", "[", 
                RowBox[{"vecSamples", ",", 
                 RowBox[{"Min", "[", 
                  RowBox[{
                   RowBox[{"Length", "@", "vecSamples"}], ",", "somLen"}], 
                  "]"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"Which", "[", 
             RowBox[{
              RowBox[{"learnMode", "==", "\"\<Exponential\>\""}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"learnRate", "=", 
               RowBox[{"N", "[", 
                RowBox[{"(", 
                 RowBox[{"(", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "-", "u"}], ")"}], "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"ite", "/", "2"}], ")"}], "/", 
                    RowBox[{"Log", "[", "radius", "]"}]}], ")"}]}], "]"}], 
                  ")"}], ")"}], "]"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"learnMode", "==", "\"\<Linear1\>\""}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"learnRate", "=", 
               RowBox[{"N", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "-", 
                   RowBox[{"(", 
                    RowBox[{"u", "/", 
                    RowBox[{"(", 
                    RowBox[{"ite", "+", "1"}], ")"}]}], ")"}]}], ")"}], "/", 
                 "2"}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"learnRates", ",", "learnRate"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"quantErrors", ",", "quantError"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"topoErrors", ",", "topoError"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"quantErrorNorms", ",", "quantErrorNorm"}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"som", "=", 
             RowBox[{"Association", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"\"\<weights\>\"", "->", "somWeights"}], "}"}], ",", 
               RowBox[{"\"\<training history\>\"", "->", 
                RowBox[{"Association", "[", 
                 RowBox[{"{", 
                  RowBox[{"\"\<info\>\"", "->", 
                   RowBox[{"Association", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\"\<infoIte\>\"", "->", 
                    RowBox[{"{", 
                    RowBox[{"u", ",", "ite"}], "}"}]}], ",", 
                    RowBox[{"\"\<infoQE\>\"", "->", "quantError"}], ",", 
                    RowBox[{"\"\<infoQEN\>\"", "->", "quantErrorNorm"}], ",", 
                    RowBox[{"\"\<infoQET\>\"", "->", "qeCondition"}], ",", 
                    RowBox[{"\"\<infoTE\>\"", "->", "topoError"}], ",", 
                    RowBox[{"\"\<infoLR\>\"", "->", "learnRate"}]}], "}"}], 
                    "]"}]}], "}"}], "]"}]}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"statMode", "==", "\"\<Stats\>\""}], "&&", 
               RowBox[{"flag", "=!=", "\"\<stop\>\""}]}], ",", 
              RowBox[{
               RowBox[{"stats", "=", 
                RowBox[{"SomDashboard", "[", 
                 RowBox[{
                 "somGrid", ",", "somWeights", ",", "bmus", ",", "vecSamples",
                   ",", 
                  RowBox[{"{", "u", "}"}], ",", "radius", ",", "learnRate", 
                  ",", "qeCondition", ",", "colorScheme", ",", "quantErrors", 
                  ",", "quantErrorNorms", ",", "topoErrors", ",", 
                  "learnRates", ",", "quantError", ",", "topoError", ",", 
                  "statVisibility"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{
                 RowBox[{"som", "[", 
                  RowBox[{"[", "\"\<training history\>\"", "]"}], "]"}], ",", 
                 RowBox[{"Association", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"\"\<renders\>\"", "->", 
                    RowBox[{"Association", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\"\<renderRGB\>\"", "->", 
                    RowBox[{"stats", "[", 
                    RowBox[{"[", "6", "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<renderPCA\>\"", "->", 
                    RowBox[{"stats", "[", 
                    RowBox[{"[", "7", "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<renderTSNE\>\"", "->", 
                    RowBox[{"stats", "[", 
                    RowBox[{"[", "8", "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<renderMean\>\"", "->", 
                    RowBox[{"stats", "[", 
                    RowBox[{"[", "9", "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<renderUM\>\"", "->", 
                    RowBox[{"stats", "[", 
                    RowBox[{"[", "10", "]"}], "]"}]}]}], "}"}], "]"}]}], ",", 
                    RowBox[{"\"\<plots\>\"", "->", 
                    RowBox[{"Association", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\"\<plotQE\>\"", "->", 
                    RowBox[{"stats", "[", 
                    RowBox[{"[", "11", "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<plotQEN\>\"", "->", 
                    RowBox[{"stats", "[", 
                    RowBox[{"[", "12", "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<plotTE\>\"", "->", 
                    RowBox[{"stats", "[", 
                    RowBox[{"[", "13", "]"}], "]"}]}], ",", 
                    RowBox[{"\"\<plotLR\>\"", "->", 
                    RowBox[{"stats", "[", 
                    RowBox[{"[", "14", "]"}], "]"}]}]}], "}"}], "]"}]}]}], 
                   "}"}], "]"}]}], "]"}], ";"}]}], "]"}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"Clear", "[", 
             RowBox[{
             "vecSamples", ",", "bmus", ",", "update", ",", "updateTotal", 
              ",", "updateTrans"}], "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"flag", "=!=", "\"\<stop\>\""}], ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"somFolder", "==", "\"\<\>\""}], ",", 
                RowBox[{"AppendTo", "[", 
                 RowBox[{"soms", ",", "som"}], "]"}], ",", 
                RowBox[{"Export", "[", 
                 RowBox[{
                  RowBox[{"FileNameJoin", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    "somFolder", ",", "\"\<training\>\"", ",", 
                    "\"\<iterations\>\"", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringLength", "[", "#", "]"}], "<", "2"}], ",", 
                    RowBox[{"\"\<0\>\"", "<>", "#"}], ",", "#"}], "]"}], 
                    "&"}], "@", 
                    RowBox[{"ToString", "[", "u", "]"}]}], "<>", 
                    "\"\<.wxf\>\""}]}], "}"}], "]"}], ",", "som"}], "]"}]}], 
               "]"}]}], "]"}]}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"u", ",", "ite"}], "}"}]}], "]"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"somFolder", "==", "\"\<\>\""}], ",", "soms", ",", 
        "\"\<\>\""}], "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.873385377641263*^9, 3.873385516737638*^9}, {
   3.873385550091094*^9, 3.873385572722598*^9}, {3.873385635622504*^9, 
   3.8733860517020073`*^9}, {3.873386210090662*^9, 3.873386239384549*^9}, {
   3.873386309549584*^9, 3.8733863109108543`*^9}, {3.8733864155360613`*^9, 
   3.873386418840481*^9}, {3.873386512092091*^9, 3.873386517091261*^9}, {
   3.87338659735462*^9, 3.873386719402219*^9}, {3.873386830427062*^9, 
   3.873386830551495*^9}, {3.873386875357253*^9, 3.873386914495583*^9}, {
   3.873386980871353*^9, 3.873387036502774*^9}, 3.873387231122149*^9, 
   3.873387290233919*^9, {3.873387417356209*^9, 3.873387438938924*^9}, {
   3.873387603324741*^9, 3.873387605546571*^9}, {3.87338770361208*^9, 
   3.873387706854288*^9}, {3.873387785033352*^9, 3.873387792679472*^9}, {
   3.873387951162977*^9, 3.873387953936849*^9}, {3.8734352095139217`*^9, 
   3.873435227302672*^9}, {3.873443079257266*^9, 3.8734431501124277`*^9}, {
   3.873443185043664*^9, 3.873443270918099*^9}, {3.873443932374257*^9, 
   3.873443950608921*^9}, {3.8734439943675528`*^9, 3.873443994485764*^9}, {
   3.873444029615147*^9, 3.873444033034376*^9}, {3.873444132476988*^9, 
   3.873444152135483*^9}, {3.873444262029603*^9, 3.873444285866397*^9}, {
   3.873444450472705*^9, 3.873444607933723*^9}, {3.873444637966737*^9, 
   3.873444726012165*^9}, 3.8734448173676653`*^9, {3.873445432162872*^9, 
   3.873445475605847*^9}, {3.873445589047042*^9, 3.87344573372485*^9}, {
   3.8734458791898594`*^9, 3.873445881963679*^9}, {3.8734465411771803`*^9, 
   3.87344655782487*^9}, {3.873446736421669*^9, 3.873446801760688*^9}, {
   3.873447077828095*^9, 3.87344708158961*^9}, {3.873521790043971*^9, 
   3.873521869927997*^9}, {3.87352190469071*^9, 3.87352194315696*^9}, {
   3.8735221638354683`*^9, 3.8735221642205153`*^9}, {3.8735223501620092`*^9, 
   3.873522350320283*^9}, {3.873532301077057*^9, 3.873532314983636*^9}, {
   3.873532348581532*^9, 3.873532350747681*^9}, {3.873532404496175*^9, 
   3.87353240672902*^9}, {3.87353249105299*^9, 3.87353249141269*^9}, {
   3.873536210818317*^9, 3.873536221292549*^9}, {3.873540445582055*^9, 
   3.873540752284154*^9}, {3.873540985586049*^9, 3.873540985987513*^9}, {
   3.873541504862449*^9, 3.873541528214989*^9}, {3.873541568949888*^9, 
   3.873541572752889*^9}, {3.873541618620403*^9, 3.873541619113285*^9}, {
   3.873542093865754*^9, 3.873542094026926*^9}, {3.873542129256746*^9, 
   3.873542129344502*^9}, {3.8735421767885013`*^9, 3.873542176826293*^9}, {
   3.873542309860053*^9, 3.873542309989377*^9}, {3.873542363284574*^9, 
   3.873542363409121*^9}, {3.873542481733224*^9, 3.873542510738567*^9}, {
   3.873542546011333*^9, 3.873542546064932*^9}, {3.87354261653633*^9, 
   3.873542690581764*^9}, {3.8735427670036917`*^9, 3.873542767060018*^9}, {
   3.873542804516057*^9, 3.873542805745706*^9}, {3.873704158411182*^9, 
   3.873704162134703*^9}, {3.8737044048772984`*^9, 3.873704434685581*^9}, {
   3.8737047143523207`*^9, 3.87370471620119*^9}, {3.873704755170008*^9, 
   3.873704755387621*^9}, {3.873704787668165*^9, 3.873704828477019*^9}, {
   3.873704887153864*^9, 3.873704887483429*^9}, {3.8737049261108723`*^9, 
   3.873704942659637*^9}, 3.8737049991028223`*^9, {3.873705172467882*^9, 
   3.873705179777847*^9}, {3.873705252596001*^9, 3.87370525783512*^9}, {
   3.873705297165678*^9, 3.873705338695337*^9}, {3.873705416619129*^9, 
   3.873705425630271*^9}, {3.87370562560017*^9, 3.873705683462313*^9}, {
   3.8737057216624546`*^9, 3.873705745373979*^9}, {3.873705787895039*^9, 
   3.8737057908514237`*^9}, {3.873705940227469*^9, 3.873705959527706*^9}, {
   3.873707171525931*^9, 3.873707256202244*^9}, {3.87370740178293*^9, 
   3.873707413004961*^9}, {3.873707473673554*^9, 3.8737074760345097`*^9}, {
   3.873707624488782*^9, 3.8737076261376*^9}, {3.873707692771713*^9, 
   3.873707697041439*^9}, {3.873707808470051*^9, 3.873707808650916*^9}, {
   3.873707869656054*^9, 3.873707870070052*^9}, {3.873708086448899*^9, 
   3.873708143723071*^9}, {3.873708183693735*^9, 3.87370822490129*^9}, {
   3.873708345036858*^9, 3.873708345168284*^9}, {3.8737088976435833`*^9, 
   3.873708918113474*^9}, {3.873708951841372*^9, 3.873708952890585*^9}, {
   3.8737089903689327`*^9, 3.873708991017507*^9}, {3.87370923438066*^9, 
   3.873709234502982*^9}, {3.873709276730397*^9, 3.873709276927443*^9}, {
   3.873709312865969*^9, 3.873709313432867*^9}, {3.873709373048411*^9, 
   3.873709374091464*^9}, {3.8737094373812304`*^9, 3.873709470117168*^9}, {
   3.873709506857611*^9, 3.873709531635229*^9}, {3.873709569555932*^9, 
   3.873709602904765*^9}, {3.87370974608241*^9, 3.873709747054133*^9}, {
   3.8737098164566393`*^9, 3.873709816744893*^9}, {3.873716764999338*^9, 
   3.8737167735458393`*^9}, {3.873716957924552*^9, 3.8737169630296*^9}, {
   3.8737170090542383`*^9, 3.8737170092076883`*^9}, {3.873717060944337*^9, 
   3.873717068378866*^9}, {3.8737171760005417`*^9, 3.873717176125722*^9}, {
   3.873717246057859*^9, 3.8737172463703547`*^9}, {3.873717328747707*^9, 
   3.873717357662152*^9}, {3.8737174015272417`*^9, 3.873717527572821*^9}, {
   3.87371760070166*^9, 3.873717602937327*^9}, {3.873717640421558*^9, 
   3.873717672725871*^9}, {3.873717714579773*^9, 3.873717716644027*^9}, {
   3.87371778331434*^9, 3.873717785317603*^9}, {3.873719269917253*^9, 
   3.8737193985962753`*^9}, {3.873719432362977*^9, 3.873719442971439*^9}, {
   3.873719473145765*^9, 3.873719517420863*^9}, {3.87371956086424*^9, 
   3.873719575892421*^9}, {3.873720144241534*^9, 3.8737201473497972`*^9}, {
   3.873720180689208*^9, 3.873720304829755*^9}, {3.873730249558449*^9, 
   3.8737302500705156`*^9}, {3.873730483852532*^9, 3.87373048459696*^9}, {
   3.873730521943986*^9, 3.8737305525429993`*^9}, {3.873730599147629*^9, 
   3.8737306244672403`*^9}, {3.873730725218842*^9, 3.873730739901509*^9}, {
   3.873730870601598*^9, 3.873730899772275*^9}, {3.873731012926404*^9, 
   3.873731066590592*^9}, {3.873731098530447*^9, 3.87373110043044*^9}, {
   3.873731215159075*^9, 3.873731215481717*^9}, {3.873731255011237*^9, 
   3.8737312592353916`*^9}, {3.873731299564954*^9, 3.873731313448468*^9}, {
   3.8737313880060797`*^9, 3.8737314087736*^9}, {3.873731465234994*^9, 
   3.873731520472202*^9}, {3.8737316359211607`*^9, 3.873731636330587*^9}, {
   3.87373167319978*^9, 3.873731674714621*^9}, {3.873731706648079*^9, 
   3.87373171768807*^9}, {3.873731797905844*^9, 3.873731798598255*^9}, {
   3.8737318468049393`*^9, 3.873731847965033*^9}, {3.873731967875914*^9, 
   3.873731973586772*^9}, {3.8737320779541893`*^9, 3.873732078953207*^9}, {
   3.8737321098484893`*^9, 3.87373212926855*^9}, {3.873732188240809*^9, 
   3.8737322160818243`*^9}, {3.873732254512391*^9, 3.873732293678485*^9}, {
   3.873732390685613*^9, 3.873732391025402*^9}, {3.873732467437949*^9, 
   3.873732504186379*^9}, {3.873732552718923*^9, 3.873732558447638*^9}, {
   3.873732688418928*^9, 3.873732736909958*^9}, {3.873732820029551*^9, 
   3.873732843845615*^9}, {3.873732894696141*^9, 3.873732900410933*^9}, {
   3.8737331444455013`*^9, 3.873733145769126*^9}, {3.873733194220615*^9, 
   3.873733231192044*^9}, {3.873733453308414*^9, 3.873733455701154*^9}, {
   3.873733509706088*^9, 3.873733515669777*^9}, {3.873733570770947*^9, 
   3.873733597363108*^9}, {3.873733644600859*^9, 3.873733650190594*^9}, {
   3.873777765971036*^9, 3.873777800931931*^9}, {3.873777845379158*^9, 
   3.87377785117083*^9}, {3.873777953992631*^9, 3.873777998601641*^9}, {
   3.873778178450327*^9, 3.873778179742261*^9}, {3.873778240636685*^9, 
   3.873778241735983*^9}, 3.873778283464538*^9, {3.873778853874364*^9, 
   3.87377892074786*^9}, {3.873779102813623*^9, 3.873779108879593*^9}, {
   3.873779161440688*^9, 3.873779161484864*^9}, 3.873779215191439*^9, {
   3.873779964944939*^9, 3.873779985057282*^9}, {3.873780085124999*^9, 
   3.873780087099896*^9}, {3.873786511095632*^9, 3.8737865220796556`*^9}, {
   3.873786552978094*^9, 3.873786588125111*^9}, {3.8737875680514603`*^9, 
   3.873787595933585*^9}, {3.87378770853725*^9, 3.873787708780367*^9}, {
   3.873787751935987*^9, 3.873787789213035*^9}, {3.873788056884252*^9, 
   3.873788095674796*^9}, {3.873790554508568*^9, 3.873790557566522*^9}, {
   3.873790628032863*^9, 3.8737906711562643`*^9}, 3.873793738156394*^9, {
   3.873802628967481*^9, 3.8738026356986055`*^9}, {3.8738028633330626`*^9, 
   3.873802864176794*^9}, {3.873802911120187*^9, 3.8738029148125873`*^9}, {
   3.873803044034139*^9, 3.873803044350628*^9}, {3.873803201204869*^9, 
   3.873803237048079*^9}, {3.873803290488361*^9, 3.873803291734705*^9}, {
   3.87380340503171*^9, 3.873803420676792*^9}, {3.8738038440081387`*^9, 
   3.873803887271284*^9}, {3.87380392771889*^9, 3.87380395650869*^9}, {
   3.873804071662975*^9, 3.873804109521666*^9}, 3.873804378835538*^9, 
   3.8738044406305203`*^9, {3.873804519982588*^9, 3.8738045205295477`*^9}, {
   3.873804569079838*^9, 3.8738045773910856`*^9}, {3.873804617241562*^9, 
   3.873804618161907*^9}, {3.873804748604499*^9, 3.873804766829073*^9}, {
   3.873804802755072*^9, 3.873804806380277*^9}, {3.8738048410252438`*^9, 
   3.873804853067714*^9}, {3.8738050035012684`*^9, 3.873805009036831*^9}, 
   3.873805115218974*^9, 3.873805196587496*^9, {3.8738083510016117`*^9, 
   3.873808353595361*^9}, {3.873808384484515*^9, 3.87380838537514*^9}, {
   3.873808443757231*^9, 3.873808453407551*^9}, {3.8738085066160383`*^9, 
   3.8738085886340847`*^9}, {3.8738088052415123`*^9, 3.873808829802955*^9}, 
   3.873808859832529*^9, {3.873808937452224*^9, 3.8738090160222397`*^9}, {
   3.873809083188949*^9, 3.873809083767074*^9}, {3.873809234426704*^9, 
   3.873809234770367*^9}, {3.8738093427412877`*^9, 3.873809366296574*^9}, {
   3.873809449599975*^9, 3.873809464415246*^9}, {3.87380952354075*^9, 
   3.873809523681256*^9}, {3.87380962063961*^9, 3.873809673984127*^9}, {
   3.873809775228259*^9, 3.873809775893405*^9}, 3.8738099475258265`*^9, {
   3.873809993499097*^9, 3.873810007838518*^9}, 3.873810045317833*^9, {
   3.8738102588579874`*^9, 3.873810258936091*^9}, {3.8738103724290347`*^9, 
   3.873810377678517*^9}, {3.873873864774091*^9, 3.8738738677021265`*^9}, {
   3.873873975949299*^9, 3.8738739773615475`*^9}, {3.8738772808382397`*^9, 
   3.8738772860559688`*^9}, {3.873883069594016*^9, 3.8738830924943433`*^9}, {
   3.873883393385705*^9, 3.873883401883706*^9}, {3.8738945280787773`*^9, 
   3.8738945314352283`*^9}, 3.873904461069008*^9, {3.8739052397810183`*^9, 
   3.873905241895392*^9}, {3.873905338514763*^9, 3.873905340824732*^9}, {
   3.8739053789195013`*^9, 3.8739053829508553`*^9}, {3.8739054791120977`*^9, 
   3.873905480877745*^9}, {3.873905523749568*^9, 3.873905529115012*^9}, {
   3.873905572086133*^9, 3.8739055746486597`*^9}, {3.873905706316983*^9, 
   3.8739057064350643`*^9}, 3.8739059455015755`*^9, {3.873906173984324*^9, 
   3.873906184296131*^9}, {3.873906274752007*^9, 3.873906300802444*^9}, 
   3.873906355917425*^9, {3.873906413121883*^9, 3.873906414048589*^9}, 
   3.8739064470106597`*^9, {3.8739094015910587`*^9, 3.873909424836804*^9}, {
   3.8739095196851587`*^9, 3.873909588412182*^9}, {3.873909689630793*^9, 
   3.873909690166674*^9}, {3.8739097262342*^9, 3.8739097264746847`*^9}, {
   3.873909764259169*^9, 3.873909798405421*^9}, {3.8739098800029817`*^9, 
   3.8739098904684467`*^9}, {3.8739099998341637`*^9, 
   3.8739100013821716`*^9}, {3.8739100489420395`*^9, 3.873910130991587*^9}, {
   3.873910295189952*^9, 3.873910365614831*^9}, {3.873910402477476*^9, 
   3.8739104130827565`*^9}, {3.873910448612497*^9, 3.873910456841086*^9}, {
   3.8739105051575007`*^9, 3.873910524000511*^9}, {3.87391057279097*^9, 
   3.8739105750271277`*^9}, {3.873910606131189*^9, 3.873910609515549*^9}, {
   3.873957013655764*^9, 3.8739570383205614`*^9}, {3.873957091155773*^9, 
   3.873957232573769*^9}, {3.8739601634508243`*^9, 3.873960210895798*^9}, {
   3.873960316996834*^9, 3.8739603353685203`*^9}, {3.873960415675997*^9, 
   3.873960421201221*^9}, {3.8739604769117317`*^9, 3.873960481191203*^9}, {
   3.873973901775226*^9, 3.873973912571744*^9}, {3.8739743590061502`*^9, 
   3.8739743686745586`*^9}, {3.8739744042653413`*^9, 
   3.8739744045961957`*^9}, {3.8739744438736544`*^9, 3.873974451169321*^9}, {
   3.873974565174471*^9, 3.873974598797803*^9}, {3.873974631771854*^9, 
   3.8739746339479704`*^9}, {3.873974726426205*^9, 3.8739747264642024`*^9}, {
   3.8739747801323442`*^9, 3.8739748093917637`*^9}, {3.873974842088657*^9, 
   3.873974863173843*^9}, {3.873975587727303*^9, 3.8739756026605268`*^9}, {
   3.873975707467035*^9, 3.873975711581343*^9}, {3.8739757543815746`*^9, 
   3.8739757727385645`*^9}, {3.873975854696038*^9, 3.873975856835027*^9}, {
   3.873976164107226*^9, 3.873976164191225*^9}, {3.873976206168029*^9, 
   3.8739762400421095`*^9}, {3.873976347640157*^9, 3.873976351273704*^9}, 
   3.873976418928842*^9, {3.8739764757236853`*^9, 3.873976580733819*^9}, {
   3.873976619249176*^9, 3.873976619820928*^9}, {3.8739768626689653`*^9, 
   3.8739768798512955`*^9}, 3.87397691002679*^9, {3.873976943359825*^9, 
   3.8739769460546665`*^9}, {3.873977009016075*^9, 3.873977011597545*^9}, 
   3.873988898792489*^9, {3.8740508982512937`*^9, 3.874050901656914*^9}, {
   3.874066395709298*^9, 3.874066397846445*^9}, {3.874066449989045*^9, 
   3.8740665042082787`*^9}, {3.874066559185174*^9, 3.874066559310226*^9}, {
   3.874066602001567*^9, 3.874066604213601*^9}, {3.874066698936287*^9, 
   3.874066699087453*^9}, {3.874066761555425*^9, 3.874066762334263*^9}, {
   3.874066959000178*^9, 3.874066968906625*^9}, {3.8740670079589243`*^9, 
   3.874067068841653*^9}, {3.8740671494256783`*^9, 3.874067203899468*^9}, {
   3.874067747771429*^9, 3.874067762656203*^9}, {3.874070904378295*^9, 
   3.874070906161617*^9}, {3.874753854161637*^9, 3.874753857778446*^9}, {
   3.874936434801871*^9, 3.874936474330879*^9}, {3.874937471045633*^9, 
   3.8749374721443276`*^9}, {3.874937950271664*^9, 3.874937966222323*^9}, {
   3.874938069688221*^9, 3.874938095399208*^9}, {3.874938257610625*^9, 
   3.874938268193698*^9}, 3.874938300306198*^9, {3.8749383619566145`*^9, 
   3.8749383787534494`*^9}, {3.8749384457838564`*^9, 3.87493844779025*^9}, {
   3.874938511311202*^9, 3.874938716694501*^9}, {3.874938828699465*^9, 
   3.874938845086835*^9}, {3.874938891117566*^9, 3.8749389337773824`*^9}, {
   3.874938976475781*^9, 3.8749389767841344`*^9}, {3.8749390264101057`*^9, 
   3.874939028260503*^9}, {3.874939060407878*^9, 3.874939113414942*^9}, {
   3.874939152856944*^9, 3.874939205830593*^9}, {3.874939264637982*^9, 
   3.874939278236412*^9}, {3.874939370513848*^9, 3.874939444625781*^9}, {
   3.874939478216257*^9, 3.874939496239456*^9}, {3.8749395958811784`*^9, 
   3.874939597262452*^9}, {3.874939832022425*^9, 3.874939845044888*^9}, {
   3.874939876078869*^9, 3.874939878730387*^9}, {3.87493997451472*^9, 
   3.874939987065764*^9}, {3.8749400574396772`*^9, 3.874940086062042*^9}, {
   3.874940191744847*^9, 3.874940197576084*^9}, {3.874940306325243*^9, 
   3.874940337385485*^9}, {3.8749404133078604`*^9, 3.874940426008269*^9}, {
   3.87494053096803*^9, 3.874940532474069*^9}, {3.874987412238572*^9, 
   3.874987430038646*^9}, {3.874987687415037*^9, 3.874987690526118*^9}, {
   3.8749877548470592`*^9, 3.874987800198994*^9}, {3.874987855516386*^9, 
   3.874987859346356*^9}, {3.874987980762078*^9, 3.874988012830005*^9}, {
   3.874988249401902*^9, 3.8749882793345747`*^9}, {3.87498898241754*^9, 
   3.874988982733538*^9}, {3.8749890460411205`*^9, 3.874989046166119*^9}, {
   3.874989134384731*^9, 3.874989137775079*^9}, {3.874989170622765*^9, 
   3.874989189493551*^9}, {3.874989328362955*^9, 3.874989329190095*^9}, {
   3.874989404377227*^9, 3.874989404902226*^9}, {3.8749897276492786`*^9, 
   3.874989738502308*^9}, {3.874989779637325*^9, 3.874989790502288*^9}, {
   3.874994784550558*^9, 3.8749948330106664`*^9}, {3.8749949199178677`*^9, 
   3.874994923626865*^9}, {3.874995159918174*^9, 3.874995180699124*^9}, 
   3.874995255531311*^9, 3.874995430942369*^9, {3.8749955014378223`*^9, 
   3.87499553219817*^9}, {3.874995573438088*^9, 3.874995574682087*^9}, {
   3.874995887768733*^9, 3.8749958896180763`*^9}, {3.874996091431529*^9, 
   3.874996107762532*^9}, {3.8749962412905655`*^9, 3.874996315538701*^9}, {
   3.874999129420259*^9, 3.874999142905258*^9}, 3.875003263674052*^9, {
   3.8750036741703987`*^9, 3.875003695454048*^9}, {3.875005359617161*^9, 
   3.875005368069544*^9}, {3.8750060654325447`*^9, 3.87500608493373*^9}, {
   3.8750072608514805`*^9, 3.875007261392481*^9}, 3.87500730829926*^9, {
   3.875007403195832*^9, 3.875007408006977*^9}, 3.875007447226384*^9, {
   3.87500749057953*^9, 3.8750074928077374`*^9}, {3.875007785692427*^9, 
   3.8750077959999485`*^9}, {3.875008010081813*^9, 3.87500801941584*^9}, {
   3.8750080958581777`*^9, 3.87500810097497*^9}, {3.875008158322017*^9, 
   3.875008172879359*^9}, {3.8750084390266933`*^9, 3.875008442534398*^9}, {
   3.875010853513875*^9, 3.875010859461293*^9}, {3.875011343473158*^9, 
   3.8750113520459228`*^9}, {3.875011597600845*^9, 3.875011601028844*^9}, {
   3.875011825432048*^9, 3.8750118607812576`*^9}, {3.8750122320478277`*^9, 
   3.8750122506534624`*^9}, {3.8750124309525604`*^9, 3.87501243452456*^9}, {
   3.8750128644235373`*^9, 3.875012872917362*^9}, {3.8750247707416825`*^9, 
   3.875024778765681*^9}, {3.8750250025316825`*^9, 3.875025005897683*^9}, {
   3.875025055819682*^9, 3.8750250585466805`*^9}, {3.8750829318817983`*^9, 
   3.875082939565797*^9}, {3.875082971909356*^9, 3.8750830430224714`*^9}, {
   3.875112384711777*^9, 3.875112391646777*^9}, {3.875172787472792*^9, 
   3.875172794359376*^9}, 3.8751728704950247`*^9, {3.875186077416551*^9, 
   3.875186089416245*^9}, {3.875186241707172*^9, 3.875186245248641*^9}, {
   3.8752486528567686`*^9, 3.875248662648727*^9}, {3.8752547946627593`*^9, 
   3.87525480550072*^9}, {3.875255782212994*^9, 3.8752557856289177`*^9}, {
   3.8752558306362896`*^9, 3.875256089676626*^9}, {3.875256275693423*^9, 
   3.875256287724549*^9}, {3.875256331853304*^9, 3.875256340724626*^9}, {
   3.875256450229323*^9, 3.875256450348623*^9}, {3.875256532005314*^9, 
   3.875256532188417*^9}, {3.875256693380782*^9, 3.875256706108105*^9}, 
   3.875256754141704*^9, {3.8752568027505603`*^9, 3.875256805052764*^9}, {
   3.875256870165216*^9, 3.8752568890289874`*^9}, {3.875256985405048*^9, 
   3.8752569894052734`*^9}, {3.875257087421544*^9, 3.8752571254698143`*^9}, {
   3.875257575981114*^9, 3.875257580284028*^9}, {3.875257619789236*^9, 
   3.875257626909873*^9}, {3.875257686316244*^9, 3.8752578607563353`*^9}, {
   3.875257891316608*^9, 3.875257892045605*^9}, 3.875257935853547*^9, {
   3.87525848699665*^9, 3.875258531949032*^9}, {3.875259117373481*^9, 
   3.8752591185856433`*^9}, 3.8752591725559*^9, {3.875259297804418*^9, 
   3.875259304235726*^9}, 3.8752603725953684`*^9, {3.883032913005861*^9, 
   3.883032913430451*^9}, {3.88303295710555*^9, 3.8830329647569137`*^9}, {
   3.8830340012693233`*^9, 3.883034050580722*^9}, {3.883034119847967*^9, 
   3.883034156371804*^9}, {3.883034229968984*^9, 3.8830343019328957`*^9}, {
   3.88303434763556*^9, 3.8830344433408546`*^9}, {3.883034531514269*^9, 
   3.8830348749298577`*^9}, 3.883035169808509*^9, {3.883035213481571*^9, 
   3.8830352188082438`*^9}, {3.883035249231731*^9, 3.883035249331304*^9}, {
   3.883046528845073*^9, 3.8830466096077*^9}, {3.883047608365158*^9, 
   3.8830476177480803`*^9}, {3.883047692799923*^9, 3.88304769534812*^9}, {
   3.8830713281185055`*^9, 3.883071454482224*^9}, {3.883114745354555*^9, 
   3.8831147622029667`*^9}, {3.883123075148616*^9, 3.883123121471855*^9}, {
   3.883653729315659*^9, 3.883653742428667*^9}, {3.8836538284730587`*^9, 
   3.883653867047914*^9}, {3.883653900823347*^9, 3.883654071851641*^9}, {
   3.8836543795295343`*^9, 3.883654387270361*^9}, 3.8836546044989233`*^9, {
   3.8836547179858108`*^9, 3.883654723685148*^9}, {3.883654756644251*^9, 
   3.883654795720151*^9}, {3.883654829917406*^9, 3.8836548579054756`*^9}, {
   3.88365522714219*^9, 3.883655228732923*^9}, {3.883655263171198*^9, 
   3.883655297122122*^9}, {3.883655519700108*^9, 3.883655521308618*^9}, {
   3.883655658394504*^9, 3.883655667627423*^9}, 3.883655809862085*^9, 
   3.883655847362583*^9, 3.883655881001246*^9, {3.883656074574547*^9, 
   3.8836561310122337`*^9}, {3.88366955222254*^9, 3.883669561013431*^9}, {
   3.8990220744202*^9, 3.899022264993869*^9}, {3.8990223362591066`*^9, 
   3.899022337592333*^9}, {3.899022399177955*^9, 3.8990223993457785`*^9}, {
   3.899022443755113*^9, 3.8990224456406913`*^9}, {3.89902254935683*^9, 
   3.899022551190521*^9}, {3.899023246218983*^9, 3.899023257930708*^9}, {
   3.899023412216826*^9, 3.899023580953616*^9}, {3.8990243070483885`*^9, 
   3.8990243074233727`*^9}, {3.8990251903346386`*^9, 
   3.8990251999424725`*^9}, {3.8990263446087*^9, 3.8990263548414*^9}, {
   3.899097010210582*^9, 3.8990970292466173`*^9}, {3.899731837891063*^9, 
   3.899731861585259*^9}, {3.8997319401827855`*^9, 3.8997319760615897`*^9}, {
   3.899732235052069*^9, 3.899732247709363*^9}, {3.8997323250926447`*^9, 
   3.899732329213947*^9}, {3.8997324272270193`*^9, 3.899732438164561*^9}, {
   3.899732470416758*^9, 3.899732493692398*^9}, {3.899732584447251*^9, 
   3.8997325848500147`*^9}, {3.899732806032569*^9, 3.8997328120552683`*^9}, {
   3.8998072422487407`*^9, 3.89980724745741*^9}, {3.9001525462084017`*^9, 
   3.9001525517615647`*^9}, {3.924607826263686*^9, 3.924607827494034*^9}, {
   3.937827621815571*^9, 3.937827626122617*^9}, {3.937827701350865*^9, 
   3.937827714591803*^9}, {3.961219142919794*^9, 3.961219153792078*^9}, {
   3.9612191939191933`*^9, 3.961219221597273*^9}, {3.961219278956479*^9, 
   3.961219302760756*^9}, {3.961229857208181*^9, 3.961229861695484*^9}, {
   3.961229982145238*^9, 3.961230293322219*^9}, {3.961231710455007*^9, 
   3.9612320595366287`*^9}, {3.9612326138100643`*^9, 3.961232636705469*^9}, {
   3.961255280823895*^9, 3.961255300694458*^9}, {3.961255417599019*^9, 
   3.961255423190271*^9}, {3.961255483043853*^9, 3.961255483495234*^9}, 
   3.961403426912539*^9, {3.961498299213065*^9, 3.96149830007362*^9}, {
   3.9614983362976713`*^9, 3.9614983368055162`*^9}, {3.961498554139361*^9, 
   3.9614985987349453`*^9}, {3.9614986340165358`*^9, 
   3.9614986700150013`*^9}, {3.961498793491947*^9, 3.9614988127177277`*^9}, {
   3.961498999922317*^9, 3.9614991545907173`*^9}, {3.961499374628263*^9, 
   3.961499391575699*^9}, {3.961499430496072*^9, 3.9614994446920013`*^9}, {
   3.961499573979363*^9, 3.961499588583624*^9}, {3.961499865660927*^9, 
   3.9614999148380423`*^9}, {3.9615000527376833`*^9, 3.961500055325041*^9}, 
   3.96150023238209*^9, {3.961500326518448*^9, 3.961500334236714*^9}, {
   3.961500591942634*^9, 3.9615006197508907`*^9}, {3.961500666316099*^9, 
   3.9615007347449408`*^9}, {3.961500770606268*^9, 3.961500780303047*^9}, {
   3.961500820370483*^9, 3.961500829703862*^9}, {3.961506527403632*^9, 
   3.961506536003973*^9}, {3.961506899604649*^9, 3.961506925727128*^9}, {
   3.961507934557682*^9, 3.961507953595334*^9}, {3.961507995383279*^9, 
   3.961507995529502*^9}, {3.9615080564240437`*^9, 3.961508131189406*^9}, {
   3.961508165616149*^9, 3.961508243217012*^9}, {3.961508404384646*^9, 
   3.961508416324264*^9}, {3.961508780667622*^9, 3.9615087880183907`*^9}, {
   3.961508834367313*^9, 3.961508845520268*^9}, 3.9615088977275457`*^9, {
   3.9615089481010942`*^9, 3.961508959566831*^9}, {3.9615090141386623`*^9, 
   3.961509028932764*^9}, {3.961509066622368*^9, 3.961509153399796*^9}, {
   3.9615091881062803`*^9, 3.96150922652661*^9}, {3.961509266921907*^9, 
   3.9615092798604507`*^9}, {3.961509588011685*^9, 3.961509594598625*^9}, {
   3.9615096806244926`*^9, 3.961509711393409*^9}, {3.9615101329914923`*^9, 
   3.961510146032778*^9}},
 CellLabel->
  "In[218]:=",ExpressionUUID->"4a21cd9d-ef0a-427a-a954-57c2c4c3eeed"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "som"}], " ", "SOM", " ", "grid"}]}], ",", 
    RowBox[{
     RowBox[{"-", "weights"}], " ", "weight", " ", "matrix"}], ",", 
    RowBox[{
     RowBox[{"-", "bmus"}], " ", "best", " ", "matching", " ", "units"}], ",", 
    RowBox[{
     RowBox[{"-", "inputN"}], " ", "input", " ", "vectors"}], ",", 
    RowBox[{
     RowBox[{"-", "ite"}], " ", "iteration", " ", "number"}], ",", 
    RowBox[{
     RowBox[{"-", "start"}], " ", "initial", " ", "radius"}], ",", 
    RowBox[{
     RowBox[{"-", "sig"}], " ", "learning", " ", "rate"}], ",", 
    RowBox[{
     RowBox[{"-", "errorStop"}], " ", "QE", " ", "threshold"}], ",", 
    RowBox[{
     RowBox[{"-", "colorScheme"}], " ", "color", " ", "scheme"}], ",", 
    RowBox[{
     RowBox[{"-", "qEList"}], " ", "Quantization", " ", "Error", " ", 
     RowBox[{"(", "QE", ")"}], " ", "history"}], ",", 
    RowBox[{
     RowBox[{"-", "qENList"}], " ", "normalized", " ", "QE", " ", "history"}],
     ",", 
    RowBox[{
     RowBox[{"-", "tEList"}], " ", "topographic", " ", "error", " ", 
     "history"}], ",", 
    RowBox[{
     RowBox[{"-", "lRList"}], " ", "learning", " ", "rate", " ", "history"}], 
    ",", 
    RowBox[{
     RowBox[{"-", "quantizationError"}], " ", "current", " ", "QE"}], ",", 
    RowBox[{
     RowBox[{"-", "topographicError"}], " ", "current", " ", "TE"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "statVisibility"}], " ", "flag"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "with", " ", "rendered", " ", "visual", 
       " ", "stats", " ", "and", " ", "plots"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Computes", " ", "and", " ", "returns", " ", "SOM", " ", "training", 
       " ", "visualizations", " ", "and", " ", "stats", " ", "for", " ", 
       "monitoring", " ", "and", " ", 
       RowBox[{"dashboards", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"SomDashboard", "[", 
    RowBox[{
    "som_", ",", "weights_", ",", "bmus_", ",", "inputN_", ",", "ite_", ",", 
     "start_", ",", "sig_", ",", "errorStop_", ",", "colorScheme_", ",", 
     "qEList_", ",", "qENList_", ",", "tEList_", ",", "lRList_", ",", 
     "quantizationError_", ",", "topographicError_", ",", " ", 
     "statVisibility_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "infoIte", ",", "infoQE", ",", "infoQET", ",", "infoTE", ",", "infoLR", 
       ",", "infoLRP", ",", "renderRGB", ",", "renderPCA", ",", "renderPCAcs",
        ",", "renderTSNE", ",", "renderTSNEcs", ",", "renderMean", ",", 
       "renderUM", ",", "plotQE", ",", "plotTE", ",", "plotLR", ",", 
       "plotQEN"}], "}"}], ",", "\n", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"infoIte", "=", 
       RowBox[{"StringJoin", "@", 
        RowBox[{"{", 
         RowBox[{"\"\<Iteration: \>\"", ",", " ", 
          RowBox[{"ToString", "@", 
           RowBox[{"First", "@", "ite"}]}], ",", " ", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "ite", "]"}], "==", "2"}], ",", 
            RowBox[{"\"\</\>\"", "<>", 
             RowBox[{"ToString", "@", 
              RowBox[{"ite", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], ",", "\"\<\>\""}], "]"}]}],
          "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"infoQE", "=", 
       RowBox[{"StringJoin", "@", 
        RowBox[{"{", 
         RowBox[{"\"\<Quantization Error: \>\"", ",", 
          RowBox[{"ToString", "@", 
           RowBox[{"N", "[", 
            RowBox[{"quantizationError", ",", "5"}], "]"}]}]}], "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"infoQET", "=", 
       RowBox[{"StringJoin", "@", 
        RowBox[{"{", 
         RowBox[{"\"\<QE Threshold: \>\"", ",", 
          RowBox[{"ToString", "@", 
           RowBox[{"N", "[", 
            RowBox[{"errorStop", ",", "5"}], "]"}]}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"infoTE", "=", 
       RowBox[{"StringJoin", "@", 
        RowBox[{"{", 
         RowBox[{"\"\<Topographic Error: \>\"", ",", 
          RowBox[{"ToString", "@", 
           RowBox[{"N", "[", 
            RowBox[{"topographicError", ",", "5"}], "]"}]}]}], "}"}]}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"infoLR", "=", 
       RowBox[{"StringJoin", "@", 
        RowBox[{"{", 
         RowBox[{"\"\<Learning Rate: \>\"", ",", 
          RowBox[{"ToString", "@", 
           RowBox[{"N", "[", 
            RowBox[{"sig", ",", "5"}], "]"}]}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"renderRGB", "=", 
       RowBox[{"Image", "[", 
        RowBox[{
         RowBox[{"ArrayReshape", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"RGBColor", "[", 
              RowBox[{"#", "[", 
               RowBox[{"[", 
                RowBox[{";;", "3"}], "]"}], "]"}], "]"}], "&"}], "/@", 
            "weights"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"som", "[", 
              RowBox[{"\"\<dimensions\>\"", ",", "\"\<y\>\""}], "]"}], ",", 
             RowBox[{"som", "[", 
              RowBox[{"\"\<dimensions\>\"", ",", "\"\<x\>\""}], "]"}]}], 
            "}"}]}], "]"}], ",", 
         RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
         RowBox[{"ColorSpace", "\[Rule]", "\"\<RGB\>\""}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"renderPCA", "=", 
       RowBox[{"Image", "[", 
        RowBox[{
         RowBox[{"ArrayReshape", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"RGBColor", "[", "#", "]"}], "&"}], "/@", 
            RowBox[{"Normalize", "/@", 
             RowBox[{"DimensionReduce", "[", 
              RowBox[{"weights", ",", "3", ",", 
               RowBox[{
               "Method", "->", "\"\<PrincipalComponentsAnalysis\>\""}]}], 
              "]"}]}]}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"som", "[", 
              RowBox[{"\"\<dimensions\>\"", ",", "\"\<y\>\""}], "]"}], ",", 
             RowBox[{"som", "[", 
              RowBox[{"\"\<dimensions\>\"", ",", "\"\<x\>\""}], "]"}]}], 
            "}"}]}], "]"}], ",", 
         RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
         RowBox[{"ColorSpace", "\[Rule]", "\"\<RGB\>\""}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"renderTSNE", "=", 
       RowBox[{"Image", "[", 
        RowBox[{
         RowBox[{"ArrayReshape", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"RGBColor", "[", "#", "]"}], "&"}], "/@", 
            RowBox[{"Normalize", "/@", 
             RowBox[{"DimensionReduce", "[", 
              RowBox[{"weights", ",", "3", ",", 
               RowBox[{"Method", "->", "\"\<TSNE\>\""}]}], "]"}]}]}], ",", 
           " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"som", "[", 
              RowBox[{"\"\<dimensions\>\"", ",", "\"\<y\>\""}], "]"}], ",", 
             RowBox[{"som", "[", 
              RowBox[{"\"\<dimensions\>\"", ",", "\"\<x\>\""}], "]"}]}], 
            "}"}]}], "]"}], ",", 
         RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
         RowBox[{"ColorSpace", "\[Rule]", "\"\<RGB\>\""}]}], "]"}]}], ";", 
      RowBox[{"renderUM", "=", 
       RowBox[{
        RowBox[{"CalculateUMatrix", "[", 
         RowBox[{"som", ",", "weights", ",", "colorScheme"}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"renderMean", "=", 
       RowBox[{"Image", "[", 
        RowBox[{
         RowBox[{"ArrayReshape", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ColorData", "[", "colorScheme", "]"}], "[", "#", "]"}],
              "&"}], "/@", 
            RowBox[{"Rescale", "[", 
             RowBox[{"Re", "@", 
              RowBox[{"Mean", "@", 
               RowBox[{"Transpose", "[", 
                RowBox[{"Normalize", "/@", "weights"}], "]"}]}]}], "]"}]}], 
           ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"som", "[", 
              RowBox[{"\"\<dimensions\>\"", ",", "\"\<y\>\""}], "]"}], ",", 
             RowBox[{"som", "[", 
              RowBox[{"\"\<dimensions\>\"", ",", "\"\<x\>\""}], "]"}]}], 
            "}"}]}], "]"}], ",", 
         RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
         RowBox[{"ColorSpace", "\[Rule]", "\"\<RGB\>\""}]}], "]"}]}], ";", 
      "\n", "\[IndentingNewLine]", 
      RowBox[{"plotQE", "=", 
       RowBox[{"ListLinePlot", "[", 
        RowBox[{"qEList", ",", 
         RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
         RowBox[{"Axes", "\[Rule]", "True"}], ",", 
         RowBox[{"LabelingSize", "\[Rule]", "0.1"}], ",", 
         RowBox[{"Ticks", "\[Rule]", "True"}], ",", 
         RowBox[{"TicksStyle", "\[Rule]", 
          RowBox[{"Directive", "[", 
           RowBox[{"Black", ",", "8"}], "]"}]}], ",", 
         RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
         RowBox[{"PlotStyle", "\[Rule]", 
          RowBox[{"{", "Black", "}"}]}], ",", 
         RowBox[{"PlotRange", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", 
              RowBox[{"First", "@", "ite"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plotQEN", "=", 
       RowBox[{"ListLinePlot", "[", 
        RowBox[{"qENList", ",", 
         RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
         RowBox[{"Axes", "\[Rule]", "True"}], ",", 
         RowBox[{"LabelingSize", "\[Rule]", "0.1"}], ",", 
         RowBox[{"Ticks", "\[Rule]", "True"}], ",", 
         RowBox[{"TicksStyle", "\[Rule]", 
          RowBox[{"Directive", "[", 
           RowBox[{"Black", ",", "8"}], "]"}]}], ",", 
         RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
         RowBox[{"PlotStyle", "\[Rule]", 
          RowBox[{"{", "Black", "}"}]}], ",", 
         RowBox[{"PlotRange", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", 
              RowBox[{"First", "@", "ite"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plotTE", "=", 
       RowBox[{"ListLinePlot", "[", 
        RowBox[{"tEList", ",", 
         RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
         RowBox[{"Axes", "\[Rule]", "True"}], ",", 
         RowBox[{"LabelingSize", "\[Rule]", "0.1"}], ",", 
         RowBox[{"Ticks", "\[Rule]", "True"}], ",", 
         RowBox[{"TicksStyle", "\[Rule]", 
          RowBox[{"Directive", "[", 
           RowBox[{"Black", ",", "8"}], "]"}]}], ",", 
         RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
         RowBox[{"PlotStyle", "\[Rule]", 
          RowBox[{"{", "Black", "}"}]}], ",", 
         RowBox[{"PlotRange", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", 
              RowBox[{"First", "@", "ite"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}]}], "]"}]}], ";", 
      RowBox[{"plotLR", "=", 
       RowBox[{"ListLinePlot", "[", 
        RowBox[{"lRList", ",", 
         RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
         RowBox[{"Axes", "\[Rule]", "True"}], ",", 
         RowBox[{"LabelingSize", "\[Rule]", "0.1"}], ",", 
         RowBox[{"Ticks", "\[Rule]", "True"}], ",", 
         RowBox[{"TicksStyle", "\[Rule]", 
          RowBox[{"Directive", "[", 
           RowBox[{"Black", ",", "8"}], "]"}]}], ",", 
         RowBox[{"AspectRatio", "\[Rule]", "1"}], ",", 
         RowBox[{"PlotStyle", "\[Rule]", 
          RowBox[{"{", "Black", "}"}]}], ",", 
         RowBox[{"PlotRange", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"1", ",", 
              RowBox[{"First", "@", "ite"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"statVisibility", "==", "\"\<Visible\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"StringRiffle", "[", 
           RowBox[{"{", 
            RowBox[{"infoIte", ",", "\[IndentingNewLine]", 
             RowBox[{"\"\<Quantization Error: \>\"", "<>", 
              RowBox[{"ToString", "@", 
               RowBox[{"N", "[", 
                RowBox[{"quantizationError", ",", "5"}], "]"}]}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"\"\<QE Threshold: \>\"", "<>", 
              RowBox[{"ToString", "@", 
               RowBox[{"N", "[", 
                RowBox[{"errorStop", ",", "5"}], "]"}]}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"\"\<Topographic Error: \>\"", "<>", 
              RowBox[{"ToString", "@", 
               RowBox[{"N", "[", 
                RowBox[{"topographicError", ",", "5"}], "]"}]}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"\"\<Learning Rate: \>\"", "<>", 
              RowBox[{"ToString", "@", 
               RowBox[{"N", "[", 
                RowBox[{"sig", ",", "5"}], "]"}]}]}]}], "}"}], "]"}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"Row", "[", 
           RowBox[{
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Column", "@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Text", "[", 
                  RowBox[{"Style", "[", 
                   RowBox[{"\"\<renderRGB\>\"", ",", "Black", ",", "8"}], 
                   "]"}], "]"}], ",", "renderRGB"}], "}"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Column", "@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Text", "[", 
                  RowBox[{"Style", "[", 
                   RowBox[{"\"\<renderMean\>\"", ",", "Black", ",", "8"}], 
                   "]"}], "]"}], ",", "renderMean"}], "}"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Column", "@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Text", "[", 
                  RowBox[{"Style", "[", 
                   RowBox[{"\"\<renderUM\>\"", ",", "Black", ",", "8"}], 
                   "]"}], "]"}], ",", "renderUM"}], "}"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Column", "@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Text", "[", 
                  RowBox[{"Style", "[", 
                   RowBox[{"\"\<plotQE\>\"", ",", "Black", ",", "8"}], "]"}], 
                  "]"}], ",", "plotQE"}], "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"Column", "@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Text", "[", 
                  RowBox[{"Style", "[", 
                   RowBox[{"\"\<plotTE\>\"", ",", "Black", ",", "8"}], "]"}], 
                  "]"}], ",", "plotTE"}], "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"Column", "@", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Text", "[", 
                  RowBox[{"Style", "[", 
                   RowBox[{"\"\<plotLR\>\"", ",", "Black", ",", "8"}], "]"}], 
                  "]"}], ",", "plotLR"}], "}"}]}]}], "\[IndentingNewLine]", 
             "}"}], ",", " ", 
            RowBox[{"Spacer", "[", "20", "]"}]}], "]"}], "]"}]}]}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
       "infoIte", ",", "infoQE", ",", "infoQET", ",", "infoTE", ",", "infoLR",
         ",", "renderRGB", ",", "renderPCA", ",", "renderTSNE", ",", 
        "renderMean", ",", "renderUM", ",", "plotQE", ",", "plotQEN", ",", 
        "plotTE", ",", "plotLR"}], "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.872738424873582*^9, 3.872738482599858*^9}, {
   3.8727385355068645`*^9, 3.872738657541343*^9}, {3.8727387142363515`*^9, 
   3.872738765260928*^9}, {3.872738851771412*^9, 3.872738853196969*^9}, {
   3.8727392543676004`*^9, 3.872739454909061*^9}, 3.872739687760745*^9, {
   3.872739906797675*^9, 3.872739934214498*^9}, {3.872741571491623*^9, 
   3.87274157184484*^9}, {3.872741973475137*^9, 3.872741982717077*^9}, 
   3.872742913437716*^9, 3.872753393717583*^9, 3.872754052411833*^9, {
   3.872765582049049*^9, 3.872765635311133*^9}, {3.8727658231198*^9, 
   3.872765981415339*^9}, {3.872767590280284*^9, 3.872767593367189*^9}, {
   3.872768544343586*^9, 3.8727685472719336`*^9}, {3.872768771950407*^9, 
   3.872768776398928*^9}, {3.8729153837201133`*^9, 3.8729153953999205`*^9}, {
   3.872915478392384*^9, 3.872915483840012*^9}, {3.8729155966021223`*^9, 
   3.872915602928151*^9}, {3.872920467818585*^9, 3.8729204711526318`*^9}, {
   3.8729244571102743`*^9, 3.872924497153649*^9}, {3.8729282381821795`*^9, 
   3.872928243097477*^9}, {3.872928683853438*^9, 3.872928689337535*^9}, {
   3.872930926150885*^9, 3.872930927417929*^9}, 3.872937199474516*^9, {
   3.872937377277337*^9, 3.872937489529397*^9}, {3.8735409084402847`*^9, 
   3.873540976250074*^9}, {3.873541711408197*^9, 3.873541711773793*^9}, {
   3.873541752396656*^9, 3.873541780896621*^9}, {3.8737188840483437`*^9, 
   3.873719024782271*^9}, 3.873730385246142*^9, {3.873777870015263*^9, 
   3.8737779418881598`*^9}, 3.87377810649841*^9, {3.873778147804317*^9, 
   3.873778149766335*^9}, {3.873778218170803*^9, 3.873778226644113*^9}, {
   3.873778876646549*^9, 3.873778877175333*^9}, {3.874753173106974*^9, 
   3.874753191669584*^9}, {3.874753246692425*^9, 3.874753324825966*^9}, {
   3.874753459708026*^9, 3.874753460366309*^9}, {3.874753601706001*^9, 
   3.874753620004197*^9}, {3.874753660176752*^9, 3.874753664531041*^9}, {
   3.874753704755543*^9, 3.874753706935508*^9}, {3.883046435598728*^9, 
   3.8830465056661053`*^9}, {3.883046618767014*^9, 3.8830466218613515`*^9}, {
   3.883047550758789*^9, 3.88304756136741*^9}, {3.883047827499261*^9, 
   3.883047832565136*^9}, {3.883123127918393*^9, 3.883123128481938*^9}, {
   3.899097047747129*^9, 3.899097064033051*^9}, {3.900152221914832*^9, 
   3.900152222508205*^9}, {3.900152258110774*^9, 3.9001522822996483`*^9}, {
   3.900152328761598*^9, 3.900152355852747*^9}, 3.900152395498975*^9, {
   3.900152428381482*^9, 3.900152429652956*^9}, {3.9001524782140408`*^9, 
   3.900152493209904*^9}, {3.90015258977125*^9, 3.900152614683834*^9}, {
   3.90032981702312*^9, 3.900329825635939*^9}, {3.900329887867134*^9, 
   3.900329889852243*^9}, {3.961219326212359*^9, 3.961219329032384*^9}, {
   3.961228016371614*^9, 3.961228018497308*^9}, {3.9612491649383993`*^9, 
   3.961249207278472*^9}},
 CellLabel->"In[44]:=",ExpressionUUID->"fb2b1856-844a-46bb-89c7-acc90ed9a60b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "data"}], " ", "dataset", " ", "entries"}]}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "somGrid"}], " ", "SOM", " ", "grid"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Association"}], " ", "with", " ", "kernel"}]}]}], ",", 
    RowBox[{"BMU", " ", "mapping"}], ",", 
    RowBox[{
     RowBox[{"and", " ", "sorted", " ", "event", " ", "groups"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Assigns", " ", "data", " ", "points", " ", "to", " ", "SOM", " ", 
       "cells"}]}]}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Informed", " ", "by", " ", "code", " ", "from", " ", "ETHZ", " ", 
     "CAAD"}], ",", " ", 
    RowBox[{"Salda\[NTilde]a", " ", "Ochoa"}], ",", " ", 
    RowBox[{
     RowBox[{"Karla", " ", "&"}], " ", "Zifeng"}], ",", " ", 
    RowBox[{"Guo", " ", 
     RowBox[{"(", "2020", ")"}]}], ",", 
    "\"\<Map & Models \[Dash] Self Organizing Maps\>\""}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"GetSOMList", "[", 
    RowBox[{"data_", ",", "somGrid_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"vecList", "=", 
        RowBox[{"data", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{"numCells", "=", 
        RowBox[{"somGrid", "[", 
         RowBox[{"\"\<dimensions\>\"", ",", "\"\<len\>\""}], "]"}]}], ",", 
       "bmus", ",", "indexGroups", ",", "eventGroups", ",", "grouped"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"bmus", "=", 
       RowBox[{"MapIndexed", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#2", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "->", 
           RowBox[{"First", "@", 
            RowBox[{"FindBMUs", "[", 
             RowBox[{"somGrid", ",", 
              RowBox[{"{", "#", "}"}]}], "]"}]}]}], "&"}], ",", "vecList"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"grouped", "=", 
       RowBox[{"GroupBy", "[", 
        RowBox[{"bmus", ",", 
         RowBox[{"Last", "->", "First"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"indexGroups", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Lookup", "[", 
          RowBox[{"grouped", ",", "c", ",", 
           RowBox[{"{", "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"c", ",", "numCells"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"eventGroups", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Extract", "[", 
           RowBox[{"data", ",", 
            RowBox[{"List", "/@", "#"}]}], "]"}], "&"}], ",", "indexGroups"}],
         "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<kernel\>\"", "->", "somGrid"}], ",", 
        RowBox[{"\"\<bmus\>\"", "->", "bmus"}], ",", 
        RowBox[{"\"\<eventListSorted\>\"", "->", "eventGroups"}]}], "]"}]}]}],
     "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.782981574204587*^9, 3.7829815775713053`*^9}, {
   3.7829816394920607`*^9, 3.782981710792522*^9}, {3.782981754658717*^9, 
   3.782981830186779*^9}, {3.7829818792170877`*^9, 3.7829818876935186`*^9}, {
   3.7829819255487194`*^9, 3.782982031431619*^9}, {3.7829820720369945`*^9, 
   3.7829821114491625`*^9}, {3.7829856264558773`*^9, 3.782985645738806*^9}, {
   3.7829874668435965`*^9, 3.7829874852758694`*^9}, {3.7829875501585393`*^9, 
   3.7829875502675343`*^9}, {3.782988989685704*^9, 3.7829890212890344`*^9}, {
   3.8735347199214773`*^9, 3.873534731212039*^9}, 3.873535174249283*^9, {
   3.8735362010877457`*^9, 3.873536201907625*^9}, {3.873536448880501*^9, 
   3.873536502966176*^9}, 3.873536819764241*^9, {3.882457195836142*^9, 
   3.882457198211376*^9}, {3.883147323550589*^9, 3.883147376075632*^9}, {
   3.8831510085175714`*^9, 3.8831510159575434`*^9}, {3.88315118706904*^9, 
   3.883151191259139*^9}, {3.899135964257786*^9, 3.8991359826065226`*^9}, {
   3.899136032014887*^9, 3.8991360327893324`*^9}, {3.8991360697987146`*^9, 
   3.899136077297741*^9}, {3.899137545557603*^9, 3.899137567268896*^9}, {
   3.919583506203187*^9, 3.919583524793511*^9}, {3.9195841647715063`*^9, 
   3.9195841652156544`*^9}, {3.9195863073890038`*^9, 3.9195863257440777`*^9}, 
   3.919587495244152*^9, {3.919587728249277*^9, 3.91958773144268*^9}, 
   3.961219335283615*^9, 3.961224572420286*^9, 3.961224691248324*^9, {
   3.961225949088036*^9, 3.96122594926783*^9}, {3.961225992698638*^9, 
   3.961226092400869*^9}, 3.961226269373683*^9, {3.961226407626494*^9, 
   3.96122641261404*^9}, {3.961226456559*^9, 3.9612264593910027`*^9}, 
   3.961226531911367*^9, {3.961226832888855*^9, 3.961226843020454*^9}, {
   3.961226873192869*^9, 3.961226884022945*^9}, {3.96122692021631*^9, 
   3.9612270020846643`*^9}, {3.96122705374926*^9, 3.961227055471868*^9}, {
   3.961227114497246*^9, 3.961227231941049*^9}, {3.961227275682242*^9, 
   3.961227282904037*^9}, {3.961232221299446*^9, 3.9612322466886578`*^9}, {
   3.9612325831174707`*^9, 3.961232600030267*^9}, {3.961232840083099*^9, 
   3.9612328533722897`*^9}, {3.9612550605329657`*^9, 
   3.9612550624514313`*^9}, {3.961255370612493*^9, 3.961255382925373*^9}, 
   3.961255532281654*^9, {3.961255592109153*^9, 3.9612556075797377`*^9}, 
   3.96125583103264*^9, {3.961256148822*^9, 3.9612561580480223`*^9}, {
   3.961256188673271*^9, 3.961256189276753*^9}},
 CellLabel->"In[45]:=",ExpressionUUID->"3e2cf556-e508-4eb4-a1c0-dc2504b140fa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Input", ":", 
       RowBox[{
        RowBox[{"-", "som"}], " ", "SOM", " ", "structure", " ", "with", " ", 
        "eventListSorted"}]}], ";", 
      RowBox[{"Output", ":", 
       RowBox[{
        RowBox[{"-", "Sorted"}], " ", "SOM", " ", "structure"}]}], ";", 
      RowBox[{"Description", ":", 
       RowBox[{
       "Orders", " ", "events", " ", "inside", " ", "each", " ", "SOM", " ", 
        "cell", " ", "by", " ", "increasing", " ", "Euclidean", " ", 
        "distance", " ", "to", " ", "the", " ", "cell"}]}]}], 
     "\[CloseCurlyQuote]"}], "s", " ", "weight", " ", 
    RowBox[{"vector", "."}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"SortSOMList", "[", "som_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "somDistances", ",", "somOrder", ",", "somOrdered", ",", "somSorted", 
       ",", "distances", ",", "order"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"somSorted", "=", "som"}], ";", "\[IndentingNewLine]", 
      RowBox[{"somDistances", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"EuclideanDistance", "[", 
            RowBox[{
             RowBox[{"som", "[", 
              RowBox[{"[", 
               RowBox[{"\"\<kernel\>\"", ",", "\"\<weights\>\"", ",", "j"}], 
               "]"}], "]"}], ",", 
             RowBox[{"som", "[", 
              RowBox[{"[", 
               RowBox[{
               "\"\<eventListSorted\>\"", ",", "j", ",", "i", ",", "1"}], 
               "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", 
              RowBox[{"som", "[", 
               RowBox[{"[", 
                RowBox[{"\"\<eventListSorted\>\"", ",", "j"}], "]"}], 
               "]"}]}]}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", 
           RowBox[{"Length", "@", 
            RowBox[{"som", "[", 
             RowBox[{"[", "\"\<eventListSorted\>\"", "]"}], "]"}]}]}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"somOrder", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Ordering", "@", 
          RowBox[{"somDistances", "[", 
           RowBox[{"[", "j", "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", 
           RowBox[{"Length", "@", 
            RowBox[{"som", "[", 
             RowBox[{"[", "\"\<eventListSorted\>\"", "]"}], "]"}]}]}], 
          "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"distances", "=", 
            RowBox[{"somDistances", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"order", "=", 
            RowBox[{"somOrder", "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"somSorted", "[", 
             RowBox[{"[", 
              RowBox[{"\"\<eventListSorted\>\"", ",", "j"}], "]"}], "]"}], 
            "=", 
            RowBox[{
             RowBox[{
              RowBox[{"som", "[", 
               RowBox[{"[", 
                RowBox[{"\"\<eventListSorted\>\"", ",", "j", ",", "#"}], 
                "]"}], "]"}], "&"}], "/@", "order"}]}], ";"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"Length", "@", 
             RowBox[{"som", "[", 
              RowBox[{"[", "\"\<eventListSorted\>\"", "]"}], "]"}]}]}], 
           "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"j", ",", "i"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "somSorted"}]}], "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.899376228446801*^9, 3.8993762962455564`*^9}, {
   3.8993848045513067`*^9, 3.899384833982382*^9}, 3.899384964957451*^9, {
   3.899385010171451*^9, 3.8993850104983263`*^9}, {3.899385055822875*^9, 
   3.899385062208951*^9}, {3.8993851355398855`*^9, 3.899385135965829*^9}, {
   3.89943981634524*^9, 3.89943990159359*^9}, {3.89943993253732*^9, 
   3.899440138288872*^9}, {3.899440226081324*^9, 3.899440310529269*^9}, {
   3.899440574970463*^9, 3.8994405836333475`*^9}, 3.899440720770089*^9, {
   3.899441645147942*^9, 3.89944165108902*^9}, {3.8994418241066885`*^9, 
   3.8994418246256876`*^9}, {3.8994438708167925`*^9, 
   3.8994438848402185`*^9}, {3.9612193453601847`*^9, 3.961219345692626*^9}, {
   3.9612322538917418`*^9, 3.9612322713879137`*^9}, {3.961232568396737*^9, 
   3.9612325741183968`*^9}, {3.961232819475945*^9, 3.961232831892234*^9}},
 CellLabel->"In[46]:=",ExpressionUUID->"6bf72eb1-6675-4ae3-9f3f-177d162e2d4b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "assoc"}], " ", "association", " ", "of", " ", 
      "associations"}]}], ";", 
    RowBox[{"Output", ":", 
     RowBox[{
      RowBox[{"-", "Flat"}], " ", "association", " ", "with", " ", "keys", 
      " ", "and", " ", "values", " ", "extracted", " ", "from", " ", "nested",
       " ", "associations"}]}], ";", 
    RowBox[{"Description", ":", 
     RowBox[{
     "Flattens", " ", "an", " ", "association", " ", "of", " ", 
      "associations", " ", "by", " ", "extracting", " ", "the", " ", "first", 
      " ", "key", " ", "and", " ", "first", " ", "value", " ", "from", " ", 
      "each", " ", "nested", " ", "pair", " ", "and", " ", "combining", " ", 
      "them", " ", "into", " ", "a", " ", "new", " ", 
      RowBox[{"association", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"FlattenAssociation", "[", "assoc_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"k", ",", "v"}], "}"}], ",", 
      RowBox[{
       RowBox[{"k", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{"Function", "@", 
           RowBox[{"First", "@", 
            RowBox[{"Keys", "@", "#"}]}]}], ",", "assoc"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"v", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{"Function", "@", 
           RowBox[{"First", "@", 
            RowBox[{"Values", "@", "#"}]}]}], ",", "assoc"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"AssociationThread", "[", 
        RowBox[{"k", "->", "v"}], "]"}]}]}], "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.882805211033594*^9, 3.8828052110345936`*^9}, {
  3.961249304771256*^9, 3.961249307558722*^9}},
 CellLabel->"In[47]:=",ExpressionUUID->"76dad8ef-02fb-4308-a4d9-e9ecaa1d2322"]
}, Closed]],

Cell[CellGroupData[{

Cell["SOM Query Functions", "Subtitle",
 CellChangeTimes->{{3.873539554198429*^9, 3.87353956385848*^9}, {
  3.873539727707151*^9, 3.873539729825041*^9}, {3.898786755033476*^9, 
  3.89878675719049*^9}, {3.8996443472215767`*^9, 3.899644348917593*^9}, {
  3.8997809578403296`*^9, 3.8997809633636866`*^9}, {3.8997810257985897`*^9, 
  3.899781030617282*^9}, {3.8997810679876633`*^9, 3.899781071456896*^9}, {
  3.899806668643939*^9, 
  3.8998066690317383`*^9}},ExpressionUUID->"36dd3c16-138c-4de3-ab14-\
7d943003004e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "query"}], " ", "search", " ", "string"}]}], ",", " ", 
    RowBox[{
     RowBox[{"-", "crit"}], " ", "selection", " ", "criterion", " ", 
     RowBox[{"(", 
      RowBox[{"img", " ", "or", " ", "txt"}], ")"}]}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "results"}], " ", "number", " ", "of", " ", "results"}], 
     ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "List"}], " ", "of", " ", "info"}], "-", 
       RowBox[{"enriched", " ", "result", " ", "associations"}]}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
       RowBox[{"Runs", " ", "a", " ", "CLIP"}], "-", 
       RowBox[{
       "encoded", " ", "query", " ", "over", " ", "the", " ", "SOM"}]}]}]}], 
    ",", 
    RowBox[{"retrieves", " ", "matching", " ", "entries"}], ",", 
    RowBox[{"and", " ", "enriches", " ", "them", " ", "with", " ", 
     RowBox[{"metadata", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"AskCLIPedia", "[", 
    RowBox[{"query_", ",", "crit_", " ", ",", "results_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"queryElem", ",", "queryResults", ",", "queryAssoc"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"queryElem", "=", 
       RowBox[{"ClipEncode", "[", 
        RowBox[{"query", ",", "imgModel", ",", "textModel"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"queryResults", "=", 
       RowBox[{"QueryEnSOM", "[", 
        RowBox[{"clipedia", ",", 
         RowBox[{"queryElem", "[", 
          RowBox[{"[", "\"\<vector_ref\>\"", "]"}], "]"}], ",", "crit", ",", 
         "0.022", ",", " ", "0.002", ",", "results", ",", "$repoFolder"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"queryAssoc", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"AddInfo", "[", 
          RowBox[{"CollateEnAssoc", "[", 
           RowBox[{"queryResults", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "queryResults"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ListResults", "[", "queryAssoc", "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.940737831896429*^9, 3.940737873166912*^9}, {
   3.940750773492679*^9, 3.940750801250993*^9}, {3.940750860071533*^9, 
   3.940750913305538*^9}, {3.940750945137951*^9, 3.940750973586526*^9}, {
   3.941144019767399*^9, 3.941144020500164*^9}, {3.9411440796369123`*^9, 
   3.941144079816606*^9}, {3.941245903946972*^9, 3.941245904260603*^9}, {
   3.941245938659359*^9, 3.9412460822724943`*^9}, {3.9412543851191483`*^9, 
   3.941254457987554*^9}, {3.941254715175501*^9, 3.941254768710473*^9}, {
   3.94224890363013*^9, 3.942248906498712*^9}, {3.942249751415194*^9, 
   3.942249806264708*^9}, {3.942249839933344*^9, 3.942249952008287*^9}, {
   3.9422504085686407`*^9, 3.942250408677734*^9}, {3.942250456204382*^9, 
   3.942250523733025*^9}, {3.9422505564649553`*^9, 3.9422505658839827`*^9}, {
   3.9422508458996468`*^9, 3.942250855794029*^9}, {3.9429126732071753`*^9, 
   3.9429127588967037`*^9}, {3.942912793855927*^9, 3.942912816427704*^9}, {
   3.942912854689004*^9, 3.9429128838920727`*^9}, 3.9612176558107157`*^9, {
   3.961234537906231*^9, 3.961234567635371*^9}, 3.961469623973003*^9, 
   3.9614732597925053`*^9},
 CellLabel->"In[48]:=",ExpressionUUID->"51722cd8-2f5d-4ff0-990b-1909748813ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "pathPair"}], " ", "list", " ", "of", " ", "file", " ", 
      "paths", " ", "with", " ", "paired", " ", "information"}]}], ",", " ", 
    RowBox[{
     RowBox[{"-", "queryVec"}], " ", "query", " ", "vector"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "results"}], " ", "number", " ", "of", " ", "results"}], 
     ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Sorted"}], " ", "list", " ", "of", " ", 
       RowBox[{"{", 
        RowBox[{"source", ",", "ID", ",", "distance", ",", "vector"}], 
        "}"}]}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Parallel", " ", "import", " ", "of", " ", "HDF5", " ", "vectors"}]}]}],
     ",", 
    RowBox[{"computes", " ", "distances"}], ",", 
    RowBox[{"and", " ", "sorts", " ", "top", " ", "results", " ", "from", " ", 
     RowBox[{"SOM", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"LaunchKernels", "[", "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ImportH5", "[", "path_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "raw", "}"}], ",", 
      RowBox[{
       RowBox[{"raw", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"path", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<Datasets\>\"", ",", 
            RowBox[{"{", 
             RowBox[{"\"\</vecs\>\"", ",", "\"\</ids\>\""}], "}"}]}], "}"}], 
          ",", 
          RowBox[{"IncludeMetaInformation", "->", "None"}], ",", 
          RowBox[{"\"\<BinaryFormat\>\"", "->", "True"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"MapThread", "[", 
        RowBox[{"List", ",", "raw", ",", "1"}], "]"}]}]}], "]"}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ParallelImportH5", "[", 
     RowBox[{"pathPair_List", ",", "queryVec_", ",", "results_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"q", "=", 
         RowBox[{"N", "@", "queryVec"}]}], ",", "chunks", ",", "partial"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"DistributeDefinitions", "[", 
        RowBox[{"ImportH5", ",", "q", ",", "CosineDistanceFast"}], "]"}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"chunks", "=", 
        RowBox[{"Partition", "[", 
         RowBox[{"pathPair", ",", 
          RowBox[{"UpTo", "[", 
           RowBox[{"Ceiling", "[", 
            RowBox[{
             RowBox[{"Length", "[", "pathPair", "]"}], "/", "$KernelCount"}], 
            "]"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"partial", "=", 
        RowBox[{"ParallelMap", "[", 
         RowBox[{
          RowBox[{"Function", "[", 
           RowBox[{"chunk", ",", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"bag", "=", 
                 RowBox[{"{", "}"}]}], ",", "tmp", ",", "path", ",", "pair", 
                ",", "dists", ",", "take", ",", "idx"}], "}"}], ",", 
              RowBox[{
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"path", ",", "pair"}], "}"}], "=", "elem"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"tmp", "=", 
                   RowBox[{"ImportH5", "[", "path", "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"tmp", "===", 
                    RowBox[{"{", "}"}]}], ",", 
                    RowBox[{"Continue", "[", "]"}]}], "]"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"bag", "=", 
                   RowBox[{"Join", "[", 
                    RowBox[{"bag", ",", 
                    RowBox[{"Map", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Append", "[", 
                    RowBox[{"#", ",", "pair"}], "]"}], "&"}], ",", "tmp"}], 
                    "]"}]}], "]"}]}]}], ",", 
                 RowBox[{"{", 
                  RowBox[{"elem", ",", "chunk"}], "}"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"bag", "===", 
                  RowBox[{"{", "}"}]}], ",", 
                 RowBox[{"Return", "[", 
                  RowBox[{"{", "}"}], "]"}]}], "]"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"dists", "=", 
                RowBox[{"CosineDistanceFast", "[", 
                 RowBox[{"q", ",", 
                  RowBox[{"bag", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"take", "=", 
                RowBox[{"Min", "[", 
                 RowBox[{"results", ",", 
                  RowBox[{"Length", "[", "dists", "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"idx", "=", 
                RowBox[{"Ordering", "[", 
                 RowBox[{"dists", ",", "take"}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"MapThread", "[", 
                RowBox[{
                 RowBox[{"Function", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"row", ",", "dist"}], "}"}], ",", 
                   RowBox[{"With", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"vec", "=", 
                    RowBox[{"row", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"id", "=", 
                    RowBox[{"row", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                    RowBox[{"p", "=", 
                    RowBox[{"row", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ToString", "@", 
                    RowBox[{"p", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"ToString", "@", 
                    RowBox[{"p", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", "dist", ",", "id", 
                    ",", "vec"}], "}"}]}], "]"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"bag", "[", 
                    RowBox[{"[", "idx", "]"}], "]"}], ",", 
                   RowBox[{"dists", "[", 
                    RowBox[{"[", "idx", "]"}], "]"}]}], "}"}]}], "]"}]}]}], 
             "]"}]}], "]"}], ",", "chunks"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"SortBy", "[", 
        RowBox[{
         RowBox[{"Join", "@@", "partial"}], ",", "Last"}], "]"}]}]}], 
     "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.955769981069683*^9, 3.95576998107386*^9}, {
   3.9557701566569157`*^9, 3.955770228738287*^9}, {3.955770342714623*^9, 
   3.955770346286639*^9}, {3.95577092084394*^9, 3.9557709456384773`*^9}, {
   3.9557711338979387`*^9, 3.955771137081534*^9}, 3.955771250445622*^9, {
   3.955771399869245*^9, 3.955771419938349*^9}, {3.955778824368991*^9, 
   3.955778827476009*^9}, {3.955781536016467*^9, 3.9557815364045973`*^9}, {
   3.955953735765751*^9, 3.955953739635415*^9}, {3.961217655812492*^9, 
   3.961217655816977*^9}, {3.96121912402211*^9, 3.9612191250749826`*^9}, {
   3.961234312913247*^9, 3.961234385417906*^9}},
 CellLabel->"In[49]:=",ExpressionUUID->"ad191eaa-0b2a-492c-bcae-be3bdf357203"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "som"}], " ", "trained", " ", "SOM"}]}], ",", " ", 
    RowBox[{
     RowBox[{"-", "queryVec"}], " ", "query", " ", "vector"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "crit"}], " ", "criteria", " ", 
     RowBox[{"(", 
      RowBox[{"img", " ", "or", " ", "text"}], ")"}]}], ",", " ", 
    RowBox[{"-", "imgFac"}], ",", 
    RowBox[{
    "txtFac", " ", "factors", " ", "for", " ", "corpus", " ", "sampling"}], 
    ",", " ", 
    RowBox[{
     RowBox[{"-", "results"}], " ", "number", " ", "of", " ", "results"}], 
    ",", " ", 
    RowBox[{
     RowBox[{"-", "repoFolder"}], " ", "base", " ", "folder"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "sampleSize"}], " ", "optional", " ", "sample", " ", 
     "size"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "filter"}], " ", "optional", " ", "ID", " ", "filter"}], 
     ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "top", " ", "matching", " ", 
       "elements", " ", "from", " ", "SOM"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Searches", " ", "SOM", " ", "hierarchy", " ", "and", " ", "retrieves", 
       " ", "most", " ", "similar", " ", "items", " ", "to", " ", "the", " ", 
       "query", " ", 
       RowBox[{"vector", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"QueryEnSOM", "[", 
    RowBox[{
    "som_", ",", "queryVec_", ",", "crit_", ",", "imgFac_", ",", "txtFac_", 
     ",", "results_", ",", "repoFolder_", ",", 
     RowBox[{"sampleSize_", ":", "False"}], ",", 
     RowBox[{"filter_", ":", 
      RowBox[{"{", "}"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "goodPos", ",", "bmuWeights", ",", "bmuDists", ",", "sortedBmus", ",", 
       "merged", ",", "lengths", ",", "target", ",", "harvestPosition", ",", 
       "validPos", ",", "subBmus", ",", "pairs", ",", "baseDir", ",", 
       "filePaths", ",", "pathPair", ",", "bmes", ",", "filtered"}], "}"}], 
     ",", 
     RowBox[{"(*", 
      RowBox[{"Identify", " ", "relevant", " ", "positions"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"goodPos", "=", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{"som", "[", 
           RowBox[{"[", 
            RowBox[{"\"\<lengths\>\"", ",", "All", ",", "crit"}], "]"}], 
           "]"}], ",", 
          RowBox[{"_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", ">", "0"}], "&"}], ")"}]}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"bmuWeights", "=", 
       RowBox[{"som", "[", 
        RowBox[{"[", 
         RowBox[{"\"\<kernel\>\"", ",", "\"\<weights\>\"", ",", "goodPos"}], 
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"bmuDists", "=", 
       RowBox[{"CosineDistanceFast", "[", 
        RowBox[{"queryVec", ",", "bmuWeights"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sortedBmus", "=", 
       RowBox[{"goodPos", "[", 
        RowBox[{"[", 
         RowBox[{"Ordering", "[", "bmuDists", "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Directly", " ", "calculate", " ", "sub"}], "-", 
        "distances"}], "*)"}], 
      RowBox[{"merged", "=", 
       RowBox[{"Association", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"sortedBmus", "[", 
                    RowBox[{"[", "bmu", "]"}], "]"}], ",", "#"}], "}"}], 
                 "&"}], "/@", 
                RowBox[{"Range", "[", 
                 RowBox[{"Length", "[", 
                  RowBox[{"som", "[", 
                   RowBox[{"[", 
                    RowBox[{"\"\<soms\>\"", ",", 
                    RowBox[{"sortedBmus", "[", 
                    RowBox[{"[", "bmu", "]"}], "]"}], ",", "\"\<kernel\>\"", 
                    ",", "\"\<weights\>\""}], "]"}], "]"}], "]"}], "]"}]}], 
               ")"}], "->", 
              RowBox[{"CosineDistanceFast", "[", 
               RowBox[{"queryVec", ",", 
                RowBox[{"som", "[", 
                 RowBox[{"[", 
                  RowBox[{"\"\<soms\>\"", ",", 
                   RowBox[{"sortedBmus", "[", 
                    RowBox[{"[", "bmu", "]"}], "]"}], ",", "\"\<kernel\>\"", 
                   ",", "\"\<weights\>\""}], "]"}], "]"}]}], "]"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"bmu", ",", 
              RowBox[{"Length", "[", "sortedBmus", "]"}]}], "}"}]}], "]"}], 
          ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Sort", " ", "and", " ", "find", " ", "threshold", " ", "position"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"merged", "=", 
       RowBox[{"Sort", "[", "merged", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"lengths", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{
         RowBox[{"som", "[", 
          RowBox[{"[", 
           RowBox[{
           "\"\<soms\>\"", ",", "All", ",", "\"\<lengths\>\"", ",", "All", 
            ",", "crit"}], "]"}], "]"}], ",", 
         RowBox[{"Keys", "[", "merged", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"target", "=", 
       RowBox[{
        RowBox[{"Total", "[", "lengths", "]"}], "*", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"crit", "===", "\"\<img\>\""}], ",", "imgFac", ",", 
          "txtFac"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"harvestPosition", "=", 
       RowBox[{
        RowBox[{"FirstPosition", "[", 
         RowBox[{
          RowBox[{"Accumulate", "[", "lengths", "]"}], ",", 
          RowBox[{"_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"#", ">=", "target"}], "&"}], ")"}]}], ",", 
          RowBox[{"Length", "[", "lengths", "]"}]}], "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"validPos", "=", 
       RowBox[{"Pick", "[", 
        RowBox[{
         RowBox[{"Range", "[", "harvestPosition", "]"}], ",", 
         RowBox[{"lengths", "[", 
          RowBox[{"[", 
           RowBox[{";;", "harvestPosition"}], "]"}], "]"}], ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", ">", "0"}], "&"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"subBmus", "=", 
       RowBox[{
        RowBox[{"Keys", "[", "merged", "]"}], "[", 
        RowBox[{"[", "validPos", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"pairs", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"sampleSize", "===", "False"}], ",", "subBmus", ",", 
         RowBox[{"RandomSample", "[", 
          RowBox[{"subBmus", ",", 
           RowBox[{"Ceiling", "[", 
            RowBox[{
             RowBox[{"Length", "[", "subBmus", "]"}], "*", "sampleSize"}], 
            "]"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"baseDir", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"DirectoryQ", "[", 
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{
            "$repoFolder", ",", "\"\<soms\>\"", ",", "\"\<240805\>\""}], 
            "}"}], "]"}], "]"}], ",", 
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"{", 
           RowBox[{
           "$repoFolder", ",", "\"\<soms\>\"", ",", "\"\<240805\>\"", ",", 
            "\"\<alloc_sub_vec\>\""}], "}"}], "]"}], ",", 
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"{", 
           RowBox[{
           "$repoFolder", ",", "\"\<soms\>\"", ",", "\"\<alloc_sub_vec\>\""}],
            "}"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"filePaths", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"FileNameJoin", "[", 
          RowBox[{"{", 
           RowBox[{"baseDir", ",", "\"\<hdf5\>\"", ",", "crit", ",", 
            RowBox[{"ToString", "[", "#1", "]"}], ",", 
            RowBox[{
             RowBox[{"ToString", "[", "#2", "]"}], "<>", "\"\<.h5\>\""}]}], 
           "}"}], "]"}], "&"}], "@@@", "pairs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pathPair", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"{", 
         RowBox[{"filePaths", ",", "pairs"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"bmes", "=", 
       RowBox[{"SortBy", "[", 
        RowBox[{
         RowBox[{"ParallelImportH5", "[", 
          RowBox[{"pathPair", ",", "queryVec", ",", 
           RowBox[{"results", "+", "1"}]}], "]"}], ",", 
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "3", "]"}], "]"}], "&"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"filtered", "=", 
       RowBox[{"Select", "[", 
        RowBox[{"bmes", ",", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"MemberQ", "[", 
            RowBox[{"filter", ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "4", "]"}], "]"}]}], "]"}]}], "&"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Take", "[", 
       RowBox[{"filtered", ",", 
        RowBox[{"UpTo", "[", "results", "]"}]}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.955701700286401*^9, 3.95570170029356*^9}, {
   3.9557020152880707`*^9, 3.9557020397143173`*^9}, {3.955702992086831*^9, 
   3.955702992786306*^9}, {3.955704214375341*^9, 3.955704267880438*^9}, {
   3.955718538995976*^9, 3.955718545802182*^9}, 3.955718659371612*^9, 
   3.9557186898342237`*^9, 3.955718834100747*^9, 3.955720535207897*^9, {
   3.955720649673909*^9, 3.9557206580549507`*^9}, {3.955720999596951*^9, 
   3.9557210083800173`*^9}, {3.955721079003914*^9, 3.955721084923658*^9}, {
   3.9557258616160707`*^9, 3.955725871921832*^9}, {3.955772173386544*^9, 
   3.955772174496564*^9}, {3.955772376509058*^9, 3.955772379506707*^9}, {
   3.9557724159906073`*^9, 3.9557724331716957`*^9}, {3.955772464717722*^9, 
   3.955772502593541*^9}, {3.955772710274068*^9, 3.955772742646949*^9}, {
   3.955778723743088*^9, 3.9557787240629807`*^9}, 3.955778774213229*^9, {
   3.955779118339683*^9, 3.955779119106391*^9}, {3.9557793324797564`*^9, 
   3.9557793327412653`*^9}, {3.955781546418248*^9, 3.9557815481906357`*^9}, {
   3.955782331590602*^9, 3.955782332634303*^9}, {3.9557824250128593`*^9, 
   3.95578242587038*^9}, {3.961217655819277*^9, 3.9612176558210993`*^9}, {
   3.961234405223686*^9, 3.961234487029076*^9}, {3.96146922280085*^9, 
   3.961469266369615*^9}, {3.9614694537851667`*^9, 3.961469454606572*^9}, {
   3.961469524147511*^9, 3.961469564676893*^9}, {3.961473265470848*^9, 
   3.961473307514619*^9}, {3.9614735088253927`*^9, 3.96147351757865*^9}, {
   3.9615130934445868`*^9, 3.961513122502265*^9}, 
   3.9615133727203608`*^9},ExpressionUUID->"75983b54-f498-4135-916b-\
77f6a95e922e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "path"}], " ", "HDF5", " ", "file", " ", "path"}]}], ";", 
    RowBox[{"Output", ":", 
     RowBox[{
      RowBox[{"-", "List"}], " ", "of", " ", 
      RowBox[{"{", 
       RowBox[{"vector", ",", "ID"}], "}"}], " ", "pairs"}]}], ";", 
    RowBox[{"Description", ":", 
     RowBox[{
     "Imports", " ", "vectors", " ", "and", " ", "IDs", " ", "from", " ", 
      "an", " ", "HDF5", " ", "file", " ", "in", " ", "serial", " ", 
      RowBox[{"mode", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"SerialImportVecH5", "[", "path_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "data", "}"}], ",", 
     RowBox[{
      RowBox[{"data", "=", 
       RowBox[{"Import", "[", 
        RowBox[{"path", ",", 
         RowBox[{"{", 
          RowBox[{"\"\<Datasets\>\"", ",", 
           RowBox[{"{", 
            RowBox[{"\"\</vecs\>\"", ",", "\"\</ids\>\""}], "}"}]}], "}"}], 
         ",", 
         RowBox[{"IncludeMetaInformation", "->", "None"}], ",", 
         RowBox[{"\"\<BinaryFormat\>\"", "->", "True"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MapThread", "[", 
       RowBox[{"List", ",", "data"}], "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9556963692553253`*^9, 3.955696369260193*^9}, 
   3.955698859046373*^9, {3.955706123368478*^9, 3.955706124838277*^9}, {
   3.955706229323751*^9, 3.955706252843678*^9}, {3.95570643351331*^9, 
   3.955706439111826*^9}, 3.955710822806119*^9, {3.955718307962377*^9, 
   3.9557183154889107`*^9}, {3.955721243576145*^9, 3.955721246704629*^9}, {
   3.955722333161538*^9, 3.955722334856653*^9}, {3.955722523822885*^9, 
   3.955722525481007*^9}, {3.95572534275383*^9, 3.9557253440716267`*^9}, {
   3.955771362398715*^9, 3.9557713809701223`*^9}, {3.955778794968279*^9, 
   3.955778796578742*^9}, {3.955781834429162*^9, 3.955781835994491*^9}, {
   3.961248877828302*^9, 3.961248880114346*^9}},
 CellLabel->
  "In[180]:=",ExpressionUUID->"2e449c93-dc59-4375-8964-a4ab8fd2960b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "vec"}], " ", "query", " ", "vector"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "vecMatrix"}], " ", "matrix", " ", "of", " ", "vectors"}], 
     ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "cosine", " ", "distances"}]}], 
     ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Computes", " ", "fast", " ", "cosine", " ", "distances", " ", 
       "between", " ", "a", " ", "query", " ", "vector", " ", "and", " ", 
       "matrix", " ", "of", " ", "vectors", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"assumes", " ", "pre"}], "-", 
          RowBox[{"normalized", " ", "input"}]}], ")"}], "."}]}]}]}]}], 
   "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CosineDistanceFast", "[", 
    RowBox[{"vec_", ",", "vecMatrix_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "dotProducts", "}"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"vecMatrix", "===", 
        RowBox[{"{", "}"}]}], ",", 
       RowBox[{"{", "}"}], ",", 
       RowBox[{
        RowBox[{"dotProducts", "=", 
         RowBox[{"vecMatrix", ".", "vec"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"1", "-", "dotProducts"}]}]}], "]"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.94041366870689*^9, 3.940413668711919*^9}, {
  3.9404140758019753`*^9, 3.940414077241022*^9}, {3.940414314560617*^9, 
  3.94041431679705*^9}, {3.940414368339604*^9, 3.9404143891810417`*^9}, {
  3.940414420729295*^9, 3.940414430474352*^9}, {3.961248893253396*^9, 
  3.96124892000981*^9}},
 CellLabel->
  "In[181]:=",ExpressionUUID->"f09b31f3-fb2f-4a8a-934d-f4dcb9f601d4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "query"}], " ", "image", " ", "or", " ", "text", " ", 
      "query"}]}], ",", " ", 
    RowBox[{
     RowBox[{"-", "imgModel"}], " ", "image", " ", "encoder"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "textModel"}], " ", "text", " ", "encoder"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Association"}], " ", "with", " ", "vector_ref", " ", 
       "and", " ", "additionalWords"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Encodes", " ", "input", " ", "using", " ", "CLIP", " ", "models"}]}]}],
     ",", 
    RowBox[{"returning", " ", "vector", " ", "and", " ", "stemmed", " ", 
     RowBox[{"tokens", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ClipEncode", "[", 
    RowBox[{"query_", ",", "imgModel_", ",", "textModel_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"tokens", ",", "additionalWords"}], "}"}], ",", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ImageQ", "[", "query", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Association", "[", 
        RowBox[{
         RowBox[{"\"\<vector_ref\>\"", "->", 
          RowBox[{"imgModel", "[", "query", "]"}]}], ",", 
         RowBox[{"\"\<additionalWords\>\"", "->", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"\"\<query\>\"", "->", "query"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"additionalWords", "=", 
         RowBox[{"ToLowerCase", "@", 
          RowBox[{"WordStem", "@", 
           RowBox[{"DeleteStopwords", "@", 
            RowBox[{"TextWordsFast", "[", "query", "]"}]}]}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<vector_ref\>\"", "->", 
           RowBox[{"textModel", "[", "query", "]"}]}], ",", 
          RowBox[{"\"\<additionalWords\>\"", "->", "additionalWords"}], ",", 
          RowBox[{"\"\<query\>\"", "->", "query"}]}], "]"}]}]}], "]"}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.919515940153678*^9, 3.9195160241043334`*^9}, {
   3.937816225904108*^9, 3.937816226499769*^9}, {3.937816303150631*^9, 
   3.9378163041219378`*^9}, {3.9378170406912317`*^9, 3.937817239260542*^9}, {
   3.937817270953706*^9, 3.937817279343972*^9}, {3.937819820791308*^9, 
   3.93781990658101*^9}, {3.937822118701874*^9, 3.937822130446494*^9}, {
   3.937822571448963*^9, 3.937822572327036*^9}, 3.937822607486434*^9, {
   3.940679868504591*^9, 3.9406798685871477`*^9}, {3.940680005113841*^9, 
   3.94068001270195*^9}, {3.942236617637692*^9, 3.9422366305049047`*^9}, {
   3.961234497385985*^9, 3.9612345097872753`*^9}},
 CellLabel->
  "In[182]:=",ExpressionUUID->"ed9edec8-4433-48cb-8395-b81222e19b2b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", "none"}], ";", 
    RowBox[{"Output", ":", 
     RowBox[{
      RowBox[{"-", "Association"}], " ", "with", " ", "empty", " ", 
      "placeholders", " ", "for", " ", "text", " ", "and", " ", "image", " ", 
      "fields"}]}], ";", 
    RowBox[{"Description", ":", 
     RowBox[{
     "Generates", " ", "an", " ", "empty", " ", "association", " ", 
      "template", " ", "for", " ", "text", " ", "and", " ", "image", " ", 
      "query", " ", 
      RowBox[{"results", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"CreateEmptyAssoc", ":=", 
   RowBox[{"Association", "[", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\"\<guideSentenceID\>\"", "->", "\"\<\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<guideSentence\>\"", "->", "\"\<\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<imgBmu\>\"", "->", "\"\<\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<imgBme\>\"", "->", "\"\<\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<imgDis\>\"", "->", "\"\<\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<imgID\>\"", "->", "\"\<\>\""}], ",", "\[IndentingNewLine]", 
      RowBox[{"\"\<imgTitle\>\"", "->", "\"\<\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<img\>\"", "->", "\"\<\>\""}], ",", "\[IndentingNewLine]", 
      RowBox[{"\"\<textBmu\>\"", "->", "\"\<\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<textBme\>\"", "->", "\"\<\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<textDis\>\"", "->", "\"\<\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<textID\>\"", "->", "\"\<\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<textTitle\>\"", "->", "\"\<\>\""}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"\"\<textSentence\>\"", "->", "\"\<\>\""}]}], "}"}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9195185824216332`*^9, 3.9195186366409807`*^9}, {
  3.961248950240506*^9, 3.961248956766982*^9}},
 CellLabel->
  "In[183]:=",ExpressionUUID->"08feac52-0c92-4395-baa0-b352a5014115"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "string"}], " ", "input", " ", "text", " ", "string"}]}], 
    ";", 
    RowBox[{"Output", ":", 
     RowBox[{"-", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"cleaned", " ", "string"}], ",", 
        RowBox[{"extracted", " ", "first", " ", "hyperlink"}]}], "}"}]}]}], 
    ";", 
    RowBox[{"Description", ":", 
     RowBox[{
     "Splits", " ", "out", " ", "and", " ", "removes", " ", "the", " ", 
      "first", " ", "detected", " ", "URL", " ", "from", " ", "a", " ", 
      "text", " ", 
      RowBox[{"string", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"IsolateLinks", "[", "string_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"splitString", ",", "linkPos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"splitString", "=", 
       RowBox[{"StringSplit", "[", "string", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"linkPos", "=", 
       RowBox[{"StringStartsQ", "[", 
        RowBox[{"splitString", ",", "\"\<http\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"StringTrim", "@", 
         RowBox[{"StringDelete", "[", 
          RowBox[{"string", ",", 
           RowBox[{"Extract", "[", 
            RowBox[{"splitString", ",", 
             RowBox[{"Position", "[", 
              RowBox[{"linkPos", ",", "True"}], "]"}]}], "]"}]}], "]"}]}], 
        ",", 
        RowBox[{
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "@", "#"}], ">", "0"}], ",", 
            RowBox[{"StringDelete", "[", 
             RowBox[{
              RowBox[{"Extract", "[", 
               RowBox[{"splitString", ",", 
                RowBox[{"First", "@", "#"}]}], "]"}], ",", 
              RowBox[{"Alternatives", "@@", 
               RowBox[{"{", 
                RowBox[{"\"\<,\>\"", ",", "\"\<;\>\""}], "}"}]}]}], "]"}], 
            ",", "\"\<\>\""}], "]"}], "&"}], "@", 
         RowBox[{"Position", "[", 
          RowBox[{"linkPos", ",", "True"}], "]"}]}]}], "}"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9360701452814217`*^9, 3.9360701547420053`*^9}, {
   3.9360704515896893`*^9, 3.936070496272607*^9}, {3.936070811393656*^9, 
   3.936070812955517*^9}, {3.93607099664933*^9, 3.9360711351211843`*^9}, {
   3.936072358430987*^9, 3.936072362522768*^9}, {3.9360724107707243`*^9, 
   3.936072412416296*^9}, 3.936072458103409*^9, {3.936072527008298*^9, 
   3.936072532784568*^9}, {3.936089332685463*^9, 3.936089359972741*^9}, {
   3.936089465773491*^9, 3.936089467138975*^9}, {3.961248383110618*^9, 
   3.961248385845065*^9}},
 CellLabel->
  "In[184]:=",ExpressionUUID->"4d7113a8-254f-4f0d-9a1e-6412dca02be0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "string"}], " ", "input", " ", "string", " ", "with", " ", 
      "keywords"}]}], ",", 
    RowBox[{
     RowBox[{"-", "rulesAssoc"}], " ", "association", " ", "of", " ", 
     "keywords", " ", "to", " ", 
     RowBox[{"{", 
      RowBox[{"tooltip", ",", "link"}], "}"}]}], ",", 
    RowBox[{
     RowBox[{"-", "defaultLink"}], " ", "fallback", " ", "hyperlink"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "defaultTitle"}], " ", "fallback", " ", "tooltip"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "pane"}], " ", "with", " ", "hyperlinked", " ", "and", 
        " ", "tooltip"}], "-", 
       RowBox[{"wrapped", " ", "string"}]}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Creates", " ", "a", " ", "pane", " ", "with", " ", "tooltips", " ", 
       "and", " ", "hyperlinks", " ", "for", " ", "matched", " ", 
       "keywords"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MakeHyperlinkWithTooltips", "[", 
    RowBox[{
    "string_", ",", "rulesAssoc_Association", ",", "defaultLink_", ",", 
     "defaultTitle_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"specialSubstrings", ",", "parts", ",", "processedParts"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"specialSubstrings", "=", 
       RowBox[{"Keys", "[", "rulesAssoc", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"parts", "=", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"string", ",", 
         RowBox[{
          RowBox[{
           RowBox[{"#", "->", "#"}], "&"}], "/@", "specialSubstrings"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"processedParts", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"{", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"KeyExistsQ", "[", 
                 RowBox[{"rulesAssoc", ",", "#"}], "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"With", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"tooltip", "=", 
                    RowBox[{
                    RowBox[{"rulesAssoc", "[", "#", "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"link", "=", 
                    RowBox[{
                    RowBox[{"rulesAssoc", "[", "#", "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"link", "===", "\"\<\>\""}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Tooltip", "[", 
                    RowBox[{"#", ",", "tooltip"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Tooltip", "[", 
                    RowBox[{
                    RowBox[{"Hyperlink", "[", 
                    RowBox[{"#", ",", "link", ",", 
                    RowBox[{"BaseStyle", "->", "Black"}], ",", 
                    RowBox[{"ActiveStyle", "->", "Gray"}]}], "]"}], ",", 
                    "tooltip"}], "]"}]}], "]"}]}], "]"}], ",", "#"}], "]"}], 
              "&"}], ",", "parts"}], "]"}], "}"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"Tooltip", "[", 
           RowBox[{
            RowBox[{"Hyperlink", "[", 
             RowBox[{
              RowBox[{"Superscript", "[", 
               RowBox[{"\"\<\>\"", ",", "\"\<\:2139\>\""}], "]"}], ",", 
              "defaultLink", ",", 
              RowBox[{"BaseStyle", "->", "Black"}], ",", 
              RowBox[{"ActiveStyle", "->", "Gray"}]}], "]"}], ",", 
            "defaultTitle"}], "]"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Pane", "[", 
       RowBox[{
        RowBox[{"Style", "[", 
         RowBox[{
          RowBox[{"Row", "[", 
           RowBox[{
            RowBox[{"#", "&"}], "/@", "processedParts"}], "]"}], ",", 
          RowBox[{"LineIndent", "->", "0"}], ",", 
          RowBox[{"Hyphenation", "->", "False"}], ",", 
          RowBox[{"LineSpacing", "->", 
           RowBox[{"{", 
            RowBox[{"1.1", ",", "0"}], "}"}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"1000", ",", "Automatic"}], "}"}], ",", 
        RowBox[{"Alignment", "->", "Left"}]}], "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.936067598873602*^9, 3.9360675988762493`*^9}, {
   3.936067664814424*^9, 3.936067677434841*^9}, {3.936067712312488*^9, 
   3.936067718881732*^9}, {3.9360677970038767`*^9, 3.936067843558794*^9}, {
   3.936068814228119*^9, 3.936068837900478*^9}, 3.936069122048236*^9, {
   3.936069610922337*^9, 3.9360696111113453`*^9}, 3.9360725697004137`*^9, {
   3.936072643188892*^9, 3.936072643414897*^9}, {3.9360731896786957`*^9, 
   3.9360732141167593`*^9}, {3.936073349777905*^9, 3.936073356403762*^9}, {
   3.9360733954423733`*^9, 3.936073416687896*^9}, {3.936073505484848*^9, 
   3.93607350778305*^9}, {3.936075248820963*^9, 3.93607525431629*^9}, {
   3.936075371938916*^9, 3.9360757122142277`*^9}, {3.936077855223586*^9, 
   3.936077863794672*^9}, {3.936078275673484*^9, 3.936078320819035*^9}, {
   3.936078363634164*^9, 3.936078424038197*^9}, {3.936078569246204*^9, 
   3.936078591319726*^9}, 3.9360786439437847`*^9, {3.936078710063005*^9, 
   3.936078720812545*^9}, 3.93607879931151*^9, 3.936078860089395*^9, {
   3.93607901542356*^9, 3.9360790224924297`*^9}, {3.936079056461341*^9, 
   3.936079145248198*^9}, {3.936079299142096*^9, 3.9360793082729387`*^9}, 
   3.936079339106249*^9, {3.936079454465665*^9, 3.936079468770653*^9}, {
   3.936079502898967*^9, 3.93607956116355*^9}, {3.936079693853921*^9, 
   3.936079748270487*^9}, {3.936090274624596*^9, 3.936090281253641*^9}, {
   3.936091866728964*^9, 3.936091874127926*^9}, {3.936260560297551*^9, 
   3.936260580381084*^9}, {3.961248308002989*^9, 3.961248310910288*^9}, {
   3.961248345518198*^9, 3.961248357836123*^9}},
 CellLabel->
  "In[185]:=",ExpressionUUID->"9f1cb144-05e0-4a7c-9a96-097542286d28"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "queryAssoc"}], " ", "list", " ", "of", " ", "enriched", 
       " ", "query", " ", "associations"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "displayable", " ", "elements", 
       " ", 
       RowBox[{"(", 
        RowBox[{"text", " ", "or", " ", "image"}], ")"}], " ", "with", " ", 
       "tooltips", " ", "and", " ", "links"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Builds", " ", "clickable", " ", "or", " ", "styled", " ", "elements", 
       " ", "for", " ", "each", " ", "result", " ", "for", " ", "simple", " ",
        "notebook", " ", "display"}]}]}], ",", 
    RowBox[{"combining", " ", "metadata", " ", "and", " ", "visual", " ", 
     RowBox[{"components", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ListResults", "[", "queryAssoc_", "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"#", "[", 
         RowBox[{"[", "\"\<type\>\"", "]"}], "]"}], "==", "\"\<img\>\""}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"KeyExistsQ", "[", 
          RowBox[{"#", ",", "\"\<imgInfo\>\""}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Tooltip", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
             RowBox[{"Hyperlink", "[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "\"\<img\>\"", "]"}], "]"}], ",", 
               RowBox[{"\"\<https://en.wikipedia.org/wiki?curid=\>\"", "<>", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "\"\<imgID\>\"", "]"}], "]"}]}]}], "]"}], ",", 
             RowBox[{"LineIndent", "->", "0"}]}], "]"}], ",", 
           RowBox[{"StringRiffle", "[", 
            RowBox[{
             RowBox[{"DeleteCases", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "\"\<imgTitle\>\"", "]"}], "]"}], ",", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", "\"\<imgCaption\>\"", "]"}], "]"}]}], "}"}], 
               ",", "\"\<\>\""}], "]"}], ",", "\"\<: \>\""}], "]"}]}], "]"}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"#", "[", 
          RowBox[{"[", "\"\<img\>\"", "]"}], "]"}]}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"KeyExistsQ", "[", 
          RowBox[{"#", ",", "\"\<textInfo\>\""}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"MakeHyperlinkWithTooltips", "[", 
          RowBox[{
           RowBox[{"#", "[", 
            RowBox[{"[", "\"\<textSentence\>\"", "]"}], "]"}], ",", 
           RowBox[{"Merge", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Merge", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "\"\<textPageCap\>\"", "]"}], "]"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "\"\<textPageImg\>\"", "]"}], "]"}]}], "}"}],
                  ",", "Identity"}], "]"}], ",", 
               RowBox[{"IsolateLinks", "/@", 
                RowBox[{"Association", "[", 
                 RowBox[{"#", "[", "\"\<textPageRef\>\"", "]"}], "]"}]}]}], 
              "}"}], ",", "First"}], "]"}], ",", 
           RowBox[{"\"\<https://en.wikipedia.org/wiki?curid=\>\"", "<>", 
            RowBox[{"#", "[", 
             RowBox[{"[", "\"\<textPageID\>\"", "]"}], "]"}]}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "\"\<textTitle\>\"", "]"}], "]"}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Tooltip", "[", 
          RowBox[{
           RowBox[{"Style", "[", 
            RowBox[{
             RowBox[{"Hyperlink", "[", 
              RowBox[{
               RowBox[{"Style", "[", 
                RowBox[{
                 RowBox[{"#", "[", 
                  RowBox[{"[", "\"\<textSentence\>\"", "]"}], "]"}], ",", 
                 "Black"}], "]"}], ",", 
               RowBox[{"\"\<https://en.wikipedia.org/wiki?curid=\>\"", "<>", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "\"\<textPageID\>\"", "]"}], "]"}]}]}], "]"}], 
             ",", 
             RowBox[{"LineIndent", "->", "0"}]}], "]"}], ",", 
           RowBox[{"#", "[", 
            RowBox[{"[", "\"\<textTitle\>\"", "]"}], "]"}]}], "]"}]}], 
        "]"}]}], "]"}], "&"}], "/@", "queryAssoc"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.935638480697214*^9, 3.935638485411867*^9}, {
   3.935638864023785*^9, 3.9356388816644983`*^9}, {3.9359876221827106`*^9, 
   3.935987654902212*^9}, {3.936087127678967*^9, 3.9360871913297462`*^9}, {
   3.936087437585442*^9, 3.936087445687983*^9}, {3.936089566455862*^9, 
   3.9360896260077257`*^9}, {3.9360897514796867`*^9, 
   3.9360897561951103`*^9}, {3.936089861050753*^9, 3.936089869048831*^9}, {
   3.93609007901215*^9, 3.93609011317247*^9}, {3.9360902337761173`*^9, 
   3.936090234623662*^9}, {3.936260597705851*^9, 3.936260609828513*^9}, 
   3.9362608096602373`*^9, {3.9378904609263144`*^9, 3.937890465131051*^9}, {
   3.9378905289694023`*^9, 3.937890538540237*^9}, {3.961249046090741*^9, 
   3.9612490880768967`*^9}},
 CellLabel->
  "In[186]:=",ExpressionUUID->"36fea079-717e-4605-b34d-1954e275b5b8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "queryAssoc"}], " ", "list", " ", "of", " ", "enriched", 
      " ", "query", " ", "associations"}]}], ";", 
    RowBox[{"Output", ":", 
     RowBox[{
      RowBox[{"-", "Column"}], " ", "of", " ", "text", " ", "references"}]}], 
    ";", 
    RowBox[{"Description", ":", 
     RowBox[{
     "Displays", " ", "all", " ", "text", " ", "references", " ", "from", " ",
       "the", " ", "query", " ", "results", " ", "in", " ", "a", " ", 
      "compact", " ", 
      RowBox[{"column", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ShowTextReferences", "[", "queryAssoc_", "]"}], ":=", 
   RowBox[{"Column", "[", 
    RowBox[{
     RowBox[{"Values", "@", 
      RowBox[{"Flatten", "@", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "\"\<type\>\"", "]"}], "]"}], "==", 
              "\"\<text\>\""}], ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "\"\<textPageRef\>\"", "]"}], "]"}], ",", 
             RowBox[{"{", "}"}]}], "]"}], "&"}], "/@", "queryAssoc"}], ",", 
         RowBox[{"{", "}"}]}], "]"}]}]}], ",", 
     RowBox[{"Spacings", "->", "1"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.941427261950573*^9, 3.941427265781898*^9}, {
  3.941427402976718*^9, 3.941427457592922*^9}, {3.9414275577330847`*^9, 
  3.941427561104639*^9}, {3.9612490826243896`*^9, 3.961249086432406*^9}},
 CellLabel->
  "In[187]:=",ExpressionUUID->"b70f523c-048d-4d8c-8e7f-a3c9c1afcd31"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "queryResults"}], " ", "list", " ", "of", " ", "query", 
      " ", "result", " ", "associations"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "mode"}], " ", "optional", " ", "string", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"\"\<Paragraph\>\"", " ", "or", " ", "\"\<Page\>\""}], ",", 
        RowBox[{"default", " ", "\"\<Paragraph\>\""}]}], ")"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "Flattened"}], " ", "list", " ", "of", " ", "image"}], 
       "-", 
       RowBox[{
       "text", " ", "associations", " ", "with", " ", "metadata"}]}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{"For", " ", "each", " ", "query", " ", "result"}]}]}], ",", 
    RowBox[{
    "retrieves", " ", "related", " ", "text", " ", "passages", " ", "and", 
     " ", "media", " ", "from", " ", "the", " ", "repository"}], ",", 
    RowBox[{"extracts", " ", "nearby", " ", "image", " ", "links", " ", 
     RowBox[{"(", 
      RowBox[{"by", " ", "paragraph", " ", "or", " ", "full", " ", "page"}], 
      ")"}]}], ",", 
    RowBox[{"loads", " ", "associated", " ", "image"}], ",", "caption", ",", 
    "vector", ",", 
    RowBox[{"and", " ", "metadata"}], ",", 
    RowBox[{
    "and", " ", "assembles", " ", "an", " ", "association", " ", "with", " ", 
     "reference", " ", "vector"}], ",", "keywords", ",", "captions", ",", 
    "titles", ",", 
    RowBox[{
    "and", " ", "additional", " ", "words", " ", "for", " ", "downstream", 
     " ", "analysis", " ", "or", " ", 
     RowBox[{"display", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CollateTextImgAssoc", "[", 
    RowBox[{"queryResults_", ",", 
     RowBox[{"mode_", ":", "\"\<Paragraph\>\""}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "queryAssoc", ",", "query", ",", "textPageID", ",", "textPageFile", ",",
        "imageLinks", ",", "imgHashs", ",", "imgTitle", ",", "imgID", ",", 
       "img", ",", "imgBio", ",", "imgVec", ",", "imgTitles", ",", 
       "imgCaptions", ",", "additionalWords", ",", "textSentence", ",", 
       "paraImg", ",", "alreadyVisited", ",", "textPos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"alreadyVisited", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"queryAssoc", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"query", "=", 
               RowBox[{"queryResults", "[", 
                RowBox[{"[", "q", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"textPageID", "=", 
               RowBox[{"First", "@", 
                RowBox[{"StringSplit", "[", 
                 RowBox[{
                  RowBox[{"query", "[", 
                   RowBox[{"[", "4", "]"}], "]"}], ",", "\"\<_\>\""}], 
                 "]"}]}]}], ";", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"mode", "=!=", "\"\<Page\>\""}], "||", 
                 RowBox[{"!", 
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"alreadyVisited", ",", "textPageID"}], "]"}]}]}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"textSentence", "=", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "$repoFolder", ",", "\"\<data\>\"", ",", "\"\<text\>\""}],
                     "}"}], "]"}], ",", 
                    RowBox[{"StringTake", "[", 
                    RowBox[{"textPageID", ",", 
                    RowBox[{"UpTo", "[", "4", "]"}]}], "]"}], ",", 
                    RowBox[{"#", "<>", "\"\<.json\>\""}]}], "}"}], "]"}], 
                    ",", "\"\<RawJSON\>\"", ",", 
                    RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}],
                     "&"}], "@", "textPageID"}], ")"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"query", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"textPageFile", "=", 
                  RowBox[{"Import", "[", 
                   RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "$repoFolder", ",", "\"\<data\>\"", ",", 
                    "\"\<pages\>\""}], "}"}], "]"}], ",", 
                    RowBox[{"StringTake", "[", 
                    RowBox[{"textPageID", ",", 
                    RowBox[{"UpTo", "[", "4", "]"}]}], "]"}], ",", 
                    RowBox[{"textPageID", "<>", "\"\<.json\>\""}]}], "}"}], 
                    "]"}], ",", "\"\<RAWJson\>\"", ",", 
                    RowBox[{"IncludeMetaInformation", "->", "None"}]}], 
                   "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"textPos", "=", 
                  RowBox[{"StringPosition", "[", 
                   RowBox[{
                    RowBox[{"textPageFile", "[", 
                    RowBox[{"[", "\"\<text\>\"", "]"}], "]"}], ",", 
                    "textSentence"}], "]"}]}], ";", 
                 RowBox[{"textSentence", "=", 
                  RowBox[{"First", "@", 
                   RowBox[{"StringTake", "[", 
                    RowBox[{
                    RowBox[{"textPageFile", "[", 
                    RowBox[{"[", "\"\<text\>\"", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<", "31"}], ",", "1", 
                    ",", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "-", "30"}]}], "]"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "30"}], ">", 
                    RowBox[{"StringLength", "@", 
                    RowBox[{"textPageFile", "[", 
                    RowBox[{"[", "\"\<text\>\"", "]"}], "]"}]}]}], ",", 
                    RowBox[{"StringLength", "@", 
                    RowBox[{"textPageFile", "[", 
                    RowBox[{"[", "\"\<text\>\"", "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "30"}]}], "]"}]}], 
                    "}"}], "&"}], "/@", "textPos"}]}], "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"paraImg", "=", 
                  RowBox[{"StringCases", "[", 
                   RowBox[{"textSentence", ",", 
                    RowBox[{"Keys", "@", 
                    RowBox[{"textPageFile", "[", 
                    RowBox[{"[", "\"\<mediaLinks\>\"", "]"}], "]"}]}]}], 
                   "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"imageLinks", "=", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"mode", "===", "\"\<Paragraph\>\""}], ",", 
                    RowBox[{"textPageFile", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<mediaLinks\>\"", ",", "paraImg"}], "]"}], 
                    "]"}], ",", 
                    RowBox[{"textPageFile", "[", 
                    RowBox[{"[", "\"\<mediaLinks\>\"", "]"}], "]"}]}], 
                   "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"imgHashs", "=", 
                  RowBox[{"DeleteCases", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"KeyExistsQ", "[", 
                    RowBox[{"$imgHashIndex", ",", "#"}], "]"}], ",", 
                    RowBox[{"$imgHashIndex", "[", "#", "]"}], ",", "Null"}], 
                    "]"}], "&"}], "/@", "imageLinks"}], ",", "Null"}], 
                   "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"imgTitle", "=", 
                  RowBox[{"textPageFile", "[", 
                   RowBox[{"[", "\"\<title\>\"", "]"}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"alreadyVisited", "=", 
                  RowBox[{"Join", "[", 
                   RowBox[{"alreadyVisited", ",", 
                    RowBox[{"{", "textPageID", "}"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Table", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"imgID", "=", 
                    RowBox[{"imgHashs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"imgID", "=!=", "Null"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"img", "=", 
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "$repoFolder", ",", "\"\<data\>\"", ",", "\"\<img\>\""}], 
                    "}"}], "]"}], ",", 
                    RowBox[{"StringTake", "[", 
                    RowBox[{"imgID", ",", "3"}], "]"}], ",", 
                    RowBox[{"imgID", "<>", "\"\<.jpg\>\""}]}], "}"}], "]"}], 
                    ",", 
                    RowBox[{"IncludeMetaInformation", "->", "None"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"imgBio", "=", 
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "$repoFolder", ",", "\"\<data\>\"", ",", 
                    "\"\<imgBios\>\"", ",", "\"\<json\>\""}], "}"}], "]"}], 
                    ",", 
                    RowBox[{"StringTake", "[", 
                    RowBox[{
                    RowBox[{"imgHashs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"UpTo", "[", "3", "]"}]}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"imgHashs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "<>", "\"\<.json\>\""}]}],
                     "}"}], "]"}], ",", "\"\<RAWJson\>\"", ",", 
                    RowBox[{"IncludeMetaInformation", "->", "None"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"imgVec", "=", 
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "$repoFolder", ",", "\"\<data\>\"", ",", 
                    "\"\<imgVecs\>\""}], "}"}], "]"}], ",", 
                    RowBox[{"StringTake", "[", 
                    RowBox[{
                    RowBox[{"imgHashs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"UpTo", "[", "3", "]"}]}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"imgHashs", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "<>", "\"\<.json\>\""}]}],
                     "}"}], "]"}], ",", "\"\<RAWJson\>\"", ",", 
                    RowBox[{"IncludeMetaInformation", "->", "None"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"imgTitle", "=", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"AssociationQ", "[", "$idTitleIndex", "]"}], ",", 
                    RowBox[{"$idTitleIndex", "[", 
                    RowBox[{"[", "textPageID", "]"}], "]"}], ",", 
                    "\"\<\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
                    RowBox[{"imgCaptions", "=", 
                    RowBox[{"imgBio", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "\"\<cap\>\""}], "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"additionalWords", "=", 
                    RowBox[{"ToLowerCase", "@", 
                    RowBox[{"WordStem", "@", 
                    RowBox[{"DeleteStopwords", "@", 
                    RowBox[{"TextWordsFast", "[", 
                    RowBox[{"StringRiffle", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"imgCaptions", "[", 
                    RowBox[{"[", "textPageID", "]"}], "]"}], ",", 
                    "imgTitle"}], "}"}], "]"}], "]"}]}]}]}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Join", "[", 
                    RowBox[{"Association", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"\"\<vector_ref\>\"", "->", 
                    RowBox[{"imgVec", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"\"\<img\>\"", "->", "img"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"\"\<keywords\>\"", "->", 
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"\"\<words\>\"", "->", 
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"\"\<type\>\"", "->", "\"\<img\>\""}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"\"\<imgID\>\"", "->", "textPageID"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"\"\<imgIDs\>\"", "->", 
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"\"\<imgCaptions\>\"", "->", 
                    RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"\"\<imgCaption\>\"", "->", 
                    RowBox[{"imgCaptions", "[", 
                    RowBox[{"[", "textPageID", "]"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"\"\<imgTitle\>\"", "->", "imgTitle"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    "\"\<additionalWords\>\"", "->", "additionalWords"}], ",",
                     "\[IndentingNewLine]", 
                    RowBox[{"\"\<imgInfo\>\"", "->", "True"}]}], 
                    "\[IndentingNewLine]", "]"}], "]"}]}]}], "]"}]}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "@", "imgHashs"}]}], "}"}]}], "]"}]}], 
                ",", "Null"}], "]"}]}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"q", ",", 
               RowBox[{"Length", "@", "queryResults"}]}], "}"}]}], "]"}], ",",
            "Null"}], "]"}], ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "queryAssoc"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.941427261950573*^9, 3.941427265781898*^9}, {
   3.941427402976718*^9, 3.941427457592922*^9}, {3.9414275577330847`*^9, 
   3.941427561104639*^9}, {3.941663604432208*^9, 3.941663627274537*^9}, {
   3.94166365906889*^9, 3.941663774681882*^9}, {3.941666313438262*^9, 
   3.941666364563946*^9}, {3.9416664434783983`*^9, 3.941666451544672*^9}, {
   3.941666494095119*^9, 3.941666496209261*^9}, {3.941666641711692*^9, 
   3.9416666866841307`*^9}, {3.941668174789307*^9, 3.941668179800839*^9}, 
   3.941668325750546*^9, {3.941668361031961*^9, 3.941668362949932*^9}, {
   3.941668573275518*^9, 3.9416685738885193`*^9}, {3.941669041161418*^9, 
   3.941669340888855*^9}, {3.941669377758377*^9, 3.941669387611573*^9}, 
   3.941669592242935*^9, {3.941670117911398*^9, 3.9416701318881903`*^9}, {
   3.9416701706379766`*^9, 3.941670177356729*^9}, {3.941670366952744*^9, 
   3.941670368391308*^9}, {3.941670524866497*^9, 3.9416705374520063`*^9}, {
   3.941670633704924*^9, 3.9416706828476686`*^9}, 3.941670714819275*^9, {
   3.94167075235183*^9, 3.9416707788308907`*^9}, {3.9416713065664883`*^9, 
   3.941671308859125*^9}, 3.942333071680676*^9, {3.961253961820589*^9, 
   3.961253961831143*^9}, {3.9612540036186743`*^9, 3.961254034119547*^9}, {
   3.9615519943716087`*^9, 3.961551997255701*^9}, {3.96155207886204*^9, 
   3.961552081917493*^9}, {3.961552123757803*^9, 3.961552153484729*^9}, {
   3.961552186504521*^9, 3.961552235447757*^9}, {3.961552314193914*^9, 
   3.961552474242588*^9}, {3.9615562258231993`*^9, 
   3.9615562590391273`*^9}},ExpressionUUID->"beec4477-1423-4a7e-97a3-\
160f6886b834"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "queryAssoc"}], " ", "association", " ", "with", " ", 
      "query", " ", "result"}]}], ",", 
    RowBox[{
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Enriched"}], " ", "association", " ", "with", " ", 
       "additional", " ", "metadata", " ", "and", " ", "derived", " ", 
       "fields"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Adds", " ", "extra", " ", "fields", " ", "like", " ", "page", " ", 
       "references"}]}]}], ",", "captions", ",", 
    RowBox[{
    "and", " ", "additional", " ", "words", " ", "by", " ", "loading", " ", 
     "from", " ", 
     RowBox[{"disk", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"AddInfo", "[", "queryAssoc_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "textPageFile", ",", "textPageRef", ",", "textPageImg", ",", 
       "textPageCap", ",", "imgBio", ",", "imgID", ",", "imgIDs", ",", 
       "imgCaptions", ",", "imgTitles", ",", "additionalWords"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"KeyExistsQ", "[", 
        RowBox[{"queryAssoc", ",", "\"\<type\>\""}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"queryAssoc", "[", "\"\<type\>\"", "]"}], "===", 
          "\"\<text\>\""}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"textPageFile", "=", 
           RowBox[{"Import", "[", 
            RowBox[{
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"FileNameJoin", "[", 
                 RowBox[{"{", 
                  RowBox[{
                  "$repoFolder", ",", "\"\<data\>\"", ",", "\"\<pages\>\""}], 
                  "}"}], "]"}], ",", 
                RowBox[{"StringTake", "[", 
                 RowBox[{
                  RowBox[{"queryAssoc", "[", 
                   RowBox[{"[", "\"\<textPageID\>\"", "]"}], "]"}], ",", 
                  RowBox[{"UpTo", "[", "4", "]"}]}], "]"}], ",", 
                RowBox[{
                 RowBox[{"queryAssoc", "[", 
                  RowBox[{"[", "\"\<textPageID\>\"", "]"}], "]"}], "<>", 
                 "\"\<.json\>\""}]}], "}"}], "]"}], ",", "\"\<RAWJson\>\"", 
             ",", 
             RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}]}], ";", 
          RowBox[{"textPageRef", "=", 
           RowBox[{"textPageFile", "[", 
            RowBox[{"[", "\"\<references\>\"", "]"}], "]"}]}], ";", 
          RowBox[{"textPageImg", "=", 
           RowBox[{"textPageFile", "[", 
            RowBox[{"[", "\"\<mediaLinks\>\"", "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"textPageCap", "=", 
           RowBox[{"textPageFile", "[", 
            RowBox[{"[", "\"\<mediaCaptions\>\"", "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"additionalWords", "=", 
           RowBox[{"ToLowerCase", "@", 
            RowBox[{"WordStem", "@", 
             RowBox[{"DeleteStopwords", "@", 
              RowBox[{"TextWordsFast", "[", 
               RowBox[{"StringRiffle", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"queryAssoc", "[", 
                   RowBox[{"[", "\"\<textSentence\>\"", "]"}], "]"}], ",", 
                  RowBox[{"queryAssoc", "[", 
                   RowBox[{"[", "\"\<textTitle\>\"", "]"}], "]"}]}], "}"}], 
                "]"}], "]"}]}]}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Join", "[", 
           RowBox[{"Association", "[", 
            RowBox[{"queryAssoc", ",", 
             RowBox[{"Association", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"\"\<textPageRef\>\"", "->", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "->", 
                    RowBox[{"textPageRef", "[", "#", "]"}]}], "&"}], "/@", 
                  RowBox[{"StringCases", "[", 
                   RowBox[{
                    RowBox[{"queryAssoc", "[", 
                    RowBox[{"[", "\"\<textSentence\>\"", "]"}], "]"}], ",", 
                    RowBox[{"Keys", "@", "textPageRef"}]}], "]"}]}], ")"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<textPageImg\>\"", "->", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "->", 
                    RowBox[{"textPageImg", "[", "#", "]"}]}], "&"}], "/@", 
                  RowBox[{"StringCases", "[", 
                   RowBox[{
                    RowBox[{"queryAssoc", "[", 
                    RowBox[{"[", "\"\<textSentence\>\"", "]"}], "]"}], ",", 
                    RowBox[{"Keys", "@", "textPageImg"}]}], "]"}]}], ")"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<textPageCap\>\"", "->", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "->", 
                    RowBox[{"textPageCap", "[", "#", "]"}]}], "&"}], "/@", 
                  RowBox[{"StringCases", "[", 
                   RowBox[{
                    RowBox[{"queryAssoc", "[", 
                    RowBox[{"[", "\"\<textSentence\>\"", "]"}], "]"}], ",", 
                    RowBox[{"Keys", "@", "textPageCap"}]}], "]"}]}], ")"}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<additionalWords\>\"", "->", "additionalWords"}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<textInfo\>\"", "->", "True"}]}], "]"}]}], "]"}], 
           "]"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"imgBio", "=", 
           RowBox[{"Import", "[", 
            RowBox[{
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"FileNameJoin", "[", 
                 RowBox[{"{", 
                  RowBox[{
                  "$repoFolder", ",", "\"\<data\>\"", ",", "\"\<imgBios\>\"", 
                   ",", "\"\<json\>\""}], "}"}], "]"}], ",", 
                RowBox[{"StringTake", "[", 
                 RowBox[{
                  RowBox[{"queryAssoc", "[", 
                   RowBox[{"[", "\"\<imgHash\>\"", "]"}], "]"}], ",", 
                  RowBox[{"UpTo", "[", "3", "]"}]}], "]"}], ",", 
                RowBox[{
                 RowBox[{"queryAssoc", "[", 
                  RowBox[{"[", "\"\<imgHash\>\"", "]"}], "]"}], "<>", 
                 "\"\<.json\>\""}]}], "}"}], "]"}], ",", "\"\<RAWJson\>\"", 
             ",", 
             RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}]}], ";", 
          RowBox[{"imgIDs", "=", 
           RowBox[{"Keys", "[", "imgBio", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"imgID", "=", 
           RowBox[{"imgIDs", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"imgCaptions", "=", 
           RowBox[{"Values", "@", 
            RowBox[{"imgBio", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"imgIDs", "[", 
                RowBox[{"[", "All", "]"}], "]"}], ",", "\"\<cap\>\""}], "]"}],
              "]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"imgTitles", "=", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"AssociationQ", "[", "$idTitleIndex", "]"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"$idTitleIndex", "[", 
                RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", "imgIDs"}], ",", 
             "\"\<\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"additionalWords", "=", 
           RowBox[{"ToLowerCase", "@", 
            RowBox[{"WordStem", "@", 
             RowBox[{"DeleteStopwords", "@", 
              RowBox[{"TextWordsFast", "[", 
               RowBox[{"StringRiffle", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"imgCaptions", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"imgTitles", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}], 
               "]"}]}]}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Join", "[", 
           RowBox[{"Association", "[", 
            RowBox[{"queryAssoc", ",", 
             RowBox[{"Association", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"\"\<imgID\>\"", "->", "imgID"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<imgIDs\>\"", "->", "imgIDs"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<imgCaptions\>\"", "->", "imgCaptions"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<imgCaption\>\"", "->", 
                RowBox[{"imgCaptions", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<imgTitles\>\"", "->", "imgTitles"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<imgTitle\>\"", "->", 
                RowBox[{"imgTitles", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<additionalWords\>\"", "->", "additionalWords"}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<imgInfo\>\"", "->", "True"}]}], 
              "\[IndentingNewLine]", "]"}]}], "]"}], "]"}]}]}], "]"}], ",", 
       "Nothing"}], "]"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.93608449903389*^9, 3.936084504633882*^9}, {
   3.936084584363019*^9, 3.936084654086318*^9}, {3.936084900500939*^9, 
   3.936084947557836*^9}, {3.9360850384812927`*^9, 3.9360851527611303`*^9}, {
   3.936085439473102*^9, 3.93608544451735*^9}, {3.936085489604166*^9, 
   3.936085547210012*^9}, {3.9360857296752853`*^9, 3.93608573847505*^9}, {
   3.936085813188375*^9, 3.936085833408807*^9}, {3.936086011530038*^9, 
   3.9360860163000517`*^9}, {3.9360869138476048`*^9, 
   3.9360869140023727`*^9}, {3.936087030006153*^9, 3.936087052322342*^9}, {
   3.9360873514781837`*^9, 3.936087364156705*^9}, {3.936087809167515*^9, 
   3.936087822569265*^9}, {3.936092250908551*^9, 3.936092322439505*^9}, {
   3.937802396115594*^9, 3.937802428009205*^9}, {3.937802479271503*^9, 
   3.937802520162573*^9}, {3.9378025730839376`*^9, 3.937802662212059*^9}, {
   3.9378027578561907`*^9, 3.937802861025538*^9}, {3.937803031520934*^9, 
   3.9378030330928593`*^9}, {3.937803072976726*^9, 3.937803082308834*^9}, {
   3.9378031860799417`*^9, 3.9378032040184298`*^9}, {3.93781948136061*^9, 
   3.9378195114112663`*^9}, {3.937820219016761*^9, 3.9378202278920794`*^9}, {
   3.937820259160982*^9, 3.937820262591441*^9}, 3.937820304146595*^9, {
   3.937820367249713*^9, 3.937820425743033*^9}, {3.937821986595605*^9, 
   3.937822011945866*^9}, {3.937822047115192*^9, 3.9378220931306868`*^9}, {
   3.937822553377364*^9, 3.937822598351448*^9}, {3.93799898608375*^9, 
   3.9379990256332703`*^9}, {3.9379991412777367`*^9, 3.937999145742845*^9}, {
   3.9612176558409643`*^9, 3.961217655842825*^9}, {3.9612490174096603`*^9, 
   3.9612490262982683`*^9}, 3.9612490935717697`*^9},
 CellLabel->
  "In[189]:=",ExpressionUUID->"05dff5bc-13ef-4408-a9b2-966ce8582710"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "query"}], " ", "list", " ", "with", " ", "SOM", " ", 
      "results"}]}], ",", 
    RowBox[{
     RowBox[{"-", "guideSentenceID"}], " ", "optional", " ", "guide", " ", 
     "sentence", " ", "ID"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "guideSentence"}], " ", "optional", " ", "guide", " ", 
      "sentence"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Association"}], " ", "with", " ", "organized", " ", 
       "match", " ", "metadata"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Combines", " ", "query", " ", "match", " ", "data", " ", "into", " ", 
       "a", " ", "standardized", " ", "association", " ", "for", " ", 
       "further", " ", 
       RowBox[{"processing", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CollateEnAssoc", "[", 
    RowBox[{"query_", ",", 
     RowBox[{"guideSentenceID_", ":", "\"\<\>\""}], ",", 
     RowBox[{"guideSentence_", ":", "\"\<\>\""}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "imgID", ",", "imgTitle", ",", "img", ",", "imgBio", ",", "imgCaption", 
       ",", "textID", ",", "textTitle", ",", "textSentence", ",", 
       "additionalWords", ",", "tokens"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"ListQ", "[", "query", "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "@", "query"}], "==", "5"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"StringContainsQ", "[", 
            RowBox[{
             RowBox[{"query", "[", 
              RowBox[{"[", "4", "]"}], "]"}], ",", "\"\<_\>\""}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"textID", "=", 
             RowBox[{
              RowBox[{"StringSplit", "[", 
               RowBox[{
                RowBox[{"query", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", "\"\<_\>\""}], "]"}], 
              "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"textTitle", "=", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"AssociationQ", "[", "$idTitleIndex", "]"}], ",", 
               RowBox[{"$idTitleIndex", "[", 
                RowBox[{"[", "textID", "]"}], "]"}], ",", 
               RowBox[{"WikipediaData", "[", 
                RowBox[{
                 RowBox[{"\"\<PageID\>\"", "->", "textID"}], ",", 
                 "\"\<Title\>\""}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"textSentence", "=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Import", "[", 
                  RowBox[{
                   RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "$repoFolder", ",", "\"\<data\>\"", ",", "\"\<text\>\""}],
                     "}"}], "]"}], ",", 
                    RowBox[{"StringTake", "[", 
                    RowBox[{"textID", ",", 
                    RowBox[{"UpTo", "[", "4", "]"}]}], "]"}], ",", 
                    RowBox[{"#", "<>", "\"\<.json\>\""}]}], "}"}], "]"}], 
                   ",", "\"\<RawJSON\>\"", ",", 
                   RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}], 
                 "&"}], "@", "textID"}], ")"}], "[", 
              RowBox[{"[", 
               RowBox[{"query", "[", 
                RowBox[{"[", "4", "]"}], "]"}], "]"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Association", "[", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"\"\<guideSentenceID\>\"", "->", "guideSentenceID"}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<guideSentence\>\"", "->", "guideSentence"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<type\>\"", "->", "\"\<text\>\""}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<textBmu\>\"", "->", 
                RowBox[{"query", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<textBme\>\"", "->", 
                RowBox[{"query", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<textDis\>\"", "->", 
                RowBox[{"query", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<textID\>\"", "->", 
                RowBox[{"query", "[", 
                 RowBox[{"[", "4", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<textPageID\>\"", "->", "textID"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<textTitle\>\"", "->", "textTitle"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<textSentence\>\"", "->", "textSentence"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<vector_ref\>\"", "->", 
                RowBox[{"query", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}]}], "}"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"img", "=", 
             RowBox[{"Import", "[", 
              RowBox[{
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"FileNameJoin", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    "$repoFolder", ",", "\"\<data\>\"", ",", "\"\<img\>\""}], 
                    "}"}], "]"}], ",", 
                  RowBox[{"StringTake", "[", 
                   RowBox[{
                    RowBox[{"query", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], ",", "3"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"query", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "<>", "\"\<.jpg\>\""}]}], 
                 "}"}], "]"}], ",", 
               RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"Association", "[", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"\"\<guideSentenceID\>\"", "->", "guideSentenceID"}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<guideSentence\>\"", "->", "guideSentence"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<type\>\"", "->", "\"\<img\>\""}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<imgBmu\>\"", "->", 
                RowBox[{"query", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<imgBme\>\"", "->", 
                RowBox[{"query", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<imgDis\>\"", "->", 
                RowBox[{"query", "[", 
                 RowBox[{"[", "3", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<imgHash\>\"", "->", 
                RowBox[{"query", "[", 
                 RowBox[{"[", "4", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{"\"\<img\>\"", "->", "img"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"\"\<vector_ref\>\"", "->", 
                RowBox[{"query", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}]}], "}"}], "]"}]}]}], "]"}], 
         ",", 
         RowBox[{"Association", "[", "]"}]}], "]"}], ",", 
       RowBox[{"Association", "[", "]"}]}], "]"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9194936842956295`*^9, 3.9194937610085363`*^9}, {
   3.9194937910836277`*^9, 3.919493842243315*^9}, {3.9194938813045535`*^9, 
   3.919494107860267*^9}, {3.9194942043885393`*^9, 3.919494316961014*^9}, {
   3.91949465105192*^9, 3.919495056813879*^9}, 3.919495185823708*^9, {
   3.9194952329189796`*^9, 3.9194952375202656`*^9}, {3.919495294317602*^9, 
   3.9194953590533514`*^9}, {3.919961756711174*^9, 3.9199617729117002`*^9}, {
   3.919996283532939*^9, 3.919996315295865*^9}, {3.919996356713546*^9, 
   3.9199964595910892`*^9}, 3.919996582476059*^9, {3.92001734548657*^9, 
   3.92001740360872*^9}, {3.935476271829054*^9, 3.935476272169722*^9}, {
   3.935476534432219*^9, 3.935476539134513*^9}, {3.93547926901987*^9, 
   3.935479302693914*^9}, {3.9354795294348717`*^9, 3.935479546600273*^9}, {
   3.9354798267786303`*^9, 3.935480235402863*^9}, {3.9354803285349007`*^9, 
   3.935480329563704*^9}, 3.9354804537487297`*^9, 3.935480516719067*^9, {
   3.935480569385672*^9, 3.935480573100976*^9}, {3.935480619627293*^9, 
   3.935480622909583*^9}, {3.935480664689434*^9, 3.935480699761302*^9}, {
   3.935481100902444*^9, 3.935481160610132*^9}, {3.935481202059963*^9, 
   3.935481315718874*^9}, {3.9354813583645763`*^9, 3.935481371643362*^9}, {
   3.935481405314805*^9, 3.935481440471396*^9}, {3.935481485727228*^9, 
   3.935481487559062*^9}, {3.935482061335166*^9, 3.935482107311294*^9}, {
   3.935482701021085*^9, 3.9354827031649323`*^9}, {3.935483276414147*^9, 
   3.935483322616683*^9}, {3.935483353222947*^9, 3.935483429689522*^9}, {
   3.935483488755021*^9, 3.935483552805893*^9}, {3.935483805572785*^9, 
   3.9354838057806997`*^9}, {3.935483924313716*^9, 3.935483924519623*^9}, {
   3.935638337105246*^9, 3.935638352194077*^9}, {3.935638405327341*^9, 
   3.9356384509447737`*^9}, {3.9356387762465*^9, 3.935638799502981*^9}, {
   3.935664864465629*^9, 3.935664877524363*^9}, {3.935722331151672*^9, 
   3.9357223668009*^9}, {3.936066244426474*^9, 3.936066283284377*^9}, 
   3.936066329031371*^9, 3.936066360410514*^9, {3.936079928136018*^9, 
   3.936079929477479*^9}, 3.936079962979019*^9, {3.93608455096986*^9, 
   3.936084571237306*^9}, {3.936085758125805*^9, 3.936085765736771*^9}, {
   3.936085915289874*^9, 3.93608591613855*^9}, {3.936086133934142*^9, 
   3.936086180182947*^9}, {3.936086331051634*^9, 3.936086334121277*^9}, {
   3.936086442217016*^9, 3.9360864452460012`*^9}, {3.936086762736228*^9, 
   3.936086778329051*^9}, {3.937819523306884*^9, 3.937819570460869*^9}, {
   3.937819724678185*^9, 3.9378197869011593`*^9}, {3.937819951399819*^9, 
   3.937820054525422*^9}, {3.937820096365611*^9, 3.937820108940692*^9}, {
   3.937885622276512*^9, 3.937885622787281*^9}, {3.937999171924391*^9, 
   3.9379992307980213`*^9}, {3.9379992984891567`*^9, 3.93799930270087*^9}, {
   3.961217655844535*^9, 3.9612176558460073`*^9}, {3.961248971541882*^9, 
   3.961248981229766*^9}},
 CellLabel->
  "In[190]:=",ExpressionUUID->"5866b1ad-db6d-4ad9-be88-536dd6588e09"]
}, Closed]],

Cell[CellGroupData[{

Cell["SOM Decoding Functions", "Subtitle",
 CellChangeTimes->{{3.873539554198429*^9, 3.87353956385848*^9}, {
  3.873539727707151*^9, 3.873539729825041*^9}, {3.898786755033476*^9, 
  3.89878675719049*^9}, {3.8996443472215767`*^9, 3.899644348917593*^9}, {
  3.8997809578403296`*^9, 3.8997809633636866`*^9}, {3.8997810257985897`*^9, 
  3.899781030617282*^9}, {3.8997810679876633`*^9, 3.899781071456896*^9}, {
  3.899806668643939*^9, 3.8998066690317383`*^9}, {3.937799256768839*^9, 
  3.937799260727551*^9}, {3.961229411645583*^9, 
  3.961229412045218*^9}},ExpressionUUID->"a4e8bd8a-5bf1-4b55-b322-\
b3147c6bda2c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{"-", "elem1"}]}], ",", 
    RowBox[{"elem2", " ", "result", " ", "associations"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "dictReverse"}], " ", "reverse", " ", "dictionary"}], ",", 
    " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "additionalWords"}], " ", "optional", " ", "list"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Association"}], " ", "with", " ", "commonTokens"}]}]}], 
    ",", "commonWords", ",", 
    RowBox[{"distance", ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Compares", " ", "two", " ", "elements", " ", "by", " ", "shared", " ", 
       "tokens", " ", "and", " ", "vector", " ", 
       RowBox[{"distance", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CompareElements", "[", 
    RowBox[{"elem1_", ",", "elem2_", ",", "dictReverse_", ",", 
     RowBox[{"additionalWords_", ":", 
      RowBox[{"{", "}"}]}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "commonTokens", ",", "commonTokensUnique", ",", "words", ",", 
       "distance"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"KeyExistsQ", "[", 
              RowBox[{"elem1", ",", "\"\<keywords\>\""}], "]"}], ",", 
             RowBox[{"KeyExistsQ", "[", 
              RowBox[{"elem2", ",", "\"\<keywords\>\""}], "]"}]}], "}"}], ",",
            "False"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"commonTokens", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"Intersection", "[", 
             RowBox[{
              RowBox[{"elem1", "[", 
               RowBox[{"[", "\"\<keywords\>\"", "]"}], "]"}], ",", 
              RowBox[{"elem2", "[", 
               RowBox[{"[", "\"\<keywords\>\"", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"Intersection", "[", 
             RowBox[{
              RowBox[{"elem1", "[", 
               RowBox[{"[", "\"\<words\>\"", "]"}], "]"}], ",", 
              RowBox[{"elem2", "[", 
               RowBox[{"[", "\"\<words\>\"", "]"}], "]"}]}], "]"}]}], "]"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"commonTokensUnique", "=", 
          RowBox[{"Reverse", "@", 
           RowBox[{"DeleteDuplicates", "@", "commonTokens"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"words", "=", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"Flatten", "@", 
             RowBox[{"Join", "[", 
              RowBox[{"{", 
               RowBox[{"additionalWords", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"DictDecodeEntry", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", "#", "}"}], "}"}], ",", "dictReverse"}], 
                   "]"}], "&"}], "/@", "commonTokensUnique"}]}], "}"}], 
              "]"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"StringLength", "[", "#", "]"}], ">", "2"}], "&"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"distance", "=", 
          RowBox[{"EuclideanDistance", "[", 
           RowBox[{
            RowBox[{"elem1", "[", 
             RowBox[{"[", "\"\<vector_ref\>\"", "]"}], "]"}], ",", 
            RowBox[{"elem2", "[", 
             RowBox[{"[", "\"\<vector_ref\>\"", "]"}], "]"}]}], "]"}]}], 
         ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"words", "=", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"Intersection", "[", 
             RowBox[{
              RowBox[{"elem1", "[", 
               RowBox[{"[", "\"\<additionalWords\>\"", "]"}], "]"}], ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"KeyExistsQ", "[", 
                 RowBox[{"elem2", ",", "\"\<additionalWords\>\""}], "]"}], 
                ",", 
                RowBox[{"elem2", "[", 
                 RowBox[{"[", "\"\<additionalWords\>\"", "]"}], "]"}], ",", 
                RowBox[{"Flatten", "[", 
                 RowBox[{"DictDecodeEntry", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"elem2", "[", 
                    RowBox[{"[", "\"\<words\>\"", "]"}], "]"}], "}"}], ",", 
                   "dictReverse"}], "]"}], "]"}]}], "]"}]}], "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"StringLength", "[", "#", "]"}], ">", "2"}], "&"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"distance", "=", 
          RowBox[{"Which", "[", 
           RowBox[{
            RowBox[{"KeyExistsQ", "[", 
             RowBox[{"elem2", ",", "\"\<textDis\>\""}], "]"}], ",", 
            RowBox[{"elem2", "[", 
             RowBox[{"[", "\"\<textDis\>\"", "]"}], "]"}], ",", 
            RowBox[{"KeyExistsQ", "[", 
             RowBox[{"elem2", ",", "\"\<imgDis\>\""}], "]"}], ",", 
            RowBox[{"elem2", "[", 
             RowBox[{"[", "\"\<imgDis\>\"", "]"}], "]"}], ",", 
            RowBox[{"!", 
             RowBox[{"MemberQ", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"KeyExistsQ", "[", 
                  RowBox[{"elem2", ",", "#"}], "]"}], "&"}], "/@", 
                RowBox[{"{", 
                 RowBox[{"\"\<imgDis\>\"", ",", "\"\<textDis\>\""}], "}"}]}], 
               ",", "True"}], "]"}]}], ",", 
            RowBox[{"CosineDistance", "[", 
             RowBox[{
              RowBox[{"elem1", "[", 
               RowBox[{"[", "\"\<vector_ref\>\"", "]"}], "]"}], ",", 
              RowBox[{"elem2", "[", 
               RowBox[{"[", "\"\<vector_ref\>\"", "]"}], "]"}]}], "]"}]}], 
           "]"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<commonTokens\>\"", "->", 
         RowBox[{"Length", "@", "words"}]}], ",", 
        RowBox[{"\"\<commonWords\>\"", "->", "words"}], ",", 
        RowBox[{"\"\<distance\>\"", "->", "distance"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.899455458566647*^9, 3.899455718268645*^9}, {
   3.911144588065578*^9, 3.911144590783551*^9}, {3.911144894420225*^9, 
   3.911144912419654*^9}, {3.9378186407519712`*^9, 3.937818711195314*^9}, {
   3.940490638655366*^9, 3.9404906621583567`*^9}, {3.9404906949390697`*^9, 
   3.9404907070075808`*^9}, {3.9404909617188053`*^9, 3.940490963476871*^9}, {
   3.940491007036233*^9, 3.940491007666264*^9}, {3.940491057801795*^9, 
   3.940491208870298*^9}, 3.940492045848926*^9, 3.940494773387089*^9, {
   3.9404950695946407`*^9, 3.940495070946308*^9}, 3.9404951445331984`*^9, {
   3.94051237913202*^9, 3.940512391263434*^9}, {3.940518764606082*^9, 
   3.940518768392049*^9}, {3.940521406839384*^9, 3.940521447147128*^9}, {
   3.961233709326017*^9, 3.961233745280018*^9}},
 CellLabel->
  "In[191]:=",ExpressionUUID->"ca0d19b1-0937-4386-a37c-4a774131741a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "customIndex"}], " ", "string", " ", "to", " ", "print", 
      " ", "on", " ", "header", " ", "1"}]}], ",", " ", 
    RowBox[{
     RowBox[{"-", "customInfo"}], " ", "string", " ", "to", " ", "print", " ",
      "on", " ", "header", " ", "2"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "element"}], " ", "result", " ", "association", " ", "with",
      " ", "info"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "guideAssoc"}], " ", "part", " ", "of", " ", "guide", " ", 
     "structure"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "allAssoc"}], " ", "additional", " ", "dictionaries", " ", 
     "for", " ", "lookup"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "allFolders"}], " ", "links", " ", "to", " ", 
     "filelocations"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "color"}], " ", "color", " ", "for", " ", "header", " ", 
     "line"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "highlights"}], " ", "list", " ", "of", " ", "words", " ", 
      "to", " ", "highlight"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "layouted"}], " ", "cells", " ", "with", " ", 
       "content"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Automatically", " ", "makes", " ", "layouted", " ", "cells", " ", 
       "depending", " ", "on", " ", "ID"}]}]}], ",", " ", 
    RowBox[{"calling", " ", "other", " ", "Panel", " ", "functions"}]}], 
   "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"BuildPanel", "[", 
    RowBox[{
    "customIndex_", ",", "customInfo_", ",", "element_", ",", "guideAssoc_", 
     ",", "allAssoc_", ",", "allFolders_", ",", "color_", ",", 
     RowBox[{"highlights_", ":", 
      RowBox[{"{", "}"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "bookAssoc", ",", "bookFolder", ",", "scanAssoc", ",", "scanFolder", 
       ",", "soundAssoc", ",", "soundFolder", ",", "materialAssoc", ",", 
       "materialFolder", ",", "videoAssoc", ",", "videoFolder", ",", 
       "poemAssoc", ",", "aerialAssoc", ",", "aerialFolder", ",", "artAssoc", 
       ",", "artFolder", ",", "guideTokenAssoc", ",", "guideSentenceAssoc", 
       ",", "guideBookAssoc", ",", "sentenceAssoc"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"guideTokenAssoc", "=", 
       RowBox[{"guideAssoc", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"guideSentenceAssoc", "=", 
       RowBox[{"guideAssoc", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"guideBookAssoc", "=", 
       RowBox[{"guideAssoc", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"element", "===", 
         RowBox[{"Association", "[", "]"}]}], ",", "\"\<\>\"", ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Column", "[", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Spacer", "[", "1", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Row", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Text", "[", 
                RowBox[{"Style", "[", 
                 RowBox[{"customIndex", ",", 
                  RowBox[{"FontSize", "\[Rule]", "8"}], ",", 
                  RowBox[{"LineIndent", "->", "0"}], ",", 
                  RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], ",", 
                  RowBox[{"FontWeight", "->", "\"\<Bold\>\""}], ",", 
                  "color"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
               RowBox[{"Text", "[", 
                RowBox[{"Style", "[", 
                 RowBox[{"customInfo", ",", 
                  RowBox[{"FontSize", "\[Rule]", "8"}], ",", 
                  RowBox[{"LineIndent", "->", "0"}], ",", 
                  RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], ",", 
                  RowBox[{"FontWeight", "->", "\"\<Plain\>\""}], ",", 
                  "Black"}], "]"}], "]"}]}], "}"}], ",", "\"\< \>\""}], "]"}],
            ",", "\[IndentingNewLine]", 
           RowBox[{"Spacer", "[", "1", "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"KeyExistsQ", "[", 
              RowBox[{"element", ",", "\"\<id\>\""}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Which", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Not", "@", 
                RowBox[{"StringStartsQ", "[", 
                 RowBox[{
                  RowBox[{"element", "[", 
                   RowBox[{"[", "\"\<id\>\"", "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                   "\"\<GP\>\"", ",", "\"\<OL\>\"", ",", "\"\<OA\>\"", ",", 
                    "\"\<OT\>\"", ",", "\"\<SF\>\"", ",", "\"\<SE\>\"", ",", 
                    "\"\<MA\>\"", ",", "\"\<VI\>\"", ",", "\"\<PO\>\"", ",", 
                    "\"\<SA\>\"", ",", "\"\<AW\>\""}], "}"}]}], "]"}]}], ",", 
               RowBox[{"GuidePanel", "[", 
                RowBox[{
                "element", ",", "guideTokenAssoc", ",", "guideSentenceAssoc", 
                 ",", "guideBookAssoc", ",", "highlights"}], "]"}]}], "]"}], 
             ",", "\[IndentingNewLine]", 
             RowBox[{"WikiPanel", "[", 
              RowBox[{"element", ",", "highlights"}], "]"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}], "]"}]}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8994770958503*^9, 3.8994772251985064`*^9}, {
   3.899477265240548*^9, 3.899477336390528*^9}, {3.8994773899203157`*^9, 
   3.899477394405876*^9}, {3.899477538141973*^9, 3.89947758470962*^9}, {
   3.899477672398679*^9, 3.899477688511218*^9}, {3.899477992298183*^9, 
   3.899477996571327*^9}, {3.899478049541549*^9, 3.8994781776765175`*^9}, {
   3.899481164982629*^9, 3.899481172822344*^9}, {3.8994852483646507`*^9, 
   3.899485529284749*^9}, 3.899486111840565*^9, {3.899654064571924*^9, 
   3.8996540696226344`*^9}, 3.899654103153808*^9, {3.899654180560128*^9, 
   3.89965424756922*^9}, 3.8996566873169837`*^9, {3.8996600563545513`*^9, 
   3.8996600858631697`*^9}, {3.899701503689093*^9, 3.899701505082185*^9}, {
   3.899701969831219*^9, 3.899702049163708*^9}, {3.899702453305958*^9, 
   3.899702456003234*^9}, {3.899710494948344*^9, 3.899710532366885*^9}, {
   3.89971082938793*^9, 3.8997108294944687`*^9}, {3.899710933962795*^9, 
   3.899710939775591*^9}, {3.8997111907057323`*^9, 3.899711202764079*^9}, 
   3.8998170300525837`*^9, {3.8998171667501564`*^9, 3.899817233252016*^9}, {
   3.899825789036689*^9, 3.899825863856172*^9}, {3.8998962612139034`*^9, 
   3.899896291861671*^9}, {3.899898210543767*^9, 3.899898217744235*^9}, {
   3.899899419009952*^9, 3.8998994365312004`*^9}, 3.899900919764148*^9, {
   3.899901990221464*^9, 3.8999019920972877`*^9}, {3.899903838674794*^9, 
   3.8999038406417484`*^9}, {3.900251066169002*^9, 3.900251095851387*^9}, {
   3.900307556155539*^9, 3.9003075674360332`*^9}, 3.9043655938938212`*^9, {
   3.904381756069313*^9, 3.904381836095298*^9}, {3.90759660551292*^9, 
   3.907596605698302*^9}, {3.907596655127898*^9, 3.907596659370409*^9}, {
   3.907596696047778*^9, 3.907596952850065*^9}, {3.9076129765590057`*^9, 
   3.907613029146532*^9}, {3.90761336164324*^9, 3.90761337396561*^9}, {
   3.9109635318111134`*^9, 3.9109635851668367`*^9}, {3.910966469541898*^9, 
   3.910966477481173*^9}, {3.91096888490312*^9, 3.910968885062647*^9}, {
   3.910968919944278*^9, 3.9109689509059353`*^9}, 3.911297128153553*^9, {
   3.933414825323951*^9, 3.9334148394600973`*^9}, {3.93779938874422*^9, 
   3.9377993891040897`*^9}, {3.9377994838727903`*^9, 3.937799485523466*^9}, 
   3.9378002473243628`*^9, {3.9378004817678022`*^9, 3.937800496466792*^9}, {
   3.937800544706984*^9, 3.937800545250766*^9}, {3.937800644306982*^9, 
   3.937800644587269*^9}, 3.93780197141921*^9, {3.937802105715639*^9, 
   3.937802170786085*^9}, {3.9378022244238157`*^9, 3.9378022278164062`*^9}, {
   3.937823117882744*^9, 3.937823150225185*^9}, {3.937823289323927*^9, 
   3.937823295608615*^9}, {3.937887560781114*^9, 3.9378875993866377`*^9}, {
   3.937906337676532*^9, 3.937906371660915*^9}, {3.937999413350512*^9, 
   3.937999414967342*^9}, {3.937999453608882*^9, 3.9379994537378387`*^9}, {
   3.938006808180846*^9, 3.938006820249958*^9}, {3.938006875053564*^9, 
   3.938006883396523*^9}, {3.9380828533878202`*^9, 3.9380828648223543`*^9}, {
   3.9380829070231133`*^9, 3.938082910334736*^9}, {3.961219034686784*^9, 
   3.961219040965941*^9}, {3.96123375902647*^9, 3.961233956281646*^9}, {
   3.9612339877790213`*^9, 3.96123412931136*^9}},
 CellLabel->
  "In[192]:=",ExpressionUUID->"f896f793-7880-4dd9-88f1-b7aba50b26ec"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "sentence"}], " ", "input", " ", "sentence"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "highlights"}], " ", "list", " ", "of", " ", "stems", " ", 
      "to", " ", "match"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "list"}], " ", "of", " ", "matching", " ", "words", " ", 
       "from", " ", "the", " ", "sentence"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Finds", " ", "words", " ", "in", " ", "a", " ", "sentence", " ", 
       "that", " ", "match", " ", "provided", " ", "word", " ", 
       RowBox[{"stems", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"FindWordsFromStems", "[", 
    RowBox[{"sentence_", ",", "highlights_"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"words", ",", "stems", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"words", "=", 
       RowBox[{"TextWordsFast", "@", "sentence"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"stems", "=", 
       RowBox[{"WordStem", "@", 
        RowBox[{"ToLowerCase", "@", "words"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"stems", ",", "#"}], "]"}], "&"}], "/@", "highlights"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Flatten", "[", "pos", "]"}], "]"}], "<", "1"}], ",", 
        RowBox[{"{", "}"}], ",", 
        RowBox[{"Part", "[", 
         RowBox[{"words", ",", "pos"}], "]"}]}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.910965437342371*^9, 3.910965452405857*^9}, {
   3.91096586030058*^9, 3.910965928274089*^9}, {3.910966946840248*^9, 
   3.910966954105124*^9}, {3.910967016127205*^9, 3.9109670162372293`*^9}, {
   3.9109670575884*^9, 3.910967067405394*^9}, {3.9109671035027122`*^9, 
   3.9109671072990313`*^9}, 3.9109673117407417`*^9, {3.910967350046617*^9, 
   3.910967366448687*^9}, {3.910967422354045*^9, 3.910967423948454*^9}, {
   3.910967768638885*^9, 3.910967771641795*^9}, {3.961248418529657*^9, 
   3.961248421684169*^9}},
 CellLabel->
  "In[193]:=",ExpressionUUID->"cd2b3f03-4ca5-4fde-b4e1-76fbdfeb1243"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "text"}], " ", "input", " ", "string"}]}], ",", 
    RowBox[{
     RowBox[{"-", "words"}], " ", "list", " ", "of", " ", "words", " ", "to", 
     " ", "highlight"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "type"}], " ", "highlight", " ", "style", " ", 
      RowBox[{"(", 
       RowBox[{
       "\"\<highlighted\>\"", ",", "\"\<underlined\>\"", ",", 
        "\"\<italicized\>\""}], ")"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "styled"}], " ", "string", " ", "with", " ", 
       "highlighted", " ", "words"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Applies", " ", "visual", " ", "highlighting", " ", "or", " ", 
       "styling", " ", "to", " ", "selected", " ", "words", " ", "in", " ", 
       "a", " ", 
       RowBox[{"string", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"HighlightText", "[", 
    RowBox[{"text_", ",", "words_", ",", 
     RowBox[{"type_", ":", "\"\<highlighted\>\""}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"splitText", ",", "highlightedWords"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", "words"}], "<", "1"}], ",", 
        RowBox[{"Return", "[", "text", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"splitText", "=", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"text", ",", 
         RowBox[{
          RowBox[{"x", ":", 
           RowBox[{"Alternatives", "@@", "words"}]}], ":>", "x"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"highlightedWords", "=", 
       RowBox[{"splitText", "/.", " ", 
        RowBox[{
         RowBox[{"word", ":", 
          RowBox[{"Alternatives", "@@", "words"}]}], ":>", 
         RowBox[{"ToString", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Which", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"type", "==", "\"\<highlighted\>\""}], ",", 
             RowBox[{"Framed", "[", 
              RowBox[{
               RowBox[{"Style", "[", 
                RowBox[{"word", ",", 
                 RowBox[{"FontColor", "->", "White"}]}], "]"}], ",", 
               RowBox[{"Background", "->", "Black"}], ",", 
               RowBox[{"FrameStyle", "->", "None"}], ",", 
               RowBox[{"FrameMargins", "->", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "2"}], ",", 
                    RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], ",", 
               RowBox[{"BaselinePosition", "->", "Baseline"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"type", "==", "\"\<underlined\>\""}], ",", 
             RowBox[{"Style", "[", 
              RowBox[{"word", ",", "Underlined"}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"type", "==", "\"\<italicized\>\""}], ",", 
             RowBox[{"Style", "[", 
              RowBox[{"word", ",", 
               RowBox[{"FontSlant", "->", "Italic"}]}], "]"}]}], "]"}], ",", 
           "StandardForm"}], "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Style", "[", 
       RowBox[{
        RowBox[{"StringJoin", "[", "highlightedWords", "]"}], ",", 
        RowBox[{"LineIndent", "->", "0"}], ",", 
        RowBox[{"LineSpacing", "->", "2"}]}], "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.911044966334319*^9, 3.9110449665473757`*^9}, {
   3.911045126615774*^9, 3.911045233676486*^9}, 3.911045331301745*^9, 
   3.911046383126606*^9, 3.9110465109323483`*^9, {3.911046555203488*^9, 
   3.911046558950066*^9}, {3.911046610413274*^9, 3.911046611970519*^9}, {
   3.96124843283885*^9, 3.961248441431713*^9}},
 CellLabel->
  "In[194]:=",ExpressionUUID->"053264ad-b44f-446a-8641-f0e8d17257db"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "element"}], " ", "result", " ", "association"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "highlights"}], " ", "list", " ", "of", " ", "word", " ", 
      "stems", " ", "to", " ", "highlight"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "formatted"}], " ", "pane", " ", "with", " ", "Wikipedia",
        " ", "image", " ", "or", " ", "text", " ", "entry"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{"Displays", " ", "a", " ", "Wikipedia", " ", "entry", " ", 
       RowBox[{"(", 
        RowBox[{"image", " ", "or", " ", "text"}], ")"}], " ", "with", " ", 
       "title"}]}]}], ",", "caption", ",", 
    RowBox[{"and", " ", "optional", " ", 
     RowBox[{"highlights", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"WikiPanel", "[", 
    RowBox[{"element_", ",", 
     RowBox[{"highlights_", ":", 
      RowBox[{"{", "}"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "img", ",", "imgDim", ",", "link", ",", "highlightWords", ",", "ref"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", "\"\<type\>\"", "]"}], "]"}], "==", "\"\<img\>\""}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"KeyExistsQ", "[", 
            RowBox[{"#", ",", "\"\<imgInfo\>\""}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"link", "=", 
             RowBox[{"\"\<https://en.wikipedia.org/wiki?curid=\>\"", "<>", 
              RowBox[{"#", "[", 
               RowBox[{"[", "\"\<imgID\>\"", "]"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"highlightWords", "=", 
             RowBox[{"FindWordsFromStems", "[", 
              RowBox[{
               RowBox[{"StringRiffle", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "\"\<imgTitle\>\"", "]"}], "]"}], ",", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "\"\<imgCaption\>\"", "]"}], "]"}]}], "}"}], 
                "]"}], ",", "highlights"}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Grid", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{"Column", "[", 
                 RowBox[{"DeleteCases", "[", 
                  RowBox[{
                   RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{"(*", "Image", "*)"}], "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Hyperlink", "[", 
                    RowBox[{
                    RowBox[{"Image", "[", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "\"\<img\>\"", "]"}], "]"}], ",", 
                    RowBox[{"ImageSize", "->", 
                    RowBox[{"{", 
                    RowBox[{"200", ",", "Automatic"}], "}"}]}]}], "]"}], ",", 
                    "link"}], "]"}], ",", 
                    RowBox[{"LineIndent", "->", "0"}]}], "]"}], ",", 
                    RowBox[{"Spacer", "[", "0.1", "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"(*", "imgTitle", "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Hyperlink", "[", 
                    RowBox[{
                    RowBox[{"HighlightText", "[", 
                    RowBox[{
                    RowBox[{"element", "[", 
                    RowBox[{"[", "\"\<imgTitle\>\"", "]"}], "]"}], ",", 
                    "highlightWords"}], "]"}], ",", "link", ",", 
                    RowBox[{"ActiveStyle", "\[Rule]", "None"}], ",", 
                    RowBox[{"BaseStyle", "->", "Black"}]}], "]"}], ",", 
                    RowBox[{"FontSize", "\[Rule]", "10"}], ",", 
                    RowBox[{"LineIndent", "->", "0"}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", 
                    RowBox[{"FontWeight", "->", "\"\<Bold\>\""}]}], "]"}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", "imgCaption", "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"element", "[", 
                    RowBox[{"[", "\"\<imgCaption\>\"", "]"}], "]"}], "=!=", 
                    "\"\<\>\""}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Hyperlink", "[", 
                    RowBox[{
                    RowBox[{"HighlightText", "[", 
                    RowBox[{
                    RowBox[{"element", "[", 
                    RowBox[{"[", "\"\<imgCaption\>\"", "]"}], "]"}], ",", 
                    "highlightWords"}], "]"}], ",", "link", ",", 
                    RowBox[{"ActiveStyle", "\[Rule]", "None"}], ",", 
                    RowBox[{"BaseStyle", "->", "Black"}]}], "]"}], ",", 
                    RowBox[{"FontSize", "\[Rule]", "10"}], ",", 
                    RowBox[{"LineIndent", "->", "0"}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", 
                    RowBox[{"FontWeight", "->", "\"\<Plain\>\""}]}], "]"}], 
                    ",", "Nothing"}], "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{"other", " ", "Mentions"}], "*)"}], 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", 
                    RowBox[{"element", "[", 
                    RowBox[{"[", "\"\<imgTitles\>\"", "]"}], "]"}]}], ">", 
                    "1"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Row", "[", 
                    RowBox[{
                    RowBox[{"#", "&"}], "/@", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\<Also: \>\"", ",", 
                    RowBox[{"FontSize", "\[Rule]", "8"}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", 
                    RowBox[{"FontWeight", "->", "Plain"}], ",", 
                    RowBox[{"LineIndent", "\[Rule]", "0"}], ",", 
                    "\"\<Text\>\""}], "]"}], "}"}], ",", 
                    RowBox[{"Riffle", "[", 
                    RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Hyperlink", "[", 
                    RowBox[{
                    RowBox[{"HighlightText", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Capitalize", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"element", "[", 
                    RowBox[{"[", "\"\<imgTitles\>\"", "]"}], "]"}], "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    "\"\<LongWords\>\""}], "]"}], "<>", "\"\< \>\""}], ",", 
                    "highlightWords"}], "]"}], ",", 
                    RowBox[{"\"\<https://en.wikipedia.org/wiki?curid=\>\"", "<>", 
                    RowBox[{
                    RowBox[{"element", "[", 
                    RowBox[{"[", "\"\<imgIDs\>\"", "]"}], "]"}], "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ",", 
                    RowBox[{"BaseStyle", "\[Rule]", "Black"}], ",", 
                    RowBox[{"ActiveStyle", "\[Rule]", "None"}], ",", 
                    RowBox[{"Appearance", "->", "None"}], ",", 
                    RowBox[{"BaseStyle", "->", "\"\<Hyperlink\>\""}], ",", 
                    RowBox[{"FrameMargins", "->", "0"}]}], "]"}], ",", 
                    "Black", ",", 
                    RowBox[{"FontSize", "\[Rule]", "8"}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", 
                    RowBox[{"FontWeight", "->", "Plain"}], ",", 
                    RowBox[{"LineIndent", "\[Rule]", "0"}], ",", 
                    "\"\<Text\>\""}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "2", ",", 
                    RowBox[{"Length", "@", 
                    RowBox[{"element", "[", 
                    RowBox[{"[", "\"\<imgTitles\>\"", "]"}], "]"}]}]}], 
                    "}"}]}], "]"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\</ \>\"", ",", 
                    RowBox[{"FontSize", "\[Rule]", "8"}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", 
                    RowBox[{"FontWeight", "->", "Plain"}], ",", 
                    RowBox[{"LineIndent", "\[Rule]", "0"}], ",", 
                    "\"\<Text\>\""}], "]"}]}], "]"}]}], "]"}]}], "]"}], ",", 
                    RowBox[{"LineIndent", "->", "0"}], ",", 
                    RowBox[{"Hyphenation", "->", "False"}], ",", 
                    RowBox[{"LineSpacing", "->", 
                    RowBox[{"{", 
                    RowBox[{"0.7", ",", "0"}], "}"}]}]}], "]"}], ",", 
                    "Nothing"}], "]"}]}], "}"}], ",", "Nothing"}], "]"}], 
                 "]"}], "\[IndentingNewLine]", "}"}], "}"}], ",", 
              RowBox[{"ItemSize", "->", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"26", ",", "Automatic", ",", "Automatic"}], "}"}], 
                 ",", "Automatic"}], "}"}]}], ",", 
              RowBox[{"Alignment", "->", 
               RowBox[{"{", 
                RowBox[{"Left", ",", "Bottom"}], "}"}]}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"no", " ", "Info"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"Image", "[", 
            RowBox[{
             RowBox[{"#", "[", 
              RowBox[{"[", "\"\<img\>\"", "]"}], "]"}], ",", 
             RowBox[{"ImageSize", "->", 
              RowBox[{"{", 
               RowBox[{"200", ",", "Automatic"}], "}"}]}]}], "]"}]}], "]"}], 
         ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"link", "=", 
           RowBox[{"\"\<https://en.wikipedia.org/wiki?curid=\>\"", "<>", 
            RowBox[{
             RowBox[{"StringSplit", "[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", "\"\<textPageID\>\"", "]"}], "]"}], ",", 
               "\"\<_\>\""}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"highlightWords", "=", 
           RowBox[{"FindWordsFromStems", "[", 
            RowBox[{
             RowBox[{"StringRiffle", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "\"\<textSentence\>\"", "]"}], "]"}], ",", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "\"\<textTitle\>\"", "]"}], "]"}]}], "}"}], 
              "]"}], ",", "highlights"}], "]"}]}], ";", "\[IndentingNewLine]",
           "\[IndentingNewLine]", 
          RowBox[{"Column", "[", 
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{"(*", "text", "*)"}], "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Hyperlink", "[", 
                   RowBox[{
                    RowBox[{"HighlightText", "[", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "\"\<textSentence\>\"", "]"}], "]"}], ",", 
                    "highlightWords"}], "]"}], ",", "link", ",", 
                    RowBox[{"BaseStyle", "\[Rule]", "Black"}], ",", 
                    RowBox[{"ActiveStyle", "\[Rule]", "None"}], ",", 
                    RowBox[{"Appearance", "->", "None"}], ",", 
                    RowBox[{"BaseStyle", "->", "\"\<Hyperlink\>\""}], ",", 
                    RowBox[{"FrameMargins", "->", "0"}]}], "]"}], ",", 
                  "Black", ",", 
                  RowBox[{"FontSize", "\[Rule]", "12"}], ",", 
                  RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], ",", 
                  RowBox[{"LineIndent", "\[Rule]", "0"}], ",", 
                  "\"\<Text\>\""}], "]"}], ",", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"KeyExistsQ", "[", 
                   RowBox[{"#", ",", "\"\<textInfo\>\""}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"ref", "=", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Merge", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Merge", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "\"\<textPageCap\>\"", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "\"\<textPageImg\>\"", "]"}], "]"}]}], "}"}],
                     ",", "Identity"}], "]"}], ",", 
                    RowBox[{"IsolateLinks", "/@", 
                    RowBox[{"Association", "[", 
                    RowBox[{"#", "[", "\"\<textPageRef\>\"", "]"}], "]"}]}]}],
                     "}"}], ",", "First"}], "]"}], "&"}], "@", "element"}]}], 
                   ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", "title", "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"Column", "[", 
                    RowBox[{
                    RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Spacer", "[", "5", "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Hyperlink", "[", 
                    RowBox[{
                    RowBox[{"HighlightText", "[", 
                    RowBox[{
                    RowBox[{"Capitalize", "[", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "\"\<textTitle\>\"", "]"}], "]"}], ",", 
                    "\"\<LongWords\>\""}], "]"}], ",", "highlightWords"}], 
                    "]"}], ",", "link", ",", 
                    RowBox[{"BaseStyle", "\[Rule]", "Black"}], ",", 
                    RowBox[{"ActiveStyle", "\[Rule]", "None"}], ",", 
                    RowBox[{"Appearance", "->", "None"}], ",", 
                    RowBox[{"BaseStyle", "->", "\"\<Hyperlink\>\""}], ",", 
                    RowBox[{"FrameMargins", "->", "0"}]}], "]"}], ",", 
                    "Black", ",", 
                    RowBox[{"FontSize", "\[Rule]", "8"}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", 
                    RowBox[{"FontWeight", "->", "Bold"}], ",", 
                    RowBox[{"LineIndent", "\[Rule]", "0"}], ",", 
                    "\"\<Text\>\""}], "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", "refs", "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", "ref"}], ">", "0"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Column", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Row", "[", 
                    RowBox[{"#", ",", "\"\< \>\""}], "]"}], "&"}], "/@", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{"#", ",", "Black", ",", 
                    RowBox[{"FontSize", "\[Rule]", "6"}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", 
                    RowBox[{"FontWeight", "->", "Thin"}], ",", 
                    RowBox[{"LineIndent", "\[Rule]", "0"}], ",", 
                    RowBox[{"LineSpacing", "->", 
                    RowBox[{"{", 
                    RowBox[{"1.1", ",", "0"}], "}"}]}], ",", "\"\<Text\>\""}],
                     "]"}], "&"}], "/@", "\[IndentingNewLine]", 
                    RowBox[{"Riffle", "[", 
                    RowBox[{
                    RowBox[{"ToString", "/@", 
                    RowBox[{"Keys", "@", "ref"}]}], ",", 
                    RowBox[{"Values", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "===", "\"\<\>\""}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"Hyperlink", "[", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"BaseStyle", "\[Rule]", "Black"}], ",", 
                    RowBox[{"ActiveStyle", "\[Rule]", "None"}], ",", 
                    RowBox[{"Appearance", "->", "None"}]}], "]"}]}], "]"}], 
                    "&"}], "/@", "ref"}], "]"}]}], "]"}]}], ",", "2"}], 
                    "]"}]}], ",", 
                    RowBox[{"Spacings", "->", "0"}]}], "]"}], ",", 
                    "Nothing"}], "]"}]}], "}"}], ",", 
                    RowBox[{"Spacings", "->", "0"}]}], "]"}]}], ",", 
                  "Nothing"}], "]"}]}], "}"}], ",", "Nothing"}], "]"}], ",", 
            RowBox[{"Spacings", "->", "0"}]}], "]"}]}]}], "]"}], "&"}], "@", 
      "element"}]}], "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.899477699055206*^9, 3.8994778543807125`*^9}, {
   3.8994782700520487`*^9, 3.8994782810711*^9}, {3.8994783488857503`*^9, 
   3.899478400151562*^9}, {3.899478433929305*^9, 3.899478483542863*^9}, {
   3.899478514945953*^9, 3.8994785466129317`*^9}, {3.899478594693713*^9, 
   3.899478596539793*^9}, {3.899478627723192*^9, 3.8994786297868824`*^9}, {
   3.899485549538911*^9, 3.899485553009943*^9}, {3.8994861448359528`*^9, 
   3.899486152536027*^9}, {3.899649128362423*^9, 3.899649132052145*^9}, {
   3.899654253455759*^9, 3.899654275775393*^9}, {3.899654328307878*^9, 
   3.8996543305792623`*^9}, {3.899658274671308*^9, 3.8996583366298065`*^9}, {
   3.899658395835727*^9, 3.899658425539959*^9}, {3.8996584675111876`*^9, 
   3.89965862128024*^9}, {3.8997021317140512`*^9, 3.899702140025709*^9}, {
   3.899702340833277*^9, 3.899702343232395*^9}, {3.899709987365282*^9, 
   3.8997100336401997`*^9}, 3.8997113420970383`*^9, {3.89989631813769*^9, 
   3.899896318189198*^9}, {3.899897974624675*^9, 3.899897985274818*^9}, {
   3.899898158178924*^9, 3.8998981726094127`*^9}, 3.899898232620638*^9, {
   3.900249801113384*^9, 3.900249812941918*^9}, {3.900251265150521*^9, 
   3.900251265282599*^9}, {3.900262078879356*^9, 3.900262081780972*^9}, {
   3.900262705550169*^9, 3.900262708008169*^9}, {3.904221651978705*^9, 
   3.904221680374053*^9}, {3.904221895901189*^9, 3.904221917481595*^9}, 
   3.904222085764224*^9, {3.90422248631187*^9, 3.904222546386677*^9}, 
   3.904222628670034*^9, {3.9042848080898747`*^9, 3.904284808165926*^9}, 
   3.904303479869326*^9, 3.904303685105225*^9, 3.904303720795074*^9, {
   3.904377637644821*^9, 3.904377639429408*^9}, {3.907611299393909*^9, 
   3.907611397323019*^9}, {3.907611431187264*^9, 3.9076115034349136`*^9}, {
   3.910962499860379*^9, 3.910962527469966*^9}, {3.9109628368145633`*^9, 
   3.910962848680722*^9}, 3.910963108785735*^9, {3.9109652985513372`*^9, 
   3.910965305930011*^9}, {3.910965342005312*^9, 3.910965342153327*^9}, {
   3.910965995571847*^9, 3.910966019844124*^9}, {3.911030037938776*^9, 
   3.911030049932107*^9}, {3.937799805579289*^9, 3.937799812462267*^9}, {
   3.937800592166852*^9, 3.937800592559038*^9}, {3.9378018425519953`*^9, 
   3.937801870436944*^9}, {3.937803241759602*^9, 3.937803242508246*^9}, {
   3.937813722940843*^9, 3.937813843539063*^9}, {3.937813924941288*^9, 
   3.9378140620917463`*^9}, {3.937814132425191*^9, 3.937814192620688*^9}, 
   3.937814253136017*^9, {3.937814287710607*^9, 3.937814346144047*^9}, {
   3.93781445334523*^9, 3.937814472651896*^9}, {3.9378145603731823`*^9, 
   3.937814592679818*^9}, {3.9378147154932632`*^9, 3.937814752127857*^9}, {
   3.937814879892764*^9, 3.937814902338236*^9}, 3.937814935066165*^9, 
   3.937823056572247*^9, {3.9378234548017387`*^9, 3.937823484704049*^9}, {
   3.937823697606001*^9, 3.937823756190165*^9}, {3.937823827586679*^9, 
   3.937823862725069*^9}, {3.937823941716341*^9, 3.937823945207629*^9}, {
   3.937824011457745*^9, 3.9378240480582743`*^9}, 3.9380063598203163`*^9, {
   3.961248456979007*^9, 3.9612484607062607`*^9}},
 CellLabel->
  "In[195]:=",ExpressionUUID->"7d3de4ea-7fb0-472f-83ec-8cf38aae2099"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "element"}], " ", "result", " ", "association"}]}], ",", 
    RowBox[{
     RowBox[{"-", "guideTokenAssoc"}], " ", "embedding", " ", "guide", " ", 
     "info"}], ",", 
    RowBox[{
     RowBox[{"-", "guideSentenceAssoc"}], " ", "sentence", " ", "guide", " ", 
     "info"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "guideBookAssoc"}], " ", "book"}], "-", 
     RowBox[{"level", " ", "guide", " ", "info"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "highlights"}], " ", "list", " ", "of", " ", "words", " ", 
      "to", " ", "highlight"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "formatted"}], " ", "pane", " ", "with", " ", "Guide", 
       " ", "text", " ", "entry"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Builds", " ", "a", " ", "styled", " ", "panel", " ", "entry", " ", 
       "for", " ", "guidebook", " ", "export", " ", "with", " ", "citations", 
       " ", "and", " ", 
       RowBox[{"highlights", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"GuidePanel", "[", 
    RowBox[{
    "element_", ",", "guideTokenAssoc_", ",", "guideSentenceAssoc_", ",", 
     "guideBookAssoc_", ",", 
     RowBox[{"highlights_", ":", 
      RowBox[{"{", "}"}]}]}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "guideBookId", ",", "page", ",", "sentence", ",", "color", ",", 
       "highlightWords", ",", "link", ",", "buttonCode"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"color", "=", "Black"}], ";", "\[IndentingNewLine]", 
      RowBox[{"guideBookId", "=", 
       RowBox[{"First", "[", 
        RowBox[{"StringSplit", "[", 
         RowBox[{
          RowBox[{"element", "[", 
           RowBox[{"[", "\"\<id\>\"", "]"}], "]"}], ",", "\"\<_\>\""}], "]"}],
         "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"page", "=", 
       RowBox[{
        RowBox[{"StringSplit", "[", 
         RowBox[{
          RowBox[{"element", "[", 
           RowBox[{"[", "\"\<id\>\"", "]"}], "]"}], ",", "\"\<_\>\""}], "]"}],
         "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sentence", "=", 
       RowBox[{"guideSentenceAssoc", "[", 
        RowBox[{"[", 
         RowBox[{"element", "[", 
          RowBox[{"[", "\"\<id\>\"", "]"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"highlightWords", "=", 
       RowBox[{"FindWordsFromStems", "[", 
        RowBox[{"sentence", ",", "highlights"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Column", "[", 
       RowBox[{
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"filePath", "=", 
              RowBox[{"guideBookAssoc", "[", 
               RowBox[{"[", 
                RowBox[{"\"\<GU1\>\"", ",", "\"\<file attachments\>\""}], 
                "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"Button", "[", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{"HighlightText", "[", 
                 RowBox[{
                  RowBox[{"sentence", "<>", "\"\< \>\"", "<>", 
                   RowBox[{"CreateInTextCitation", "[", 
                    RowBox[{"guideBookAssoc", "[", "guideBookId", "]"}], 
                    "]"}], "<>", "\"\< (\>\"", "<>", "\"\<p. \>\"", "<>", 
                   RowBox[{"ToString", "@", "page"}], "<>", "\"\<)\>\""}], 
                  ",", "highlightWords", ",", "\"\<underlined\>\""}], "]"}], 
                ",", "Black", ",", 
                RowBox[{"FontSize", "->", "16"}], ",", 
                RowBox[{"FontFamily", "->", "\"\<Helvetica\>\""}], ",", 
                RowBox[{"FontWeight", "->", "\"\<Bold\>\""}], ",", 
                RowBox[{"LineIndent", "->", "0"}], ",", "\"\<Text\>\""}], 
               "]"}], ",", 
              RowBox[{"SystemOpen", "[", "filePath", "]"}], ",", 
              RowBox[{"Appearance", "->", "None"}], ",", 
              RowBox[{"BaseStyle", "->", "\"\<Hyperlink\>\""}], ",", 
              RowBox[{"FrameMargins", "->", "0"}]}], "]"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Column", "[", 
           RowBox[{
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"Style", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"guideBookAssoc", "[", 
                   RowBox[{"guideBookId", ",", "\"\<title\>\""}], "]"}], 
                  "<>", "\"\<: \>\"", "<>", 
                  RowBox[{"guideBookAssoc", "[", 
                   RowBox[{"guideBookId", ",", "\"\<author\>\""}], "]"}], 
                  "<>", "\"\<, \>\"", "<>", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"#", "==", "\"\<\>\""}], ",", "\"\<n.d.\>\"", ",", 
                    RowBox[{
                    RowBox[{"ToString", "@", "#"}], "<>", "\"\<.\>\""}]}], 
                   "]"}]}], "&"}], "@", 
                RowBox[{"guideBookAssoc", "[", 
                 RowBox[{"guideBookId", ",", "\"\<publication year\>\""}], 
                 "]"}]}], ",", 
               RowBox[{"FontSize", "\[Rule]", "8"}], ",", 
               RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], ",", 
               RowBox[{"LineIndent", "\[Rule]", "0"}], ",", "color"}], "]"}], 
             "}"}], ",", 
            RowBox[{"Spacings", "->", "0"}]}], "]"}]}], "\[IndentingNewLine]",
          "}"}], ",", 
        RowBox[{"Spacings", "->", "0"}]}], "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.899477699055206*^9, 3.8994778543807125`*^9}, {
   3.8994782700520487`*^9, 3.8994782810711*^9}, {3.8994783488857503`*^9, 
   3.899478400151562*^9}, {3.899478433929305*^9, 3.899478483542863*^9}, {
   3.899478514945953*^9, 3.8994785466129317`*^9}, {3.899478594693713*^9, 
   3.899478596539793*^9}, {3.899478627723192*^9, 3.8994786297868824`*^9}, {
   3.899485549538911*^9, 3.899485553009943*^9}, {3.8994861448359528`*^9, 
   3.899486152536027*^9}, {3.899649128362423*^9, 3.899649132052145*^9}, {
   3.899654253455759*^9, 3.899654275775393*^9}, {3.899654328307878*^9, 
   3.8996543305792623`*^9}, {3.899658274671308*^9, 3.8996583366298065`*^9}, {
   3.899658395835727*^9, 3.899658425539959*^9}, {3.8996584675111876`*^9, 
   3.89965862128024*^9}, {3.8997021317140512`*^9, 3.899702140025709*^9}, {
   3.899702340833277*^9, 3.899702343232395*^9}, {3.899709987365282*^9, 
   3.8997100336401997`*^9}, 3.8997113420970383`*^9, {3.8998172769114685`*^9, 
   3.899817300564802*^9}, {3.899825881368394*^9, 3.899825982957016*^9}, {
   3.899836127391432*^9, 3.899836133751609*^9}, {3.8998963051431684`*^9, 
   3.8998963051616793`*^9}, {3.899898118589347*^9, 3.899898131375767*^9}, {
   3.899898237368027*^9, 3.899898247670757*^9}, {3.9043775931106997`*^9, 
   3.904377622581375*^9}, {3.904377725787925*^9, 3.904377729119575*^9}, 
   3.904378336760758*^9, {3.904378382379414*^9, 3.9043783864261503`*^9}, {
   3.910968975027082*^9, 3.910968986253035*^9}, {3.910969058313093*^9, 
   3.910969063995575*^9}, {3.910974109057373*^9, 3.910974121785613*^9}, {
   3.911029361211855*^9, 3.91102937618451*^9}, {3.911029540020949*^9, 
   3.911029542104289*^9}, 3.911032218050031*^9, {3.911032366351635*^9, 
   3.911032366656588*^9}, 3.911033319196065*^9, {3.9110336406001587`*^9, 
   3.911033641449211*^9}, {3.911034270943789*^9, 3.911034274237938*^9}, {
   3.925300623184168*^9, 3.925300631156241*^9}, {3.925300919730789*^9, 
   3.925301053226046*^9}, 3.925756752190175*^9, 3.926503574365663*^9, {
   3.935466430221274*^9, 3.935466438679122*^9}, {3.9354665758392*^9, 
   3.9354665840141163`*^9}, {3.935835985195283*^9, 3.9358360493036623`*^9}, {
   3.93583744698201*^9, 3.935837491519762*^9}, {3.935837762710258*^9, 
   3.935837780366962*^9}, {3.938006677446857*^9, 3.938006677774333*^9}, {
   3.938006725088285*^9, 3.938006747162178*^9}, {3.9380070382484007`*^9, 
   3.93800704124209*^9}, 3.938010304730631*^9, {3.9404956039355803`*^9, 
   3.940495637479439*^9}, {3.961248488740489*^9, 3.961248573506989*^9}},
 CellLabel->
  "In[196]:=",ExpressionUUID->"89ef853a-ed78-4ba0-8617-ba4475bfa404"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "elem"}], " ", "association", " ", "with", " ", "author", 
       " ", "string"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "list"}], " ", "of", " ", "last", " ", "names"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Extracts", " ", "last", " ", "names", " ", "from", " ", "an", " ", 
       "author", " ", "string"}]}]}], ",", 
    RowBox[{"handling", " ", "multiple", " ", 
     RowBox[{"authors", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"FindLastNames", "[", "elem_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"elem", "[", 
       RowBox[{"[", "\"\<author\>\"", "]"}], "]"}], "!=", "\"\<\>\""}], ",", 
     RowBox[{"StringDelete", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"First", "@", 
          RowBox[{"StringSplit", "[", 
           RowBox[{"#", ",", "\"\<,\>\""}], "]"}]}], "&"}], "/@", 
        RowBox[{"StringSplit", "[", 
         RowBox[{
          RowBox[{"elem", "[", 
           RowBox[{"[", "\"\<author\>\"", "]"}], "]"}], ",", "\"\<;\>\""}], 
         "]"}]}], ",", "WhitespaceCharacter"}], "]"}], ",", 
     RowBox[{"{", "\"\<n.a.\>\"", "}"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.865421721132448*^9, 3.8654218748941307`*^9}, {
  3.865421904915327*^9, 3.865421911472234*^9}, {3.86542209415636*^9, 
  3.865422120993117*^9}, {3.865422226238743*^9, 3.865422244876933*^9}, {
  3.8654223085897765`*^9, 3.865422323105994*^9}, {3.865422782058701*^9, 
  3.8654227834053326`*^9}, {3.865492652177177*^9, 3.8654926554537363`*^9}, {
  3.961248589363796*^9, 3.9612485942042923`*^9}},
 CellLabel->
  "In[197]:=",ExpressionUUID->"f0995df0-3e09-469f-9a04-98b9cfcc4260"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "elem"}], " ", "association", " ", "with", " ", "author", 
      " ", "and", " ", "year"}]}], ";", 
    RowBox[{"Output", ":", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "formatted"}], " ", "in"}], "-", 
      RowBox[{"text", " ", "citation", " ", "string"}]}]}], ";", 
    RowBox[{"Description", ":", 
     RowBox[{
      RowBox[{"Creates", " ", "a", " ", "formatted", " ", "in"}], "-", 
      RowBox[{"text", " ", "citation", " ", "like", " ", 
       RowBox[{"\"\<(Smith et al., 2020)\>\"", "."}]}]}]}]}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CreateInTextCitation", "[", "elem_", "]"}], ":=", 
   RowBox[{"Module", " ", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lastNames", "=", 
       RowBox[{"FindLastNames", "[", "elem", "]"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<(\>\"", "<>", 
      RowBox[{"Which", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", "lastNames"}], ">", "2"}], ",", 
        RowBox[{
         RowBox[{"lastNames", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\< et al.\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Length", "@", "lastNames"}], "==", "2"}], ",", 
        RowBox[{
         RowBox[{"lastNames", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\< & \>\"", "<>", 
         RowBox[{"lastNames", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Length", "@", "lastNames"}], "<", "2"}], ",", 
        RowBox[{"lastNames", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "<>", "\"\<, \>\"", "<>", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"elem", "[", 
          RowBox[{"[", "\"\<publication year\>\"", "]"}], "]"}], "!=", 
         "\"\<\>\""}], ",", 
        RowBox[{"ToString", "@", 
         RowBox[{"elem", "[", "\"\<publication year\>\"", "]"}]}], ",", 
        "\"\<n.a.\>\""}], "]"}], "<>", "\"\<)\>\""}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.86542235421963*^9, 3.865422432193252*^9}, {
  3.8654224863490086`*^9, 3.8654224938607616`*^9}, {3.865422548973654*^9, 
  3.865422577837266*^9}, {3.8654227225199227`*^9, 3.8654227533641443`*^9}, {
  3.8654227983613534`*^9, 3.865422966276013*^9}, {3.937839566717622*^9, 
  3.9378395790870237`*^9}, {3.9612486093000927`*^9, 3.961248615521613*^9}},
 CellLabel->
  "In[198]:=",ExpressionUUID->"fc6e308d-9018-4b11-b36b-79145bcbee91"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "elem"}], " ", "list", " ", "with", " ", 
       RowBox[{"{", 
        RowBox[{"vector", ",", "keywords", ",", "words", ",", "id"}], 
        "}"}]}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "association"}], " ", "with", " ", "keywords"}]}]}], ",", 
    "words", ",", "vector", ",", 
    RowBox[{
     RowBox[{"and", " ", "id"}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Converts", " ", "an", " ", "element", " ", "tuple", " ", "into", " ", 
       "a", " ", "standardized", " ", "association", " ", 
       RowBox[{"format", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ElemAssoc", "[", "elem_", "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"\"\<keywords\>\"", "->", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], "==", "2"}], ",", 
             RowBox[{"First", "@", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"First", "@", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], "&"}], "@", "#"}],
         ",", 
        RowBox[{
         RowBox[{
          RowBox[{"\"\<words\>\"", "->", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", "#"}], "==", "1"}], ",", 
             RowBox[{"First", "@", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}], ",", 
             RowBox[{"Last", "@", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], "&"}], "@", "#"}],
         ",", 
        RowBox[{"\"\<vector_ref\>\"", "->", 
         RowBox[{"#", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", 
        RowBox[{"\"\<id\>\"", "->", 
         RowBox[{"#", "[", 
          RowBox[{"[", "3", "]"}], "]"}]}]}], "]"}], "&"}], "@", "elem"}]}], 
   ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.900262352063642*^9, 3.900262392456683*^9}, {
   3.900262443620578*^9, 3.900262448956544*^9}, 3.900262480752172*^9, 
   3.911052066393259*^9, 3.911073852657226*^9, 3.911074544015366*^9, {
   3.961248624950103*^9, 3.9612486258326073`*^9}},
 CellLabel->
  "In[199]:=",ExpressionUUID->"51205d91-41ad-4e60-804d-b761f35a4c91"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "encounters"}], " ", "list", " ", "of", " ", "query", " ", 
      "results", " ", "in", " ", "association", " ", "format", " ", "with", 
      " ", "added", " ", "info"}]}], ",", " ", 
    RowBox[{
     RowBox[{"-", "guide"}], " ", "guide", " ", "structure"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "title"}], " ", "export", " ", "title"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "exportFolder"}], " ", "folder", " ", "path"}], ",", " ", 
    RowBox[{
     RowBox[{"dictReverse", " ", "reverse", " ", "dictionary"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Notebook"}], " ", "object"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Generates", " ", "a", " ", "formatted", " ", "guidebook", " ", 
       "notebook", " ", "with", " ", "SOM", " ", 
       RowBox[{"encounters", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MakeGuideBook", "[", 
    RowBox[{
    "encounters_", ",", "guide_", ",", "title_", ",", "exportFolder_", ",", 
     "dictReverse_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "date", ",", "time", ",", "number", ",", "color", ",", "cells", ",", 
       "notebookName", ",", "notebookFileName", ",", "notebook", ",", 
       "highlights"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"date", "=", 
       RowBox[{"StringRiffle", "[", 
        RowBox[{
         RowBox[{"IntegerString", "[", 
          RowBox[{
           RowBox[{"DateValue", "[", 
            RowBox[{"{", 
             RowBox[{
             "\"\<Year\>\"", ",", "\"\<Month\>\"", ",", "\"\<Day\>\""}], 
             "}"}], "]"}], ",", "10", ",", "2"}], "]"}], ",", "\"\<\>\""}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"IntegerString", "[", 
           RowBox[{
            RowBox[{"DateValue", "[", "\"\<Hour\>\"", "]"}], ",", "10", ",", 
            "2"}], "]"}], ",", 
          RowBox[{"IntegerString", "[", 
           RowBox[{
            RowBox[{"DateValue", "[", "\"\<Minute\>\"", "]"}], ",", "10", ",",
             "2"}], "]"}], ",", 
          RowBox[{"IntegerString", "[", 
           RowBox[{
            RowBox[{"DateValue", "[", "\"\<Second\>\"", "]"}], ",", "10", ",",
             "2"}], "]"}]}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"color", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"RGBColor", "[", "#", "]"}], "&"}], "/@", 
        RowBox[{"Normalize", "/@", 
         RowBox[{"DimensionReduce", "[", 
          RowBox[{
           RowBox[{"guide", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "\"\<kernel\>\"", ",", "\"\<weights\>\""}], 
             "]"}], "]"}], ",", "3", ",", 
           RowBox[{"Method", "->", "\"\<PrincipalComponentsAnalysis\>\""}]}], 
          "]"}]}]}]}], ";", 
      RowBox[{"cells", "=", 
       RowBox[{"Flatten", "@", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"(*", 
            RowBox[{"Create", " ", "Guide", " ", "Cells"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"highlights", "=", 
              RowBox[{"Intersection", "[", 
               RowBox[{
                RowBox[{"Select", "[", 
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    "i", ",", "All", ",", "All", ",", 
                    "\"\<additionalWords\>\""}], "]"}], "]"}], "]"}], ",", 
                  "StringQ"}], "]"}], ",", 
                RowBox[{"First", "@", 
                 RowBox[{"DictDecodeEntry", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"guide", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    "1", ",", "\"\<eventListSorted\>\"", ",", "i", ",", "All",
                     ",", "2"}], "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{"UpTo", "[", "2", "]"}]}], "]"}], "]"}], "]"}], 
                    "}"}], ",", "dictReverse"}], "]"}]}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CreateFlipControl", "@", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"BuildPanel", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"guide", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "<>", "\"\< \>\"", "<>", 
                   RowBox[{"ToString", "@", "i"}], "<>", "\"\<, Pos: \>\"", "<>", 
                   RowBox[{"ToString", "@", "i"}], "<>", "\"\<, \>\"", "<>", 
                   RowBox[{"ToString", "@", "j"}], "<>", "\"\<:\>\""}], ",", 
                  RowBox[{"\"\<Dis: \>\"", "<>", 
                   RowBox[{"ToString", "@", 
                    RowBox[{"CosineDistance", "[", 
                    RowBox[{
                    RowBox[{"guide", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    "1", ",", "\"\<kernel\>\"", ",", "\"\<weights\>\"", ",", 
                    "i"}], "]"}], "]"}], ",", 
                    RowBox[{"guide", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    "1", ",", "\"\<eventListSorted\>\"", ",", "i", ",", "j", 
                    ",", "1"}], "]"}], "]"}]}], "]"}]}], "<>", "\"\<.\>\""}], 
                  ",", 
                  RowBox[{"ElemAssoc", "@", 
                   RowBox[{"guide", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    "1", ",", "\"\<eventListSorted\>\"", ",", "i", ",", "j"}],
                     "]"}], "]"}]}], ",", 
                  RowBox[{"guide", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"{", "}"}], ",", 
                  RowBox[{"{", "}"}], ",", 
                  RowBox[{"color", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", "highlights"}], "]"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", 
                  RowBox[{"Min", "[", 
                   RowBox[{"2", ",", 
                    RowBox[{"Length", "@", 
                    RowBox[{"guide", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "\"\<eventListSorted\>\"", ",", "i"}], 
                    "]"}], "]"}]}]}], "]"}]}], "}"}]}], "]"}]}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"Create", " ", "Response", " ", "Cells"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"CreateFlipControl", "@", 
               RowBox[{"RandomSample", "@", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"BuildPanel", "[", 
                   RowBox[{
                    RowBox[{"\"\<Corpuscle \>\"", "<>", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "k", ",", "\"\<type\>\""}], 
                    "]"}], "]"}], "==", "\"\<text\>\""}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "k", ",", "\"\<textID\>\""}], 
                    "]"}], "]"}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "k", ",", "\"\<imgID\>\""}], 
                    "]"}], "]"}]}], "]"}], "<>", "\"\<. Cell \>\"", "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "k", ",", "\"\<type\>\""}], 
                    "]"}], "]"}], "==", "\"\<text\>\""}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "k", ",", "\"\<textBmu\>\""}],
                     "]"}], "]"}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "k", ",", "\"\<imgBmu\>\""}], 
                    "]"}], "]"}]}], "]"}], "<>", "\"\<. Result \>\"", "<>", 
                    RowBox[{"ToString", "@", "i"}], "<>", "\"\<-\>\"", "<>", 
                    RowBox[{"ToString", "@", "j"}], "<>", " ", "\"\</\>\"", "<>", 
                    RowBox[{"ToString", "@", 
                    RowBox[{"Length", "@", "encounters"}]}], "<>", 
                    "\"\<.\>\""}], ",", 
                    RowBox[{"\"\<Dis: \>\"", "<>", 
                    RowBox[{"ToString", "@", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "k", ",", "\"\<type\>\""}], 
                    "]"}], "]"}], "==", "\"\<text\>\""}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "k", ",", "\"\<textDis\>\""}],
                     "]"}], "]"}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "k", ",", "\"\<imgDis\>\""}], 
                    "]"}], "]"}]}], "]"}]}], "<>", "\"\<.\>\""}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "k"}], "]"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{"{", "}"}]}], "}"}], ",", 
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{"{", "}"}], ",", "Black", ",", "highlights"}], 
                   "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"k", ",", 
                    RowBox[{"Length", "@", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], "}"}]}], 
                 "]"}]}]}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"encounters", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}]}], "]"}]}], "}"}],
           ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "@", "encounters"}]}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"notebookName", "=", 
       RowBox[{
       "date", "<>", "\"\<_\>\"", "<>", "time", "<>", "\"\<_\>\"", "<>", 
        "title", "<>", "\"\<.nb\>\""}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"notebookFileName", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"exportFolder", ",", "notebookName"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"notebookFileName", ",", "\"\<\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"notebook", "=", 
       RowBox[{"NotebookOpen", "[", 
        RowBox[{"notebookFileName", ",", 
         RowBox[{"WindowSize", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"840", ",", "Automatic"}], "}"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"SetOptions", "[", 
       RowBox[{"notebook", ",", 
        RowBox[{"PrintingOptions", "->", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<PrintingMargins\>\"", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"50", ",", "50"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"50", ",", "50"}], "}"}]}], "}"}]}], ",", 
           RowBox[{"\"\<RestPagesFooter\>\"", "->", "None"}], ",", 
           RowBox[{"\"\<RestPagesHeader\>\"", "->", "None"}]}], "}"}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Paste", "[", 
       RowBox[{"notebook", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"Item", "[", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{"Capitalize", "[", 
                 RowBox[{"title", ",", "\"\<TitleCase\>\""}], "]"}], ",", 
                RowBox[{"FontSize", "\[Rule]", "24"}], ",", 
                RowBox[{"FontWeight", "->", "Bold"}], ",", 
                RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], ",", 
                RowBox[{"LineIndent", "\[Rule]", "0"}], ",", "Black"}], "]"}],
               ",", 
              RowBox[{"Alignment", "->", "Left"}]}], "]"}], "}"}], "}"}], ",", 
          RowBox[{"ItemSize", "->", 
           RowBox[{"{", 
            RowBox[{"25", ",", "5"}], "}"}]}], ",", 
          RowBox[{"Frame", "->", "None"}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Paste", "[", 
          RowBox[{"notebook", ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"StringQ", "[", 
              RowBox[{"cells", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
             RowBox[{"Pane", "[", "\"\<\>\"", "]"}], ",", 
             RowBox[{"cells", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Pause", "[", "0.1", "]"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "cells"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "notebook", "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9195176152779927`*^9, 3.919517771365585*^9}, 
   3.9195178015854*^9, {3.9195178442133093`*^9, 3.919517845316017*^9}, {
   3.919517981446499*^9, 3.9195180055749345`*^9}, {3.919962092620634*^9, 
   3.9199621232398252`*^9}, {3.920083654551283*^9, 3.920083670567913*^9}, {
   3.92008487187687*^9, 3.920084876362352*^9}, {3.922351842581853*^9, 
   3.922351843485536*^9}, {3.922352691263072*^9, 3.922352693846146*^9}, {
   3.9223527459781647`*^9, 3.9223527474430532`*^9}, {3.937828717914032*^9, 
   3.9378287181483917`*^9}, {3.937843183981072*^9, 3.9378431957450237`*^9}, {
   3.937843350223091*^9, 3.9378433521561728`*^9}, {3.937843507913598*^9, 
   3.937843511300516*^9}, {3.9378435639306707`*^9, 3.937843566882819*^9}, {
   3.937843873500663*^9, 3.937843873869059*^9}, {3.9378439103406076`*^9, 
   3.937843910596794*^9}, {3.937843948223151*^9, 3.937843960960833*^9}, {
   3.937844512458098*^9, 3.9378445272663116`*^9}, 3.937844690792666*^9, {
   3.93784477776477*^9, 3.9378447977620993`*^9}, {3.9378448366657763`*^9, 
   3.9378448911403522`*^9}, {3.93784610906469*^9, 3.93784613529313*^9}, {
   3.937846228359651*^9, 3.9378462734745693`*^9}, 3.937846361349571*^9, {
   3.937846563898522*^9, 3.937846581274535*^9}, {3.937911709960504*^9, 
   3.937911710542363*^9}, {3.937929407274448*^9, 3.937929444722541*^9}, {
   3.937929494114718*^9, 3.9379295195951347`*^9}, {3.9379300321101513`*^9, 
   3.937930038156466*^9}, {3.937931402941481*^9, 3.937931432179772*^9}, {
   3.9379316271644173`*^9, 3.937931630533782*^9}, {3.938007117953411*^9, 
   3.938007130200679*^9}, {3.9380072303978558`*^9, 3.938007232458234*^9}, 
   3.938011634052752*^9, {3.938011759354912*^9, 3.938011762307303*^9}, {
   3.938011864869632*^9, 3.938011865371304*^9}, {3.940919392219119*^9, 
   3.940919400637623*^9}, {3.9409202862302837`*^9, 3.940920286483741*^9}, {
   3.941034376372177*^9, 3.941034376456788*^9}, {3.9612335832984047`*^9, 
   3.9612335850429*^9}, {3.961233633662298*^9, 3.961233696086287*^9}},
 CellLabel->
  "In[200]:=",ExpressionUUID->"67cd78cc-0cc8-41c3-93eb-e4e1c5e286d2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "formattedCells"}], " ", "already", " ", "formatted", " ", 
      "notebook", " ", "cells"}]}], ",", " ", 
    RowBox[{
     RowBox[{"-", "title"}], " ", "export", " ", "title"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "exportFolder"}], " ", "folder", " ", "path"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Notebook"}], " ", "object"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{"Creates", " ", "a", " ", "separate", " ", "notebook"}]}]}], 
    ",", " ", 
    RowBox[{"showing", " ", "results", " ", "as", " ", "in", " ", "cells"}]}],
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MakeQueryBook", "[", 
    RowBox[{"formattedCells_", ",", "title_", ",", "exportFolder_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "date", ",", "time", ",", "number", ",", "notebookName", ",", 
       "notebookFileName", ",", "notebook"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"date", "=", 
       RowBox[{"StringRiffle", "[", 
        RowBox[{
         RowBox[{"IntegerString", "[", 
          RowBox[{
           RowBox[{"DateValue", "[", 
            RowBox[{"{", 
             RowBox[{
             "\"\<Year\>\"", ",", "\"\<Month\>\"", ",", "\"\<Day\>\""}], 
             "}"}], "]"}], ",", "10", ",", "2"}], "]"}], ",", "\"\<\>\""}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"StringJoin", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"IntegerString", "[", 
           RowBox[{
            RowBox[{"DateValue", "[", "\"\<Hour\>\"", "]"}], ",", "10", ",", 
            "2"}], "]"}], ",", 
          RowBox[{"IntegerString", "[", 
           RowBox[{
            RowBox[{"DateValue", "[", "\"\<Minute\>\"", "]"}], ",", "10", ",",
             "2"}], "]"}], ",", 
          RowBox[{"IntegerString", "[", 
           RowBox[{
            RowBox[{"DateValue", "[", "\"\<Second\>\"", "]"}], ",", "10", ",",
             "2"}], "]"}]}], "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"notebookName", "=", 
       RowBox[{
       "date", "<>", "\"\<_\>\"", "<>", "time", "<>", "\"\<_\>\"", "<>", 
        "title", "<>", "\"\<.nb\>\""}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"notebookFileName", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{"exportFolder", ",", "notebookName"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Export", "[", 
       RowBox[{"notebookFileName", ",", "\"\<\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"notebook", "=", 
       RowBox[{"NotebookOpen", "[", 
        RowBox[{"notebookFileName", ",", 
         RowBox[{"WindowSize", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"840", ",", "Automatic"}], "}"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"SetOptions", "[", 
       RowBox[{"notebook", ",", 
        RowBox[{"PrintingOptions", "->", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<PrintingMargins\>\"", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"50", ",", "50"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"50", ",", "50"}], "}"}]}], "}"}]}], ",", 
           RowBox[{"\"\<RestPagesFooter\>\"", "->", "None"}], ",", 
           RowBox[{"\"\<RestPagesHeader\>\"", "->", "None"}]}], "}"}]}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Paste", "[", 
       RowBox[{"notebook", ",", 
        RowBox[{"Grid", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{"Item", "[", 
             RowBox[{
              RowBox[{"Style", "[", 
               RowBox[{
                RowBox[{"Capitalize", "[", 
                 RowBox[{"title", ",", "\"\<TitleCase\>\""}], "]"}], ",", 
                RowBox[{"FontSize", "\[Rule]", "24"}], ",", 
                RowBox[{"FontWeight", "->", "Bold"}], ",", 
                RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], ",", 
                RowBox[{"LineIndent", "\[Rule]", "0"}], ",", "Black"}], "]"}],
               ",", 
              RowBox[{"Alignment", "->", "Left"}]}], "]"}], "}"}], "}"}], ",", 
          RowBox[{"ItemSize", "->", 
           RowBox[{"{", 
            RowBox[{"25", ",", "5"}], "}"}]}], ",", 
          RowBox[{"Frame", "->", "None"}]}], "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Paste", "[", 
          RowBox[{"notebook", ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"StringQ", "[", 
              RowBox[{"formattedCells", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
             RowBox[{"Pane", "[", "\"\<\>\"", "]"}], ",", 
             RowBox[{"formattedCells", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Pause", "[", "0.1", "]"}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "formattedCells"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "notebook", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9195176152779927`*^9, 3.919517771365585*^9}, 
   3.9195178015854*^9, {3.9195178442133093`*^9, 3.919517845316017*^9}, {
   3.919517981446499*^9, 3.9195180055749345`*^9}, {3.919962092620634*^9, 
   3.9199621232398252`*^9}, {3.920083654551283*^9, 3.920083670567913*^9}, {
   3.92008487187687*^9, 3.920084876362352*^9}, {3.922351842581853*^9, 
   3.922351843485536*^9}, {3.922352691263072*^9, 3.922352693846146*^9}, {
   3.9223527459781647`*^9, 3.9223527474430532`*^9}, {3.9380072118536873`*^9, 
   3.9380072124032793`*^9}, {3.9409194493073483`*^9, 
   3.9409194494505043`*^9}, {3.940919871760041*^9, 3.940919878222725*^9}, {
   3.940920274075822*^9, 3.940920282598165*^9}, {3.9410340799979057`*^9, 
   3.941034083590666*^9}, {3.941034127049762*^9, 3.9410341273087063`*^9}, {
   3.9410341736601562`*^9, 3.941034173809598*^9}, {3.9410342538249197`*^9, 
   3.941034254760256*^9}, {3.942237526711569*^9, 3.94223755565077*^9}, {
   3.942237638721221*^9, 3.942237639020941*^9}, {3.9612190597615137`*^9, 
   3.961219060324503*^9}, {3.961233578865302*^9, 3.9612336128259974`*^9}},
 CellLabel->
  "In[201]:=",ExpressionUUID->"d4618021-f5ec-4e98-aabc-0c6d64bf1448"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "queries"}], " ", "list", " ", "of", " ", "query", " ", 
      "results", " ", "in", " ", "association", " ", "format", " ", "with", 
      " ", "added", " ", "info"}]}], ",", " ", 
    RowBox[{
     RowBox[{"-", "title"}], " ", "export", " ", "title"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "exportFolder"}], " ", "folder", " ", "path"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Notebook"}], " ", "object"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{"Creates", " ", "a", " ", "separate", " ", "notebook"}]}]}], 
    ",", " ", 
    RowBox[{"showing", " ", "results", " ", "as", " ", "in", " ", "cells"}]}],
    "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClipediaLog", "[", 
     RowBox[{"encounters_", ",", "title_", ",", "exportFolder_"}], "]"}], ":=",
     "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"highlights", ",", "formattedCells", ",", "newTitle"}], "}"}], 
      ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"StringQ", "[", "title", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"highlights", "=", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"ToLowerCase", "@", 
              RowBox[{"WordStem", "@", 
               RowBox[{"DeleteStopwords", "@", 
                RowBox[{"TextWordsFast", "[", "title", "]"}]}]}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"StringLength", "[", "#", "]"}], ">", "2"}], "&"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"newTitle", "=", "title"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"highlights", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"newTitle", "=", "\"\<\>\""}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"formattedCells", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Which", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"AssociationQ", "[", 
             RowBox[{"encounters", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"encounters", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "]"}], "!=", "0"}], ",", 
              RowBox[{"BuildPanel", "[", 
               RowBox[{
                RowBox[{"\"\<Corpuscle \>\"", "<>", "\[IndentingNewLine]", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<type\>\""}], "]"}], "]"}], "==", 
                    "\"\<text\>\""}], ",", 
                   RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<textID\>\""}], "]"}], "]"}], ",", 
                   RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<imgID\>\""}], "]"}], "]"}]}], 
                  "]"}], "<>", "\"\<. Cell \>\"", "<>", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<type\>\""}], "]"}], "]"}], "==", 
                    "\"\<text\>\""}], ",", 
                   RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<textBmu\>\""}], "]"}], "]"}], ",", 
                   RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<imgBmu\>\""}], "]"}], "]"}]}], 
                  "]"}], "<>", "\"\<. Result \>\"", "<>", 
                 RowBox[{"ToString", "@", "i"}], "<>", "\"\</\>\"", "<>", 
                 RowBox[{"ToString", "@", 
                  RowBox[{"Length", "@", "encounters"}]}], "<>", 
                 "\"\<.\>\""}], ",", 
                RowBox[{"\"\<Dis: \>\"", "<>", 
                 RowBox[{"ToString", "@", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<type\>\""}], "]"}], "]"}], "==", 
                    "\"\<text\>\""}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<textDis\>\""}], "]"}], "]"}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<imgDis\>\""}], "]"}], "]"}]}], 
                   "]"}]}], "<>", "\"\<.\>\""}], ",", 
                RowBox[{"encounters", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", "\[IndentingNewLine]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", "}"}], ",", 
                  RowBox[{"{", "}"}], ",", 
                  RowBox[{"{", "}"}]}], "}"}], ",", 
                RowBox[{"{", "}"}], ",", 
                RowBox[{"{", "}"}], ",", "Black", ",", "highlights"}], "]"}], 
              ",", "Nothing"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"ListQ", "[", 
             RowBox[{"encounters", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "@", "#"}], ">", "0"}], ",", 
                RowBox[{"CreateFlipControl", "[", "#", "]"}], ",", 
                "\"\<\>\""}], "]"}], "&"}], "@", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "!=", "0"}],
                  ",", 
                 RowBox[{"BuildPanel", "[", 
                  RowBox[{
                   RowBox[{"\"\<Corpuscle \>\"", "<>", "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "\"\<type\>\""}], "]"}], 
                    "]"}], "==", "\"\<text\>\""}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "\"\<textID\>\""}], "]"}], 
                    "]"}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "\"\<imgID\>\""}], "]"}], 
                    "]"}]}], "]"}], "<>", "\"\<. Cell \>\"", "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "\"\<type\>\""}], "]"}], 
                    "]"}], "==", "\"\<text\>\""}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "\"\<textBmu\>\""}], "]"}], 
                    "]"}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "\"\<imgBmu\>\""}], "]"}], 
                    "]"}]}], "]"}], "<>", "\"\<. Result \>\"", "<>", 
                    RowBox[{"ToString", "@", "i"}], "<>", "\"\<-\>\"", "<>", 
                    RowBox[{"ToString", "@", "j"}], "<>", " ", "\"\</\>\"", "<>", 
                    RowBox[{"ToString", "@", 
                    RowBox[{"Length", "@", "encounters"}]}], "<>", 
                    "\"\<.\>\""}], ",", 
                   RowBox[{"\"\<Dis: \>\"", "<>", 
                    RowBox[{"ToString", "@", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "\"\<type\>\""}], "]"}], 
                    "]"}], "==", "\"\<text\>\""}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "\"\<textDis\>\""}], "]"}], 
                    "]"}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "\"\<imgDis\>\""}], "]"}], 
                    "]"}]}], "]"}]}], "<>", "\"\<.\>\""}], ",", 
                   RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{"{", "}"}]}], "}"}], ",", 
                   RowBox[{"{", "}"}], ",", 
                   RowBox[{"{", "}"}], ",", "Black", ",", "highlights"}], 
                  "]"}], ",", "Nothing"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"Length", "@", 
                  RowBox[{"encounters", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}]}], "]"}]}]}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "@", "encounters"}]}], "}"}]}], "]"}]}], ";", 
       "\n", 
       RowBox[{"MakeQueryBook", "[", 
        RowBox[{"formattedCells", ",", "newTitle", ",", "exportFolder"}], 
        "]"}]}]}], "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9422484333001547`*^9, 3.9422484588402452`*^9}, {
   3.942248520902486*^9, 3.94224859032907*^9}, {3.942248622239954*^9, 
   3.9422486862089653`*^9}, {3.961232473555043*^9, 3.9612325547622337`*^9}, 
   3.961232810388845*^9, {3.9612332866937027`*^9, 3.961233346990569*^9}, {
   3.9612334362691507`*^9, 3.9612334368130827`*^9}, {3.961300632632983*^9, 
   3.961300664966173*^9}, {3.96130070676436*^9, 3.961300756892353*^9}},
 CellLabel->
  "In[202]:=",ExpressionUUID->"0e36cd06-3af1-4d43-9edd-37cb7edec16b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "panes"}], " ", "list", " ", "of", " ", "pane", " ", 
      "elements"}]}], ";", 
    RowBox[{"Output", ":", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "dynamic"}], " ", "module", " ", "with", " ", "flip"}], 
      "-", 
      RowBox[{"through", " ", "UI"}]}]}], ";", 
    RowBox[{"Description", ":", 
     RowBox[{
     "Creates", " ", "a", " ", "dynamic", " ", "widget", " ", "to", " ", 
      "flip", " ", "through", " ", "multiple", " ", "panes", " ", "using", 
      " ", "arrow", " ", 
      RowBox[{"buttons", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CreateFlipControl", "[", "panes_List", "]"}], ":=", 
   RowBox[{"DynamicModule", "[", 
    RowBox[{
     RowBox[{"{", "flipState", "}"}], ",", 
     RowBox[{
      RowBox[{"flipState", "=", "1"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Grid", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dynamic", "[", 
            RowBox[{
             RowBox[{"panes", "[", 
              RowBox[{"[", "flipState", "]"}], "]"}], ",", 
             RowBox[{"TrackedSymbols", ":>", 
              RowBox[{"{", "flipState", "}"}]}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Row", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Button", "[", 
               RowBox[{
                RowBox[{"Graphics", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"LightGray", ",", 
                    RowBox[{"Polygon", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"1", ",", "1"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0.5"}], "}"}]}], "}"}], "]"}]}], "}"}],
                   ",", 
                  RowBox[{"ImageSize", "->", "8"}]}], "]"}], ",", 
                RowBox[{"flipState", "=", 
                 RowBox[{"Mod", "[", 
                  RowBox[{
                   RowBox[{"flipState", "-", "1"}], ",", 
                   RowBox[{"Length", "[", "panes", "]"}], ",", "1"}], "]"}]}],
                 ",", 
                RowBox[{"Appearance", "->", "None"}]}], "]"}], ",", 
              RowBox[{"Spacer", "[", "5", "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"Button", "[", 
               RowBox[{
                RowBox[{"Graphics", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"LightGray", ",", 
                    RowBox[{"Polygon", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0.5"}], "}"}]}], "}"}], "]"}]}], "}"}],
                   ",", 
                  RowBox[{"ImageSize", "->", "8"}]}], "]"}], ",", 
                RowBox[{"flipState", "=", 
                 RowBox[{"Mod", "[", 
                  RowBox[{
                   RowBox[{"flipState", "+", "1"}], ",", 
                   RowBox[{"Length", "[", "panes", "]"}], ",", "1"}], "]"}]}],
                 ",", 
                RowBox[{"Appearance", "->", "None"}]}], "]"}]}], "}"}], 
            "]"}]}], "}"}], "}"}], ",", 
        RowBox[{"ItemSize", "->", 
         RowBox[{"{", 
          RowBox[{"50", ",", "Automatic"}], "}"}]}], ",", 
        RowBox[{"Alignment", "->", 
         RowBox[{"{", 
          RowBox[{"Left", ",", "Top"}], "}"}]}]}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.904378627565576*^9, 3.904378627568494*^9}, {
  3.904378658461936*^9, 3.904378750615155*^9}, {3.9043805077683573`*^9, 
  3.904380531000945*^9}, {3.904380573505145*^9, 3.904380596306325*^9}, {
  3.904380635111836*^9, 3.9043807944695377`*^9}, {3.904383080321156*^9, 
  3.904383122016539*^9}, {3.904410170921813*^9, 3.904410175011755*^9}, {
  3.904413230055972*^9, 3.90441323388013*^9}, {3.90441326972227*^9, 
  3.904413276174883*^9}, {3.961248647796071*^9, 3.961248652202344*^9}},
 CellLabel->
  "In[203]:=",ExpressionUUID->"cd076f0e-8317-4605-8ea8-50105a470764"]
}, Closed]],

Cell[CellGroupData[{

Cell["SOM Rendering Functions", "Subtitle",
 CellChangeTimes->{{3.898063417685889*^9, 3.8980634241293945`*^9}, {
   3.898063455525037*^9, 3.898063469740698*^9}, {3.8980689923009634`*^9, 
   3.8980689967895722`*^9}, {3.8998064357255993`*^9, 3.89980643994103*^9}, {
   3.8998067303640494`*^9, 3.8998067392798367`*^9}, {3.9195303640838213`*^9, 
   3.919530364294482*^9}, 
   3.9195895026678944`*^9},ExpressionUUID->"0e86fa5b-a1c6-46f6-819e-\
1351a2e1380a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "queryAssocList"}], " ", "list", " ", "of", " ", "result", 
      " ", "associations"}]}], ",", " ", 
    RowBox[{
     RowBox[{"-", "height"}], " ", "image", " ", "height"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "square"}], " ", "boolean", " ", "crop", " ", "flag"}], ",",
     " ", 
    RowBox[{
     RowBox[{"-", "spacing"}], " ", "spacing", " ", "between"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "partitions"}], " ", "row", " ", "partitions"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "background"}], " ", "background", " ", "color"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Rendered"}], " ", "row", " ", "of", " ", "images"}]}], 
     ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Displays", " ", "images", " ", "with", " ", "tooltips", " ", "and", 
       " ", "links", " ", "in", " ", "a", " ", "row", " ", "or", " ", "grid", 
       " ", 
       RowBox[{"layout", "."}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"RenderImgRow", "[", 
    RowBox[{"queryAssocList_", ",", "height_", ",", 
     RowBox[{"square_", ":", "False"}], ",", 
     RowBox[{"spacing_", ":", "0"}], ",", 
     RowBox[{"partitions_", ":", "0"}], ",", 
     RowBox[{"background_", ":", "White"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "width", ",", "imgTiles", ",", "imgSizeMax", ",", "squareSetting", ",", 
       "imgInfo"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"imgInfo", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Extract", "[", 
            RowBox[{"#", ",", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{"#", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "\"\<type\>\""}], "]"}], "]"}], ",", 
               "\"\<img\>\""}], "]"}]}], "]"}], "&"}], "/@", 
          "queryAssocList"}], ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", "imgInfo"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"width", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"partitions", "==", "0"}], ",", 
            RowBox[{"Length", "@", "imgInfo"}], ",", "partitions"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"squareSetting", "=", "square"}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"partitions", "!=", "0"}], ",", 
           RowBox[{"squareSetting", "=", "True"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"imgTiles", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "@", 
                RowBox[{"imgInfo", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "===", "0"}], ",", 
              RowBox[{"Rasterize", "[", 
               RowBox[{"Graphics", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"background", ",", 
                   RowBox[{"Rectangle", "[", "]"}]}], "}"}], ",", 
                 RowBox[{"PlotRange", "->", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ",", 
                 RowBox[{"PlotRangePadding", "->", "None"}], ",", 
                 RowBox[{"ImagePadding", "->", "None"}], ",", 
                 RowBox[{"ImageMargins", "->", "0"}], ",", 
                 RowBox[{"Frame", "->", "False"}], ",", 
                 RowBox[{"ImageSize", "->", 
                  RowBox[{"{", 
                   RowBox[{"height", ",", "height"}], "}"}]}]}], "]"}], "]"}],
               ",", "\[IndentingNewLine]", 
              RowBox[{"Tooltip", "[", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{
                  RowBox[{"Hyperlink", "[", 
                   RowBox[{
                    RowBox[{"Image", "[", 
                    RowBox[{
                    RowBox[{"ImageResize", "[", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"squareSetting", "==", "True"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ImageCrop", "[", 
                    RowBox[{
                    RowBox[{"imgInfo", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<img\>\""}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"#", ",", "#"}], "}"}]}], "]"}], "&"}], "@", 
                    RowBox[{"Min", "[", 
                    RowBox[{"ImageDimensions", "[", 
                    RowBox[{"imgInfo", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<img\>\""}], "]"}], "]"}], "]"}], 
                    "]"}]}], ",", 
                    RowBox[{"imgInfo", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<img\>\""}], "]"}], "]"}]}], "]"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"squareSetting", "==", "False"}], ",", 
                    "Automatic", ",", "height"}], "]"}], ",", "height"}], 
                    "}"}]}], "]"}], ",", 
                    RowBox[{"ImageSize", "->", 
                    RowBox[{"{", 
                    RowBox[{"Automatic", ",", "height"}], "}"}]}]}], "]"}], 
                    ",", 
                    RowBox[{"\"\<https://en.wikipedia.org/wiki?curid=\>\"", "<>", 
                    RowBox[{"imgInfo", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<imgID\>\""}], "]"}], "]"}]}]}], 
                   "]"}], ",", 
                  RowBox[{"LineIndent", "->", "0"}]}], "]"}], ",", 
                RowBox[{"StringRiffle", "[", 
                 RowBox[{
                  RowBox[{"DeleteCases", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"imgInfo", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<imgTitle\>\""}], "]"}], "]"}], ",", 
                    RowBox[{"imgInfo", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<imgCaption\>\""}], "]"}], "]"}]}], 
                    "}"}], ",", "\"\<\>\""}], "]"}], ",", "\"\<: \>\""}], 
                 "]"}]}], "]"}], ",", 
              RowBox[{"PlotRangePadding", "->", "None"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "@", "imgInfo"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"squareSetting", "==", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Row", "[", 
            RowBox[{"imgTiles", ",", 
             RowBox[{"Spacer", "[", "spacing", "]"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Grid", "[", 
            RowBox[{
             RowBox[{"Partition", "[", 
              RowBox[{"imgTiles", ",", "width"}], "]"}], ",", 
             RowBox[{"Spacings", "->", 
              RowBox[{"{", 
               RowBox[{"spacing", ",", "spacing"}], "}"}]}], ",", 
             RowBox[{"Background", "->", "background"}], ",", 
             RowBox[{"Frame", "->", "False"}], ",", 
             RowBox[{"Alignment", "->", 
              RowBox[{"{", 
               RowBox[{"Center", ",", "Center"}], "}"}]}]}], "]"}]}], 
          "]"}]}]}], "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.937895555327688*^9, 3.937895680368965*^9}, {
   3.937895718560154*^9, 3.937895785784718*^9}, {3.9378958792579193`*^9, 
   3.937895902761736*^9}, {3.937896021982061*^9, 3.937896022311882*^9}, {
   3.937896072536346*^9, 3.937896072894005*^9}, {3.937896951172574*^9, 
   3.9378969799125233`*^9}, {3.9378971212457933`*^9, 3.93789715241184*^9}, 
   3.937897222584076*^9, {3.937897274960952*^9, 3.937897291686936*^9}, {
   3.937897853135586*^9, 3.937897872279118*^9}, {3.9378979651108828`*^9, 
   3.937898050552352*^9}, {3.9378982211881847`*^9, 3.937898223265193*^9}, 
   3.937898297825336*^9, {3.937898501359212*^9, 3.937898506657151*^9}, {
   3.93790934318991*^9, 3.9379093645516233`*^9}, {3.9379094723685427`*^9, 
   3.937909490621209*^9}, {3.937909529533486*^9, 3.937909537489965*^9}, {
   3.937909648631205*^9, 3.937909649194252*^9}, {3.9379104442857637`*^9, 
   3.9379104791624823`*^9}, {3.937910563611672*^9, 3.937910587432352*^9}, {
   3.937910624916812*^9, 3.937910659809149*^9}, {3.937910700664171*^9, 
   3.937910712915518*^9}, {3.937910755177703*^9, 3.9379107993860292`*^9}, {
   3.937910831019298*^9, 3.937910923790201*^9}, {3.937910982365097*^9, 
   3.9379109849467916`*^9}, {3.937911016842462*^9, 3.93791110014223*^9}, {
   3.942249462779195*^9, 3.9422495286235037`*^9}, {3.9422495784852962`*^9, 
   3.942249582225547*^9}, {3.961234253408936*^9, 3.961234292215802*^9}},
 CellLabel->
  "In[204]:=",ExpressionUUID->"ddaa96a3-662b-41b0-9d02-835e4d6d487c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "som"}], " ", "SOM", " ", "with", " ", "weights", " ", 
       "and", " ", "TF"}], "-", "IDF"}]}], ",", " ", 
    RowBox[{
     RowBox[{"-", "fontSize"}], " ", "font", " ", "size"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "cutoff"}], " ", "max", " ", "words"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "method"}], " ", "dimension", " ", "reduction", " ", 
      "method"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Grid"}], " ", "of", " ", "styled", " ", "text", " ", 
       "panes"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Renders", " ", "SOM", " ", "cells", " ", "colored", " ", "with", " ", 
       "common", " ", "words", " ", "weighted", " ", "by", " ", 
       "importance"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "Informed", " ", "by", " ", "code", " ", "from", " ", "ETHZ", " ", 
     "CAAD"}], ",", " ", 
    RowBox[{"Salda\[NTilde]a", " ", "Ochoa"}], ",", " ", 
    RowBox[{
     RowBox[{"Karla", " ", "&"}], " ", "Zifeng"}], ",", 
    RowBox[{"Guo", " ", 
     RowBox[{"(", "2020", ")"}]}], ",", 
    RowBox[{"\"\<Map & Models \[Dash] Self Organizing Maps\>\"", "."}]}], 
   "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"RenderTextSom", "[", 
    RowBox[{"som_", ",", "fontSize_", ",", "cutoff_", ",", "method_"}], "]"}],
    ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "colorData", ",", "colors", ",", "allScoresTFIDF", ",", "panes", ",", 
       "values", ",", "words", ",", "counts", ",", "wordsFormatted"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"colorData", "=", 
       RowBox[{"Normalize", "/@", 
        RowBox[{"DimensionReduce", "[", 
         RowBox[{
          RowBox[{"som", "[", 
           RowBox[{"\"\<kernel\>\"", ",", "\"\<weights\>\""}], "]"}], ",", 
          "3", ",", 
          RowBox[{"Method", "->", "method"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"colors", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"RGBColor", "[", "#", "]"}], "&"}], "/@", "colorData"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"allScoresTFIDF", "=", 
       RowBox[{"som", "[", 
        RowBox[{"[", "\"\<tfidf\>\"", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"panes", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Pane", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"values", "=", 
               RowBox[{
                RowBox[{"allScoresTFIDF", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{";;", 
                  RowBox[{"UpTo", "[", "cutoff", "]"}]}], "]"}], "]"}]}], ";",
               "\[IndentingNewLine]", 
              RowBox[{"words", "=", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"DictDecodeEntry", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", "#", "}"}], "}"}], ",", "dictReverse"}], 
                   "]"}], "&"}], "/@", 
                 RowBox[{"values", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"counts", "=", 
               RowBox[{"AssociationThread", "[", 
                RowBox[{"words", ",", 
                 RowBox[{"values", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"wordsFormatted", "=", 
               RowBox[{"ScaleWords", "@", "counts"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"Column", "[", 
               RowBox[{
                RowBox[{"{", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"Pane", "[", 
                   RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"\"\<c \>\"", "<>", 
                    RowBox[{"ToString", "@", "j"}], "<>", "\"\< e \>\"", "<>", 
                    RowBox[{"ToString", "@", 
                    RowBox[{"Length", "@", 
                    RowBox[{"som", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<words\>\"", ",", "j"}], "]"}], "]"}]}]}]}], 
                    ",", "5", ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", "White"}], "]"}], ",", 
                    RowBox[{"Alignment", "\[Rule]", "Bottom"}], ",", 
                    RowBox[{"ImageSize", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"110", ",", "6"}], "}"}]}]}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"Pane", "[", 
                   RowBox[{
                    RowBox[{"Style", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", "wordsFormatted"}], ">", 
                    "cutoff"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Apply", "[", 
                    RowBox[{"StringJoin", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToString", "[", 
                    RowBox[{"#", ",", "StandardForm"}], "]"}], "&"}], "/@", 
                    RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"StringRiffle", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToString", "[", 
                    RowBox[{"#", ",", "StandardForm"}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\< \>\""}], ",", 
                    "fontSize", ",", 
                    RowBox[{"Which", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">=", "0.85"}], ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<", "0.85"}], "&&", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">", "0.65"}]}], ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Plain\>\""}], ",", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<=", "6.5"}], ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Thin\>\""}]}], 
                    "]"}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", "White"}], "]"}], "&"}], "/@", 
                    RowBox[{"wordsFormatted", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{"UpTo", "@", "cutoff"}]}], "]"}], "]"}]}], 
                    ")"}]}], ",", "\"\<\>\""}], "]"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\< ...\>\"", ",", "fontSize", ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", "White"}], "]"}]}], "}"}]}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"StringRiffle", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToString", "[", 
                    RowBox[{"#", ",", "StandardForm"}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\< \>\""}], ",", 
                    "fontSize", ",", 
                    RowBox[{"Which", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">=", "0.85"}], ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<", "0.85"}], "&&", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">", "0.65"}]}], ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Plain\>\""}], ",", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<=", "6.5"}], ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Thin\>\""}]}], 
                    "]"}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", "White"}], "]"}], "&"}], "/@", 
                    RowBox[{"wordsFormatted", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{"UpTo", "@", "cutoff"}]}], "]"}], "]"}]}], 
                    ")"}]}], ",", "\"\<\>\""}], "]"}]}], "]"}], ",", 
                    RowBox[{"LineIndent", "\[Rule]", "0"}], ",", 
                    RowBox[{"LineSpacing", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"0.1", ",", " ", "8"}], "}"}]}], ",", 
                    RowBox[{"TextAlignment", "\[Rule]", "Center"}]}], "]"}], 
                    ",", 
                    RowBox[{"ImageSize", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"110", ",", "110"}], "}"}]}]}], "]"}]}], "}"}], 
                ",", 
                RowBox[{"Spacings", "\[Rule]", 
                 RowBox[{"-", "0.3"}]}]}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Alignment", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"Center", ",", "Top"}], "}"}]}], ",", 
             RowBox[{"ImageSize", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{"115", ",", "115"}], "}"}]}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{"som", "[", 
              RowBox[{
              "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", 
               "\"\<len\>\""}], "]"}]}], "}"}]}], "]"}]}], ",", "j"}], "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Grid", "[", 
       RowBox[{
        RowBox[{"Partition", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Panel", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"panes", "[", 
               RowBox[{"[", "#", "]"}], "]"}], ",", 
              RowBox[{"Background", "\[Rule]", 
               RowBox[{"colors", "[", 
                RowBox[{"[", "#", "]"}], "]"}]}], ",", 
              RowBox[{"ImageMargins", "->", "0"}], ",", 
              RowBox[{"ImageSize", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"130", ",", "130"}], "}"}]}]}], "]"}], "&"}], "/@", 
           RowBox[{"Range", "@", 
            RowBox[{"Length", "@", "colors"}]}]}], ",", 
          RowBox[{"UpTo", "@", 
           RowBox[{"som", "[", 
            RowBox[{
            "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", "\"\<x\>\""}], 
            "]"}]}]}], "]"}], ",", 
        RowBox[{"Frame", "\[Rule]", "None"}], ",", 
        RowBox[{"FrameStyle", "\[Rule]", 
         RowBox[{"Directive", "[", "White", "]"}]}], ",", 
        RowBox[{"Spacings", "->", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{"-", "0.1"}]}], "}"}]}], ",", 
        RowBox[{"Alignment", "\[Rule]", 
         RowBox[{"{", 
          RowBox[{"Center", ",", "Center"}], "}"}]}]}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.8993148673365297`*^9, {3.899314975898782*^9, 3.899314975994483*^9}, {
   3.8993151764365597`*^9, 3.899315176540778*^9}, {3.8993152246815577`*^9, 
   3.89931522995743*^9}, {3.89931530530831*^9, 3.8993153054114237`*^9}, {
   3.899315892438869*^9, 3.899315920794191*^9}, {3.9105273363063993`*^9, 
   3.910527349504668*^9}, {3.910599156724554*^9, 3.9105991575336437`*^9}, {
   3.9106035510865345`*^9, 3.9106035524767914`*^9}, {3.91060456254895*^9, 
   3.9106045901173644`*^9}, {3.9106087720419226`*^9, 3.910608776837927*^9}, {
   3.910612323936498*^9, 3.9106123372855177`*^9}, {3.910628823741165*^9, 
   3.910628823826676*^9}, 3.9115538470844383`*^9, {3.919593027371316*^9, 
   3.9195932224931283`*^9}, {3.9195932738482103`*^9, 3.91959330470778*^9}, {
   3.9195934843731475`*^9, 3.9195935017879972`*^9}, {3.919593912520664*^9, 
   3.9195939482476654`*^9}, {3.961218316272221*^9, 3.961218338653913*^9}, {
   3.9612186361927433`*^9, 3.961218679983185*^9}, {3.9612189602063637`*^9, 
   3.961219010131259*^9}, 3.961223859458385*^9, {3.9612240989498253`*^9, 
   3.961224109194001*^9}, {3.961234194610311*^9, 3.9612342459393177`*^9}},
 CellLabel->
  "In[205]:=",ExpressionUUID->"dc5ea0fc-14da-4b29-9448-314d7153714b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "som"}], " ", "SOM", " ", "object"}]}], ",", " ", 
    RowBox[{"imgFolder", " ", "folder", " ", "with", " ", "images"}], ",", 
    " ", 
    RowBox[{
     RowBox[{"-", "width"}], " ", "target", " ", "width"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "background"}], " ", "background", " ", "color"}], ",", " ", 
    RowBox[{
     RowBox[{"-", "spacings"}], " ", "grid", " ", "spacings"}], ",", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "patch"}], " ", "fill", " ", "flag"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Assembled"}], " ", "image", " ", "grid"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Renders", " ", "SOM", " ", "as", " ", "an", " ", "image", " ", 
       "map"}]}]}], ",", " ", 
    RowBox[{
    "optionally", " ", "patching", " ", "empty", " ", "cells", " ", "with", 
     " ", 
     RowBox[{"neighbors", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"RenderImgSom", "[", 
    RowBox[{
    "som_", ",", "imgFolder_", ",", "width_", ",", "background_", ",", 
     "spacings_", ",", 
     RowBox[{"patch_", ":", "False"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"imgSizeMax", ",", "imgs", ",", "imgTiles", ",", "render"}], 
      "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"imgSizeMax", "=", 
       RowBox[{"Ceiling", "[", 
        RowBox[{"width", "/", 
         RowBox[{"som", "[", 
          RowBox[{"[", 
           RowBox[{
           "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", "\"\<x\>\""}], 
           "]"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Monitor", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"imgs", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "@", 
                RowBox[{"som", "[", 
                 RowBox[{"[", 
                  RowBox[{"\"\<eventListSorted\>\"", ",", "i"}], "]"}], 
                 "]"}]}], ">", "0"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"Import", "@", 
                 RowBox[{"FileNameJoin", "[", 
                  RowBox[{"{", 
                   RowBox[{"imgFolder", ",", 
                    RowBox[{"First", "@", 
                    RowBox[{"StringSplit", "[", 
                    RowBox[{"#", ",", "\"\<_\>\""}], "]"}]}], ",", 
                    RowBox[{"#", "<>", "\"\<.jpg\>\""}]}], "}"}], "]"}]}], 
                "&"}], "@", 
               RowBox[{"som", "[", 
                RowBox[{"[", 
                 RowBox[{
                 "\"\<eventListSorted\>\"", ",", "i", ",", "1", ",", "3"}], 
                 "]"}], "]"}]}], ",", 
              RowBox[{"If", "[", 
               RowBox[{"patch", ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"ImageQ", "[", "#", "]"}], ",", "#", ",", 
                    RowBox[{"Graphics", "[", 
                    RowBox[{"{", 
                    RowBox[{"background", ",", 
                    RowBox[{"Rectangle", "[", "]"}]}], "}"}], "]"}]}], "]"}], 
                  "&"}], "@", 
                 RowBox[{"FindClosestNeighbouringImage", "[", 
                  RowBox[{"i", ",", "som", ",", "imgFolder"}], "]"}]}], ",", 
                RowBox[{"Graphics", "[", 
                 RowBox[{"{", 
                  RowBox[{"background", ",", 
                   RowBox[{"Rectangle", "[", "]"}]}], "}"}], "]"}]}], "]"}]}],
              "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "@", 
               RowBox[{"som", "[", 
                RowBox[{"[", "\"\<eventListSorted\>\"", "]"}], "]"}]}]}], 
             "}"}]}], "]"}]}], ";"}], ",", 
        RowBox[{
         RowBox[{"ToString", "@", "i"}], "<>", "\"\</\>\"", "<>", 
         RowBox[{"ToString", "@", 
          RowBox[{"Length", "@", 
           RowBox[{"som", "[", 
            RowBox[{"[", "\"\<eventListSorted\>\"", "]"}], "]"}]}]}]}]}], 
       "]"}], ";", "\n", 
      RowBox[{"imgTiles", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ImageResize", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ImageCrop", "[", 
              RowBox[{
               RowBox[{"imgs", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"#", ",", "#"}], "}"}]}], "]"}], "&"}], "@", 
            RowBox[{"Min", "[", 
             RowBox[{"ImageDimensions", "[", 
              RowBox[{"imgs", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}]}], ",", 
           "imgSizeMax"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "imgs"}]}], "}"}]}], "]"}]}], ";", "\n", 
      RowBox[{"render", "=", 
       RowBox[{"ImageAssemble", "[", 
        RowBox[{
         RowBox[{"Partition", "[", 
          RowBox[{"imgTiles", ",", 
           RowBox[{"som", "[", 
            RowBox[{"[", 
             RowBox[{
             "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", "\"\<x\>\""}], 
             "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"Spacings", "->", "spacings"}], ",", 
         RowBox[{"Background", "->", "background"}]}], "]"}]}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.910863480735239*^9, 3.910863613562944*^9}, 
   3.9108637132905097`*^9, 3.9108637998233156`*^9, 3.9108640015205307`*^9, 
   3.918235801134788*^9, {3.9182359018029137`*^9, 3.918235903230606*^9}, {
   3.918236970341745*^9, 3.918236973547036*^9}, {3.918237090802717*^9, 
   3.91823709102563*^9}, {3.918239009866144*^9, 3.9182390099805393`*^9}, {
   3.919581750822613*^9, 3.919581753558885*^9}, {3.919582573321772*^9, 
   3.919582625633085*^9}, {3.919583117548895*^9, 3.919583120666048*^9}, {
   3.919585899987608*^9, 3.919586163459198*^9}, {3.9195880096649647`*^9, 
   3.91958804464832*^9}, {3.9195887455768967`*^9, 3.919588750815569*^9}, {
   3.961234148792222*^9, 3.961234183678393*^9}},
 CellLabel->
  "In[206]:=",ExpressionUUID->"0b754e4d-eb57-4482-9411-6eb2567a03c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "cell"}], " ", "index", " ", "in", " ", "SOM", " ", 
      "grid"}]}], ",", 
    RowBox[{
     RowBox[{"-", "som"}], " ", "SOM", " ", "object"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "folder"}], " ", "folder", " ", "path", " ", "with", " ", 
      "images"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "imported"}], " ", "image", " ", "object", " ", "from", 
       " ", "a", " ", "neighboring", " ", "cell"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
       RowBox[{
       "Finds", " ", "and", " ", "returns", " ", "an", " ", "image", " ", 
        "from", " ", "the", " ", "nearest", " ", "non"}], "-", 
       RowBox[{
       "empty", " ", "neighboring", " ", "SOM", " ", "cell", " ", "for", " ", 
        RowBox[{"rendering", "."}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"FindClosestNeighbouringImage", "[", 
    RowBox[{"cell_", ",", "som_", ",", "folder_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "neighbours", ",", "goodNeighbours", ",", "okNeighbours", ",", 
       "replacement"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"neighbours", "=", 
       RowBox[{"FindNeighboursInGrid", "[", 
        RowBox[{"cell", ",", 
         RowBox[{"som", "[", 
          RowBox[{"[", 
           RowBox[{
           "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", "\"\<x\>\""}], 
           "]"}], "]"}], ",", 
         RowBox[{"som", "[", 
          RowBox[{"[", 
           RowBox[{
           "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", "\"\<y\>\""}], 
           "]"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"goodNeighbours", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"neighbours", ",", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"som", "[", 
               RowBox[{"[", 
                RowBox[{"\"\<eventListSorted\>\"", ",", "#"}], "]"}], "]"}], 
              "]"}], "&"}], "/@", "neighbours"}], ",", 
           RowBox[{"_", "?", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"#", ">", "1"}], "&"}], ")"}]}]}], "]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"replacement", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "@", "goodNeighbours"}], ">", "0"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"goodNeighbours", "=", 
           RowBox[{"RandomSample", "[", "goodNeighbours", "]"}]}], ";", 
          RowBox[{
           RowBox[{
            RowBox[{"Import", "@", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{"folder", ",", 
                RowBox[{"First", "@", 
                 RowBox[{"StringSplit", "[", 
                  RowBox[{"#", ",", "\"\<_\>\""}], "]"}]}], ",", 
                RowBox[{"#", "<>", "\"\<.jpg\>\""}]}], "}"}], "]"}]}], "&"}], 
           "@", 
           RowBox[{"som", "[", 
            RowBox[{"[", 
             RowBox[{"\"\<eventListSorted\>\"", ",", 
              RowBox[{"goodNeighbours", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "2", ",", "3"}], "]"}], 
            "]"}]}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"okNeighbours", "=", 
           RowBox[{"Extract", "[", 
            RowBox[{"neighbours", ",", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"som", "[", 
                   RowBox[{"[", 
                    RowBox[{"\"\<eventListSorted\>\"", ",", "#"}], "]"}], 
                   "]"}], "]"}], "&"}], "/@", "neighbours"}], ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"#", ">", "0"}], "&"}], ")"}]}]}], "]"}]}], "]"}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"replacement", "=", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "@", "okNeighbours"}], ">", "1"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"okNeighbours", "=", 
               RowBox[{"RandomSample", "[", "okNeighbours", "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"Import", "@", 
                 RowBox[{"FileNameJoin", "[", 
                  RowBox[{"{", 
                   RowBox[{"folder", ",", 
                    RowBox[{"First", "@", 
                    RowBox[{"StringSplit", "[", 
                    RowBox[{"#", ",", "\"\<_\>\""}], "]"}]}], ",", 
                    RowBox[{"#", "<>", "\"\<.jpg\>\""}]}], "}"}], "]"}]}], 
                "&"}], "@", 
               RowBox[{"som", "[", 
                RowBox[{"[", 
                 RowBox[{"\"\<eventListSorted\>\"", ",", 
                  RowBox[{"okNeighbours", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", "1", ",", "3"}], 
                 "]"}], "]"}]}]}], ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"Import", "@", 
                RowBox[{"FileNameJoin", "[", 
                 RowBox[{"{", 
                  RowBox[{"folder", ",", 
                   RowBox[{"First", "@", 
                    RowBox[{"StringSplit", "[", 
                    RowBox[{"#", ",", "\"\<_\>\""}], "]"}]}], ",", 
                   RowBox[{"#", "<>", "\"\<.jpg\>\""}]}], "}"}], "]"}]}], 
               "&"}], "@", 
              RowBox[{"som", "[", 
               RowBox[{"[", 
                RowBox[{"\"\<eventListSorted\>\"", ",", 
                 RowBox[{"okNeighbours", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", "1", ",", "3"}], "]"}],
                "]"}]}]}], "]"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "replacement"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBmIQncElYlBo+NZRTFnTEERrrHWbCKJvRUvPBNF9/l2r
QLTD1D4wHeSWL1IEpM/wBImB6F1vzqiDaJFD4ZogumPjCV0QndS+yghE/7o6
xQxEz5i+xRJEfzvqbw8WZ5zjBKI3XWH2AtGTd1gFguke2XAQbV+wH0y7zv0T
C6KbHt9LB9vzdkkOiF79c14tiDZb96YJREcJ6jaDaP7tMp0gmm3b/j4QrfOE
bQqIPvdz7UwQrRbztY3J5K3jwuIdnSD62b8je0F0gqLGURDte1U2mANI34iP
A9Ni6VuKq5vfOmZMLS8H0QDgJ42B
  "],
 CellLabel->
  "In[207]:=",ExpressionUUID->"dd8fa3d0-400b-4664-ae58-13c12dd673c4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "som"}], " ", "SOM", " ", "object"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "dictReverse"}], " ", "reverse", " ", "dictionary"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Rendered"}], " ", "grid", " ", "of", " ", "SOM", " ", 
       "cells", " ", "with", " ", "keywords", " ", "in", " ", "colored", " ", 
       "linear", " ", "layout"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Renders", " ", "the", " ", "SOM", " ", "using", " ", "linear", " ", 
       "text", " ", "style"}]}]}], ",", 
    RowBox[{
    "with", " ", "weights", " ", "and", " ", "importance", " ", "levels", " ", 
     RowBox[{"applied", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"RenderLinearTextSom", "[", 
    RowBox[{"som_", ",", "dictReverse_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "fontSize", ",", "cutoff", ",", "colorData", ",", "color", ",", 
       "allScoresTFIDF", ",", "panes", ",", "values", ",", "words", ",", 
       "counts", ",", "wordsFormatted"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"fontSize", "=", "8"}], ";", "\[IndentingNewLine]", 
      RowBox[{"cutoff", "=", "38"}], ";", "\[IndentingNewLine]", 
      RowBox[{"colorData", "=", 
       RowBox[{"Normalize", "/@", 
        RowBox[{"DimensionReduce", "[", 
         RowBox[{
          RowBox[{"som", "[", 
           RowBox[{"\"\<kernel\>\"", ",", "\"\<weights\>\""}], "]"}], ",", 
          "3", ",", 
          RowBox[{"Method", "->", "\"\<PrincipalComponentsAnalysis\>\""}]}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"color", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"RGBColor", "[", "#", "]"}], "&"}], "/@", "colorData"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"allScoresTFIDF", "=", 
       RowBox[{"som", "[", 
        RowBox[{"[", "\"\<tfidf\>\"", "]"}], "]"}]}], ";", "\n", 
      "\[IndentingNewLine]", 
      RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"panes", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Pane", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"values", "=", 
                RowBox[{
                 RowBox[{"allScoresTFIDF", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{";;", 
                   RowBox[{"UpTo", "[", "cutoff", "]"}]}], "]"}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"words", "=", 
                RowBox[{"Flatten", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"DictDecodeEntry", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", "#", "}"}], "}"}], ",", "dictReverse"}], 
                    "]"}], "&"}], "/@", 
                  RowBox[{"values", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"counts", "=", 
                RowBox[{"AssociationThread", "[", 
                 RowBox[{"words", ",", 
                  RowBox[{"values", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"wordsFormatted", "=", 
                RowBox[{"ScaleWords", "@", "counts"}]}], ";", 
               "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"Column", "[", 
                RowBox[{
                 RowBox[{"{", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"Pane", "[", 
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"\"\<c \>\"", "<>", 
                    RowBox[{"ToString", "@", "j"}], "<>", "\"\< e \>\"", "<>", 
                    RowBox[{"ToString", "@", 
                    RowBox[{"Length", "@", 
                    RowBox[{"som", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<words\>\"", ",", "j"}], "]"}], "]"}]}]}]}], 
                    ",", "5", ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", "White"}], "]"}], ",", 
                    RowBox[{"Alignment", "\[Rule]", "Bottom"}], ",", 
                    RowBox[{"ImageSize", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"110", ",", "6"}], "}"}]}]}], "]"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"Pane", "[", 
                    RowBox[{
                    RowBox[{"Style", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", "wordsFormatted"}], ">", 
                    "cutoff"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Apply", "[", 
                    RowBox[{"StringJoin", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToString", "[", 
                    RowBox[{"#", ",", "StandardForm"}], "]"}], "&"}], "/@", 
                    RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"StringRiffle", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToString", "[", 
                    RowBox[{"#", ",", "StandardForm"}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\< \>\""}], ",", 
                    "fontSize", ",", 
                    RowBox[{"Which", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">=", "0.85"}], ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<", "0.85"}], "&&", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">", "0.65"}]}], ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Plain\>\""}], ",", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<=", "6.5"}], ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Thin\>\""}]}], 
                    "]"}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", "White"}], "]"}], "&"}], "/@", 
                    RowBox[{"wordsFormatted", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{"UpTo", "@", "cutoff"}]}], "]"}], "]"}]}], 
                    ")"}]}], ",", "\"\<\>\""}], "]"}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{"\"\< ...\>\"", ",", "fontSize", ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", "White"}], "]"}]}], "}"}]}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"StringRiffle", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ToString", "[", 
                    RowBox[{"#", ",", "StandardForm"}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\< \>\""}], ",", 
                    "fontSize", ",", 
                    RowBox[{"Which", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">=", "0.85"}], ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Bold\>\""}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<", "0.85"}], "&&", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ">", "0.65"}]}], ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Plain\>\""}], ",", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<=", "6.5"}], ",", 
                    RowBox[{"FontWeight", "\[Rule]", "\"\<Thin\>\""}]}], 
                    "]"}], ",", 
                    RowBox[{"FontFamily", "\[Rule]", "\"\<Helvetica\>\""}], 
                    ",", "White"}], "]"}], "&"}], "/@", 
                    RowBox[{"wordsFormatted", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{"UpTo", "@", "cutoff"}]}], "]"}], "]"}]}], 
                    ")"}]}], ",", "\"\<\>\""}], "]"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"LineIndent", "\[Rule]", "0"}], ",", 
                    RowBox[{"LineSpacing", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"0.1", ",", " ", "8"}], "}"}]}], ",", 
                    RowBox[{"TextAlignment", "\[Rule]", "Center"}]}], "]"}], 
                    ",", 
                    RowBox[{"ImageSize", "\[Rule]", 
                    RowBox[{"{", 
                    RowBox[{"110", ",", "110"}], "}"}]}]}], "]"}]}], 
                  "\[IndentingNewLine]", "}"}], ",", 
                 RowBox[{"Spacings", "\[Rule]", 
                  RowBox[{"-", "0.3"}]}]}], "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Alignment", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"Center", ",", "Top"}], "}"}]}], ",", 
              RowBox[{"ImageSize", "\[Rule]", "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"115", ",", "115"}], "}"}]}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", 
              RowBox[{"som", "[", 
               RowBox[{
               "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", 
                "\"\<len\>\""}], "]"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"Grid", "[", 
          RowBox[{
           RowBox[{"Partition", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Panel", "[", 
                RowBox[{
                 RowBox[{"panes", "[", 
                  RowBox[{"[", "#", "]"}], "]"}], ",", 
                 RowBox[{"Background", "\[Rule]", 
                  RowBox[{"color", "[", 
                   RowBox[{"[", "#", "]"}], "]"}]}], ",", 
                 RowBox[{"ImageMargins", "->", "0"}], ",", 
                 RowBox[{"ImageSize", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"130", ",", "130"}], "}"}]}]}], "]"}], "&"}], "/@", 
              RowBox[{"Range", "@", 
               RowBox[{"Length", "@", "color"}]}]}], ",", 
             RowBox[{"UpTo", "@", 
              RowBox[{"som", "[", 
               RowBox[{
               "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", 
                "\"\<x\>\""}], "]"}]}]}], "]"}], ",", 
           RowBox[{"Frame", "\[Rule]", "None"}], ",", 
           RowBox[{"FrameStyle", "\[Rule]", 
            RowBox[{"Directive", "[", "White", "]"}]}], ",", 
           RowBox[{"Spacings", "->", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"-", "0.1"}]}], "}"}]}], ",", 
           RowBox[{"Alignment", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Center", ",", "Center"}], "}"}]}]}], "]"}]}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "j"}], "}"}]}], "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.8993148673365297`*^9, {3.899314975898782*^9, 3.899314975994483*^9}, {
   3.8993151764365597`*^9, 3.899315176540778*^9}, {3.8993152246815577`*^9, 
   3.89931522995743*^9}, {3.89931530530831*^9, 3.8993153054114237`*^9}, {
   3.899315892438869*^9, 3.899315920794191*^9}, {3.9105273363063993`*^9, 
   3.910527349504668*^9}, {3.910599156724554*^9, 3.9105991575336437`*^9}, {
   3.9106035510865345`*^9, 3.9106035524767914`*^9}, {3.91060456254895*^9, 
   3.9106045901173644`*^9}, {3.9106087720419226`*^9, 3.910608776837927*^9}, {
   3.911228060624826*^9, 3.911228064853241*^9}, {3.911553891517111*^9, 
   3.911553893436205*^9}, {3.9195262677011256`*^9, 3.91952644032211*^9}, {
   3.9195298429469*^9, 3.9195298790068555`*^9}, {3.9195893685813217`*^9, 
   3.9195893756823854`*^9}, {3.961224287563093*^9, 3.9612242890043993`*^9}, {
   3.961249123512607*^9, 3.961249142195418*^9}},
 CellLabel->
  "In[208]:=",ExpressionUUID->"b46acbc7-c364-4ea5-a695-c750d2abbffe"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "som"}], " ", "SOM", " ", "object"}]}], ",", 
    RowBox[{
     RowBox[{"-", "imgX"}], " ", "target", " ", "image", " ", "width"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "dimRed"}], " ", "dimensionality", " ", "reduction", " ", 
      "method", " ", 
      RowBox[{"(", 
       RowBox[{"\"\<Mean\>\"", " ", "or", " ", "other"}], ")"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Pair"}], " ", "of", " ", "rasterized", " ", "SOM", " ", 
       "background", " ", "image", " ", "and", " ", "its", " ", 
       RowBox[{"{", 
        RowBox[{"width", ",", "height"}], "}"}]}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Renders", " ", "a", " ", "background", " ", "image", " ", "for", " ", 
       "the", " ", "SOM", " ", "using", " ", "either", " ", "grayscale", " ", 
       "mean", " ", "values", " ", "or", " ", "RGB", " ", "projection", " ", 
       "from", " ", "dimensionality", " ", "reduction", " ", "on", " ", "its",
        " ", "weights"}]}]}], ",", 
    RowBox[{
    "resized", " ", "to", " ", "the", " ", "specified", " ", "width", " ", 
     "while", " ", "maintaining", " ", "aspect", " ", 
     RowBox[{"ratio", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"RenderSomBackground", "[", 
    RowBox[{"som_", ",", "imgX_", ",", "dimRed_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"imgY", ",", "imgFactor", ",", "somBG"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"imgFactor", "=", 
       RowBox[{"imgX", "/", 
        RowBox[{"som", "[", 
         RowBox[{
         "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", "\"\<x\>\""}], 
         "]"}]}]}], ";", "\n", 
      RowBox[{"imgY", "=", 
       RowBox[{"imgFactor", "*", 
        RowBox[{"som", "[", 
         RowBox[{
         "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", "\"\<y\>\""}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"dimRed", "==", "\"\<Mean\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"somBG", "=", 
          RowBox[{"Rasterize", "[", 
           RowBox[{
            RowBox[{"ImageResize", "[", 
             RowBox[{
              RowBox[{"Image", "[", 
               RowBox[{
                RowBox[{"ArrayReshape", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"ColorData", "[", "\"\<GrayTones\>\"", "]"}], "[",
                     "#", "]"}], "&"}], "/@", 
                   RowBox[{"Rescale", "[", 
                    RowBox[{"Re", "@", 
                    RowBox[{"Mean", "@", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{"Normalize", "/@", 
                    RowBox[{"som", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<kernel\>\"", ",", "\"\<weights\>\""}], "]"}],
                     "]"}]}], "]"}]}]}], "]"}]}], ",", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"som", "[", 
                    RowBox[{
                    "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", 
                    "\"\<y\>\""}], "]"}], ",", 
                    RowBox[{"som", "[", 
                    RowBox[{
                    "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", 
                    "\"\<x\>\""}], "]"}]}], "}"}]}], "]"}], ",", 
                RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
                RowBox[{"ColorSpace", "\[Rule]", "\"\<RGB\>\""}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"imgX", ",", "imgY"}], "}"}], ",", 
              RowBox[{"Resampling", "->", "\"\<Nearest\>\""}]}], "]"}], ",", 
            RowBox[{"RasterSize", "->", 
             RowBox[{"{", 
              RowBox[{"imgX", ",", "imgY"}], "}"}]}]}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{"somBG", "=", 
         RowBox[{"Rasterize", "[", 
          RowBox[{
           RowBox[{"ImageResize", "[", 
            RowBox[{
             RowBox[{"Image", "[", 
              RowBox[{
               RowBox[{"ArrayReshape", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"RGBColor", "[", "#", "]"}], "&"}], "/@", 
                  RowBox[{"Normalize", "/@", 
                   RowBox[{"DimensionReduce", "[", 
                    RowBox[{
                    RowBox[{"som", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<kernel\>\"", ",", "\"\<weights\>\""}], "]"}],
                     "]"}], ",", "3", ",", 
                    RowBox[{"Method", "->", "dimRed"}]}], "]"}]}]}], ",", " ", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"som", "[", 
                    RowBox[{
                    "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", 
                    "\"\<y\>\""}], "]"}], ",", 
                   RowBox[{"som", "[", 
                    RowBox[{
                    "\"\<kernel\>\"", ",", "\"\<dimensions\>\"", ",", 
                    "\"\<x\>\""}], "]"}]}], "}"}]}], "]"}], ",", 
               RowBox[{"ImageSize", "\[Rule]", "Tiny"}], ",", 
               RowBox[{"ColorSpace", "\[Rule]", "\"\<RGB\>\""}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"imgX", ",", "imgY"}], "}"}], ",", 
             RowBox[{"Resampling", "->", "\"\<Nearest\>\""}]}], "]"}], ",", 
           RowBox[{"RasterSize", "->", 
            RowBox[{"{", 
             RowBox[{"imgX", ",", "imgY"}], "}"}]}]}], "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"somBG", ",", 
        RowBox[{"{", 
         RowBox[{"imgX", ",", "imgY"}], "}"}]}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.899792290749361*^9, 3.8997923756657867`*^9}, {
   3.8997924661548934`*^9, 3.899792516768779*^9}, {3.8997925642294683`*^9, 
   3.8997926428936152`*^9}, {3.900158785227399*^9, 3.900158825580687*^9}, {
   3.900158899502161*^9, 3.900158957335287*^9}, {3.9001590049497547`*^9, 
   3.900159023801736*^9}, 3.900159084055485*^9, {3.961249752207487*^9, 
   3.9612497771251917`*^9}},
 CellLabel->
  "In[209]:=",ExpressionUUID->"116a798a-81f6-41af-801e-31979c51db79"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "notebookContent"}], " ", "list", " ", "of", " ", 
       "notebook", " ", "cells", " ", "or", " ", "notebook", " ", 
       "content"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "associations", " ", "with", 
       " ", "\"\<title\>\""}]}]}], ",", "\"\<link\>\"", ",", 
    RowBox[{
     RowBox[{
     "and", " ", "\"\<img\>\"", " ", "for", " ", "each", " ", "guidebook", 
      " ", "page"}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{"Extracts", " ", "titles"}]}]}], ",", "links", ",", 
    RowBox[{
    "and", " ", "images", " ", "from", " ", "notebook", " ", "pages"}], ",", 
    RowBox[{
    "ensuring", " ", "valid", " ", "strings", " ", "or", " ", "images"}], ",", 
    RowBox[{
    "and", " ", "returns", " ", "them", " ", "as", " ", "a", " ", "list", " ",
      "of", " ", "cleaned", " ", 
     RowBox[{"associations", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ExtractGuideBookImages", "[", "notebookContent_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "notebookText", ",", "notebookPages", ",", "title1", ",", "link1", ",", 
       "title2", ",", "link2", ",", "img"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"notebookPages", "=", 
       RowBox[{"Cases", "[", 
        RowBox[{
         RowBox[{"Pick", "[", 
          RowBox[{"notebookContent", ",", 
           RowBox[{"Map", "[", 
            RowBox[{"Not", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"#", "===", "\"\<\>\""}], "&"}], "/@", 
              "notebookContent"}]}], "]"}]}], "]"}], ",", "_Pane"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"title2", "=", 
       RowBox[{"Normal", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{
            "1", ",", "1", ",", "2", ",", "1", ",", "1", ",", "3", ",", "1", 
             ",", "1", ",", "1"}], "]"}], "]"}], "&"}], "/@", 
         "notebookPages"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"link2", "=", 
       RowBox[{"Normal", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{
            "1", ",", "1", ",", "2", ",", "1", ",", "1", ",", "3", ",", "1", 
             ",", "2", ",", "1", ",", "1"}], "]"}], "]"}], "&"}], "/@", 
         "notebookPages"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"img", "=", 
       RowBox[{"Normal", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"#", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", "2", ",", "1", ",", "1", ",", "2"}], 
            "]"}], "]"}], "&"}], "/@", "notebookPages"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Association", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"\"\<title\>\"", "->", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"StringQ", "[", 
              RowBox[{"title2", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
             RowBox[{"title2", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "\"\<\>\""}], "]"}]}], ",",
           "\[IndentingNewLine]", 
          RowBox[{"\"\<link\>\"", "->", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"StringQ", "[", 
              RowBox[{"link2", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
             RowBox[{"link2", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "\"\<\>\""}], "]"}]}], ",",
           "\[IndentingNewLine]", 
          RowBox[{"\"\<link\>\"", "->", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"StringQ", "[", 
              RowBox[{"link2", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
             RowBox[{"link2", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "\"\<\>\""}], "]"}]}], ",",
           "\[IndentingNewLine]", 
          RowBox[{"\"\<img\>\"", "->", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"ImageQ", "[", 
              RowBox[{"img", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
             RowBox[{"img", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"Rasterize", "@", 
              RowBox[{"Graphics", "[", "]"}]}]}], "]"}]}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", "notebookPages"}]}], "}"}]}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.922593896132081*^9, 3.922594061036036*^9}, {
   3.922594183642456*^9, 3.9225941913722*^9}, {3.922594464683426*^9, 
   3.922594478201692*^9}, {3.9225945491102467`*^9, 3.922594657801527*^9}, {
   3.922595438162985*^9, 3.9225954404916677`*^9}, {3.922595492399199*^9, 
   3.922595519463105*^9}, {3.9227026770029593`*^9, 3.922702799439438*^9}, {
   3.961218253829769*^9, 3.961218255658908*^9}, 3.961218293598714*^9, {
   3.961249867068858*^9, 3.9612498695474977`*^9}},
 CellLabel->
  "In[210]:=",ExpressionUUID->"2281332b-7d71-4235-9993-7e992aa1932e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "images"}], " ", "list", " ", "of", " ", "images"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "targetRows"}], " ", "integer", " ", "number", " ", "of", 
      " ", "target", " ", "rows"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "image", " ", "groups", " ", 
       "partitioned", " ", "by", " ", "rows"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Evenly", " ", "distributes", " ", "a", " ", "list", " ", "of", " ", 
       "images", " ", "across", " ", "the", " ", "specified", " ", "number", 
       " ", "of", " ", "rows"}]}]}], ",", 
    RowBox[{
    "handling", " ", "remainders", " ", "and", " ", "adjusting", " ", "to", 
     " ", "avoid", " ", "underfilled", " ", "final", " ", "rows"}], ",", 
    RowBox[{"and", " ", "returns", " ", "the", " ", "partitioned", " ", 
     RowBox[{"list", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"DistributeImagesEvenly", "[", 
      RowBox[{"images_List", ",", "targetRows_Integer"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"totalImages", "=", 
          RowBox[{"Length", "[", "images", "]"}]}], ",", "imagesPerRow", ",", 
         "remainder", ",", "distribution", ",", "finalDistribution"}], "}"}], 
       ",", 
       RowBox[{"(*", 
        RowBox[{"Basic", " ", "distribution", " ", "calculation"}], "*)"}], 
       RowBox[{
        RowBox[{"imagesPerRow", "=", 
         RowBox[{"Quotient", "[", 
          RowBox[{"totalImages", ",", "targetRows"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"remainder", "=", 
         RowBox[{"Mod", "[", 
          RowBox[{"totalImages", ",", "targetRows"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Initial", " ", "distribution", " ", 
          RowBox[{"plan", ":", 
           RowBox[{
           "each", " ", "element", " ", "represents", " ", "the", " ", 
            "number", " ", "of", " ", "images", " ", "in", " ", "that", " ", 
            "row"}]}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"distribution", "=", 
         RowBox[{"ConstantArray", "[", 
          RowBox[{"imagesPerRow", ",", "targetRows"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Distribute", " ", "the", " ", "remainder", " ", "to", " ", "make", 
          " ", "the", " ", "final", " ", "rows", " ", "as", " ", "full", " ", 
          "as", " ", "possible"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Do", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"distribution", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "+=", "1"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"targetRows", "-", "remainder", "+", "1"}], ",", 
            "targetRows"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Adjust", " ", "the", " ", "distribution", " ", "if", " ", "the", 
          " ", "last", " ", "two", " ", "rows", " ", "have", " ", 
          "significantly", " ", "fewer", " ", "images"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "distribution", "]"}], ">", "1"}], "&&", 
           RowBox[{
            RowBox[{"Last", "[", "distribution", "]"}], "<", 
            "imagesPerRow"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Attempt", " ", "to", " ", "redistribute", " ", "images", " ", 
            "to", " ", "avoid", " ", "a", " ", "short", " ", "final", " ", 
            "row"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"finalDistribution", "=", 
            RowBox[{"Most", "[", "distribution", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"finalDistribution", ",", 
             RowBox[{
              RowBox[{"Last", "[", "distribution", "]"}], "+", 
              RowBox[{"Last", "[", 
               RowBox[{"Most", "[", "distribution", "]"}], "]"}]}]}], "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"finalDistribution", "=", 
            RowBox[{"Most", "[", "finalDistribution", "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"finalDistribution", ",", 
             RowBox[{"Last", "[", "distribution", "]"}]}], "]"}], ";"}], ",", 
          RowBox[{
           RowBox[{"finalDistribution", "=", "distribution"}], ";"}]}], "]"}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Use", " ", "the", " ", "distribution", " ", "to", " ", "partition", 
          " ", "the", " ", "images", " ", "list"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"FoldPairList", "[", 
         RowBox[{"TakeDrop", ",", "images", ",", "finalDistribution"}], 
         "]"}]}]}], "]"}]}], ";"}], "\n"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.961218268282979*^9, 3.9612182879410152`*^9}, {
  3.9612498906418467`*^9, 3.9612498931228848`*^9}},
 CellLabel->
  "In[211]:=",ExpressionUUID->"ce8974a7-9ea9-4c19-a2f9-6a9bf3d069ff"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "images"}], " ", "list", " ", "of", " ", "images"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "tolerance"}], " ", "optional", " ", "similarity", " ", 
      "tolerance", " ", 
      RowBox[{"(", 
       RowBox[{"default", " ", "0.1"}], ")"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "positions", " ", 
       RowBox[{"(", "indices", ")"}], " ", "of", " ", "unique"}]}]}], ",", 
    RowBox[{
     RowBox[{"non", "-", 
      RowBox[{
      "empty", " ", "images", " ", "scanned", " ", "from", " ", "end", " ", 
       "to", " ", "start"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{"Scans", " ", "images", " ", "in", " ", "reverse"}]}]}], ",", 
    RowBox[{
     RowBox[{"identifies", " ", "unique", " ", "non"}], "-", 
     RowBox[{
     "empty", " ", "images", " ", "by", " ", "comparing", " ", "with", " ", 
      "previously", " ", "collected", " ", "ones", " ", "using", " ", 
      "ImageDistance"}]}], ",", 
    RowBox[{"and", " ", "returns", " ", "their", " ", 
     RowBox[{"positions", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"FindLastUniquePositions", "[", 
    RowBox[{"images_List", ",", 
     RowBox[{"tolerance_", ":", "0.1"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"uniquePositions", "=", 
        RowBox[{"{", "}"}]}], ",", "isDuplicate", ",", "isWhite"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"isDuplicate", "=", 
          RowBox[{"AnyTrue", "[", 
           RowBox[{"uniquePositions", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"ImageDistance", "[", 
               RowBox[{
                RowBox[{"images", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"images", "[", 
                 RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "<=", "tolerance"}],
              "&"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"isWhite", "=", 
          RowBox[{
           RowBox[{"ImageDistance", "[", 
            RowBox[{
             RowBox[{"images", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"Rasterize", "@", 
              RowBox[{"Graphics", "[", "]"}]}]}], "]"}], "==", "0"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"!", 
            RowBox[{"MemberQ", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"isDuplicate", ",", "isWhite"}], "}"}], ",", "True"}], 
             "]"}]}], ",", 
           RowBox[{"PrependTo", "[", 
            RowBox[{"uniquePositions", ",", "i"}], "]"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "images", "]"}], ",", "1", ",", 
          RowBox[{"-", "1"}]}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "uniquePositions"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.921744914823537*^9, 3.921744950761694*^9}, 
   3.921745269190003*^9, 3.921745308610393*^9, {3.921745389260964*^9, 
   3.9217453938567038`*^9}, {3.9217467741253757`*^9, 
   3.9217467803912477`*^9}, {3.921747988691997*^9, 3.921747990557254*^9}, {
   3.922703416086228*^9, 3.9227034176526327`*^9}, {3.9227036659903708`*^9, 
   3.922703711860097*^9}, {3.9612499094746027`*^9, 3.961249911565048*^9}},
 CellLabel->
  "In[212]:=",ExpressionUUID->"5acdff82-528c-4117-9c33-3bedaf398ab3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"I", "\[IndentingNewLine]", 
     RowBox[{"nput", ":", 
      RowBox[{
       RowBox[{"-", "images"}], " ", "list", " ", "of", " ", "images"}]}]}], 
    ",", 
    RowBox[{
     RowBox[{"-", "width"}], " ", "target", " ", "display", " ", "width"}], 
    ",", 
    RowBox[{
     RowBox[{"-", "height"}], " ", "target", " ", "display", " ", "height"}], 
    ",", 
    RowBox[{
     RowBox[{"-", "links"}], " ", "optional", " ", "list", " ", "of", " ", 
     "hyperlinks"}], ",", 
    RowBox[{
     RowBox[{"-", "titles"}], " ", "optional", " ", "list", " ", "of", " ", 
     "tooltips"}], ",", 
    RowBox[{
     RowBox[{"-", "spacerVer"}], " ", "optional", " ", "vertical", " ", 
     "spacing"}], ",", 
    RowBox[{
     RowBox[{"-", "spacerHor"}], " ", "optional", " ", "horizontal", " ", 
     "spacing"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "commonHeight"}], " ", "optional", " ", "common", " ", 
      "image", " ", "height", " ", 
      RowBox[{"(", 
       RowBox[{"default", " ", "200"}], ")"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Interactive"}], " ", "pane", " ", "with", " ", "a", " ", 
       "linear", " ", "grid", " ", "of", " ", "resized", " ", "images"}]}]}], 
    ",", 
    RowBox[{"optional", " ", "hyperlinks"}], ",", 
    RowBox[{
     RowBox[{"and", " ", "tooltips"}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Arranges", " ", "images", " ", "into", " ", "evenly", " ", 
       "distributed", " ", "rows", " ", "to", " ", "match", " ", "the", " ", 
       "target", " ", "aspect", " ", "ratio"}]}]}], ",", 
    RowBox[{"resizes", " ", "them"}], ",", 
    RowBox[{
    "adds", " ", "optional", " ", "links", " ", "and", " ", "tooltips"}], ",", 
    RowBox[{
    "and", " ", "displays", " ", "them", " ", "as", " ", "a", " ", 
     "scrollable", " ", "grid", " ", 
     RowBox[{"panel", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ShowLinearGuideImages", "[", 
    RowBox[{"images_List", ",", "width_Integer", ",", "height_Integer", ",", 
     RowBox[{"links_", ":", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"titles_", ":", 
      RowBox[{"{", "}"}]}], ",", 
     RowBox[{"spacerVer_", ":", "2"}], ",", 
     RowBox[{"spacerHor_", ":", "2"}], ",", 
     RowBox[{"commonHeight_", ":", "200"}]}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "targetAspectRatio", ",", "resizedImages", ",", "resizedImagesIndiv", 
       ",", "cells", ",", "totalWidth", ",", "idealTotalWidth", ",", 
       "estimatedRows", ",", "rowsOfImages", ",", "pixelLen", ",", "listLen", 
       ",", "grids", ",", "gridSize", ",", "grid", ",", "img", ",", 
       RowBox[{"rasterWidth", "=", "500"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "@", "images"}], ">", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"targetAspectRatio", "=", 
         RowBox[{"height", "/", "width"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"resizedImages", "=", 
         RowBox[{"ColorConvert", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ImageResize", "[", 
              RowBox[{"#", ",", 
               RowBox[{"{", 
                RowBox[{"Automatic", ",", "commonHeight"}], "}"}]}], "]"}], 
             "&"}], "/@", "images"}], ",", "\"\<RGB\>\""}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"totalWidth", "=", 
         RowBox[{"Total", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ImageDimensions", "[", "#", "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", "resizedImages"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"idealTotalWidth", "=", 
         RowBox[{"Sqrt", "[", 
          RowBox[{"totalWidth", "*", 
           RowBox[{"commonHeight", "/", "targetAspectRatio"}]}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"estimatedRows", "=", 
         RowBox[{"Floor", "[", 
          RowBox[{"totalWidth", "/", "idealTotalWidth"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"rowsOfImages", "=", 
         RowBox[{"DistributeImagesEvenly", "[", 
          RowBox[{"resizedImages", ",", "estimatedRows"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"pixelLen", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Total", "[", 
            RowBox[{"Part", "[", 
             RowBox[{
              RowBox[{"ImageDimensions", "/@", "#"}], ",", "All", ",", "1"}], 
             "]"}], "]"}], "&"}], "/@", "rowsOfImages"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"listLen", "=", 
         RowBox[{"Length", "/@", "rowsOfImages"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"resizedImagesIndiv", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"ImageResize", "[", 
              RowBox[{
               RowBox[{"rowsOfImages", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"Automatic", ",", 
                 RowBox[{"N", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Max", "[", "pixelLen", "]"}], "/", 
                    RowBox[{"pixelLen", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "*", 
                   RowBox[{
                    RowBox[{"ImageDimensions", "[", 
                    RowBox[{"rowsOfImages", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}]}], "]"}],
              ",", 
             RowBox[{"{", 
              RowBox[{"j", ",", 
               RowBox[{"Length", "@", 
                RowBox[{"rowsOfImages", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "rowsOfImages"}]}], "}"}]}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"cells", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"links", "===", 
            RowBox[{"{", "}"}]}], ",", "resizedImagesIndiv", ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Hyperlink", "[", 
                RowBox[{
                 RowBox[{"resizedImagesIndiv", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
                 RowBox[{"links", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"Total", "[", 
                    RowBox[{"Part", "[", 
                    RowBox[{"listLen", ",", 
                    RowBox[{"1", ";;", "i"}]}], "]"}], "]"}], "-", 
                    RowBox[{"listLen", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "+", "j"}], "]"}], 
                  "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"Length", "@", 
                  RowBox[{"rowsOfImages", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "rowsOfImages"}]}], "}"}]}], "]"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"cells", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"titles", "===", 
            RowBox[{"{", "}"}]}], ",", "cells", ",", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Tooltip", "[", 
                RowBox[{
                 RowBox[{"cells", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
                 RowBox[{"titles", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"Total", "[", 
                    RowBox[{"Part", "[", 
                    RowBox[{"listLen", ",", 
                    RowBox[{"1", ";;", "i"}]}], "]"}], "]"}], "-", 
                    RowBox[{"listLen", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "+", "j"}], "]"}], "]"}], 
                 ",", 
                 RowBox[{"TooltipStyle", " ", "\[Rule]", " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Background", "\[Rule]", "White"}], ",", 
                    RowBox[{"FontColor", "->", "Black"}], ",", 
                    RowBox[{"CellFrame", "->", "2"}], ",", 
                    RowBox[{"CellFrameColor", "->", "White"}], ",", 
                    RowBox[{"CellFrameMargins", "->", "3"}]}], "}"}]}], ",", 
                 RowBox[{"TooltipDelay", "->", "0"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", 
                 RowBox[{"Length", "@", 
                  RowBox[{"rowsOfImages", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "@", "rowsOfImages"}]}], "}"}]}], "]"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grids", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Grid", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Pane", "[", 
                 RowBox[{
                  RowBox[{"cells", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
                  RowBox[{"ImageDimensions", "@", 
                   RowBox[{"resizedImagesIndiv", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]}], ",", 
                  RowBox[{"ContentPadding", "->", "False"}], ",", 
                  RowBox[{
                  "ImageSizeAction", "\[Rule]", "\"\<ResizeToFit\>\""}]}], 
                 "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "1", ",", 
                  RowBox[{"Length", "@", 
                   RowBox[{"resizedImagesIndiv", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}]}], "]"}], "}"}],
              ",", 
             RowBox[{"Spacings", "->", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"spacerVer", "-", "0.3"}], ",", "0"}], "}"}]}]}], 
            "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Length", "@", "rowsOfImages"}]}], "}"}]}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"gridSize", "=", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ImageDimensions", "[", "#", "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", 
          RowBox[{"Rasterize", "/@", "grids"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{"Grid", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"{", "#", "}"}], "&"}], "/@", "grids"}], ",", 
           RowBox[{"Spacings", "->", 
            RowBox[{"{", 
             RowBox[{"0", ",", 
              RowBox[{"spacerHor", "-", "0.3"}]}], "}"}]}], ",", 
           RowBox[{"Alignment", "->", 
            RowBox[{"{", 
             RowBox[{"Left", ",", "Top"}], "}"}]}], ",", 
           RowBox[{"Frame", "->", "None"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"img", "=", 
         RowBox[{"Panel", "[", 
          RowBox[{"grid", ",", 
           RowBox[{"Background", "->", "White"}], ",", 
           RowBox[{"ContentPadding", "->", "False"}], ",", 
           RowBox[{"FrameMargins", "->", "0"}], ",", 
           RowBox[{"ImageSize", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"N", "[", 
                 RowBox[{
                  RowBox[{"Min", "[", "gridSize", "]"}], "/", 
                  RowBox[{"Max", "[", "gridSize", "]"}]}], "]"}], "*", 
                RowBox[{
                 RowBox[{"Min", "[", "gridSize", "]"}], "/", "2"}]}], ")"}], 
              ",", "Automatic"}], "}"}]}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Pane", "[", 
         RowBox[{"img", ",", 
          RowBox[{"ImageSize", "->", "rasterWidth"}], ",", 
          RowBox[{"ImageSizeAction", "->", "\"\<ShrinkToFit\>\""}]}], 
         "]"}]}]}], "\[IndentingNewLine]", "]"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.922274895882057*^9, 3.922275061299089*^9}, {
   3.922337100566317*^9, 3.922337107163629*^9}, {3.922337198599308*^9, 
   3.9223372678361797`*^9}, {3.922353027203803*^9, 3.922353087828964*^9}, {
   3.922353118495296*^9, 3.922353149163992*^9}, {3.9223533086162233`*^9, 
   3.922353310158239*^9}, {3.922353355484198*^9, 3.9223535341053467`*^9}, {
   3.922354931932172*^9, 3.922354993248369*^9}, {3.922355250274377*^9, 
   3.92235533627414*^9}, {3.9223554055325327`*^9, 3.9223554644816628`*^9}, {
   3.922355593644799*^9, 3.92235559631384*^9}, {3.9224137267985067`*^9, 
   3.922413727127145*^9}, {3.922413772377993*^9, 3.9224138398491*^9}, {
   3.922413876276017*^9, 3.922413880225943*^9}, {3.9224139267567663`*^9, 
   3.922413929486411*^9}, {3.922413978021172*^9, 3.922413978392606*^9}, {
   3.922414106094326*^9, 3.922414111983679*^9}, {3.9224142359175873`*^9, 
   3.922414324214449*^9}, {3.922414391834272*^9, 3.922414458051428*^9}, {
   3.9224144959191217`*^9, 3.922414496233715*^9}, {3.922415889220647*^9, 
   3.922415928623951*^9}, {3.9224162824031363`*^9, 3.9224162825538816`*^9}, 
   3.922416631883874*^9, {3.9224166754843473`*^9, 3.922416675627262*^9}, {
   3.922416878694257*^9, 3.922416888317568*^9}, {3.9224169229130077`*^9, 
   3.922416976998263*^9}, {3.922419603297874*^9, 3.922419643293952*^9}, {
   3.922419691530875*^9, 3.922419697176538*^9}, {3.92241990003552*^9, 
   3.922419900511792*^9}, {3.9224199721888866`*^9, 3.92241997245429*^9}, {
   3.922420038540856*^9, 3.922420038761385*^9}, {3.922420078743608*^9, 
   3.9224200798200912`*^9}, {3.922420133420227*^9, 3.9224201666871223`*^9}, {
   3.9224202089707747`*^9, 3.922420211378634*^9}, {3.922420254255046*^9, 
   3.922420289381907*^9}, {3.922420432603691*^9, 3.922420441927459*^9}, {
   3.922420474336051*^9, 3.9224205643158903`*^9}, {3.922420597700879*^9, 
   3.922420664671166*^9}, {3.9224209990109243`*^9, 3.922421066220821*^9}, {
   3.9224211282875767`*^9, 3.922421198609706*^9}, {3.922425136059957*^9, 
   3.9224252128438177`*^9}, {3.922425641444518*^9, 3.922425659472761*^9}, 
   3.922425962839438*^9, {3.922426551321007*^9, 3.922426573460923*^9}, {
   3.9224266567050333`*^9, 3.922426679102792*^9}, {3.922426803631835*^9, 
   3.9224268171307583`*^9}, {3.922596221817671*^9, 3.922596224359688*^9}, {
   3.922597136620202*^9, 3.922597136784329*^9}, {3.922700226394515*^9, 
   3.922700227027173*^9}, {3.922701359639419*^9, 3.9227013599253798`*^9}, {
   3.922701401611404*^9, 3.922701402043075*^9}, 3.922951985434757*^9, {
   3.940914503879015*^9, 3.940914513779458*^9}, {3.961249935136786*^9, 
   3.961249937378293*^9}},
 CellLabel->
  "In[213]:=",ExpressionUUID->"0a5de72f-6436-4a25-91df-7e9e7a069443"]
}, Closed]],

Cell[CellGroupData[{

Cell["Archidromes", "Subtitle",
 CellChangeTimes->{{3.898063417685889*^9, 3.8980634241293945`*^9}, {
  3.898063455525037*^9, 3.898063469740698*^9}, {3.8980689923009634`*^9, 
  3.8980689967895722`*^9}, {3.899806546343158*^9, 3.8998065484391937`*^9}, {
  3.899806673749098*^9, 3.899806685727475*^9}, {3.904210878811308*^9, 
  3.904210884704926*^9}, {3.96122942900765*^9, 3.961229432717765*^9}, {
  3.961229464857923*^9, 
  3.96122949660145*^9}},ExpressionUUID->"d24e0b33-073f-4155-b5d8-\
dc2db54f697a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "guideFolder"}], " ", "folder", " ", "path", " ", 
       "containing", " ", "guide", " ", "PDF", " ", "files"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Interactive"}], " ", "grid", " ", "interface", " ", "to",
        " ", "enter", " ", "metadata", " ", "and", " ", "save", " ", "as", 
       " ", 
       RowBox[{"guide", ".", "csv"}]}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Builds", " ", "an", " ", "interactive", " ", "form", " ", "displaying",
        " ", "detected", " ", "guide", " ", "PDF", " ", "files"}]}]}], ",", 
    RowBox[{"lets", " ", "the", " ", "user", " ", "input", " ", "title"}], 
    ",", "author", ",", 
    RowBox[{"and", " ", "publication", " ", "year", " ", "for", " ", "each"}],
     ",", 
    RowBox[{"and", " ", "exports", " ", "a", " ", 
     RowBox[{"guide", ".", "csv"}], " ", "file", " ", "with", " ", "the", " ",
      "collected", " ", 
     RowBox[{"metadata", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MakeGuideCSV", "[", "guideFolder_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"guideCSV", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"guideFiles", "=", 
       RowBox[{"Select", "[", 
        RowBox[{
         RowBox[{"FileNames", "[", 
          RowBox[{"All", ",", "guideFolder"}], "]"}], ",", 
         RowBox[{"StringContainsQ", "[", 
          RowBox[{"\"\<.pdf\>\"", ",", 
           RowBox[{"IgnoreCase", "->", "True"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"guideBookCount", "=", 
       RowBox[{"Length", "@", "guideFiles"}]}], ";", "\n", 
      "\[IndentingNewLine]", 
      RowBox[{"Manipulate", "[", 
       RowBox[{
        RowBox[{"Grid", "[", 
         RowBox[{
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"With", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"i", "=", "i"}], ",", 
                  RowBox[{"j", "=", "j"}]}], "}"}], ",", 
                RowBox[{"InputField", "[", 
                 RowBox[{
                  RowBox[{"Dynamic", "[", 
                   RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], ",", 
                  "String", ",", 
                  RowBox[{"FieldSize", "->", 
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"j", "==", "1"}], ",", "30", ",", "Medium"}], 
                    "]"}]}]}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "guideBookCount"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", "4"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"{", 
              RowBox[{"\"\<\>\"", ",", "\"\<\>\"", ",", "\"\<\>\"", ",", 
               RowBox[{"Item", "[", 
                RowBox[{"Button", "[", 
                 RowBox[{"\"\<Save Data\>\"", ",", 
                  RowBox[{
                   RowBox[{"guideCSV", "=", 
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<key\>\"", ",", "\"\<title\>\"", ",", 
                    "\"\<author\>\"", ",", "\"\<publication year\>\"", ",", 
                    "\"\<file attachments\>\""}], "}"}], "}"}], ",", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"\"\<GU\>\"", "<>", 
                    RowBox[{"ToString", "@", "i"}]}], ",", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "4"}], "]"}], "]"}], ",", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}], ",", 
                    RowBox[{"data", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "3"}], "]"}], "]"}], ",", 
                    RowBox[{"guideFiles", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"Length", "@", "data"}]}], "}"}]}], "]"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"Export", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"guideFolder", ",", "\"\<guide.csv\>\""}], "}"}], 
                    "]"}], ",", "guideCSV"}], "]"}], ";"}]}], 
                 "\[IndentingNewLine]", "]"}], "]"}]}], "}"}], "}"}]}], "]"}],
           ",", 
          RowBox[{"Alignment", "->", "Left"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"data", ",", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Last", "@", 
                 RowBox[{"FileNameSplit", "[", 
                  RowBox[{"guideFiles", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", 
                "\"\<author\>\"", ",", "\"\<year\>\"", ",", "\"\<title\>\""}],
                "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "guideBookCount"}], "}"}]}], "]"}]}], 
           "\[IndentingNewLine]", "}"}], ",", 
          RowBox[{"ControlType", "->", "None"}]}], "}"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9042103250912724`*^9, 3.904210442734846*^9}, {
  3.904210473159671*^9, 3.90421050586201*^9}, {3.904210540397976*^9, 
  3.904210651877213*^9}, {3.904210698434548*^9, 3.904210716697287*^9}, {
  3.904210772347496*^9, 3.9042107902242603`*^9}, {3.9043159266946907`*^9, 
  3.904315931471286*^9}, {3.905097415612775*^9, 3.905097421421886*^9}, {
  3.961249974293404*^9, 3.9612499767172422`*^9}},
 CellLabel->
  "In[214]:=",ExpressionUUID->"04c25102-e016-4adc-bca5-8c32508fa183"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "strList"}], " ", "list", " ", "of", " ", "strings"}]}], 
     ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "List"}], " ", "of", " ", "cleaned", " ", "strings", " ",
         "with", " ", "non"}], "-", 
       RowBox[{
       "string", " ", "elements", " ", "and", " ", "empty", " ", "strings", 
        " ", "removed"}]}]}]}], ",", 
    RowBox[{
     RowBox[{"and", " ", "whitespace", " ", "trimmed"}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
       RowBox[{
       "Cleans", " ", "a", " ", "list", " ", "by", " ", "removing", " ", 
        "any", " ", "non"}], "-", 
       RowBox[{
       "string", " ", "or", " ", "empty", " ", "entries", " ", "and", " ", 
        "trimming", " ", "leading", " ", "and", " ", "trailing", " ", 
        "whitespace", " ", "from", " ", "each", " ", "remaining", " ", 
        RowBox[{"string", "."}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"ClearAll", "[", "CleanupStrings", "]"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"CleanupStrings", "[", "strList_List", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "result", "}"}], ",", 
      RowBox[{
       RowBox[{"result", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"strList", ",", 
          RowBox[{"_", "?", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"StringQ", "[", "#", "]"}]}], "&"}], ")"}]}]}], "]"}]}],
        ";", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Remove", " ", "non"}], "-", 
         RowBox[{"string", " ", "elements"}]}], "*)"}], 
       RowBox[{"result", "=", 
        RowBox[{"DeleteCases", "[", 
         RowBox[{"result", ",", "\"\<\>\""}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"Remove", " ", "empty", " ", "strings"}], "*)"}], 
       RowBox[{"result", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"StringTrim", "[", "#", "]"}], "&"}], "/@", "result"}]}], 
       ";", 
       RowBox[{"(*", 
        RowBox[{
        "Trim", " ", "extra", " ", "white", " ", "space", " ", "from", " ", 
         "each", " ", "string"}], "*)"}], "result"}]}], "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8976784716202497`*^9, 3.897678482028698*^9}, {
  3.8976785814952183`*^9, 3.8976785931985273`*^9}, {3.9612500015448*^9, 
  3.961250003973773*^9}},
 CellLabel->
  "In[215]:=",ExpressionUUID->"37ae6f86-8428-4b37-9f8e-7e8ffc49e1b9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "bookPages"}], " ", "list", " ", "of", " ", "book", " ", 
       "pages", " ", "as", " ", "list", " ", "of", " ", "strings"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "cleaned", " ", "book", " ", 
       "pages", " ", "with", " ", "repeated", " ", 
       RowBox[{"header", "/", "footer"}], " ", "lines", " ", "removed"}]}], 
     ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Processes", " ", "each", " ", "book", " ", "page", " ", "by", " ", 
       "splitting", " ", "into", " ", "lines"}]}]}], ",", 
    RowBox[{
    "removing", " ", "repeated", " ", "first", " ", "and", " ", "last", " ", 
     "lines", " ", 
     RowBox[{"(", 
      RowBox[{
      "such", " ", "as", " ", "titles", " ", "or", " ", "page", " ", 
       "numbers"}], ")"}]}], ",", 
    RowBox[{"and", " ", "reconstructing", " ", "cleaned", " ", "page", " ", 
     RowBox[{"text", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CleanBook", "[", "bookPages_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "linesPages", ",", "lines1", ",", "lines2", ",", "lines3", ",", 
       "lines4", ",", "middlePages", ",", "linesP1", ",", "linesP2", ",", 
       "linesP3", ",", "linesP4", ",", "cleanBookPages"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Clean", " ", "up", " ", "Pages", " ", "of", " ", "Book", " ", "with", 
       " ", "repeating", " ", "titles"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"linesPages", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Flatten", "@", 
          RowBox[{"StringSplit", "[", 
           RowBox[{
            RowBox[{"bookPages", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", "\"\<\\n\>\""}], "]"}]}], 
         ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "bookPages"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Extract", " ", "lines"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"lines1", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "@", 
             RowBox[{"linesPages", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ">", "5"}], ",", 
           RowBox[{
            RowBox[{"linesPages", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", "\"\<\>\""}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "linesPages"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"lines2", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "@", 
             RowBox[{"linesPages", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ">", "5"}], ",", 
           RowBox[{
            RowBox[{"linesPages", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "\"\<\>\""}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "linesPages"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"lines3", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "@", 
             RowBox[{"linesPages", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ">", "5"}], ",", 
           RowBox[{
            RowBox[{"linesPages", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"-", "2"}], "]"}], "]"}], ",", "\"\<\>\""}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "linesPages"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"lines4", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "@", 
             RowBox[{"linesPages", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ">", "5"}], ",", 
           RowBox[{
            RowBox[{"linesPages", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}], ",", "\"\<\>\""}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "linesPages"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"middlePages", "=", 
       RowBox[{"CleanTextSimple", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"StringRiffle", "[", 
           RowBox[{
            RowBox[{"DeleteCases", "[", 
             RowBox[{
              RowBox[{"linesPages", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", 
              RowBox[{"Alternatives", "@@", 
               RowBox[{"Join", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"lines1", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{"lines2", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{"lines3", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", 
                  RowBox[{"lines4", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "]"}]}]}], "]"}], 
            ",", "\"\<\\n\>\""}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "@", "linesPages"}]}], "}"}]}], "]"}]}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"Clean", " ", "lines"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"linesP1", "=", 
       RowBox[{"PurgeRepeatedBookLines", "[", "lines1", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"linesP2", "=", 
       RowBox[{"PurgeRepeatedBookLines", "[", "lines2", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"linesP3", "=", 
       RowBox[{"PurgeRepeatedBookLines", "[", "lines3", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"linesP4", "=", 
       RowBox[{"PurgeRepeatedBookLines", "[", "lines4", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Reconfigure", " ", "Pages"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"cleanBookPages", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"StringTrim", "@", 
          RowBox[{"StringRiffle", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"linesP1", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"linesP2", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"middlePages", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"linesP3", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"linesP4", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "linesPages"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "cleanBookPages"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8969735947565517`*^9, 3.896973726945809*^9}, {
   3.8969737655875034`*^9, 3.8969738074557743`*^9}, {3.897146969433442*^9, 
   3.8971469696245575`*^9}, {3.897151214619239*^9, 3.8971512153141236`*^9}, {
   3.897151262719548*^9, 3.897151302242844*^9}, {3.8971513362020116`*^9, 
   3.897151396939828*^9}, {3.897152266413742*^9, 3.8971522967413816`*^9}, {
   3.897152660057282*^9, 3.897152669895792*^9}, {3.89715538330583*^9, 
   3.8971554006258793`*^9}, 3.8975441875835295`*^9, {3.8975480588170586`*^9, 
   3.897548059278561*^9}, {3.8975488943855906`*^9, 3.897548901918229*^9}, {
   3.8976611792980895`*^9, 3.8976611819537907`*^9}, 3.8979830063967385`*^9, {
   3.961250014791952*^9, 3.9612500405995502`*^9}},
 CellLabel->
  "In[217]:=",ExpressionUUID->"a45ba830-beb7-4c4c-9dee-f03919a69fc1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "lines"}], " ", "list", " ", "of", " ", "text", " ", 
       "lines"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "cleaned", " ", "lines", " ", 
       "with", " ", "repeated", " ", "numerals"}]}]}], ",", 
    RowBox[{"page", " ", "numbers"}], ",", 
    RowBox[{
     RowBox[{
     "or", " ", "detected", " ", "repeating", " ", "substrings", " ", 
      "removed"}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Cleans", " ", "book", " ", "lines", " ", "by", " ", "removing", " ", 
       "Roman", " ", "numerals", " ", "and", " ", "digits"}]}]}], ",", 
    RowBox[{
    "identifying", " ", "repeated", " ", "substrings", " ", "across", " ", 
     "lines"}], ",", 
    RowBox[{
    "and", " ", "purging", " ", "them", " ", "to", " ", "return", " ", 
     "cleaned", " ", "line", " ", 
     RowBox[{"content", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"PurgeRepeatedBookLines", "[", "lines_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "numerals", ",", "cleanLines", ",", "riffledLines", ",", 
       "repeatedSubstrings", ",", "purgeableSubstrings", ",", "linesClean"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"numerals", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"ToString", "[", 
          RowBox[{"RomanNumeral", "[", "#", "]"}], "]"}], "&"}], "/@", 
        RowBox[{"Range", "[", "99", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"cleanLines", "=", 
       RowBox[{"StringTrim", "[", 
        RowBox[{"StringDelete", "[", 
         RowBox[{
          RowBox[{"StringDelete", "[", 
           RowBox[{
            RowBox[{"CleanTextSimple", "@", "lines"}], ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
              "WhitespaceCharacter", "|", "StartOfString", "|", 
               "PunctuationCharacter"}], ")"}], "~~", 
             RowBox[{"Alternatives", "[", "numerals", "]"}], "~~", 
             RowBox[{"(", 
              RowBox[{
              "WhitespaceCharacter", "|", "EndOfString", "|", 
               "PunctuationCharacter"}], ")"}]}], ",", 
            RowBox[{"IgnoreCase", "->", "True"}]}], "]"}], ",", 
          "DigitCharacter"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"riffledLines", "=", 
       RowBox[{"StringRiffle", "@", "cleanLines"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"repeatedSubstrings", "=", 
       RowBox[{"FindLongestSubstrings", "[", 
        RowBox[{"riffledLines", ",", "cleanLines"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"purgeableSubstrings", "=", 
       RowBox[{"FindPurgeableSubstrings", "[", 
        RowBox[{"riffledLines", ",", "repeatedSubstrings"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"linesClean", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"DeleteMultipleSubstrings", "[", 
          RowBox[{
           RowBox[{"cleanLines", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", "purgeableSubstrings"}], 
          "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "lines"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "linesClean"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.896970469999509*^9, 3.8969706749451747`*^9}, {
   3.8969709947569575`*^9, 3.896971031656526*^9}, {3.8969711017330546`*^9, 
   3.8969711307643447`*^9}, {3.8969711792058125`*^9, 3.896971180116012*^9}, {
   3.8969717197214127`*^9, 3.896971749315471*^9}, {3.8969733366442227`*^9, 
   3.896973339133482*^9}, 3.896973376353445*^9, {3.8971521781081653`*^9, 
   3.897152178302*^9}, {3.8971560348054075`*^9, 3.8971560358406353`*^9}, {
   3.8975417336379313`*^9, 3.8975417847345147`*^9}, {3.8975434339438705`*^9, 
   3.8975435410629406`*^9}, 3.8975440788799477`*^9, {3.897661253690744*^9, 
   3.8976612558322487`*^9}, {3.9612500547812243`*^9, 3.9612500570993767`*^9}},
 CellLabel->
  "In[218]:=",ExpressionUUID->"8c26f5a9-72ed-408f-bcab-f208d1300d54"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "string"}], " ", "combined", " ", "string", " ", "of", " ",
       "words"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "strings"}], " ", "list", " ", "of", " ", "original", " ", 
      "strings"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "longest", " ", "repeated", " ",
        "substrings", " ", "or", " ", "sequences", " ", "found", " ", 
       "across", " ", "input"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Analyzes", " ", "the", " ", "combined", " ", "string", " ", "to", " ", 
       "identify", " ", "long", " ", "repeated", " ", "word", " ", 
       "sequences", " ", 
       RowBox[{"(", 
        RowBox[{"minimum", " ", "length", " ", "3"}], ")"}], " ", "by", " ", 
       "comparing", " ", "partitions", " ", "and", " ", "finding", " ", 
       "common", " ", "subsequences"}]}]}], ",", 
    RowBox[{
    "and", " ", "returns", " ", "them", " ", "along", " ", "with", " ", 
     "frequently", " ", "occurring", " ", 
     RowBox[{"substrings", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"FindLongestSubstrings", "[", 
    RowBox[{"string_", ",", "strings_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "stringSplit", ",", "dict", ",", "numbers", ",", "patterns", ",", " ", 
       "partitions", ",", "outcome", ",", "winner", ",", "longestSeq", ",", 
       "longestString"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"stringSplit", "=", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"string", ",", "WhitespaceCharacter"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dict", "=", 
       RowBox[{"DeleteDuplicates", "@", "stringSplit"}]}], ";", "\n", 
      RowBox[{"numbers", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Position", "[", 
           RowBox[{"dict", ",", "#"}], "]"}], "&"}], "/@", "stringSplit"}], 
        "]"}]}], ";", "\n", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", "numbers"}], "<", "1"}], ",", 
        RowBox[{"patterns", "=", 
         RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{"patterns", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"partitions", "=", 
             RowBox[{"Partition", "[", 
              RowBox[{"numbers", ",", 
               RowBox[{"UpTo", "[", "j", "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"outcome", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"LongestCommonSubsequence", "[", 
                RowBox[{
                 RowBox[{"partitions", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], ",", 
                 RowBox[{"partitions", "[", 
                  RowBox[{"[", "#", "]"}], "]"}]}], "]"}], "&"}], "/@", 
              RowBox[{"Range", "[", 
               RowBox[{"2", ",", 
                RowBox[{"Length", "@", "partitions"}]}], "]"}]}]}]}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "1", ",", 
             RowBox[{
              RowBox[{"Length", "@", "numbers"}], "-", "1"}], ",", 
             RowBox[{"Ceiling", "[", 
              RowBox[{
               RowBox[{"Length", "@", "numbers"}], "/", "1000"}], "]"}]}], 
            "}"}]}], "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", "\n", 
      RowBox[{"longestSeq", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Pick", "[", 
          RowBox[{"#", ",", 
           RowBox[{
            RowBox[{"Length", "@", "#"}], ">=", "3"}]}], "]"}], "&"}], "/@", 
        RowBox[{"DeleteDuplicates", "[", 
         RowBox[{"Flatten", "[", 
          RowBox[{"patterns", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"longestString", "=", 
       RowBox[{"StringTrim", "@", 
        RowBox[{"Join", "[", 
         RowBox[{
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"StringRiffle", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"dict", "[", 
                  RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
                RowBox[{"longestSeq", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", "@", "longestSeq"}]}], "}"}]}], "]"}], ",", 
            "\"\<\>\""}], "]"}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Extract", "[", 
             RowBox[{
              RowBox[{"Keys", "[", 
               RowBox[{"Counts", "[", "#", "]"}], "]"}], ",", 
              RowBox[{"Position", "[", 
               RowBox[{
                RowBox[{"Values", "[", 
                 RowBox[{"Counts", "[", "#", "]"}], "]"}], ",", 
                RowBox[{"x_", "/;", 
                 RowBox[{"x", ">", "3"}]}]}], "]"}]}], "]"}], "&"}], "@", 
           RowBox[{"StringTrim", "[", 
            RowBox[{"StringDelete", "[", 
             RowBox[{"strings", ",", "DigitCharacter"}], "]"}], "]"}]}]}], 
         "]"}]}]}]}]}], "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8638642658746786`*^9, 3.8638644023624496`*^9}, {
   3.8638644436235466`*^9, 3.863864454499508*^9}, {3.8638646617420053`*^9, 
   3.863864917667719*^9}, {3.863864957753577*^9, 3.8638649813678064`*^9}, {
   3.8638650263224125`*^9, 3.8638650312213316`*^9}, {3.863865063823097*^9, 
   3.8638651735783157`*^9}, 3.8638652674818163`*^9, 3.8638653766553593`*^9, {
   3.863865429339967*^9, 3.863865469990401*^9}, {3.86386555027563*^9, 
   3.8638655536471925`*^9}, {3.863865585662549*^9, 3.8638656253164387`*^9}, {
   3.863865723539291*^9, 3.8638657863610773`*^9}, {3.863866336012402*^9, 
   3.8638663714552765`*^9}, {3.863866483312545*^9, 3.8638664840401106`*^9}, {
   3.863867033686945*^9, 3.863867053214872*^9}, {3.863867117623226*^9, 
   3.8638671667181783`*^9}, {3.863867200163819*^9, 3.8638672878023057`*^9}, {
   3.863867323149829*^9, 3.863867347960617*^9}, {3.8638673920758486`*^9, 
   3.8638674134718075`*^9}, {3.8638674469179215`*^9, 3.863867483440287*^9}, {
   3.863867555039218*^9, 3.863867569697432*^9}, {3.8638676504780965`*^9, 
   3.863867731075045*^9}, {3.863867783983381*^9, 3.863867819944152*^9}, {
   3.863867944992251*^9, 3.8638679450939503`*^9}, {3.86386815690245*^9, 
   3.863868161467487*^9}, {3.8638681952042236`*^9, 3.8638682276119905`*^9}, {
   3.8638682704449134`*^9, 3.863868281823352*^9}, {3.863868356803086*^9, 
   3.863868359410698*^9}, 3.863868405445078*^9, {3.863868579006246*^9, 
   3.863868580201695*^9}, {3.8638692744149656`*^9, 3.8638692974053187`*^9}, 
   3.8638693389574404`*^9, {3.8638693784065237`*^9, 3.863869428674467*^9}, {
   3.8638694778328295`*^9, 3.8638695075900946`*^9}, {3.8638695511386375`*^9, 
   3.8638695540791206`*^9}, {3.8638695927347*^9, 3.8638697524153037`*^9}, 
   3.8638698849562263`*^9, {3.863869929736564*^9, 3.863869932352597*^9}, {
   3.8638703477349405`*^9, 3.863870347982177*^9}, {3.8638704246094074`*^9, 
   3.8638704278072166`*^9}, {3.863870488176374*^9, 3.8638704936854887`*^9}, {
   3.863870612809924*^9, 3.863870688941742*^9}, {3.8638707609848833`*^9, 
   3.863870796880453*^9}, {3.8638709129393044`*^9, 3.863870918011159*^9}, {
   3.863872182197363*^9, 3.8638721822581806`*^9}, {3.8638809329434023`*^9, 
   3.8638809330221667`*^9}, {3.8638810385701437`*^9, 
   3.8638810654476824`*^9}, {3.8638830821515865`*^9, 
   3.8638831457945704`*^9}, {3.8638833296379337`*^9, 
   3.8638833459221573`*^9}, {3.8639472306450977`*^9, 3.8639472680608263`*^9}, 
   3.863947406102669*^9, 3.863948953127384*^9, {3.863949188785073*^9, 
   3.8639491897733946`*^9}, {3.8639492323743773`*^9, 3.8639492441659155`*^9}, 
   3.8639494911114006`*^9, {3.863950898921159*^9, 3.8639509137991834`*^9}, 
   3.8639518616061263`*^9, {3.863955933376684*^9, 3.863956038562363*^9}, {
   3.863967110825785*^9, 3.863967129269355*^9}, 3.8639671647912235`*^9, {
   3.863967438035145*^9, 3.8639674387252216`*^9}, {3.863967504661045*^9, 
   3.863967525020056*^9}, {3.8639676897509317`*^9, 3.863967695057872*^9}, {
   3.8639677701360846`*^9, 3.8639678040573583`*^9}, {3.8639678360695443`*^9, 
   3.8639678361452913`*^9}, {3.863967901318364*^9, 3.863967912694027*^9}, {
   3.864017625543954*^9, 3.8640176257233524`*^9}, {3.8969597637902675`*^9, 
   3.896959766597268*^9}, {3.896959801188463*^9, 3.8969598066643286`*^9}, {
   3.8969637704080653`*^9, 3.8969637850239534`*^9}, {3.8971481396364403`*^9, 
   3.8971481467578664`*^9}, {3.8971530178271294`*^9, 
   3.8971530179020443`*^9}, {3.897153059064803*^9, 3.897153059162051*^9}, {
   3.8971532729560614`*^9, 3.89715330376748*^9}, {3.8971534700070815`*^9, 
   3.897153490880926*^9}, {3.8971554155861144`*^9, 3.8971554160460124`*^9}, {
   3.89715591894221*^9, 3.897155962750519*^9}, 3.8971559951770678`*^9, {
   3.8971560447610717`*^9, 3.897156053831153*^9}, {3.8971563033051624`*^9, 
   3.8971563110014067`*^9}, {3.897156380291234*^9, 3.8971563816273775`*^9}, {
   3.89754774908665*^9, 3.8975477531746497`*^9}, {3.897661259666749*^9, 
   3.8976612601747484`*^9}, {3.8979721133451967`*^9, 3.8979721191600003`*^9}, 
   3.8979722633128753`*^9, {3.961218064134601*^9, 3.961218064465537*^9}, {
   3.961250075488307*^9, 3.961250077360463*^9}},
 CellLabel->
  "In[219]:=",ExpressionUUID->"310ebe06-0433-404f-b7db-06b7391dcc58"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "text"}], " ", "input", " ", "string"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "toDelete"}], " ", "list", " ", "of", " ", "substrings", 
      " ", "to", " ", "remove"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Cleaned"}], " ", "string", " ", "with", " ", "specified",
        " ", "substrings", " ", "removed", " ", "and", " ", "overlapping", 
       " ", "sections", " ", "resolved"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Deletes", " ", "multiple", " ", "substrings", " ", "from", " ", "the", 
       " ", "input", " ", "text"}]}]}], ",", 
    RowBox[{"trims", " ", "extra", " ", "spaces"}], ",", 
    RowBox[{
    "finds", " ", "common", " ", "intersecting", " ", "words", " ", "across", 
     " ", "careful", " ", "deletion", " ", "passes"}], ",", 
    RowBox[{
    "and", " ", "returns", " ", "the", " ", "final", " ", "cleaned", " ", 
     RowBox[{"string", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"DeleteMultipleSubstrings", "[", 
    RowBox[{"text_", ",", "toDelete_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "purgedTextList", ",", "cleanedTextList", ",", "splitTexts", ",", 
       "firstText", ",", "intersectedTexts", ",", "finalText"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"ToString", "@", "toDelete"}], "==", "\"\<{}\>\""}], ",", 
       "text", ",", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "@", "toDelete"}], "==", "1"}], ",", 
         RowBox[{"StringDelete", "[", 
          RowBox[{"text", ",", "toDelete"}], "]"}], ",", 
         RowBox[{
          RowBox[{"purgedTextList", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"StringDelete", "[", 
              RowBox[{"text", ",", "#"}], "]"}], "&"}], "/@", "toDelete"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"cleanedTextList", "=", 
           RowBox[{"StringTrim", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"StringReplace", "[", 
               RowBox[{"#", ",", 
                RowBox[{"\"\<  \>\"", " ", "->", " ", "\"\< \>\""}]}], "]"}], 
              "&"}], "/@", "purgedTextList"}], "]"}]}], ";", 
          RowBox[{"splitTexts", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"StringSplit", "[", 
              RowBox[{"#", ",", "\"\< \>\""}], "]"}], "&"}], "/@", 
            "cleanedTextList"}]}], ";", 
          RowBox[{"firstText", "=", 
           RowBox[{"splitTexts", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"intersectedTexts", "=", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"firstText", "=", 
              RowBox[{"Cases", "[", 
               RowBox[{"firstText", ",", 
                RowBox[{"Apply", "[", 
                 RowBox[{"Alternatives", ",", 
                  RowBox[{"splitTexts", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "]"}]}], "]"}]}],
              ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{
                RowBox[{"Length", "@", "splitTexts"}], "-", "1"}]}], "}"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"finalText", "=", 
           RowBox[{"StringRiffle", "@", 
            RowBox[{"Last", "@", "intersectedTexts"}]}]}]}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.863940156878318*^9, 3.863940265593074*^9}, {
  3.863941218251096*^9, 3.863941251345718*^9}, {3.863941307311099*^9, 
  3.863941336465694*^9}, {3.863947129950042*^9, 3.863947163228997*^9}, {
  3.863953006307542*^9, 3.863953042423065*^9}, {3.8639539135217867`*^9, 
  3.863953955357361*^9}, {3.8976612688052225`*^9, 3.8976612693505907`*^9}, {
  3.961250093113262*^9, 3.961250127474462*^9}},
 CellLabel->
  "In[220]:=",ExpressionUUID->"78111f3e-923f-4d50-8c66-69a224290c2b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "text"}], " ", "input", " ", "string"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "substrings"}], " ", "list", " ", "of", " ", "candidate", 
      " ", "substrings"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Ordered"}], " ", "list", " ", "of", " ", "substrings", 
       " ", "identified", " ", "as", " ", "frequently", " ", "repeated", " ", 
       "and", " ", "suitable", " ", "for", " ", "removal"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Analyzes", " ", "which", " ", "substrings", " ", "appear", " ", 
       "frequently", " ", 
       RowBox[{"(", 
        RowBox[{"at", " ", "least", " ", "4", " ", "times"}], ")"}], " ", 
       "in", " ", "the", " ", "text"}]}]}], ",", 
    RowBox[{"clusters", " ", "them", " ", "by", " ", "similarity"}], ",", 
    RowBox[{
    "orders", " ", "them", " ", "by", " ", "word", " ", "count", " ", "and", 
     " ", "length"}], ",", 
    RowBox[{
    "and", " ", "returns", " ", "a", " ", "flattened", " ", "list", " ", 
     "for", " ", "prioritized", " ", 
     RowBox[{"deletion", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"FindPurgeableSubstrings", "[", 
    RowBox[{"text_", ",", "substrings_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "repCount", ",", "winRepPos", ",", "commonRep", ",", "clusteredRep", 
       ",", "orderedRep", ",", "sortedRep", ",", "finalRep", ",", 
       "flattenedRep"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Counts", " ", "most", " ", "numerable", " ", "repitions", " ", "to", 
       " ", "delete", " ", "and", " ", "attempts", " ", "to", " ", "cluster", 
       " ", "them", " ", "based", " ", "on", " ", "Length", " ", "for", " ", 
       "ordered", " ", "purge"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"repCount", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"StringCount", "[", 
          RowBox[{"text", ",", "#"}], "]"}], "&"}], "/@", "substrings"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"winRepPos", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Pick", "[", 
          RowBox[{"#", ",", 
           RowBox[{"#", ">=", "4"}]}], "]"}], "&"}], "/@", "repCount"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"commonRep", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{"substrings", ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Position", "[", 
          RowBox[{"repCount", ",", 
           RowBox[{"Alternatives", "@@", "winRepPos"}]}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", "commonRep"}], "<", "1"}], ",", 
        RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"clusteredRep", "=", 
          RowBox[{"FindClusters", "[", "commonRep", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "If", " ", "Clusters", " ", "are", " ", "only", " ", "one", " ", 
            "deep"}], ",", " ", 
           RowBox[{"then", " ", "dissolve", " ", "them"}]}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"AllTrue", "[", 
            RowBox[{
             RowBox[{"Length", "/@", "clusteredRep"}], ",", 
             RowBox[{
              RowBox[{"#", "==", "1"}], "&"}]}], "]"}], ",", 
           RowBox[{"clusteredRep", "=", 
            RowBox[{"{", 
             RowBox[{"Flatten", "[", "clusteredRep", "]"}], "}"}]}], ",", 
           "clusteredRep"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"orderedRep", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"Reverse", "@", 
             RowBox[{"SortBy", "[", 
              RowBox[{"#", ",", "WordCount"}], "]"}]}], "&"}], "/@", 
           "clusteredRep"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"sortedRep", "=", 
          RowBox[{"Reverse", "@", 
           RowBox[{"SortBy", "[", 
            RowBox[{"orderedRep", ",", "Length"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"finalRep", "=", 
          RowBox[{"Reverse", "@", 
           RowBox[{"SortBy", "[", 
            RowBox[{"sortedRep", ",", "WordCount"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"flattenedRep", "=", 
          RowBox[{"Flatten", "@", "finalRep"}]}]}]}], "\[IndentingNewLine]", 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQA2IQnf+jWvLpyTeOlVOKpUD0j3kOCiD6otIVMxBt0ixl
A6KPcxy0A9HNoXE/nwFp+z18v0D0sv1vHZ8D6SiB204gWuVOagiIvvH9axiI
Fvj6SPgFkH4T3yEComvaI5xeA+nbLEu9QHQTY104iH7y2D0KRE956tUHohUP
i84G0SH8bp9A9PP4XjD9Zm7WzndA+v+LFWD6opS8ynsg3bclE0xLPQrXZj/1
xlGkvRtMcz12nQaiuyo5Z4DoezsnzQXR88qFF4LoGdkPdoPoJYaJe0D0ubdS
JTacbx3T7smA6TdvAq+B6JDfIWB6xTzh10Zcbx0PzlMF03zz+Rtzmt86Ppgg
A6YLG+MNaoD0svgFYBoAEWHFkg==
  "],
 CellLabel->
  "In[221]:=",ExpressionUUID->"1b9afccb-20ef-4f6b-bed8-78fa5075a413"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "zoteroCSV"}], " ", "Zotero", " ", "CSV", " ", "table"}]}],
     ",", 
    RowBox[{
     RowBox[{"-", "refClassifier"}], " ", "reference", " ", "classifier", " ",
      "function"}], ",", 
    RowBox[{
     RowBox[{"-", "feDR"}], " ", "text", " ", "model"}], ",", " ", 
    RowBox[{
    "feature", " ", "extractor", " ", "or", " ", "dimensionality", " ", 
     "reducer"}], ",", 
    RowBox[{
     RowBox[{"-", "dict"}], " ", "dictionary", " ", "for", " ", "encoding"}], 
    ",", 
    RowBox[{
     RowBox[{"-", "dictReverse"}], " ", "reverse", " ", "dictionary", " ", 
     "for", " ", "decoding"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "transformer"}], " ", "optional", " ", "mode", " ", "flag",
       " ", 
      RowBox[{"(", "\"\<transformer\>\"", ")"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", 
       RowBox[{"{", 
        RowBox[{"vector", ",", "tokens", ",", "key"}], "}"}], " ", 
       "triples"}]}]}], ",", 
    RowBox[{"embedding", " ", "association"}], ",", 
    RowBox[{"sentence", " ", "association"}], ",", 
    RowBox[{
     RowBox[{"and", " ", "book", " ", "metadata", " ", "association"}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Processes", " ", "books", " ", "by", " ", "extracting", " ", "and", 
       " ", "cleaning", " ", "sentences", " ", "from", " ", "attached", " ", 
       "files"}]}]}], ",", 
    RowBox[{"filtering", " ", "English", " ", "content"}], ",", 
    RowBox[{"removing", " ", "references"}], ",", 
    RowBox[{"tokenizing", " ", "and", " ", "embedding", " ", "words"}], ",", 
    RowBox[{
    "vectorizing", " ", "sentences", " ", "using", " ", "any", " ", "feature",
      " ", "extractor"}], ",", 
    RowBox[{
    "and", " ", "returning", " ", "all", " ", "data", " ", "structures", " ", 
     "for", " ", "downstream", " ", 
     RowBox[{"use", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"EncodeGuidesFromBooks", "[", 
    RowBox[{
    "zoteroCSV_", ",", "refClassifier_", ",", "feDR_", ",", "dict_", ",", 
     "dictReverse_", ",", 
     RowBox[{"transformer_", ":", "\"\<\>\""}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "zoteroAss", ",", "guideBookAssoc", ",", "guideBookKeys", ",", 
       "guideSentences", ",", "guideSentenceAssoc", ",", 
       "guideSentenceAssocKeys", ",", "text", ",", 
       RowBox[{"status", "=", "\"\<\>\""}], ",", "sentences", ",", 
       "cleanPages", ",", "englishPos", ",", "sentencesEng", ",", 
       "sentencesEngNoRef", ",", "sentencesEngNoRefClean", ",", 
       "sentencesFiltered", ",", "wordAssoc", ",", "tokenAssoc", ",", "test1",
        ",", "test2", ",", "pos1", ",", "pos2", ",", "pos", ",", "tokenKeys", 
       ",", "data"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Case", " ", "all", " ", "keys", " ", "to", " ", "lower", " ", "case"}],
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"zoteroAss", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"AssociationThread", "[", 
          RowBox[{
           RowBox[{"ToLowerCase", "@", 
            RowBox[{"First", "@", "zoteroCSV"}]}], ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"Rest", "@", "zoteroCSV"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"guideBookAssoc", "=", 
       RowBox[{"FlattenAssociation", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Association", "[", 
           RowBox[{
            RowBox[{"zoteroAss", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "\"\<key\>\""}], "]"}], "]"}], "->", 
            RowBox[{"zoteroAss", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "@", "zoteroAss"}]}], "}"}]}], "]"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"guideBookKeys", "=", 
       RowBox[{"Keys", "@", "guideBookAssoc"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"guideSentences", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"text", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"Import", "[", 
                RowBox[{"#", ",", "\"\<PagePlaintext\>\""}], "]"}], "&"}], 
              "@", 
              RowBox[{"guideBookAssoc", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"guideBookKeys", "[", 
                  RowBox[{"[", "g", "]"}], "]"}], ",", 
                 "\"\<file attachments\>\""}], "]"}], "]"}]}]}], ";", 
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"Clean", " ", "Book"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"status", "=", 
             RowBox[{"\"\<Splitting book \>\"", "<>", 
              RowBox[{"ToString", "@", "g"}], "<>", "\"\< of \>\"", "<>", 
              RowBox[{"ToString", "@", 
               RowBox[{"Length", "@", "guideBookKeys"}]}], "<>", 
              "\"\< into pages ...\>\""}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "@", "text"}], "<", "2"}], ",", 
              RowBox[{"sentences", "=", 
               RowBox[{"{", 
                RowBox[{"TextSentences", "[", 
                 RowBox[{"First", "@", 
                  RowBox[{"Join", "[", 
                   RowBox[{"CleanupString", "/@", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", "text", "}"}], "]"}]}], "]"}]}], "]"}], 
                "}"}]}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"cleanPages", "=", 
                RowBox[{"CleanBook", "[", 
                 RowBox[{"CleanupString", "/@", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"{", "text", "}"}], "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"sentences", "=", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"TextSentences", "[", 
                   RowBox[{"cleanPages", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", 
                    RowBox[{"Length", "@", "text"}]}], "}"}]}], "]"}]}]}]}], 
             "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"Cleaning", " ", "sentences"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"status", "=", 
             RowBox[{"\"\<Cleaning \>\"", "<>", 
              RowBox[{"ToString", "@", 
               RowBox[{"Length", "@", "sentences"}]}], "<>", 
              "\"\< pages of book \>\"", "<>", 
              RowBox[{"ToString", "@", "g"}], "<>", "\"\< ...\>\""}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "@", 
                   RowBox[{"sentences", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ">", "0"}], "&&", 
                 RowBox[{
                  RowBox[{"Length", "@", 
                   RowBox[{"sentences", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}]}], ">", "0"}], "&&", 
                 RowBox[{"i", "<", 
                  RowBox[{"Length", "@", "sentences"}]}]}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"StringLength", "[", 
                    RowBox[{"Last", "[", 
                    RowBox[{"sentences", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ">", "1"}], 
                   "&&", "\[IndentingNewLine]", 
                   RowBox[{"Not", "@", 
                    RowBox[{"StringMatchQ", "[", 
                    RowBox[{
                    RowBox[{"StringTake", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"sentences", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Length", "@", 
                    RowBox[{"sentences", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "]"}], ",", 
                    RowBox[{"-", "1"}]}], "]"}], ",", 
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{"{", 
                    RowBox[{
                    "\"\<.\>\"", ",", "\"\<;\>\"", ",", "\"\<:\>\"", ",", 
                    "\"\<!\>\"", ",", "\"\<?\>\""}], "}"}]}]}], "]"}]}]}], 
                  ",", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"sentences", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Length", "@", 
                    RowBox[{"sentences", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "]"}], "=", 
                    RowBox[{"StringRiffle", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"sentences", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Length", "@", 
                    RowBox[{"sentences", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"sentences", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "}"}], "]"}]}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"sentences", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], "=", 
                    RowBox[{"Delete", "[", 
                    RowBox[{
                    RowBox[{"sentences", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", "1"}], 
                    "]"}]}]}], ",", "\"\<\>\""}], "]"}], ",", "\"\<\>\""}], 
               "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{
                 RowBox[{"Length", "@", "sentences"}], "-", "1"}]}], "}"}]}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"englishPos", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Position", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"MatchQ", "[", 
                    RowBox[{
                    RowBox[{"LanguageIdentify", "[", "#", "]"}], ",", 
                    TemplateBox[{"\"English\"", 
                    RowBox[{"Entity", "[", 
                    RowBox[{"\"Language\"", ",", "\"English\""}], "]"}], 
                    "\"Entity[\\\"Language\\\", \\\"English\\\"]\"", 
                    "\"language\""},
                    "Entity"]}], "]"}], "&"}], "/@", 
                  RowBox[{"sentences", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], ",", "True"}], "]"}], 
               ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "@", "sentences"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
             "Filter", " ", "Sentences", " ", "for", " ", "English", " ", 
              "and", " ", "for", " ", "Length"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"status", "=", 
             RowBox[{"\"\<Filtering \>\"", "<>", 
              RowBox[{"ToString", "@", 
               RowBox[{"Length", "@", "sentences"}]}], "<>", 
              "\"\< pages of book \>\"", "<>", 
              RowBox[{"ToString", "@", "g"}], "<>", "\"\< ...\>\""}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"sentencesEng", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"sentences", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "[", 
                   RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
                 RowBox[{"englishPos", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "@", "sentences"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"sentencesEngNoRef", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"Pick", "[", 
                  RowBox[{
                   RowBox[{"sentencesEng", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
                   RowBox[{
                    RowBox[{"refClassifier", "[", 
                    RowBox[{"sentencesEng", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], "]"}], "==", 
                    "\"\<sentence\>\""}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"j", ",", 
                   RowBox[{"Length", "@", 
                    RowBox[{"sentencesEng", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "@", "sentencesEng"}]}], "}"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"sentencesEngNoRefClean", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Pick", "[", 
                  RowBox[{"#", ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"DictWordCount", "[", "#", "]"}], ">", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"TextWordsFast", "[", "#", "]"}], "]"}], "/", 
                    "1.5"}], ")"}]}], "&&", 
                    RowBox[{
                    RowBox[{"DictWordCount", "[", "#", "]"}], ">=", "5"}]}]}],
                   "]"}], "&"}], "/@", 
                RowBox[{"sentencesEngNoRef", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "@", "sentencesEngNoRef"}]}], "}"}]}], 
              "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"sentencesFiltered", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Pick", "[", 
                  RowBox[{"#", ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"TextWordsFast", "[", "#", "]"}], "]"}], ">", 
                    "10"}], "&&", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"TextWordsFast", "[", "#", "]"}], "]"}], "<", 
                    "100"}]}]}], "]"}], "&"}], "/@", 
                RowBox[{"sentencesEngNoRefClean", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "@", "sentencesEngNoRefClean"}]}], "}"}]}],
               "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"AppendTo", "[", 
             RowBox[{"guideSentences", ",", "sentencesFiltered"}], "]"}], 
            ";"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"g", ",", 
             RowBox[{"Length", "@", "guideBookKeys"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Tokenize", " ", "sentences"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"guideSentenceAssoc", "=", 
          RowBox[{"Association", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"guideBookKeys", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "<>", "\"\<_\>\"", "<>", 
                    RowBox[{"ToString", "@", "j"}], "<>", "\"\<_\>\"", "<>", 
                    RowBox[{"ToString", "@", "k"}]}], "->", 
                   RowBox[{"guideSentences", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j", ",", "k"}], "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"k", ",", 
                    RowBox[{"Length", "@", 
                    RowBox[{"guideSentences", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], "}"}]}], "]"}],
                 ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", 
                  RowBox[{"Length", "@", 
                   RowBox[{"guideSentences", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", "@", "guideBookKeys"}]}], "}"}]}], "]"}], 
            "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"guideSentenceAssocKeys", "=", 
          RowBox[{"Keys", "@", "guideSentenceAssoc"}]}], ";", 
         RowBox[{"wordAssoc", "=", 
          RowBox[{"Association", "[", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"guideSentenceAssocKeys", "[", 
               RowBox[{"[", "g", "]"}], "]"}], "->", 
              RowBox[{"Association", "[", 
               RowBox[{"\"\<words\>\"", "->", 
                RowBox[{"WordStem", "[", 
                 RowBox[{"PickCleanDictWordsFromSentences", "[", 
                  RowBox[{"guideSentenceAssoc", "[", 
                   RowBox[{"[", 
                    RowBox[{"guideSentenceAssocKeys", "[", 
                    RowBox[{"[", "g", "]"}], "]"}], "]"}], "]"}], "]"}], 
                 "]"}]}], "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"g", ",", 
               RowBox[{"Length", "@", "guideSentenceAssocKeys"}]}], "}"}]}], 
            "]"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Clean", " ", "up", " ", "tokens"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"status", "=", 
          RowBox[{"\"\<Cleaning up \>\"", "<>", 
           RowBox[{"ToString", "@", 
            RowBox[{"Length", "@", "guideSentenceAssocKeys"}]}], "<>", 
           "\"\< tokenized sentences ...\>\""}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"tokenAssoc", "=", 
          RowBox[{"Association", "[", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"guideSentenceAssocKeys", "[", 
               RowBox[{"[", "g", "]"}], "]"}], "->", 
              RowBox[{"Association", "[", 
               RowBox[{
                RowBox[{"\"\<tokens\>\"", "->", 
                 RowBox[{"Flatten", "@", 
                  RowBox[{"Values", "[", 
                   RowBox[{"DictEncodeEntry", "[", 
                    RowBox[{
                    RowBox[{"wordAssoc", "[", 
                    RowBox[{"[", 
                    RowBox[{"guideSentenceAssocKeys", "[", 
                    RowBox[{"[", "g", "]"}], "]"}], "]"}], "]"}], ",", 
                    "dict"}], "]"}], "]"}]}]}], ",", 
                RowBox[{"\"\<words\>\"", "->", 
                 RowBox[{"Flatten", "@", 
                  RowBox[{"Values", "[", 
                   RowBox[{"wordAssoc", "[", 
                    RowBox[{"[", 
                    RowBox[{"guideSentenceAssocKeys", "[", 
                    RowBox[{"[", "g", "]"}], "]"}], "]"}], "]"}], "]"}]}]}]}],
                "]"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"g", ",", 
               RowBox[{"Length", "@", "guideSentenceAssocKeys"}]}], "}"}]}], 
            "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"test1", "=", 
          RowBox[{"Values", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", 
            RowBox[{"wordAssoc", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "\"\<words\>\""}], "]"}], "]"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"test2", "=", 
          RowBox[{"Values", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", 
            RowBox[{"tokenAssoc", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "\"\<tokens\>\""}], "]"}], "]"}]}], "]"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"pos1", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{"test1", ",", 
             RowBox[{"x_", "/;", 
              RowBox[{
               RowBox[{"x", "<", "8"}], "||", 
               RowBox[{"x", ">", "32"}]}]}]}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"pos2", "=", 
          RowBox[{"Position", "[", 
           RowBox[{"test2", ",", 
            RowBox[{"x_", "/;", 
             RowBox[{"x", "<", "4"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"pos", "=", 
          RowBox[{"DeleteDuplicates", "[", 
           RowBox[{"Join", "[", 
            RowBox[{"pos1", ",", "pos2"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"tokenAssoc", "=", 
          RowBox[{"KeyDrop", "[", 
           RowBox[{"tokenAssoc", ",", 
            RowBox[{"guideSentenceAssocKeys", "[", 
             RowBox[{"[", 
              RowBox[{"Sequence", "@@@", "pos"}], "]"}], "]"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Tokenize", " ", "sentences"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"tokenKeys", "=", 
          RowBox[{"Keys", "@", "tokenAssoc"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"transformer", "==", "\"\<transformer\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"data", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"status", "=", 
                 RowBox[{"\"\<Vectorizing \>\"", "<>", 
                  RowBox[{"ToString", "@", "g"}], "<>", "\"\< of \>\"", "<>", 
                  RowBox[{"ToString", "@", 
                   RowBox[{"Length", "@", "tokenAssoc"}]}], "<>", 
                  "\"\< corpuscles ...\>\""}]}], ";", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"feDR", "[", 
                   RowBox[{"guideSentenceAssoc", "[", 
                    RowBox[{"[", 
                    RowBox[{"tokenKeys", "[", 
                    RowBox[{"[", "g", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"tokenAssoc", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"tokenKeys", "[", 
                    RowBox[{"[", "g", "]"}], "]"}], ",", "\"\<tokens\>\""}], 
                    "]"}], "]"}], "}"}], ",", 
                  RowBox[{"tokenKeys", "[", 
                   RowBox[{"[", "g", "]"}], "]"}]}], "}"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"g", ",", 
                 RowBox[{"Length", "@", "tokenKeys"}]}], "}"}]}], "]"}]}], 
            ";"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"data", "=", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"status", "=", 
                 RowBox[{"\"\<Vectorizing \>\"", "<>", 
                  RowBox[{"ToString", "@", "g"}], "<>", "\"\< of \>\"", "<>", 
                  RowBox[{"ToString", "@", 
                   RowBox[{"Length", "@", "tokenAssoc"}]}], "<>", 
                  "\"\< corpuscles ...\>\""}]}], ";", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"feDR", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"DictDecodeEntry", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"tokenAssoc", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"tokenKeys", "[", 
                    RowBox[{"[", "g", "]"}], "]"}], ",", "\"\<tokens\>\""}], 
                    "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"#", "<=", "10000"}], "&"}]}], "]"}], "}"}], ",", 
                    "dictReverse"}], "]"}], "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"tokenAssoc", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"tokenKeys", "[", 
                    RowBox[{"[", "g", "]"}], "]"}], ",", "\"\<tokens\>\""}], 
                    "]"}], "]"}], "}"}], ",", 
                  RowBox[{"tokenKeys", "[", 
                   RowBox[{"[", "g", "]"}], "]"}]}], "}"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"g", ",", 
                 RowBox[{"Length", "@", "tokenKeys"}]}], "}"}]}], "]"}]}], 
            ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], 
        "\[IndentingNewLine]", ",", "status"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
       "data", ",", "tokenAssoc", ",", "guideSentenceAssoc", ",", 
        "guideBookAssoc"}], "}"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8997346227945795`*^9, 3.8997346234093466`*^9}, {
   3.899734904856662*^9, 3.899734981285426*^9}, {3.899735013372365*^9, 
   3.899735031379569*^9}, {3.89973512806994*^9, 3.8997351329181376`*^9}, {
   3.8997364269031773`*^9, 3.899736625719596*^9}, {3.899736782555388*^9, 
   3.8997367843952813`*^9}, {3.8997368383751144`*^9, 3.899736894031384*^9}, 
   3.89973694322183*^9, {3.8997385888585196`*^9, 3.8997386425896387`*^9}, {
   3.899738814043404*^9, 3.899738832620637*^9}, {3.899739973709829*^9, 
   3.899739974876218*^9}, {3.899740311333383*^9, 3.899740390289421*^9}, {
   3.899740460211474*^9, 3.899740472546177*^9}, {3.899740569289631*^9, 
   3.8997406350244536`*^9}, {3.899740678551874*^9, 3.8997407075120745`*^9}, {
   3.8997407378169093`*^9, 3.8997407693594503`*^9}, {3.8997457454311295`*^9, 
   3.8997461877120676`*^9}, {3.899804851318943*^9, 3.899804918912966*^9}, {
   3.8998049522807083`*^9, 3.8998050762012835`*^9}, {3.8998051549822865`*^9, 
   3.899805195434742*^9}, {3.8998052272571106`*^9, 3.8998052906755495`*^9}, 
   3.899805405295813*^9, {3.8998057433615427`*^9, 3.8998057672392397`*^9}, {
   3.89980581029323*^9, 3.8998058176219006`*^9}, {3.89980587422042*^9, 
   3.8998059638850417`*^9}, {3.899806009035095*^9, 3.8998060143206563`*^9}, {
   3.8998061221967506`*^9, 3.899806257063625*^9}, {3.899806355992951*^9, 
   3.8998063563817515`*^9}, {3.8998063937397685`*^9, 3.8998063998312035`*^9}, 
   3.899807071325013*^9, {3.8998174470904937`*^9, 3.899817450263873*^9}, {
   3.899826039564859*^9, 3.899826060297616*^9}, {3.8998312648696256`*^9, 
   3.8998312911868153`*^9}, {3.899831527827652*^9, 3.8998315282709756`*^9}, {
   3.899832947941337*^9, 3.899832955382995*^9}, {3.9105211717242947`*^9, 
   3.910521192102792*^9}, {3.9105213186381807`*^9, 3.910521326974666*^9}, {
   3.910521443266674*^9, 3.9105215297155104`*^9}, {3.910521591044159*^9, 
   3.9105216284521685`*^9}, 3.9105239906053934`*^9, {3.910524054524419*^9, 
   3.9105240555548573`*^9}, 3.910524091318218*^9, {3.910524599052495*^9, 
   3.9105245995598445`*^9}, {3.919527274970193*^9, 3.919527332683824*^9}, {
   3.919527885980031*^9, 3.919527888509169*^9}, 3.91952806054657*^9, 
   3.9195295258547506`*^9, {3.937824665506777*^9, 3.937824722710479*^9}, {
   3.937825054112628*^9, 3.937825058829834*^9}, {3.96125048723029*^9, 
   3.961250576582692*^9}},
 CellLabel->
  "In[222]:=",ExpressionUUID->"c4ce68cb-640b-481a-af97-60174112c648"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "guideFile"}], " ", "path", " ", "to", " ", "guide", " ", 
      "file"}]}], ",", 
    RowBox[{
     RowBox[{"-", "exportFolder"}], " ", "folder", " ", "for", " ", "saving", 
     " ", "output"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "interpolated"}], " ", "optional", " ", "boolean", " ", 
      "to", " ", "enable", " ", "interpolated", " ", "mode", " ", "with", " ",
       "Diadromes", " ", 
      RowBox[{"(", 
       RowBox[{"default", " ", "False"}], ")"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Generates"}], " ", "and", " ", "exports", " ", "a", " ", 
       "guidebook", " ", "file", " ", "with", " ", "retrieved", " ", "SOM", 
       " ", "encounters"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Loads", " ", "a", " ", "guide", " ", "SOM", " ", "and", " ", "related",
        " ", "data"}]}]}], ",", 
    RowBox[{"queries", " ", "the", " ", "main", " ", "SOM", " ", 
     RowBox[{"(", "clipedia", ")"}], " ", "for", " ", "matching", " ", "text",
      " ", "and", " ", "images"}], ",", 
    RowBox[{
    "optionally", " ", "interpolates", " ", "between", " ", "SOM", " ", 
     "nodes", " ", "with", " ", "Diadromes"}], ",", 
    RowBox[{"collects", " ", "encounters"}], ",", 
    RowBox[{
    "and", " ", "generates", " ", "a", " ", "guidebook", " ", "using", " ", 
     "MakeGuideBook"}], ",", 
    RowBox[{"saving", " ", "it", " ", "to", " ", "the", " ", "specified", " ", 
     RowBox[{"folder", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ClipediaGuidebook", "[", 
    RowBox[{"guideFile_", ",", "exportFolder_", ",", 
     RowBox[{"interpolated_", ":", "False"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "guide", ",", "guideSom", ",", "guideAssoc", ",", "guideTokenAssoc", 
       ",", "guideSentences", ",", "guideBookAssoc", ",", "results", ",", 
       "spectrum", ",", "encounters", ",", "ids", ",", "k", ",", "queryVecA", 
       ",", "queryVecB", ",", "interImgResults", ",", "interTxtResults", ",", 
       "imgEncounters", ",", "txtEncounters", ",", "title", ",", 
       "guideSentenceID", ",", "guideSentence", ",", "txtQuery", ",", 
       "imgQuery"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"guide", "=", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Import", "@", "guideFile"}], ",", 
         RowBox[{"{", 
          RowBox[{"FileBaseName", "[", "guideFile", "]"}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"guideSom", "=", 
       RowBox[{"guide", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"guideAssoc", "=", 
       RowBox[{"guide", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"guideTokenAssoc", "=", 
       RowBox[{"guideAssoc", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"guideSentences", "=", 
       RowBox[{"guideAssoc", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"guideBookAssoc", "=", 
       RowBox[{"guideAssoc", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"results", "=", "64"}], ";", "\[IndentingNewLine]", 
      RowBox[{"spectrum", "=", "8"}], ";", "\[IndentingNewLine]", 
      RowBox[{"encounters", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"interpolated", "=!=", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"encounters", "=", "\[IndentingNewLine]", 
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Length", "@", 
                   RowBox[{"guideSom", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<eventListSorted\>\"", ",", "j"}], "]"}], 
                    "]"}]}], ">", "0"}], ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"guideSentenceID", "=", 
                   RowBox[{"guideSom", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    "\"\<eventListSorted\>\"", ",", "j", ",", "1", ",", "3"}],
                     "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"guideSentence", "=", 
                   RowBox[{"guideSentences", "[", 
                    RowBox[{"[", 
                    RowBox[{"guideSom", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    "\"\<eventListSorted\>\"", ",", "j", ",", "1", ",", "3"}],
                     "]"}], "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"txtQuery", "=", 
                   RowBox[{
                    RowBox[{"QueryEnSOM", "[", 
                    RowBox[{"clipedia", ",", 
                    RowBox[{"guideSom", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    "\"\<eventListSorted\>\"", ",", "j", ",", "1", ",", "1"}],
                     "]"}], "]"}], ",", "\"\<txt\>\"", ",", "0.015", ",", " ",
                     "0.0005", ",", "1", ",", "$repoFolder"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"imgQuery", "=", 
                   RowBox[{
                    RowBox[{"QueryEnSOM", "[", 
                    RowBox[{"clipedia", ",", 
                    RowBox[{"Mean", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"guideSom", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    "\"\<eventListSorted\>\"", ",", "j", ",", "1", ",", "1"}],
                     "]"}], "]"}], ",", 
                    RowBox[{"txtQuery", "[", 
                    RowBox[{"[", "5", "]"}], "]"}]}], "}"}], "]"}], ",", 
                    "\"\<img\>\"", ",", "0.01", ",", "0.0005", ",", "1", ",", 
                    "$repoFolder"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"AddInfo", "[", 
                    RowBox[{"CollateEnAssoc", "[", "#", "]"}], "]"}], "&"}], "/@", 
                   RowBox[{"{", 
                    RowBox[{"txtQuery", ",", "imgQuery"}], "}"}]}]}], ",", 
                 "\[IndentingNewLine]", "CreateEmptyAssoc"}], "]"}], "}"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"guideSom", "[", 
                  RowBox[{"[", "\"\<eventListSorted\>\"", "]"}], "]"}]}]}], 
               "}"}]}], "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ids", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"KeyExistsQ", "[", 
                   RowBox[{"#", ",", "\"\<type\>\""}], "]"}], ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "\"\<type\>\"", "]"}], "]"}], "==", 
                    "\"\<img\>\""}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "\"\<imgHash\>\"", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "\"\<textID\>\"", "]"}], "]"}]}], "]"}], ",", 
                  RowBox[{"{", "}"}]}], "]"}], "&"}], "/@", 
               RowBox[{"Flatten", "[", "encounters", "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"k", "=", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"j", "==", 
                 RowBox[{"Length", "@", 
                  RowBox[{"guideSom", "[", 
                   RowBox[{"[", "\"\<eventListSorted\>\"", "]"}], "]"}]}]}], 
                ",", "1", ",", 
                RowBox[{"j", "+", "1"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"queryVecA", "=", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "@", 
                  RowBox[{"guideSom", "[", 
                   RowBox[{"[", 
                    RowBox[{"\"\<eventListSorted\>\"", ",", "j"}], "]"}], 
                   "]"}]}], ">", "0"}], ",", 
                RowBox[{"guideSom", "[", 
                 RowBox[{"[", 
                  RowBox[{
                  "\"\<eventListSorted\>\"", ",", "j", ",", "1", ",", "1"}], 
                  "]"}], "]"}], ",", 
                RowBox[{"guideSom", "[", 
                 RowBox[{"[", 
                  RowBox[{
                  "\"\<kernel\>\"", ",", "\"\<weights\>\"", ",", "j"}], "]"}],
                  "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"queryVecB", "=", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "@", 
                  RowBox[{"guideSom", "[", 
                   RowBox[{"[", 
                    RowBox[{"\"\<eventListSorted\>\"", ",", "k"}], "]"}], 
                   "]"}]}], ">", "0"}], ",", 
                RowBox[{"guideSom", "[", 
                 RowBox[{"[", 
                  RowBox[{
                  "\"\<eventListSorted\>\"", ",", "k", ",", "1", ",", "1"}], 
                  "]"}], "]"}], ",", 
                RowBox[{"guideSom", "[", 
                 RowBox[{"[", 
                  RowBox[{
                  "\"\<kernel\>\"", ",", "\"\<weights\>\"", ",", "k"}], "]"}],
                  "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"interImgResults", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}], "}"}], "&"}], "/@", 
                  RowBox[{"QueryEnSOM", "[", 
                   RowBox[{
                   "clipedia", ",", "#", ",", "\"\<img\>\"", ",", "0.015", 
                    ",", " ", "0.0005", ",", "results", ",", "$repoFolder"}], 
                   "]"}]}], ")"}], "&"}], "/@", 
               RowBox[{"{", 
                RowBox[{"queryVecA", ",", "queryVecB"}], "}"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"interTxtResults", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "5", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}], "}"}], "&"}], "/@", 
                  RowBox[{"QueryEnSOM", "[", 
                   RowBox[{
                   "clipedia", ",", "#", ",", "\"\<txt\>\"", ",", "0.015", 
                    ",", " ", "0.0005", ",", "results", ",", "$repoFolder"}], 
                   "]"}]}], ")"}], "&"}], "/@", 
               RowBox[{"{", 
                RowBox[{"queryVecA", ",", "queryVecB"}], "}"}]}]}], ";", 
             RowBox[{"imgEncounters", "=", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"InterpolateWithSOM", "[", 
                    RowBox[{
                    "queryVecA", ",", "queryVecB", ",", "interImgResults", 
                    ",", "spectrum", ",", "1", ",", "ids"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}], ",", 
                RowBox[{"Association", "[", "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"txtEncounters", "=", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"InterpolateWithSOM", "[", 
                    RowBox[{
                    "queryVecA", ",", "queryVecB", ",", "interTxtResults", 
                    ",", "spectrum", ",", "1", ",", "ids"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", "1"}], "]"}], ",", 
                RowBox[{"Association", "[", "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"encounters", "=", 
              RowBox[{"Join", "[", 
               RowBox[{"encounters", ",", 
                RowBox[{"{", 
                 RowBox[{"TransposeUnevenLists", "[", 
                  RowBox[{"imgEncounters", ",", "txtEncounters"}], "]"}], 
                 "}"}]}], "]"}]}]}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", 
              RowBox[{"Length", "@", 
               RowBox[{"guideSom", "[", 
                RowBox[{"[", "\"\<eventListSorted\>\"", "]"}], "]"}]}]}], 
             "}"}]}], "]"}]}], "]"}], ",", "j"}], "]"}], ";", 
      "\[IndentingNewLine]", "\n", 
      RowBox[{"title", "=", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"interpolated", "==", "True"}], ",", " ", "\"\<Walking\>\"",
           ",", "\"\<Flying\>\""}], "]"}], "<>", "\"\< with \>\"", "<>", 
        RowBox[{"Capitalize", "[", 
         RowBox[{
          RowBox[{"StringDelete", "[", 
           RowBox[{
            RowBox[{"StringReplace", "[", 
             RowBox[{
              RowBox[{"FileBaseName", "[", "guideFile", "]"}], ",", 
              RowBox[{"\"\<_\>\"", "->", "\"\< \>\""}]}], "]"}], ",", 
            "DigitCharacter"}], "]"}], ",", "\"\<TitleCase\>\""}], "]"}]}]}], 
      " ", ";", "\[IndentingNewLine]", 
      RowBox[{"MakeGuideBook", "[", 
       RowBox[{
       "encounters", ",", "guide", ",", "title", ",", "exportFolder", ",", 
        "dictReverse"}], "]"}], ";"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.91951814422414*^9, 3.919518151877295*^9}, {
   3.919525683780736*^9, 3.919525697548151*^9}, {3.919530426997554*^9, 
   3.919530429904744*^9}, {3.919531028730813*^9, 3.919531035916066*^9}, {
   3.919531220105997*^9, 3.919531221587739*^9}, {3.919958416109049*^9, 
   3.919958457335821*^9}, {3.919960789672873*^9, 3.919960812647579*^9}, {
   3.9223509230702887`*^9, 3.922350930161759*^9}, {3.937828408709611*^9, 
   3.937828409569026*^9}, {3.937839803744093*^9, 3.9378398278483686`*^9}, {
   3.937844953309803*^9, 3.937844957142207*^9}, 3.937846534692622*^9, {
   3.937846686165112*^9, 3.9378466864923563`*^9}, {3.9409501540271397`*^9, 
   3.940950461706847*^9}, {3.940950495091159*^9, 3.940950510511313*^9}, {
   3.940951478603434*^9, 3.940951480046591*^9}, 3.9410021238822927`*^9, {
   3.941013303647353*^9, 3.941013373627204*^9}, {3.941015448881528*^9, 
   3.941015450620318*^9}, {3.941016106732704*^9, 3.941016111714356*^9}, {
   3.941016364862604*^9, 3.9410163677567997`*^9}, {3.941016513112423*^9, 
   3.9410165135511723`*^9}, {3.941020233647893*^9, 3.941020238037592*^9}, {
   3.9410318024068737`*^9, 3.9410318494460573`*^9}, {3.94113876667297*^9, 
   3.941138786820929*^9}, {3.941141939739704*^9, 3.941141941629487*^9}, {
   3.9411422472197847`*^9, 3.9411422522208977`*^9}, {3.9413178800639563`*^9, 
   3.941317882908852*^9}, {3.9612176558731937`*^9, 3.961217655879937*^9}, {
   3.9612505969140787`*^9, 3.961250599051098*^9}, {3.961250682209626*^9, 
   3.961250693556541*^9}, {3.961469425651132*^9, 3.96146942865687*^9}, {
   3.961469635310033*^9, 3.961469644471899*^9}, {3.96147354831505*^9, 
   3.961473559639893*^9}},
 CellLabel->"",ExpressionUUID->"de31b112-d3a6-45bc-8f4f-c4f5d4a485f4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"CheckTrainingSamplesQ", "[", 
   RowBox[{"guideVec_", ",", "guideSpectrum_"}], "]"}], ":=", 
  RowBox[{"Which", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "@", "guideVec"}], "<", "guideSpectrum"}], ",", 
    RowBox[{
     RowBox[{
     "PrintTemporary", "[", 
      "\"\<There is too little data to train on. Check if your PDFs are \
OCR'd, if it they are in English, or if they contain little text. You can \
only train on English text. OCR PDFs with Adobe Acrobat. If you have \
correctly OCR'd files in English, with little text, such as a song texts \
saved as single PDFs, add simply more PDFs to your guideFolder.\>\"", "]"}], 
     ";"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Length", "@", "guideVec"}], "<", 
     RowBox[{"guideSpectrum", "*", "10"}]}], ",", 
    RowBox[{
     RowBox[{
     "PrintTemporary", "[", 
      "\"\<There is little data to train on, but training might still be \
successful. Make sure all your PDFs are OCR'd, are in English, or contain \
little text. If this is all good, consider adding simply more PDFs to your \
guideFolder.\>\"", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "True", "]"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Length", "@", "guideVec"}], ">=", 
     RowBox[{"guideSpectrum", "*", "10"}]}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{
     "PrintTemporary", "[", 
      "\"\<Number of training samples is sufficient.\>\"", "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", "True", "]"}]}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.921567053581999*^9, 3.921567103541918*^9}, {
  3.92156715782588*^9, 3.921567211571084*^9}, {3.921567250477585*^9, 
  3.921567376506714*^9}, {3.921567456522544*^9, 3.921567645463902*^9}, {
  3.921567677545546*^9, 3.92156768548759*^9}, {3.921567718884063*^9, 
  3.921567792411656*^9}, {3.921567849544717*^9, 3.921567908004825*^9}, {
  3.921567974290039*^9, 3.9215679848701897`*^9}, {3.9215680779604588`*^9, 
  3.921568082178124*^9}, {3.921568122818906*^9, 3.92156812734205*^9}, {
  3.9378251387381573`*^9, 3.9378251453412724`*^9}},
 CellLabel->
  "In[224]:=",ExpressionUUID->"fa5da9f5-d303-4dce-9fbd-a5a71a4f7077"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "x"}], " ", "number", " ", "of", " ", "1", "D", " ", "SOM",
       " ", "cells"}]}], ",", 
    RowBox[{
     RowBox[{"-", "guideVec"}], " ", "list", " ", "of", " ", "training", " ", 
     "input", " ", "vectors"}], ",", 
    RowBox[{
     RowBox[{"-", "somSelection"}], " ", "selection", " ", "mode", " ", 
     RowBox[{"(", 
      RowBox[{
      "\"\<Automatic\>\"", " ", "for", " ", "pick", " ", "based", " ", "on", 
       " ", 
       RowBox[{"TE", "/", "QE"}], " ", "or", " ", "\"\<Last\>\"", " ", "for", 
       " ", "last", " ", "iteration"}], ")"}]}], ",", 
    RowBox[{
     RowBox[{"-", "dictReverse"}], " ", "reverse", " ", "dictionary", " ", 
     "for", " ", "adding", " ", "words", " ", "for", " ", "rendering"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "periodicity"}], " ", "optional", " ", "boolean", " ", 
      "for", " ", "grid", " ", "periodicity", " ", 
      RowBox[{"(", 
       RowBox[{"default", " ", "True"}], ")"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Trained"}], " ", "and", " ", "enriched", " ", "SOM", " ",
        "structure", " ", "with", " ", "added", " ", "guide", " ", 
       "words"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Creates", " ", "and", " ", "trains", " ", "a", " ", "SOM", " ", "grid",
        " ", "on", " ", "the", " ", "provided", " ", "vectors"}]}]}], ",", 
    RowBox[{
    "selects", " ", "the", " ", "best", " ", "SOM", " ", "iteration", " ", 
     "based", " ", "on", " ", "quantization", " ", "and", " ", "topographic", 
     " ", "error", " ", 
     RowBox[{"(", 
      RowBox[{"or", " ", "last", " ", "iteration"}], ")"}]}], ",", 
    RowBox[{"generates", " ", "the", " ", "SOM", " ", "list"}], ",", 
    RowBox[{"sorts", " ", "it"}], ",", 
    RowBox[{
    "and", " ", "adds", " ", "words", " ", "using", " ", "the", " ", 
     "reverse", " ", 
     RowBox[{"dictionary", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"TrainGuide", "[", 
    RowBox[{
    "x_", ",", "guideVec_", ",", "somSelection_", ",", "dictReverse_", ",", 
     RowBox[{"periodicity_", ":", "True"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "y", ",", "vecInput", ",", "somKernel", ",", "colorScheme", ",", 
       "sampleLength", ",", "qeCondition", ",", "trainedSomKernels", ",", 
       "error", ",", "errorMinPos", ",", "guideSom", ",", "status", ",", 
       "wordSom"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"y", "=", "1"}], ";", "\[IndentingNewLine]", 
         RowBox[{"vecInput", "=", 
          RowBox[{"guideVec", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"somKernel", "=", 
          RowBox[{"CreateSomGridRandomSample", "[", 
           RowBox[{"vecInput", ",", "y", ",", "x", ",", 
            RowBox[{"First", "[", 
             RowBox[{"Dimensions", "[", 
              RowBox[{"guideVec", "[", 
               RowBox[{"[", 
                RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}], ",", 
            "periodicity"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"colorScheme", "=", "\"\<GrayTones\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"sampleLength", "=", 
          RowBox[{"Length", "@", "guideVec"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"qeCondition", "=", "0.001"}], ";", " ", 
         RowBox[{"(*", 
          RowBox[{
          "The", " ", "smallest", " ", "quantization", " ", "error", " ", 
           "by", " ", "which", " ", "training", " ", "should", " ", "be", " ",
            "stopped"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"trainedSomKernels", "=", 
          RowBox[{"BatchSOM", "[", 
           RowBox[{
           "somKernel", ",", "vecInput", ",", "sampleLength", ",", 
            "qeCondition", ",", "32", ",", "\"\<NoStats\>\"", ",", 
            "\"\<Invisible\>\"", ",", "\"\<Linear1\>\"", ",", 
            "\"\<EuclideanDistance\>\"", ",", "colorScheme", ",", 
            "\"\<\>\""}], "]"}]}], ";", "\n", "\[IndentingNewLine]", 
         RowBox[{"Which", "[", 
          RowBox[{
           RowBox[{"somSelection", "==", "\"\<Automatic\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Chooses", " ", "best", " ", "SOM", " ", "automatically"}], 
            "*)"}], 
           RowBox[{
            RowBox[{"error", "=", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"trainedSomKernels", "[", 
                  RowBox[{"[", 
                   RowBox[{
                   "i", ",", "\"\<training history\>\"", ",", "\"\<info\>\"", 
                    ",", "\"\<infoQEN\>\""}], "]"}], "]"}], "+", 
                 RowBox[{"(", 
                  RowBox[{"trainedSomKernels", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    "i", ",", "\"\<training history\>\"", ",", "\"\<info\>\"",
                     ",", "\"\<infoTE\>\""}], "]"}], "]"}], ")"}]}], ")"}], 
               ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", 
                 RowBox[{"Length", "@", "trainedSomKernels"}]}], "}"}]}], 
              "]"}]}], ";", 
            RowBox[{"errorMinPos", "=", 
             RowBox[{"First", "@", 
              RowBox[{"Flatten", "[", 
               RowBox[{"Position", "[", 
                RowBox[{"error", ",", 
                 RowBox[{"Min", "[", "error", "]"}]}], "]"}], "]"}]}]}], ";", 
            RowBox[{"PrintTemporary", "[", 
             RowBox[{"\"\<Iteration \>\"", "<>", 
              RowBox[{"ToString", "@", "errorMinPos"}], "<>", 
              "\"\< selected. Building SOM.\>\""}], "]"}], ";", 
            RowBox[{
             RowBox[{"somKernel", "[", 
              RowBox[{"[", "\"\<weights\>\"", "]"}], "]"}], "=", 
             RowBox[{"trainedSomKernels", "[", 
              RowBox[{"[", 
               RowBox[{"errorMinPos", ",", "\"\<weights\>\""}], "]"}], 
              "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
           RowBox[{"somSelection", "==", "\"\<Last\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"somKernel", "[", 
              RowBox[{"[", "\"\<weights\>\"", "]"}], "]"}], "=", 
             RowBox[{
              RowBox[{"Last", "[", "trainedSomKernels", "]"}], "[", 
              RowBox[{"[", "\"\<weights\>\"", "]"}], "]"}]}], ";"}]}], "]"}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"guideSom", "=", 
          RowBox[{"GetSOMList", "[", 
           RowBox[{"guideVec", ",", "somKernel"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"guideSom", "=", 
          RowBox[{"SortSOMList", "[", "guideSom", "]"}]}], ";"}], ",", 
        RowBox[{"\"\<Training guide model, iteration \>\"", "<>", 
         RowBox[{"ToString", "@", "u"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AddGuideWords", "[", 
       RowBox[{"guideSom", ",", "dictReverse"}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8998008800936856`*^9, 3.8998009657732368`*^9}, {
   3.8998010696466665`*^9, 3.899801371436723*^9}, {3.8998029773268332`*^9, 
   3.8998029809407563`*^9}, {3.899803538103747*^9, 3.899803540949953*^9}, {
   3.89980436813822*^9, 3.8998043895585628`*^9}, {3.8998044950759754`*^9, 
   3.8998045871221237`*^9}, {3.899805444331732*^9, 3.8998055891425667`*^9}, {
   3.899805654958067*^9, 3.8998057060817404`*^9}, {3.8998068970793076`*^9, 
   3.8998069562376175`*^9}, {3.8998071147527466`*^9, 3.89980712566529*^9}, {
   3.89980726321264*^9, 3.899807265841809*^9}, {3.899827589431593*^9, 
   3.899827603062193*^9}, 3.904641484183723*^9, {3.9195261821848555`*^9, 
   3.9195261837142625`*^9}, {3.919531679718762*^9, 3.919531683408851*^9}, {
   3.921671443424149*^9, 3.921671443872521*^9}, {3.9378254427477417`*^9, 
   3.937825460082218*^9}, {3.937825768002913*^9, 3.937825788297017*^9}, {
   3.937826260998949*^9, 3.937826274141878*^9}, 3.937826830445117*^9, {
   3.937827657550479*^9, 3.937827679175372*^9}, {3.937827790461791*^9, 
   3.937827813412429*^9}, {3.9612507069614973`*^9, 3.961250779437889*^9}},
 CellLabel->
  "In[225]:=",ExpressionUUID->"66e64c4e-980e-4b17-987b-32a68dec5e35"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "guideSom"}], " ", "SOM", " ", "structure"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "dictReverse"}], " ", "reverse", " ", "dictionary", " ", 
      "mapping", " ", "encoded", " ", "tokens", " ", "to", " ", "words"}], 
     ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "SOM"}], " ", "structure", " ", "with", " ", "added", 
        " ", "words", " ", "and", " ", "TF"}], "-", 
       RowBox[{"IDF", " ", "scores"}]}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
       RowBox[{
       "Calculates", " ", "the", " ", "most", " ", "characteristic", " ", 
        "words", " ", "for", " ", "each", " ", "SOM", " ", "cell", " ", 
        "using", " ", "TF"}], "-", 
       RowBox[{"IDF", " ", "scoring"}]}]}]}], ",", 
    RowBox[{"decodes", " ", "tokens"}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"AddGuideWords", "[", 
    RowBox[{"guideSom_", ",", "dictReverse_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "cellWordCounts", ",", "somWordCounts", ",", "somWordTotal", ",", 
       "cellWordKeys", ",", "tfidf", ",", "tfidfAssoc", ",", "allWordsTFIDF", 
       ",", "allScoresTFIDF", ",", "words", ",", "wordSom"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"cellWordCounts", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"ReverseSort", "[", 
          RowBox[{"Counts", "[", 
           RowBox[{"Select", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"guideSom", "[", 
               RowBox[{"[", 
                RowBox[{
                "\"\<eventListSorted\>\"", ",", "i", ",", "All", ",", "2"}], 
                "]"}], "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"#", "<=", "10000"}], "&"}]}], "]"}], "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", 
            RowBox[{"guideSom", "[", 
             RowBox[{"[", "\"\<eventListSorted\>\"", "]"}], "]"}]}]}], 
          "}"}]}], "]"}]}], ";", 
      RowBox[{"somWordCounts", "=", 
       RowBox[{"ReverseSort", "[", 
        RowBox[{"Counts", "[", 
         RowBox[{"Select", "[", 
          RowBox[{
           RowBox[{"Flatten", "[", 
            RowBox[{"guideSom", "[", 
             RowBox[{"[", 
              RowBox[{
              "\"\<eventListSorted\>\"", ",", "All", ",", "All", ",", "2"}], 
              "]"}], "]"}], "]"}], ",", 
           RowBox[{
            RowBox[{"#", "<=", "10000"}], "&"}]}], "]"}], "]"}], "]"}]}], ";", 
      RowBox[{"somWordTotal", "=", 
       RowBox[{"Total", "@", "somWordCounts"}]}], 
      RowBox[{"(*", 
       RowBox[{"Length", "[", "somWordCounts", "]"}], "*)"}], ";", 
      RowBox[{"cellWordKeys", "=", 
       RowBox[{"Keys", "[", "cellWordCounts", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Calculate", " ", "most", " ", "characteristic", " ", "words", " ", 
         "with", " ", "TFIDF"}], " ", "-", " ", 
        RowBox[{
        "squared", " ", "IDF", " ", "for", " ", "higher", " ", "penalization",
          " ", "of", " ", "common", " ", "words"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"tfidf", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"cellWordCounts", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "[", "#", "]"}], "/", 
                RowBox[{"Total", "@", 
                 RowBox[{"cellWordCounts", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}]}], ")"}], "*", 
              RowBox[{"(", 
               RowBox[{"Log", "[", 
                RowBox[{"somWordTotal", "/", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"somWordCounts", "[", "#", "]"}], "+", "0.0001"}], 
                  ")"}]}], "]"}], 
               RowBox[{"(*", 
                RowBox[{"^", "2"}], "*)"}], ")"}]}], ")"}], ")"}], "&"}], "/@", 
          RowBox[{"cellWordKeys", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "cellWordKeys"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tfidfAssoc", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"AssociationThread", "[", 
          RowBox[{
           RowBox[{"cellWordKeys", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"tfidf", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "tfidf"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"allWordsTFIDF", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"cellWordKeys", "[", 
            RowBox[{"[", 
             RowBox[{"i", ",", "#"}], "]"}], "]"}], "&"}], "/@", 
          RowBox[{"Reverse", "[", 
           RowBox[{"Ordering", "[", 
            RowBox[{"tfidf", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "tfidf"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"allScoresTFIDF", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"#", ",", 
             RowBox[{
              RowBox[{"tfidfAssoc", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", "#", "]"}], ",", 
             RowBox[{
              RowBox[{"cellWordCounts", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "[", "#", "]"}]}], "}"}], 
           "&"}], "/@", 
          RowBox[{"allWordsTFIDF", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "tfidf"}]}], "}"}]}], "]"}]}], ";", 
      RowBox[{"words", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"DictDecodeEntry", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"{", "#", "}"}], "}"}], ",", "dictReverse"}], "]"}], 
            "&"}], "/@", 
           RowBox[{"allWordsTFIDF", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "allWordsTFIDF"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"wordSom", "=", 
       RowBox[{"Append", "[", 
        RowBox[{"guideSom", ",", 
         RowBox[{"Association", "[", 
          RowBox[{
           RowBox[{"\"\<words\>\"", "->", "allWordsTFIDF"}], ",", 
           RowBox[{"\"\<tfidf\>\"", "->", "allScoresTFIDF"}]}], "]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "wordSom"}]}], 
    "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8993556648244753`*^9, 3.89935569897256*^9}, {
   3.8993559164100237`*^9, 3.899355918271615*^9}, {3.899357206972728*^9, 
   3.89935722978475*^9}, {3.89935731786232*^9, 3.899357359989891*^9}, {
   3.899357903668045*^9, 3.899357906925432*^9}, {3.899357968844308*^9, 
   3.899357972484317*^9}, {3.8993584452563457`*^9, 3.899358479755234*^9}, 
   3.899358517374502*^9, {3.8993587677860413`*^9, 3.8993587724233713`*^9}, 
   3.89936553280925*^9, 3.8993657647964907`*^9, {3.8993671457095957`*^9, 
   3.89936714677099*^9}, {3.899367394053482*^9, 3.899367416130587*^9}, {
   3.899370638959046*^9, 3.8993706422481127`*^9}, {3.899371141003358*^9, 
   3.899371142408381*^9}, {3.899375246379286*^9, 3.899375248877131*^9}, {
   3.89937538576115*^9, 3.899375388126807*^9}, {3.899375422232141*^9, 
   3.8993754270525293`*^9}, {3.899375881635697*^9, 3.8993758922443933`*^9}, {
   3.899376188438755*^9, 3.899376189172161*^9}, {3.899393992886207*^9, 
   3.89939400921628*^9}, {3.8997478692101865`*^9, 3.8997478785025454`*^9}, {
   3.899803802103155*^9, 3.899804009551155*^9}, {3.8998040753076572`*^9, 
   3.8998041231050863`*^9}, {3.899804222751601*^9, 3.8998042715047903`*^9}, {
   3.910527131337922*^9, 3.910527138633217*^9}, {3.910529631777173*^9, 
   3.9105296327541757`*^9}, {3.910529752451186*^9, 3.91052977025836*^9}, 
   3.9105298206430798`*^9, {3.910550287053866*^9, 3.9105503395382023`*^9}, {
   3.9105916898224573`*^9, 3.910591693874323*^9}, {3.9105917581695385`*^9, 
   3.9105917588376555`*^9}, {3.9105919453734035`*^9, 3.9105920093569927`*^9}, 
   3.910592194050048*^9, {3.910595315109015*^9, 3.910595365005695*^9}, {
   3.9105954249764977`*^9, 3.9105954388470354`*^9}, {3.9105959790928183`*^9, 
   3.910595979147519*^9}, {3.910596081971008*^9, 3.910596153295077*^9}, {
   3.9105995811803603`*^9, 3.910599585186612*^9}, {3.9106000687321715`*^9, 
   3.9106000771049857`*^9}, {3.910600274161166*^9, 3.9106002781654*^9}, {
   3.9106003131781225`*^9, 3.91060031535649*^9}, {3.910600363746795*^9, 
   3.910600369585994*^9}, 3.9106004606045856`*^9, {3.9106004920032997`*^9, 
   3.9106004976633854`*^9}, {3.9106005946941566`*^9, 
   3.9106005998442774`*^9}, {3.9106009737167244`*^9, 
   3.9106009763279724`*^9}, {3.910601709830941*^9, 3.9106017151515937`*^9}, {
   3.9106018300781727`*^9, 3.9106018483139563`*^9}, {3.9106022241902733`*^9, 
   3.9106022259772034`*^9}, {3.9106026391149607`*^9, 
   3.9106026442245007`*^9}, {3.9106027478648586`*^9, 
   3.9106027637545185`*^9}, {3.9106029455995445`*^9, 3.91060295436784*^9}, {
   3.910603024701501*^9, 3.910603027588234*^9}, {3.9106032930523043`*^9, 
   3.9106033111772194`*^9}, {3.9106034326499734`*^9, 3.910603439700281*^9}, {
   3.9106036982830687`*^9, 3.9106037069089804`*^9}, {3.910604016384816*^9, 
   3.9106040199817467`*^9}, {3.9106043954627657`*^9, 
   3.9106044303304443`*^9}, {3.910629017653659*^9, 3.9106290176661396`*^9}, 
   3.9106304311053267`*^9, {3.911227809262005*^9, 3.9112278112810388`*^9}, {
   3.9612180105685368`*^9, 3.9612180208557243`*^9}, {3.9612507980596943`*^9, 
   3.9612508152883863`*^9}},
 CellLabel->
  "In[226]:=",ExpressionUUID->"28166257-5dd6-4f08-adb7-68dd9d7e30a2"]
}, Closed]],

Cell[CellGroupData[{

Cell["Diadromes ", "Subtitle",
 CellChangeTimes->{{3.873539554198429*^9, 3.87353956385848*^9}, {
  3.873539727707151*^9, 3.873539729825041*^9}, {3.898786755033476*^9, 
  3.89878675719049*^9}, {3.9195250564585123`*^9, 3.919525078172947*^9}, {
  3.961229536726454*^9, 
  3.961229538418304*^9}},ExpressionUUID->"1dfc312e-4cf7-4e92-8d36-\
cff0bf158471"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "queryVecA"}], " ", "starting", " ", "vector"}]}], ",", 
    RowBox[{
     RowBox[{"-", "queryVecB"}], " ", "ending", " ", "vector"}], ",", 
    RowBox[{
     RowBox[{"-", "vecResults"}], " ", "pair", " ", "of", " ", "vector", " ", 
     "result", " ", "lists"}], ",", 
    RowBox[{
     RowBox[{"-", "spectrum"}], " ", "number", " ", "of", " ", "SOM", " ", 
     "cells"}], ",", 
    RowBox[{
     RowBox[{"-", "depth"}], " ", "number", " ", "of", " ", "entries", " ", 
     "per", " ", "query"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "filterIDs"}], " ", "optional", " ", "list", " ", "of", 
      " ", "IDs", " ", "to", " ", "exclude"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "interpolated", " ", 
       "encounter", " ", "paths", " ", "between", " ", "two", " ", "SOM", " ",
        "points"}]}]}], ",", 
    RowBox[{
     RowBox[{
     "with", " ", "details", " ", "for", " ", "image", " ", "and", " ", 
      "text", " ", "encounters"}], ";", 
     RowBox[{"Description", ":", " ", 
      RowBox[{"Key", " ", "Diadrome", " ", "function"}]}]}], ",", " ", 
    RowBox[{
    "trains", " ", "a", " ", "new", " ", "SOM", " ", "on", " ", "provided", 
     " ", "vectors"}], ",", 
    RowBox[{
    "finds", " ", "the", " ", "shortest", " ", "or", " ", "alternate", " ", 
     "circular", " ", "paths", " ", "between", " ", "two", " ", "nodes"}], 
    ",", 
    RowBox[{
    "retrieves", " ", "and", " ", "filters", " ", "associated", " ", 
     "encounters", " ", "from", " ", "SOM", " ", "cells"}], ",", 
    RowBox[{
    "and", " ", "returns", " ", "structured", " ", "result", " ", "lists", 
     " ", "including", " ", "additional", " ", 
     RowBox[{"metadata", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"InterpolateWithSOM", "[", 
    RowBox[{
    "queryVecA_", ",", "queryVecB_", ",", "vecResults_", ",", "spectrum_", 
     ",", "depth_", ",", 
     RowBox[{"filterIDs_", ":", 
      RowBox[{"{", "}"}]}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "vec", ",", "vecInput", ",", "somKernel", ",", "trainedSomKernels", ",",
        "error", ",", "errorMinPos", ",", "circles", ",", "interSom", ",", 
       "indexes", ",", "loops", ",", "loopsOrdered", ",", "interAssoc", ",", 
       "ids", ",", "encounters", ",", "goodPosStart", ",", "goodPosEnd", ",", 
       "goodPosSOM"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"vec", "=", 
       RowBox[{"Catenate", "[", "vecResults", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"vecInput", "=", 
       RowBox[{"vec", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"somKernel", "=", 
       RowBox[{"CreateSomGridRandomSample", "[", 
        RowBox[{"vecInput", ",", "1", ",", "spectrum", ",", 
         RowBox[{"First", "[", 
          RowBox[{"Dimensions", "[", 
           RowBox[{"vec", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}], ",", 
         "True"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"trainedSomKernels", "=", 
       RowBox[{"BatchSOM", "[", 
        RowBox[{"somKernel", ",", "vecInput", ",", 
         RowBox[{"Length", "@", "vec"}], ",", "0.001", ",", "32", ",", 
         "\"\<NoStats\>\"", ",", "\"\<Invisible\>\"", ",", 
         "\"\<Exponential\>\"", ",", "\"\<EuclideanDistance\>\"", ",", 
         "\"\<GrayTones\>\"", ",", "\"\<\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"error", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"trainedSomKernels", "[", 
            RowBox[{"[", 
             RowBox[{
             "i", ",", "\"\<training history\>\"", ",", "\"\<info\>\"", ",", 
              "\"\<infoQEN\>\""}], "]"}], "]"}], "+", 
           RowBox[{"(", 
            RowBox[{"trainedSomKernels", "[", 
             RowBox[{"[", 
              RowBox[{
              "i", ",", "\"\<training history\>\"", ",", "\"\<info\>\"", ",", 
               "\"\<infoTE\>\""}], "]"}], "]"}], ")"}]}], ")"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "trainedSomKernels"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"errorMinPos", "=", 
       RowBox[{"First", "@", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Position", "[", 
          RowBox[{"error", ",", 
           RowBox[{"Min", "[", "error", "]"}]}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"somKernel", "[", 
        RowBox[{"[", "\"\<weights\>\"", "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{"Last", "[", "trainedSomKernels", "]"}], "[", 
        RowBox[{"[", "\"\<weights\>\"", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"interSom", "=", 
       RowBox[{"SortSOMList", "[", 
        RowBox[{"GetSOMList", "[", 
         RowBox[{"vec", ",", "somKernel"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"indexes", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Ordering", "[", 
           RowBox[{"CosineDistanceFast", "[", 
            RowBox[{"#", ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "@", "#"}], ">", "0"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
                   RowBox[{"interSom", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    "\"\<kernel\>\"", ",", "\"\<weights\>\"", ",", "j"}], 
                    "]"}], "]"}]}], "]"}], "&"}], "@", 
                RowBox[{"interSom", "[", 
                 RowBox[{"[", 
                  RowBox[{"\"\<eventListSorted\>\"", ",", "j"}], "]"}], 
                 "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "spectrum"}], "}"}]}], "]"}]}], "]"}], 
           "]"}], "[", 
          RowBox[{"[", "1", "]"}], "]"}], "&"}], "/@", 
        RowBox[{"{", 
         RowBox[{"queryVecA", ",", "queryVecB"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"indexes", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "==", 
         RowBox[{"indexes", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"indexes", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "=", 
         RowBox[{
          RowBox[{"Ordering", "[", 
           RowBox[{"CosineDistanceFast", "[", 
            RowBox[{"queryVecB", ",", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "@", "#"}], ">", "0"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
                   RowBox[{"interSom", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    "\"\<kernel\>\"", ",", "\"\<weights\>\"", ",", "j"}], 
                    "]"}], "]"}]}], "]"}], "&"}], "@", 
                RowBox[{"interSom", "[", 
                 RowBox[{"[", 
                  RowBox[{"\"\<eventListSorted\>\"", ",", "j"}], "]"}], 
                 "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"j", ",", "spectrum"}], "}"}]}], "]"}]}], "]"}], 
           "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"loops", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"CircularRange", "[", 
          RowBox[{
           RowBox[{"indexes", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"indexes", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", "spectrum"}], "]"}], ",", 
         RowBox[{"Reverse", "@", 
          RowBox[{"CircularRange", "[", 
           RowBox[{
            RowBox[{"indexes", "[", 
             RowBox[{"[", "2", "]"}], "]"}], ",", 
            RowBox[{"indexes", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "spectrum"}], "]"}]}]}], 
        "}"}]}], ";", 
      RowBox[{"loopsOrdered", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{"loops", ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"Ordering", "[", 
         RowBox[{"Length", "/@", "loops"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ids", "=", "filterIDs"}], ";", "\[IndentingNewLine]", 
      RowBox[{"circles", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"encounters", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ids", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"KeyExistsQ", "[", 
                 RowBox[{"#", ",", "\"\<type\>\""}], "]"}], ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "\"\<type\>\"", "]"}], "]"}], "==", 
                   "\"\<img\>\""}], ",", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "\"\<imgHash\>\"", "]"}], "]"}], ",", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "\"\<textID\>\"", "]"}], "]"}]}], "]"}], ",", 
                RowBox[{"{", "}"}]}], "]"}], "&"}], "/@", 
             RowBox[{"Flatten", "[", "encounters", "]"}]}], ",", "ids"}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"goodPosStart", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"vecResults", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "All", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"_", "?", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "!=", "0"}], "&&", 
                 RowBox[{"Not", "[", 
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"ids", ",", "#"}], "]"}], "]"}]}], "&"}], ")"}]}], 
             ",", "1", ",", "depth"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"goodPosEnd", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"vecResults", "[", 
              RowBox[{"[", 
               RowBox[{"2", ",", "All", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"_", "?", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"#", "!=", "0"}], "&&", 
                 RowBox[{"Not", "[", 
                  RowBox[{"MemberQ", "[", 
                   RowBox[{"ids", ",", "#"}], "]"}], "]"}]}], "&"}], ")"}]}], 
             ",", "1", ",", "depth"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"encounters", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"encounters", ",", 
              RowBox[{"{", 
               RowBox[{"AddInfo", "/@", 
                RowBox[{"CollateEnAssoc", "/@", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{"\"\<\[LongDash]\>\"", ",", "3"}], "]"}], ",", 
                    "#"}], "]"}], "&"}], "/@", "\[IndentingNewLine]", 
                   RowBox[{"Which", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"i", "==", "\"\<A\>\""}], ",", 
                    RowBox[{"Reverse", "/@", 
                    RowBox[{"Part", "[", 
                    RowBox[{
                    RowBox[{"vecResults", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "goodPosStart"}], 
                    "]"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"i", "==", "\"\<B\>\""}], ",", 
                    RowBox[{"Reverse", "/@", 
                    RowBox[{"Part", "[", 
                    RowBox[{
                    RowBox[{"vecResults", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", "goodPosEnd"}], 
                    "]"}]}], ",", "\[IndentingNewLine]", 
                    RowBox[{"NumberQ", "[", "i", "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"goodPosSOM", "=", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"interSom", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    "\"\<eventListSorted\>\"", ",", "i", ",", "All", ",", 
                    "2"}], "]"}], "]"}], ",", 
                    RowBox[{"_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "!=", "0"}], "&&", 
                    RowBox[{"Not", "[", 
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"ids", ",", "#"}], "]"}], "]"}]}], "&"}], ")"}]}],
                     ",", "1", ",", "depth"}], "]"}], "]"}]}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"Reverse", "/@", 
                    RowBox[{"Part", "[", 
                    RowBox[{
                    RowBox[{"interSom", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<eventListSorted\>\"", ",", "i"}], "]"}], 
                    "]"}], ",", "goodPosSOM"}], "]"}]}]}]}], "]"}]}], 
                  ")"}]}]}], "}"}]}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", 
             RowBox[{"Append", "[", 
              RowBox[{
               RowBox[{"Prepend", "[", 
                RowBox[{
                 RowBox[{"Quiet", "[", 
                  RowBox[{"Check", "[", 
                   RowBox[{
                    RowBox[{"Most", "[", 
                    RowBox[{"Rest", "[", 
                    RowBox[{"loopsOrdered", "[", 
                    RowBox[{"[", "l", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}], "]"}], ",", "\"\<A\>\""}], 
                "]"}], ",", "\"\<B\>\""}], "]"}]}], "}"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"circles", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"circles", ",", 
            RowBox[{"{", 
             RowBox[{"DeleteCases", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"DeleteCases", "[", 
                  RowBox[{
                   RowBox[{"DeleteDuplicates", "[", "#", "]"}], ",", 
                   RowBox[{"{", "}"}]}], "]"}], "&"}], "/@", "encounters"}], 
               ",", 
               RowBox[{"{", "}"}]}], "]"}], "}"}]}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"l", ",", "2"}], "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "circles"}]}], "\[IndentingNewLine]", "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9379040609060297`*^9, 3.937904258359767*^9}, {
   3.937904293607246*^9, 3.937904323579421*^9}, {3.937904363871132*^9, 
   3.93790436419165*^9}, {3.937904425462543*^9, 3.9379044737894278`*^9}, 
   3.9379045081134233`*^9, {3.937913854634387*^9, 3.937913902003118*^9}, {
   3.937924711958844*^9, 3.937924716415674*^9}, 3.9379274498604317`*^9, {
   3.937930920521274*^9, 3.937930925511558*^9}, {3.937931006145667*^9, 
   3.9379310084904346`*^9}, {3.9379310719356747`*^9, 
   3.9379310759551897`*^9}, {3.937995800118844*^9, 3.937995800846169*^9}, {
   3.937997144040316*^9, 3.937997157037148*^9}, {3.937998367209803*^9, 
   3.937998386547297*^9}, 3.9379984587267437`*^9, {3.937998497121152*^9, 
   3.937998509937084*^9}, {3.93799949615044*^9, 3.937999740589036*^9}, {
   3.9379997910331573`*^9, 3.937999809998444*^9}, {3.938000097465946*^9, 
   3.938000131687264*^9}, {3.938000201824915*^9, 3.938000238251793*^9}, {
   3.938000285963356*^9, 3.938000370479653*^9}, {3.938001356940178*^9, 
   3.938001364798222*^9}, 3.938001617548377*^9, {3.9380017838850403`*^9, 
   3.938001784618122*^9}, {3.940916811998208*^9, 3.940916825135125*^9}, {
   3.940916953377282*^9, 3.940916955793469*^9}, {3.94091703735973*^9, 
   3.940917047480914*^9}, {3.940917083593466*^9, 3.9409171710516043`*^9}, {
   3.940917215477339*^9, 3.940917228105958*^9}, {3.9409172859892397`*^9, 
   3.9409172886125727`*^9}, {3.94091732109373*^9, 3.940917322816214*^9}, {
   3.94091751010635*^9, 3.9409175330308867`*^9}, {3.940917620654962*^9, 
   3.940917639826435*^9}, {3.94091768488218*^9, 3.940917689767042*^9}, {
   3.940917742535701*^9, 3.940917744509454*^9}, {3.941087454015779*^9, 
   3.941087458100848*^9}, {3.941087491294354*^9, 3.941087492751356*^9}, {
   3.941087531166442*^9, 3.94108763049201*^9}, {3.941088013711075*^9, 
   3.941088041398438*^9}, {3.94108808105795*^9, 3.941088084275523*^9}, {
   3.941091865389377*^9, 3.941091944753284*^9}, {3.941092063388907*^9, 
   3.941092116951036*^9}, {3.9410922640838547`*^9, 3.941092271509337*^9}, {
   3.9410924688139353`*^9, 3.9410924937750187`*^9}, {3.9410925667859173`*^9, 
   3.941092595730481*^9}, 3.941093072544387*^9, {3.9410933788167133`*^9, 
   3.941093380343606*^9}, {3.941093466329039*^9, 3.941093512480771*^9}, 
   3.9422490845816803`*^9, {3.961250922626348*^9, 3.96125099464168*^9}},
 CellLabel->
  "In[227]:=",ExpressionUUID->"dbded075-4854-4d0c-b56a-de84cbd5ae98"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "start"}], " ", "starting", " ", "index"}]}], ",", 
    RowBox[{
     RowBox[{"-", "end"}], " ", "ending", " ", "index"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "len"}], " ", "total", " ", "number", " ", "of", " ", 
      "elements"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "indices", " ", "representing", 
       " ", "a", " ", "circular", " ", "range", " ", "from", " ", "start", 
       " ", "to", " ", "end", " ", "over", " ", "length", " ", "len"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
       RowBox[{"Generates", " ", "a", " ", "circular", " ", 
        RowBox[{"(", 
         RowBox[{"wrap", "-", "around"}], ")"}], " ", "range", " ", "between",
         " ", "two", " ", "indices", " ", "over", " ", "a", " ", "fixed"}], 
       "-", 
       RowBox[{"length", " ", "sequence"}]}]}]}], ",", 
    RowBox[{
    "handling", " ", "cases", " ", "where", " ", "the", " ", "end", " ", 
     "index", " ", "is", " ", "numerically", " ", "less", " ", "than", " ", 
     "the", " ", "start", " ", 
     RowBox[{"index", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CircularRange", "[", 
    RowBox[{"start_", ",", "end_", ",", "len_"}], "]"}], ":=", 
   RowBox[{"Mod", "[", 
    RowBox[{
     RowBox[{"Range", "[", 
      RowBox[{"start", ",", 
       RowBox[{"end", "+", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"end", "<", "start"}], ",", "len", ",", "0"}], "]"}]}]}], 
      "]"}], ",", "len", ",", "1"}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.961251008253355*^9, 3.961251010360599*^9}},
 CellLabel->
  "In[228]:=",ExpressionUUID->"fafcf83f-a539-4e5f-b2d3-8eaff34938dc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "list1"}], " ", "first", " ", "list"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "list2"}], " ", "second", " ", "list"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "paired", " ", "elements"}]}]}],
     ",", 
    RowBox[{
     RowBox[{
     "padding", " ", "the", " ", "shorter", " ", "list", " ", "with", " ", 
      "Nulls", " ", "and", " ", "removing", " ", "them", " ", "after", " ", 
      "transposition"}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Aligns", " ", "two", " ", "lists", " ", "of", " ", "unequal", " ", 
       "length", " ", "by", " ", "randomly", " ", "padding", " ", "the", " ", 
       "shorter", " ", "list", " ", "with", " ", "Nulls"}]}]}], ",", 
    RowBox[{"transposing", " ", "them", " ", "into", " ", "pairs"}], ",", 
    RowBox[{
    "and", " ", "then", " ", "removing", " ", "Null", " ", "entries", " ", 
     "to", " ", "return", " ", "paired", " ", "elements", " ", "without", " ",
      "loss", " ", "of", " ", "data", " ", "from", " ", "the", " ", "longer", 
     " ", "list"}], " ", "\[Dash]", " ", 
    RowBox[{
    "used", " ", "in", " ", "cases", " ", "where", " ", "Diadromes", " ", 
     "for", " ", "images", " ", "and", " ", "texts", " ", "yield", " ", 
     "uneven", " ", "lists", " ", "between", " ", "two", " ", "given", " ", 
     "points"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"TransposeUnevenLists", "[", 
    RowBox[{"list1_", ",", "list2_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "order", ",", "shortList", ",", "longList", ",", "difference", ",", 
       "indexes"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"order", "=", 
       RowBox[{"Ordering", "[", 
        RowBox[{"Length", "/@", 
         RowBox[{"{", 
          RowBox[{"list1", ",", "list2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"shortList", "=", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"list1", ",", "list2"}], "}"}], "[", 
        RowBox[{"[", 
         RowBox[{"order", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"longList", "=", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"list1", ",", "list2"}], "}"}], "[", 
        RowBox[{"[", 
         RowBox[{"order", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"difference", "=", 
       RowBox[{
        RowBox[{"Length", "@", "longList"}], "-", 
        RowBox[{"Length", "@", "shortList"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"indexes", "=", 
       RowBox[{"RandomChoice", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"Length", "@", "shortList"}], "]"}], ",", "difference"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"shortList", "=", 
         RowBox[{"Insert", "[", 
          RowBox[{"shortList", ",", "Null", ",", "index"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"index", ",", "indexes"}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"DeleteCases", "[", 
         RowBox[{"#", ",", "Null"}], "]"}], "&"}], "/@", 
       RowBox[{"Transpose", "[", 
        RowBox[{"{", 
         RowBox[{"longList", ",", "shortList"}], "}"}], "]"}]}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.937924038303152*^9, 3.937924043332725*^9}, {
   3.937924076784779*^9, 3.937924086617148*^9}, {3.9379244426564417`*^9, 
   3.9379245016313543`*^9}, 3.9379276103872547`*^9, {3.9612508470115356`*^9, 
   3.961250901991869*^9}},
 CellLabel->
  "In[229]:=",ExpressionUUID->"14340338-57f8-4464-a369-21952262bf17"]
}, Closed]],

Cell[CellGroupData[{

Cell["Orthodromes ", "Subtitle",
 CellChangeTimes->{{3.873539554198429*^9, 3.87353956385848*^9}, {
  3.873539727707151*^9, 3.873539729825041*^9}, {3.898786755033476*^9, 
  3.89878675719049*^9}, {3.9195250564585123`*^9, 3.919525078172947*^9}, {
  3.961229536726454*^9, 3.961229538418304*^9}, {3.961229580979341*^9, 
  3.961229582659164*^9}},ExpressionUUID->"a97a9735-6f27-435c-9d3d-\
c5db93033e70"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "points"}], " ", "list", " ", "of", " ", "points"}]}], ",", 
    RowBox[{
     RowBox[{"-", "distanceMode"}], " ", "distance", " ", "function", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"e", ".", "g", "."}], ",", "EuclideanDistance"}], ")"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "numPoints"}], " ", "number", " ", "of", " ", "evenly", 
      " ", "spaced", " ", "points", " ", "to", " ", "generate"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "interpolated", " ", "points", 
       " ", "equally", " ", "spaced", " ", "along", " ", "the", " ", 
       "cumulative", " ", "distance"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Computes", " ", "cumulative", " ", "distances", " ", "between", " ", 
       "consecutive", " ", "points"}]}]}], ",", 
    RowBox[{"builds", " ", "a", " ", "linear", " ", "interpolation"}], ",", 
    RowBox[{
    "and", " ", "returns", " ", "a", " ", "list", " ", "of", " ", "points", 
     " ", "evenly", " ", "spaced", " ", "along", " ", "the", " ", "original", 
     " ", "path", " ", "using", " ", "the", " ", "specified", " ", "distance",
      " ", 
     RowBox[{"metric", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"EqualInterpolation", "[", 
     RowBox[{"points_", ",", "distanceMode_", ",", "numPoints_"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "distances", ",", "cumulativeDistances", ",", "interpolation", ",", 
        "newDistanceIntervals", ",", "newPoints"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"distances", "=", 
        RowBox[{
         RowBox[{"ToExpression", "[", "distanceMode", "]"}], "@@@", 
         RowBox[{"Partition", "[", 
          RowBox[{"points", ",", "2", ",", "1"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"cumulativeDistances", "=", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"Accumulate", "[", "distances", "]"}], ",", "0"}], "]"}]}], 
       ";", 
       RowBox[{"interpolation", "=", 
        RowBox[{"Interpolation", "[", 
         RowBox[{
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"cumulativeDistances", ",", "points"}], "}"}], "]"}], ",", 
          RowBox[{"InterpolationOrder", "->", "1"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"newDistanceIntervals", "=", 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{"Max", "[", "cumulativeDistances", "]"}], ",", 
          RowBox[{
           RowBox[{"Max", "[", "cumulativeDistances", "]"}], "/", 
           RowBox[{"(", 
            RowBox[{"numPoints", "-", "1"}], ")"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"newPoints", "=", 
        RowBox[{"Quiet", "[", 
         RowBox[{"interpolation", "/@", "newDistanceIntervals"}], "]"}]}], 
       ";", "\[IndentingNewLine]", "newPoints"}]}], "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.935642360832089*^9, 3.935642360834988*^9}, {
   3.93565401318427*^9, 3.935654014169598*^9}, {3.9356540831423817`*^9, 
   3.9356540890252457`*^9}, {3.961217702084371*^9, 3.961217715682743*^9}, 
   3.961217995176353*^9, {3.961251052903387*^9, 3.9612510553309793`*^9}},
 CellLabel->
  "In[230]:=",ExpressionUUID->"300ecba4-99b6-435e-bd95-0059a8446291"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "vectorA"}], " ", "starting", " ", "vector"}]}], ",", 
    RowBox[{
     RowBox[{"-", "vectorB"}], " ", "ending", " ", "vector"}], ",", 
    RowBox[{
     RowBox[{"-", "numSteps"}], " ", "number", " ", "of", " ", 
     "interpolation", " ", "steps"}], ",", 
    RowBox[{
     RowBox[{"-", "mode"}], " ", "interpolation", " ", "method", " ", 
     RowBox[{"(", 
      RowBox[{
      "\"\<Slerp\>\"", ",", "\"\<Orthodrome\>\"", ",", 
       "\"\<Spherical Meridian\>\"", ",", "\"\<Linear Interpolation\>\""}], 
      ")"}]}], ",", 
    RowBox[{
     RowBox[{"-", "crop"}], " ", "optional", " ", "boolean", " ", "to", " ", 
     "crop", " ", "path", " ", "at", " ", "closest", " ", "point", " ", "for",
      " ", "Orthodromes", " ", 
     RowBox[{"(", 
      RowBox[{"default", " ", "False"}], ")"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "loopVal"}], " ", "optional", " ", "loop", " ", "value"}], 
     ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "interpolated", " ", "vectors", 
       " ", "between", " ", "vectorA", " ", "and", " ", "vectorB"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Generates", " ", "interpolated", " ", "vectors", " ", "between", " ", 
       "two", " ", "input", " ", "vectors", " ", "using", " ", "selected", 
       " ", "methods"}], ":", 
      RowBox[{"spherical", " ", "linear", " ", "interpolation", " ", 
       RowBox[{"(", "Slerp", ")"}]}]}]}], ",", 
    RowBox[{"great", "-", 
     RowBox[{"circle", " ", 
      RowBox[{"(", "Orthodrome", ")"}]}]}], ",", 
    RowBox[{"meridian", "-", "based"}], ",", 
    RowBox[{"or", " ", "linear", " ", "interpolation"}], ",", 
    RowBox[{
    "with", " ", "options", " ", "for", " ", "dimensional", " ", "alignment", 
     " ", "and", " ", "path", " ", 
     RowBox[{"cropping", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"InterpolateVectors", "[", 
    RowBox[{"vectorA_", ",", "vectorB_", ",", "numSteps_", ",", "mode_", ",", 
     RowBox[{"crop_", ":", "False"}], ",", 
     RowBox[{"loopVal_", ":", "Null"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "interpolatedVectors", ",", "vectorNormA", ",", "normA", ",", 
       "vectorNormB", ",", "normB", ",", 
       RowBox[{"epsilon", "=", "1.0*^-7"}], ",", "theta", ",", "slerpSteps", 
       ",", "phi", ",", "coords", ",", "rotationMatrix", ",", "northPole", 
       ",", "points", ",", "dim", ",", "loops", ",", "equator", ",", 
       "rotationMatrix1", ",", "rotationMatrix2", ",", "alignedPoints", ",", 
       "alignmentVector", ",", "closestPoint", ",", "closestPointIndex", ",", 
       "referenceAltitude", ",", "pointAltitudes", ",", "lambdaRange", ",", 
       "kValues", ",", "lambda0Values"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"mode", "==", "\"\<Spherical Meridian\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Great", " ", "only", " ", "for", " ", "Antipodes"}], ",", 
          " ", 
          RowBox[{
          "where", " ", "SLERP", " ", "does", " ", "not", " ", "work"}]}], 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"dim", "=", 
          RowBox[{"Length", "@", "vectorA"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Generate", " ", "points", " ", "along", " ", "a", " ", "meridian", 
           " ", "from", " ", "one", " ", "pole", " ", "to", " ", "another"}], 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"points", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"theta", "=", 
              RowBox[{"Pi", " ", 
               RowBox[{"i", "/", "numSteps"}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"coords", "=", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"j", "==", "dim"}], ",", 
                  RowBox[{"Cos", "[", "theta", "]"}], ",", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"j", "==", "1"}], ",", 
                    RowBox[{"Sin", "[", "theta", "]"}], ",", "0"}], "]"}]}], 
                 "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"j", ",", "1", ",", "dim"}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", "coords"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "0", ",", 
              RowBox[{"numSteps", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Rotation", " ", "matrix", " ", "to", " ", 
           RowBox[{"align", "'"}], 
           RowBox[{"northPole", "'"}], " ", 
           RowBox[{"with", "'"}], 
           RowBox[{"pole", "'"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"northPole", "=", 
          RowBox[{"Append", "[", 
           RowBox[{
            RowBox[{"ConstantArray", "[", 
             RowBox[{"0", ",", 
              RowBox[{"dim", "-", "1"}]}], "]"}], ",", "1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"equator", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"j", "==", "dim"}], ",", 
              RowBox[{"Cos", "[", 
               RowBox[{"Pi", " ", "*", 
                RowBox[{"(", 
                 RowBox[{"1", "/", "2"}], ")"}]}], "]"}], ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"j", "==", "1"}], ",", 
                RowBox[{"Sin", "[", 
                 RowBox[{"Pi", " ", "/", "2"}], "]"}], ",", "0"}], "]"}]}], 
             "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "1", ",", "dim"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"rotationMatrix1", "=", 
          RowBox[{"RotationMatrix", "[", 
           RowBox[{"{", 
            RowBox[{"northPole", ",", "vectorA"}], "}"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"alignedPoints", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"rotationMatrix1", ".", "#"}], "&"}], "/@", "points"}]}], 
         ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"interpolatedVectors", "=", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"vectorB", "==", 
             RowBox[{"-", "vectorA"}]}], ",", "alignedPoints", ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"alignmentVector", "=", 
              RowBox[{"Last", "[", 
               RowBox[{"Orthogonalize", "[", 
                RowBox[{"{", 
                 RowBox[{"vectorA", ",", "vectorB"}], "}"}], "]"}], "]"}]}], 
             ";", "  ", 
             RowBox[{"(*", 
              RowBox[{
               RowBox[{
               "The", " ", "third", " ", "vector", " ", "for", " ", 
                "orientation"}], ",", " ", 
               RowBox[{"orthogonal", " ", 
                RowBox[{"to", "'"}], 
                RowBox[{"pole", "'"}]}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"rotationMatrix2", "=", 
              RowBox[{"Quiet", "@", 
               RowBox[{"RotationMatrix", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"rotationMatrix1", ".", "equator"}], ",", 
                  "alignmentVector"}], "}"}], "]"}]}]}], ";", " ", 
             "\[IndentingNewLine]", 
             RowBox[{"interpolatedVectors", "=", 
              RowBox[{
               RowBox[{
                RowBox[{"rotationMatrix2", ".", "#"}], "&"}], "/@", 
               "alignedPoints"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"closestPoint", "=", 
              RowBox[{"First", "@", 
               RowBox[{"Nearest", "[", 
                RowBox[{"interpolatedVectors", ",", "vectorB", ",", 
                 RowBox[{"DistanceFunction", "->", "CosineDistance"}]}], 
                "]"}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"closestPointIndex", "=", 
              RowBox[{"First", "@", 
               RowBox[{"Flatten", "@", 
                RowBox[{"Position", "[", 
                 RowBox[{"interpolatedVectors", ",", "closestPoint"}], 
                 "]"}]}]}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"crop", "==", "True"}], ",", 
               RowBox[{"EqualInterpolation", "[", 
                RowBox[{
                 RowBox[{"interpolatedVectors", "[", 
                  RowBox[{"[", 
                   RowBox[{";;", "closestPointIndex"}], "]"}], "]"}], ",", 
                 "\"\<EuclideanDistance\>\"", ",", "numSteps"}], "]"}], ",", 
               "interpolatedVectors"}], "]"}]}]}], "]"}]}], ";"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"mode", "==", "\"\<Orthodrome\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"interpolatedVectors", "=", 
          RowBox[{"GreatCirclePoints", "[", 
           RowBox[{"vectorA", ",", 
            RowBox[{"-", "vectorA"}], ",", "numSteps", ",", "vectorB"}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"closestPoint", "=", 
          RowBox[{"First", "@", 
           RowBox[{"Nearest", "[", 
            RowBox[{"interpolatedVectors", ",", "vectorB", ",", 
             RowBox[{"DistanceFunction", "->", "CosineDistance"}]}], 
            "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"closestPointIndex", "=", 
          RowBox[{"First", "@", 
           RowBox[{"Flatten", "@", 
            RowBox[{"Position", "[", 
             RowBox[{"interpolatedVectors", ",", "closestPoint"}], 
             "]"}]}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"interpolatedVectors", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"crop", "==", "True"}], ",", 
            RowBox[{"EqualInterpolation", "[", 
             RowBox[{
              RowBox[{"interpolatedVectors", "[", 
               RowBox[{"[", 
                RowBox[{";;", "closestPointIndex"}], "]"}], "]"}], ",", 
              "\"\<EuclideanDistance\>\"", ",", "numSteps"}], "]"}], ",", 
            "interpolatedVectors"}], "]"}]}], ";"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"mode", "==", "\"\<Slerp\>\""}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"vectorNormA", "=", 
          RowBox[{"Norm", "[", "vectorA", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"vectorNormB", "=", 
          RowBox[{"Norm", "[", "vectorB", "]"}]}], ";", 
         RowBox[{"(*", 
          RowBox[{
          "Handle", " ", "cases", " ", "where", " ", "either", " ", "vector", 
           " ", "is", " ", "a", " ", "zero", " ", "vector"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"vectorNormA", "<", "epsilon"}], "||", 
            RowBox[{"vectorNormB", "<", "epsilon"}]}], ",", 
           RowBox[{"(*", 
            RowBox[{
            "Fallback", " ", "to", " ", "linear", " ", "interpolation", " ", 
             "if", " ", "one", " ", "of", " ", "the", " ", "vectors", " ", 
             "is", " ", "zero"}], "*)"}], 
           RowBox[{"interpolatedVectors", "=", 
            RowBox[{"N", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "-", 
                   RowBox[{"i", "/", 
                    RowBox[{"(", 
                    RowBox[{"numSteps", "-", "1"}], ")"}]}]}], ")"}], " ", 
                 "vectorA"}], "+", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"i", "/", 
                   RowBox[{"(", 
                    RowBox[{"numSteps", "-", "1"}], ")"}]}], ")"}], " ", 
                 "vectorB"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "0", ",", 
                 RowBox[{"numSteps", "-", "1"}]}], "}"}]}], "]"}], "]"}]}], 
           ",", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Slerp", " ", "interpolation", " ", "for", " ", "non"}], 
             "-", 
             RowBox[{"zero", " ", "vectors"}]}], "*)"}], 
           RowBox[{
            RowBox[{"theta", "=", 
             RowBox[{"ArcCos", "[", 
              RowBox[{"Clip", "[", 
               RowBox[{
                RowBox[{"Dot", "[", 
                 RowBox[{
                  RowBox[{"Normalize", "[", "vectorA", "]"}], ",", 
                  RowBox[{"Normalize", "[", "vectorB", "]"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1."}], ",", "1."}], "}"}]}], "]"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"slerpSteps", "=", 
             RowBox[{"N", "[", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Abs", "[", 
                    RowBox[{"Sin", "[", "theta", "]"}], "]"}], ">", 
                   "epsilon"}], ",", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "-", 
                    RowBox[{"i", "/", 
                    RowBox[{"(", 
                    RowBox[{"numSteps", "-", "1"}], ")"}]}]}], ")"}], " ", 
                    "theta"}], "]"}], " ", "vectorA"}], "+", 
                    RowBox[{
                    RowBox[{"Sin", "[", 
                    RowBox[{
                    RowBox[{"i", "/", 
                    RowBox[{"(", 
                    RowBox[{"numSteps", "-", "1"}], ")"}]}], " ", "theta"}], 
                    "]"}], " ", "vectorB"}]}], ")"}], "/", 
                   RowBox[{"Sin", "[", "theta", "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"1", "-", 
                    RowBox[{"i", "/", 
                    RowBox[{"(", 
                    RowBox[{"numSteps", "-", "1"}], ")"}]}]}], ")"}], " ", 
                    "vectorA"}], "+", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{"i", "/", 
                    RowBox[{"(", 
                    RowBox[{"numSteps", "-", "1"}], ")"}]}], ")"}], " ", 
                    "vectorB"}]}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "0", ",", 
                  RowBox[{"numSteps", "-", "1"}]}], "}"}]}], "]"}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"interpolatedVectors", "=", "slerpSteps"}]}]}], "]"}], 
         ";"}], ",", "\n", "\[IndentingNewLine]", 
        RowBox[{"mode", "==", "\"\<Linear Interpolation\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"interpolatedVectors", "=", 
          RowBox[{"N", "[", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"vectorA", "+", 
              RowBox[{"i", "*", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"vectorB", "-", "vectorA"}], ")"}], "/", 
                RowBox[{"(", 
                 RowBox[{"numSteps", "-", "1"}], ")"}]}]}]}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "0", ",", 
               RowBox[{"numSteps", "-", "1"}]}], "}"}]}], "]"}], "]"}]}], 
         ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "interpolatedVectors"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9136271747206*^9, 3.913627381630642*^9}, {
   3.913627417435849*^9, 3.913627458653061*^9}, {3.913627562969698*^9, 
   3.913627566267201*^9}, {3.913627677646579*^9, 3.913627712049519*^9}, {
   3.913627851401165*^9, 3.9136278722165403`*^9}, {3.9136279318893633`*^9, 
   3.913627965749154*^9}, 3.913628087010107*^9, {3.913629313891068*^9, 
   3.913629322356185*^9}, {3.9136294656126432`*^9, 3.913629492961825*^9}, {
   3.913629655499106*^9, 3.913629720005988*^9}, {3.913629810138216*^9, 
   3.913629848266286*^9}, {3.913629987832858*^9, 3.913630028113385*^9}, {
   3.9136300719929953`*^9, 3.913630089617824*^9}, {3.913630652089069*^9, 
   3.913630671877369*^9}, {3.913630716799617*^9, 3.913630744647299*^9}, 
   3.9136349319415207`*^9, {3.918639662855418*^9, 3.918639783351697*^9}, {
   3.91863981492911*^9, 3.918639890051661*^9}, {3.9186399877864017`*^9, 
   3.918640027302341*^9}, {3.918640082923296*^9, 3.91864009223589*^9}, {
   3.918640711733912*^9, 3.9186407121681957`*^9}, {3.918712893767253*^9, 
   3.9187129190150967`*^9}, {3.918712951790227*^9, 3.918713056625642*^9}, {
   3.9187183712876043`*^9, 3.9187184443953*^9}, {3.918718491153819*^9, 
   3.918718522099744*^9}, {3.9187185808478813`*^9, 3.91871859218227*^9}, {
   3.918718649679076*^9, 3.9187186560766983`*^9}, {3.918719481756442*^9, 
   3.9187195320970373`*^9}, {3.918719844397215*^9, 3.918719855822021*^9}, {
   3.918721945531646*^9, 3.9187219463306837`*^9}, 3.919239207424752*^9, {
   3.919239302664077*^9, 3.91923930678307*^9}, 3.9192397936719913`*^9, {
   3.9192400904168158`*^9, 3.919240111905768*^9}, {3.919240194735839*^9, 
   3.919240300643277*^9}, {3.919240448666687*^9, 3.919240478574348*^9}, {
   3.9192409130740843`*^9, 3.919240913981168*^9}, 3.919240946997427*^9, {
   3.919241018210657*^9, 3.9192410375686893`*^9}, 3.919241096819171*^9, {
   3.919241430250403*^9, 3.919241469117613*^9}, {3.919241529916355*^9, 
   3.9192415525904303`*^9}, {3.919241583770418*^9, 3.919241586749361*^9}, {
   3.919241640216342*^9, 3.919241684892621*^9}, {3.919241728479122*^9, 
   3.919241779838582*^9}, {3.919241906650859*^9, 3.9192419109812717`*^9}, {
   3.9192420247059526`*^9, 3.919242025287088*^9}, {3.919242069558446*^9, 
   3.9192420715411043`*^9}, {3.919242146901108*^9, 3.919242147410754*^9}, {
   3.91924229811882*^9, 3.919242301282339*^9}, 3.9192424082988033`*^9, {
   3.9194114931864*^9, 3.9194114937608595`*^9}, {3.9194117915861516`*^9, 
   3.919411843879403*^9}, {3.91941188637424*^9, 3.919411942943523*^9}, {
   3.919411979442509*^9, 3.919411994851119*^9}, {3.9194120523015347`*^9, 
   3.919412134480322*^9}, {3.9194122645181184`*^9, 3.919412405578717*^9}, {
   3.9194137982872467`*^9, 3.9194137992109733`*^9}, {3.9194138837514057`*^9, 
   3.919413920625882*^9}, {3.919414212561919*^9, 3.919414219315729*^9}, {
   3.9194143869144697`*^9, 3.919414391884294*^9}, 3.9194146612602453`*^9, {
   3.9194146950091834`*^9, 3.919414722323863*^9}, {3.919414754649414*^9, 
   3.9194147614084373`*^9}, {3.91941479374033*^9, 3.919414795176629*^9}, {
   3.919414831066876*^9, 3.919414832508712*^9}, 3.919414959735919*^9, {
   3.9194150012896976`*^9, 3.9194151114363794`*^9}, {3.919415155605654*^9, 
   3.919415192039504*^9}, {3.9194152368153615`*^9, 3.9194154505534115`*^9}, 
   3.9194210983578796`*^9, {3.9194211568274326`*^9, 3.9194211856051273`*^9}, {
   3.9194222707005415`*^9, 3.9194222720216813`*^9}, {3.931067249580741*^9, 
   3.931067255668613*^9}, {3.931074410420848*^9, 3.931074442019568*^9}, {
   3.931074494845571*^9, 3.931074522590685*^9}, {3.9310745587181177`*^9, 
   3.931074666089325*^9}, {3.931075270241412*^9, 3.9310752756107197`*^9}, {
   3.93461938669431*^9, 3.934619443299342*^9}, 3.935638316851077*^9, {
   3.935642377011735*^9, 3.935642558504908*^9}, {3.935653428361741*^9, 
   3.935653438529655*^9}, {3.93565348322926*^9, 3.935653486972291*^9}, 
   3.935653592452631*^9, {3.935654097735031*^9, 3.935654117364994*^9}, {
   3.9356542515892563`*^9, 3.9356542569779043`*^9}, {3.935654467252376*^9, 
   3.935654510737172*^9}, {3.9356545684270782`*^9, 3.935654592737047*^9}, {
   3.935654738533575*^9, 3.935654739383762*^9}, {3.935655043166697*^9, 
   3.935655061071033*^9}, {3.9356556855848417`*^9, 3.935655685766671*^9}, {
   3.935655829582019*^9, 3.935655853900792*^9}, 3.935656008730031*^9, 
   3.935656060637499*^9, {3.935656134321101*^9, 3.935656179034243*^9}, {
   3.935657856669211*^9, 3.935657864405751*^9}, {3.935657906573329*^9, 
   3.9356579075239973`*^9}, {3.935657941887394*^9, 3.9356579449619083`*^9}, 
   3.9356579982544327`*^9, {3.9359162543098717`*^9, 3.935916254903592*^9}, {
   3.9405667984508457`*^9, 3.940566807210326*^9}, {3.940566871946301*^9, 
   3.940566897078582*^9}, {3.940566986229186*^9, 3.9405670555163317`*^9}, {
   3.940567290877123*^9, 3.940567358745672*^9}, {3.9405706898286877`*^9, 
   3.940570717011779*^9}, {3.940574394995564*^9, 3.940574518465671*^9}, {
   3.940574568181551*^9, 3.9405745712494373`*^9}, 3.9405752510606117`*^9, {
   3.940575281650949*^9, 3.9405752912360907`*^9}, {3.940575505367167*^9, 
   3.9405755112623653`*^9}, {3.940575586979775*^9, 3.94057558976115*^9}, {
   3.940575713761827*^9, 3.940575717931491*^9}, {3.9405762998464327`*^9, 
   3.9405763365819893`*^9}, {3.94091211817881*^9, 3.940912123525405*^9}, {
   3.9409151844113607`*^9, 3.940915193832402*^9}, {3.961217735845448*^9, 
   3.961217779115419*^9}, {3.9612178548406677`*^9, 3.961217891972959*^9}, 
   3.9612179234654493`*^9, {3.96125107788822*^9, 3.961251117354705*^9}},
 CellLabel->
  "In[231]:=",ExpressionUUID->"ba6c253a-bb1c-4a73-8830-dabf08a310ea"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "a"}], " ", "starting", " ", "vector"}]}], ",", 
    RowBox[{
     RowBox[{"-", "b"}], " ", "ending", " ", "vector"}], ",", 
    RowBox[{
     RowBox[{"-", "numPoints"}], " ", "number", " ", "of", " ", "points", " ",
      "to", " ", "generate"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "thirdVec"}], " ", "optional", " ", "third", " ", "vector",
       " ", "to", " ", "define", " ", "plane", " ", 
      RowBox[{"(", 
       RowBox[{"default", " ", "None"}], ")"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "interpolated", " ", "points", 
       " ", "along", " ", "the", " ", "great", " ", "circle", " ", "path", 
       " ", "from", " ", "a", " ", "to", " ", "b"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Computes", " ", "equally", " ", "spaced", " ", "points", " ", "along", 
       " ", "the", " ", "great", " ", "circle", " ", "arc", " ", "between", 
       " ", "two", " ", "vectors", " ", "on", " ", "a", " ", "unit", " ", 
       "sphere"}]}]}], ",", 
    RowBox[{
     RowBox[{
     "optionally", " ", "using", " ", "a", " ", "third", " ", "vector", " ", 
      "to", " ", "define", " ", "the", " ", "interpolation", " ", "plane"}], 
     ";", 
     RowBox[{
     "includes", " ", "checks", " ", "for", " ", "colinearity", " ", "and", 
      " ", 
      RowBox[{"coplanarity", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"GreatCirclePoints", "[", 
      RowBox[{"a_", ",", "b_", ",", "numPoints_", ",", 
       RowBox[{"thirdVec_", ":", "None"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "aUnit", ",", "bUnit", ",", "thetaAB", ",", "c", ",", "angles", ",", 
         "points", ",", "n", ",", "e1", ",", "e2", ",", "thetaB", ",", 
         "thetaThirdVec", ",", "thirdVecUnit", ",", "rank", ",", "thetaRange",
          ",", "v2"}], "}"}], ",", 
       RowBox[{"(*", 
        RowBox[{
        "Ensure", " ", "a", " ", "and", " ", "b", " ", "are", " ", "unit", 
         " ", "vectors"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Determine", " ", "the", " ", "plane"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"aUnit", "=", 
         RowBox[{"Normalize", "[", "a", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"bUnit", "=", 
         RowBox[{"Normalize", "[", "b", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Compute", " ", "the", " ", "angle", " ", "between", " ", "a", " ", 
          "and", " ", "b"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"thetaAB", "=", 
         RowBox[{"ArcCos", "[", 
          RowBox[{"Clip", "[", 
           RowBox[{
            RowBox[{"aUnit", ".", "bUnit"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Handle", " ", "the", " ", "case", " ", "when", " ", "a", " ", "and",
           " ", "b", " ", "are", " ", "the", " ", "same"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Abs", "[", "thetaAB", "]"}], "<", 
           RowBox[{"10", "^", 
            RowBox[{"-", "10"}]}]}], ",", 
          RowBox[{
           RowBox[{"Return", "[", 
            RowBox[{"Table", "[", 
             RowBox[{"aUnit", ",", 
              RowBox[{"{", "numPoints", "}"}]}], "]"}], "]"}], ";"}]}], "]"}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{"Determine", " ", "the", " ", "plane"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"thirdVec", "=!=", "None"}], "&&", 
           RowBox[{"thirdVec", "=!=", "b"}]}], ",", 
          RowBox[{"(*", 
           RowBox[{
           "Use", " ", "thirdVec", " ", "to", " ", "define", " ", "the", " ", 
            "plane"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"thirdVecUnit", "=", 
            RowBox[{"Normalize", "[", "thirdVec", "]"}]}], ";"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"thirdVecUnit", "=", 
           RowBox[{"Normalize", "[", 
            RowBox[{"RandomReal", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
              RowBox[{"Dimensions", "@", "aUnit"}]}], "]"}], "]"}]}]}], "]"}],
         ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Compute", " ", "the", " ", "rank", " ", "of", " ", "the", " ", 
           "matrix", " ", "formed", " ", "by", " ", "aUnit"}], ",", "bUnit", 
          ",", 
          RowBox[{"and", " ", "thirdVecUnit"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"rank", "=", 
         RowBox[{"MatrixRank", "[", 
          RowBox[{"{", 
           RowBox[{"aUnit", ",", "bUnit", ",", "thirdVecUnit"}], "}"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"rank", ">", "2"}], ",", 
          RowBox[{
           RowBox[{"Return", "[", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"GreatCirclePoints", "::", "noncoplanar"}], "]"}], ";", 
             "$Failed"}], "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"Use", " ", "Gram"}], "-", 
          RowBox[{
          "Schmidt", " ", "to", " ", "find", " ", "an", " ", "orthonormal", 
           " ", "basis"}]}], "*)"}], 
        RowBox[{"e1", "=", "aUnit"}], ";", "\[IndentingNewLine]", 
        RowBox[{"v2", "=", 
         RowBox[{"thirdVecUnit", "-", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"e1", ".", "thirdVecUnit"}], ")"}], " ", "e1"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Norm", "[", "v2", "]"}], "<", 
           RowBox[{"10", "^", 
            RowBox[{"-", "10"}]}]}], ",", 
          RowBox[{
           RowBox[{"Return", "[", 
            RowBox[{
             RowBox[{"Message", "[", 
              RowBox[{"GreatCirclePoints", "::", "colinear"}], "]"}], ";", 
             "$Failed"}], "]"}], ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"e2", "=", 
         RowBox[{"Normalize", "[", "v2", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Compute", " ", "angles", " ", "for", " ", "bUnit", " ", "and", " ", 
          "thirdVecUnit"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{
          "Adjust", " ", "thetaAB", " ", "to", " ", "be", " ", "within"}], 
          "-", 
          RowBox[{"Pi", " ", "to", " ", "Pi"}]}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"thetaAB", ">", "Pi"}], ",", 
          RowBox[{"thetaAB", "-=", 
           RowBox[{"2", " ", "Pi"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"thetaAB", "<", 
           RowBox[{"-", "Pi"}]}], ",", 
          RowBox[{"thetaAB", "+=", 
           RowBox[{"2", " ", "Pi"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
         "Generate", " ", "angles", " ", "from", " ", "0", " ", "to", " ", 
          "thetaAB"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"angles", "=", 
         RowBox[{"Subdivide", "[", 
          RowBox[{"0", ",", "thetaAB", ",", 
           RowBox[{"numPoints", "-", "1"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"points", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"e1", "*", 
             RowBox[{"Cos", "[", "ang", "]"}]}], "+", 
            RowBox[{"e2", "*", 
             RowBox[{"Sin", "[", "ang", "]"}]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"ang", ",", "angles"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "points"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"GreatCirclePoints", "::", "noncoplanar"}], "=", 
     "\"\<Vectors a, b, and thirdVec are not coplanar.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"GreatCirclePoints", "::", "colinear"}], "=", 
     "\"\<Vectors a and thirdVec are colinear.\>\""}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"GreatCirclePoints", "::", "antipodal"}], "=", 
     "\"\<Vectors a and b are antipodal; specify thirdVec to define the \
plane.\>\""}], ";"}], "\n"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.94091156710321*^9, 3.9409115896711807`*^9}, {
   3.940911642724596*^9, 3.940911642880908*^9}, {3.940911684610753*^9, 
   3.94091168970927*^9}, {3.9409117362038927`*^9, 3.940911838086834*^9}, {
   3.940911869702814*^9, 3.940911920006069*^9}, {3.940911955771427*^9, 
   3.940911967941983*^9}, {3.940911999891308*^9, 3.940912000708785*^9}, 
   3.940912337711527*^9, {3.940912434859933*^9, 3.940912436561821*^9}, {
   3.940912474953968*^9, 3.940912478340357*^9}, {3.9409129518726883`*^9, 
   3.9409130694255867`*^9}, {3.94091310072232*^9, 3.940913174896945*^9}, {
   3.940913237985173*^9, 3.940913290739006*^9}, {3.940913330304661*^9, 
   3.940913425361746*^9}, {3.940913548627542*^9, 3.940913617497159*^9}, {
   3.9409138911691217`*^9, 3.940913911023067*^9}, {3.940914029947385*^9, 
   3.940914076217737*^9}, {3.9409141539219027`*^9, 3.94091415427603*^9}, {
   3.940914299990727*^9, 3.940914312684017*^9}, {3.961217937118258*^9, 
   3.9612179811885653`*^9}, {3.961251140665193*^9, 3.96125114324438*^9}},
 CellLabel->
  "In[232]:=",ExpressionUUID->"b403a686-5244-4a31-80bf-a40a9a2475c2"]
}, Closed]],

Cell[CellGroupData[{

Cell["Thelodromes", "Subtitle",
 CellChangeTimes->{{3.898063417685889*^9, 3.8980634241293945`*^9}, {
  3.898063455525037*^9, 3.898063469740698*^9}, {3.8980689923009634`*^9, 
  3.8980689967895722`*^9}, {3.8998064357255993`*^9, 3.89980643994103*^9}, {
  3.8998067303640494`*^9, 3.8998067392798367`*^9}, {3.904204443063366*^9, 
  3.9042044469781103`*^9}, {3.940482871035838*^9, 3.940482871879086*^9}, {
  3.961229604249056*^9, 
  3.9612296072619867`*^9}},ExpressionUUID->"2f89e428-7fc9-461b-a072-\
58272af224fe"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "startQuery"}], " ", "starting", " ", "query", " ", 
      "string", " ", "or", " ", "\"\<guideStart\>\"", " ", "to", " ", "use", 
      " ", "guide"}]}], ",", 
    RowBox[{
     RowBox[{"-", "exportFolder"}], " ", "folder", " ", "to", " ", "save", 
     " ", "output"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "guideFile"}], " ", "optional", " ", "guide", " ", "file", 
      " ", "path", " ", 
      RowBox[{"(", 
       RowBox[{"default", " ", "None"}], ")"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Initializes"}], " ", "and", " ", "logs", " ", "a", " ", 
       "Clipedia", " ", "exploration", " ", "notebook", " ", "session"}]}], 
     ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Sets", " ", "up", " ", "a", " ", "Clipedia", " ", "exploration", " ", 
       "session", " ", "by", " ", "preparing", " ", "the", " ", "start", " ", 
       "vector", " ", 
       RowBox[{"(", 
        RowBox[{
        "from", " ", "a", " ", "user", " ", "query", " ", "or", " ", 
         "guide"}], ")"}]}]}]}], ",", 
    RowBox[{
    "optionally", " ", "loading", " ", "a", " ", "guide", " ", "file", " ", 
     "for", " ", "additional", " ", "suggestions"}], ",", 
    RowBox[{"launching", " ", "the", " ", "exploration", " ", "interface"}], 
    ",", " ", 
    RowBox[{
    "and", " ", "creating", " ", "a", " ", "new", " ", "exploration", " ", 
     "notebook", " ", "for", " ", "logging", " ", "steps", " ", "and", " ", 
     RowBox[{"results", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ClipediaCompass", "[", 
    RowBox[{"startQuery_", ",", "exportFolder_", ",", 
     RowBox[{"guideFile_", ":", "None"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"start", ",", "guide", ",", "guideName", ",", "guideElem"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", "$guideNamed", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"guideFile", "=!=", "None"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"guide", "=", 
          RowBox[{"Import", "@", "guideFile"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"guideName", "=", 
          RowBox[{"Capitalize", "@", 
           RowBox[{"FileBaseName", "[", "guideFile", "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"guideElem", "=", 
          RowBox[{"ElemAssoc", "/@", 
           RowBox[{"Catenate", "[", 
            RowBox[{"guide", "[", 
             RowBox[{"[", 
              RowBox[{
              "1", ",", "\"\<eventListSorted\>\"", ",", "All", ",", "All"}], 
              "]"}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"$guideNamed", "=", 
          RowBox[{"{", 
           RowBox[{"guideName", ",", "guide", ",", "guideElem"}], "}"}]}], 
         ";"}], ",", 
        RowBox[{"Clear", "[", 
         RowBox[{"{", 
          RowBox[{"guideName", ",", "$guideNamed"}], "}"}], "]"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"start", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"startQuery", "===", "\"\<guideStart\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Association", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"\"\<vector_ref\>\"", "\[Rule]", 
             RowBox[{
              RowBox[{"RandomSample", "[", 
               RowBox[{
                RowBox[{"DeleteCases", "[", 
                 RowBox[{
                  RowBox[{"guide", "[", 
                   RowBox[{"[", 
                    RowBox[{"1", ",", "\"\<eventListSorted\>\""}], "]"}], 
                   "]"}], ",", 
                  RowBox[{"{", "}"}]}], "]"}], ",", "1"}], "]"}], "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"\"\<additionalWords\>\"", "->", 
             RowBox[{"{", "}"}]}]}], "}"}], "]"}], ",", 
         RowBox[{"ClipEncode", "[", 
          RowBox[{"startQuery", ",", "imgModel", ",", "textModel"}], "]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"LaunchDiviningRod", "[", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"$electedNotebook", "=", 
       RowBox[{"ClipediaLog", "[", 
        RowBox[{
         RowBox[{"{", "}"}], ",", 
         RowBox[{"\"\<A wander with \>\"", "<>", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ValueQ", "[", "guideName", "]"}], ",", "guideName", ",", 
            "\"\<nobody\>\""}], "]"}]}], ",", "exportFolder"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"$tep", "=", "0"}], ";", 
      RowBox[{"$pectrum", "=", "2"}], ";", 
      RowBox[{"$earchVal", "=", "36"}], ";", "\[IndentingNewLine]", 
      RowBox[{"NotebookWrite", "[", 
       RowBox[{"$electedNotebook", ",", 
        RowBox[{"Cell", "[", 
         RowBox[{
          RowBox[{"BoxData", "@", 
           RowBox[{"ToBoxes", "[", 
            RowBox[{"NextStep", "[", "start", "]"}], "]"}]}], ",", 
          "\"\<Output\>\""}], "]"}]}], "]"}], ";"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9409488841230907`*^9, 3.940948985841662*^9}, {
  3.940949054385687*^9, 3.940949070116007*^9}, {3.940949119763179*^9, 
  3.940949154770033*^9}, {3.9409491979852324`*^9, 3.940949381867937*^9}, {
  3.94094947968528*^9, 3.940949533351602*^9}, {3.940949619572042*^9, 
  3.940949630018661*^9}, {3.940949946488597*^9, 3.9409499498326473`*^9}, {
  3.941231791831361*^9, 3.941231802184065*^9}, {3.961233524467416*^9, 
  3.961233531148415*^9}, {3.961251167514192*^9, 3.961251205343061*^9}, {
  3.9612514810353403`*^9, 3.961251490055354*^9}, {3.961313553815535*^9, 
  3.96131355472556*^9}},
 CellLabel->
  "In[236]:=",ExpressionUUID->"b24e93b9-6166-4a32-9b9e-c51f1392f919"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "call"}], " ", "number", " ", "of", " ", "current", " ", 
      "step"}]}], ",", 
    RowBox[{
     RowBox[{"-", "encounters"}], " ", "list", " ", "of", " ", "encounter", 
     " ", "associations"}], ",", 
    RowBox[{
     RowBox[{"-", "queryElem"}], " ", "query", " ", "element", " ", "to", " ",
      "look", " ", "out", " ", "for"}], ",", 
    RowBox[{
     RowBox[{"-", "dictReverse"}], " ", "reverse", " ", "dictionary"}], ",", 
    RowBox[{
     RowBox[{"-", "dictWeights"}], " ", "word", " ", "weights"}], ",", 
    RowBox[{
     RowBox[{"-", "allAssoc"}], " ", "full", " ", "data", " ", 
     "association"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "allFolders"}], " ", "associated", " ", "folders"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Interactive"}], " ", "flip", " ", "control", " ", 
       "displaying", " ", "encounter", " ", "details", " ", "with", " ", 
       "guide", " ", "suggestions", " ", "and", " ", "controls"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Displays", " ", "a", " ", "dynamic", " ", "interactive", " ", 
       "interface", " ", "for", " ", "exploring", " ", "and", " ", 
       "comparing", " ", "closest", " ", "results"}]}]}], ",", 
    RowBox[{"showing", " ", "distances"}], ",", 
    RowBox[{"code", " ", "words"}], ",", 
    RowBox[{"guide", " ", "picks"}], ",", 
    RowBox[{"and", " ", "allowing", " ", "user", " ", "selections"}], ",", 
    RowBox[{
    "all", " ", "within", " ", "the", " ", "Clipedia", " ", "exploration", 
     " ", 
     RowBox[{"notebook", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ShowEncountersCompass", "[", 
    RowBox[{
    "call_", ",", "encounters_", ",", "queryElem_", ",", "dictReverse_", ",", 
     "dictWeights_", ",", "allAssoc_", ",", "allFolders_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "comparison", ",", "guideSuggestions", ",", "guideName", ",", "guide", 
       ",", "suggestion"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"$tocked", "=", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"$tack", ",", 
         RowBox[{"Association", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"call", "->", 
             RowBox[{"Pick", "[", 
              RowBox[{"#", ",", 
               RowBox[{"Not", "/@", 
                RowBox[{"MissingQ", "/@", "#"}]}]}], "]"}]}], "&"}], "@", 
           RowBox[{"Flatten", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"encounters", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "\"\<id\>\""}], "]"}], "]"}], ",", 
              RowBox[{"encounters", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "\"\<textID\>\""}], "]"}], "]"}], ",", 
              RowBox[{"encounters", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "\"\<imgHash\>\""}], "]"}], "]"}]}], 
             "}"}], "]"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "@", "encounters"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"suggestion", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "@", "$guideNamed"}], "===", "3"}], ",", 
            RowBox[{"ConsultGuide", "[", 
             RowBox[{"encounters", ",", "dictReverse", ",", "dictWeights"}], 
             "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", "}"}], ",", 
              RowBox[{"{", "}"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"$uggestionImg", "=", 
          RowBox[{"suggestion", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"$uggestionText", "=", 
          RowBox[{"suggestion", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"CreateFlipControl", "[", "\[IndentingNewLine]", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"comparison", "=", 
              RowBox[{"CompareElements", "[", 
               RowBox[{"queryElem", ",", 
                RowBox[{"encounters", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", "dictReverse"}], 
               "]"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"Column", "[", 
              RowBox[{
               RowBox[{"{", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Grid", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"BuildPanel", "[", 
                    RowBox[{
                    RowBox[{"\"\<Corpuscle \>\"", "<>", 
                    RowBox[{"Which", "[", 
                    RowBox[{
                    RowBox[{"KeyExistsQ", "[", 
                    RowBox[{
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", "\"\<id\>\""}], 
                    "]"}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<id\>\""}], "]"}], "]"}], ",", 
                    RowBox[{"KeyExistsQ", "[", 
                    RowBox[{
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", "\"\<textID\>\""}], 
                    "]"}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<textID\>\""}], "]"}], "]"}], ",", 
                    RowBox[{"KeyExistsQ", "[", 
                    RowBox[{
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", "\"\<imgHash\>\""}], 
                    "]"}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<imgHash\>\""}], "]"}], "]"}]}], 
                    "]"}], "<>", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"KeyExistsQ", "[", 
                    RowBox[{
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", "\"\<cell\>\""}], 
                    "]"}], ",", 
                    RowBox[{"\"\<. Cell \>\"", "<>", 
                    RowBox[{"ToString", "@", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "\"\<cell\>\""}], "]"}], "]"}]}]}], 
                    ",", "\"\<\>\""}], "]"}], "<>", "\"\<. Result \>\"", "<>", 
                    RowBox[{"ToString", "@", "i"}], "<>", "\"\</\>\"", "<>", 
                    RowBox[{"ToString", "@", 
                    RowBox[{"Length", "@", "encounters"}]}], "<>", 
                    "\"\<:\>\""}], ",", 
                    RowBox[{"\"\<Dis: \>\"", "<>", 
                    RowBox[{"ToString", "@", 
                    RowBox[{"comparison", "[", 
                    RowBox[{"[", "\"\<distance\>\"", "]"}], "]"}]}], "<>", 
                    "\"\<. CodeWords: \>\"", "<>", 
                    RowBox[{"ToString", "@", 
                    RowBox[{"Length", "@", "#"}]}], "<>", "\"\< - \>\"", "<>", 
                    RowBox[{"StringRiffle", "[", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{"UpTo", "[", "8", "]"}]}], "]"}], "]"}], ",", 
                    "\"\<, \>\""}], "]"}], "<>", "\"\<.\>\""}], ",", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{"{", "}"}]}], "}"}], ",", "allAssoc", ",", 
                    "allFolders", ",", "Black", ",", "#"}], "]"}], "&"}], "@", 
                    RowBox[{"comparison", "[", 
                    RowBox[{"[", "\"\<commonWords\>\"", "]"}], "]"}]}], "}"}],
                     "}"}], ",", 
                   RowBox[{"ItemSize", "->", 
                    RowBox[{"{", 
                    RowBox[{"50", ",", "Automatic"}], "}"}]}], ",", 
                   RowBox[{"Alignment", "->", "Left"}]}], "]"}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Column", "[", 
                  RowBox[{
                   RowBox[{"{", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "@", "$guideNamed"}], "===", "3"}], ",",
                     "\[IndentingNewLine]", 
                    RowBox[{"Which", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"MatchQ", "[", 
                    RowBox[{"i", ",", 
                    RowBox[{"$uggestionImg", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"$uggestionImg", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "===", 
                    RowBox[{"{", "}"}]}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Text", "[", 
                    RowBox[{
                    RowBox[{"$guideNamed", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\<'s pick\>\""}],
                     "]"}], ",", 
                    RowBox[{"FontSize", "->", "10"}]}], "]"}], ",", 
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Text", "[", 
                    RowBox[{
                    RowBox[{"$guideNamed", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<>", 
                    "\"\<'s pick. Why?\>\""}], "]"}], ",", 
                    RowBox[{"FontSize", "->", "10"}]}], "]"}], ",", 
                    RowBox[{"CreateDialog", "[", 
                    RowBox[{
                    RowBox[{"$uggestionImg", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"Background", "\[Rule]", 
                    RowBox[{"Lighter", "[", 
                    RowBox[{"Gray", ",", " ", "0.8"}], "]"}]}], ",", 
                    RowBox[{"WindowTitle", "->", 
                    RowBox[{
                    RowBox[{"$guideNamed", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<>", 
                    "\"\<s Commentary\>\""}]}], ",", 
                    RowBox[{"WindowSize", "->", 
                    RowBox[{"{", 
                    RowBox[{"400", ",", "All"}], "}"}]}]}], "]"}]}], "]"}]}], 
                    "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"MatchQ", "[", 
                    RowBox[{"i", ",", 
                    RowBox[{"$uggestionText", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"$uggestionText", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "===", 
                    RowBox[{"{", "}"}]}], ",", 
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Text", "[", 
                    RowBox[{
                    RowBox[{"$guideNamed", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<>", "\"\<'s pick\>\""}],
                     "]"}], ",", 
                    RowBox[{"FontSize", "->", "10"}]}], "]"}], ",", 
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Text", "[", 
                    RowBox[{
                    RowBox[{"$guideNamed", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<>", 
                    "\"\<'s pick. Why?\>\""}], "]"}], ",", 
                    RowBox[{"FontSize", "->", "10"}]}], "]"}], ",", 
                    RowBox[{"CreateDialog", "[", 
                    RowBox[{
                    RowBox[{"$uggestionText", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"Background", "\[Rule]", 
                    RowBox[{"Lighter", "[", 
                    RowBox[{"Gray", ",", " ", "0.8"}], "]"}]}], ",", 
                    RowBox[{"WindowTitle", "->", 
                    RowBox[{
                    RowBox[{"$guideNamed", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<>", 
                    "\"\<s Commentary\>\""}]}], ",", 
                    RowBox[{"WindowSize", "->", 
                    RowBox[{"{", 
                    RowBox[{"400", ",", "All"}], "}"}]}]}], "]"}]}], "]"}]}], 
                    "]"}]}], "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Text", "[", 
                    RowBox[{"Dynamic", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{"$elected", ",", "#"}], "]"}], "==", "True"}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{"Button", "[", 
                    RowBox[{"\"\<\:2a02\>\"", ",", 
                    RowBox[{"$elected", "=", 
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{"$elected", ",", "#"}], "]"}]}], ",", 
                    RowBox[{"Appearance", "->", "\"\<Frameless\>\""}]}], 
                    "]"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"Button", "[", 
                    RowBox[{"\"\<\:2a00\>\"", ",", 
                    RowBox[{"$elected", "=", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"$elected", ",", 
                    RowBox[{"Association", "[", 
                    RowBox[{"call", "->", "#"}], "]"}]}], "]"}]}], ",", 
                    RowBox[{"Appearance", "->", "\"\<Frameless\>\""}]}], 
                    "]"}]}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"FontSize", "->", "12"}]}], "]"}], "&"}], "@", 
                    RowBox[{"encounters", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], ",", 
                    "\[IndentingNewLine]", "\[IndentingNewLine]", 
                    RowBox[{"Button", "[", 
                    RowBox[{
                    RowBox[{"Style", "[", 
                    RowBox[{
                    RowBox[{"Text", "[", "\"\<\[DownArrow]\>\"", "]"}], ",", 
                    RowBox[{"FontSize", "->", "12"}], ",", 
                    RowBox[{"FontColor", "->", "Black"}]}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"SelectionMove", "[", 
                    RowBox[{
                    "$electedNotebook", ",", "After", ",", "Notebook"}], 
                    "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"NotebookWrite", "[", 
                    RowBox[{"$electedNotebook", ",", 
                    RowBox[{"Cell", "[", 
                    RowBox[{
                    RowBox[{"BoxData", "@", 
                    RowBox[{"ToBoxes", "[", 
                    RowBox[{"NextStep", "[", "]"}], "]"}]}], ",", 
                    "\"\<Output\>\""}], "]"}]}], "]"}]}], ",", 
                    RowBox[{"Appearance", "->", "\"\<Frameless\>\""}]}], 
                    "]"}]}], "}"}], ",", 
                   RowBox[{"Alignment", "->", "Center"}]}], "]"}]}], "}"}], 
               ",", 
               RowBox[{"Alignment", "->", "Center"}]}], "]"}]}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "@", "encounters"}]}], "}"}]}], "]"}], 
          "]"}]}], ",", 
        RowBox[{
        "Print", "[", "\"\<No encounters. Could not display queries.\>\"", 
         "]"}]}], "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.904312510153882*^9, 3.904312629670409*^9}, {
   3.904312728061932*^9, 3.904312762262331*^9}, 3.904377535139866*^9, {
   3.904410103418847*^9, 3.904410114546609*^9}, {3.904412015648621*^9, 
   3.904412070875265*^9}, {3.904413102279581*^9, 3.904413105472091*^9}, {
   3.904413140550361*^9, 3.904413184281827*^9}, {3.90761354572526*^9, 
   3.907613631628292*^9}, 3.910965022590016*^9, 3.911145112916367*^9, {
   3.911145196961769*^9, 3.911145216281186*^9}, {3.925358937203977*^9, 
   3.925358939245842*^9}, {3.925360303731728*^9, 3.9253603338399267`*^9}, {
   3.9253603673615637`*^9, 3.925360431217627*^9}, {3.925361087974925*^9, 
   3.9253610911235313`*^9}, {3.925361142420507*^9, 3.9253611455080223`*^9}, {
   3.925361179847352*^9, 3.925361227111472*^9}, {3.925361273204658*^9, 
   3.92536129357489*^9}, 3.925365355520404*^9, {3.925365390889179*^9, 
   3.925365413900487*^9}, 3.925365484040864*^9, {3.925366054629229*^9, 
   3.925366057120474*^9}, {3.9253660920518703`*^9, 3.92536612386754*^9}, {
   3.9253669616125793`*^9, 3.9253669751511383`*^9}, {3.925367269335431*^9, 
   3.925367270461719*^9}, {3.9253673408802156`*^9, 3.925367342725058*^9}, {
   3.9253674966982517`*^9, 3.925367521743906*^9}, {3.9253676045056477`*^9, 
   3.925367608495328*^9}, {3.9253676705718718`*^9, 3.925367721001577*^9}, 
   3.925367756666473*^9, 3.9253678676068287`*^9, {3.925367934502808*^9, 
   3.925367936479662*^9}, {3.925369209762554*^9, 3.9253692159870358`*^9}, 
   3.925369269563154*^9, {3.925369385668602*^9, 3.925369389507175*^9}, 
   3.9253694390836287`*^9, {3.925370598800241*^9, 3.925370614254146*^9}, 
   3.925370811213286*^9, {3.925371153811982*^9, 3.925371185583819*^9}, {
   3.925371374554078*^9, 3.9253713757542143`*^9}, {3.925371414068928*^9, 
   3.925371420635964*^9}, {3.925371465561214*^9, 3.925371467785418*^9}, {
   3.925371627439938*^9, 3.925371629779813*^9}, {3.9253730538143806`*^9, 
   3.925373209424892*^9}, {3.925373339075082*^9, 3.9253733810008163`*^9}, 
   3.925373671414188*^9, 3.9253739279134197`*^9, {3.925373987136229*^9, 
   3.925374076063081*^9}, {3.925374366405983*^9, 3.925374385620072*^9}, {
   3.925374429283978*^9, 3.925374606513261*^9}, {3.9253746421848288`*^9, 
   3.9253747055621243`*^9}, {3.9253747527631083`*^9, 3.925374752812549*^9}, 
   3.9253748009242363`*^9, {3.9253850311314297`*^9, 3.925385144367867*^9}, {
   3.925385533751239*^9, 3.925385548364524*^9}, {3.92538566455296*^9, 
   3.925385710567585*^9}, {3.9253857479733953`*^9, 3.925385766011485*^9}, {
   3.9253858659715023`*^9, 3.9253858701161127`*^9}, 3.925386095496336*^9, {
   3.925386147500271*^9, 3.925386152110443*^9}, 3.925386306714279*^9, {
   3.925386416372265*^9, 3.9253864178683147`*^9}, {3.925386468479575*^9, 
   3.925386482311893*^9}, {3.9253866830854387`*^9, 3.9253866954909573`*^9}, {
   3.9253867704544888`*^9, 3.92538677848518*^9}, {3.925386821860968*^9, 
   3.9253868266280107`*^9}, {3.925386922691094*^9, 3.9253869565930862`*^9}, {
   3.9253879449343777`*^9, 3.9253879734381638`*^9}, {3.925391717394232*^9, 
   3.9253917433416567`*^9}, {3.9253921013784313`*^9, 3.925392106619566*^9}, {
   3.925392259271843*^9, 3.925392322502602*^9}, {3.925392370460764*^9, 
   3.925392428232318*^9}, {3.925392470361001*^9, 3.9253924734334173`*^9}, {
   3.9253925204767237`*^9, 3.92539254877671*^9}, {3.925392680622066*^9, 
   3.925392689512281*^9}, {3.925392761939906*^9, 3.925392769473467*^9}, {
   3.92539576626597*^9, 3.925395769152807*^9}, {3.9254007056486883`*^9, 
   3.925400741300758*^9}, 3.925402218025481*^9, {3.9254485386069613`*^9, 
   3.925448567142107*^9}, {3.925449978239674*^9, 3.925450053671256*^9}, 
   3.925450350233033*^9, 3.925450517405263*^9, 3.92545058875534*^9, {
   3.925458227846094*^9, 3.925458235068096*^9}, {3.925458289318112*^9, 
   3.925458303267002*^9}, 3.9254585523928328`*^9, 3.925458619983976*^9, {
   3.925458706900222*^9, 3.9254587152122498`*^9}, {3.925458768883973*^9, 
   3.925458887977027*^9}, {3.9254589713583117`*^9, 3.9254589972154903`*^9}, {
   3.9254590502891827`*^9, 3.925459061329239*^9}, {3.925459251131328*^9, 
   3.925459300837413*^9}, {3.925459452938869*^9, 3.925459481057519*^9}, {
   3.925459829502289*^9, 3.925459875672492*^9}, 3.925461597033353*^9, {
   3.925465603268053*^9, 3.925465635827298*^9}, {3.925465868069023*^9, 
   3.925465871905834*^9}, {3.92548356082094*^9, 3.9254835885048227`*^9}, {
   3.9404897403605556`*^9, 3.9404897473969717`*^9}, 3.9404923649086657`*^9, {
   3.9404924851334867`*^9, 3.940492495595058*^9}, 3.940493110830886*^9, 
   3.940512342134943*^9, {3.940513076835979*^9, 3.9405130962406597`*^9}, {
   3.941037874105142*^9, 3.9410379194450483`*^9}, {3.941038012095837*^9, 
   3.941038017106455*^9}, {3.941039816657916*^9, 3.941039835654644*^9}, {
   3.941039944591033*^9, 3.9410399703287773`*^9}, {3.941040036333187*^9, 
   3.94104004265654*^9}, {3.941040123687714*^9, 3.9410401306935673`*^9}, {
   3.941040737771962*^9, 3.9410407454978333`*^9}, 3.941040893186898*^9, 
   3.941041054208933*^9, {3.941041093721448*^9, 3.941041093871482*^9}, {
   3.941041194304942*^9, 3.941041230044025*^9}, {3.941046731651787*^9, 
   3.941046748830265*^9}, {3.9410487632648706`*^9, 3.941048802512768*^9}, {
   3.941048875538453*^9, 3.9410488819902067`*^9}, {3.941049028345358*^9, 
   3.9410490312157173`*^9}, {3.941049221251638*^9, 3.941049244916423*^9}, {
   3.941049319903672*^9, 3.941049356992929*^9}, {3.941049418048999*^9, 
   3.941049667801565*^9}, 3.941050125409663*^9, {3.9411187276237717`*^9, 
   3.941118729755044*^9}, {3.961217679992391*^9, 3.961217681114859*^9}, {
   3.961251220553084*^9, 3.9612512214759007`*^9}, {3.961251269898114*^9, 
   3.961251302792337*^9}},
 CellLabel->
  "In[237]:=",ExpressionUUID->"56d5bac3-df60-447d-8608-90d85468f4bf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "start"}], " ", "optional", " ", "starting", " ", "query",
        " ", "element", " ", 
       RowBox[{"(", 
        RowBox[{"default", " ", "Null"}], ")"}]}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Displays"}], " ", "next", " ", "step", " ", "of", " ", 
       "Clipedia", " ", "exploration", " ", "with", " ", "updated", " ", 
       "encounter", " ", "results", " ", "based", " ", "on", " ", "SOM"}]}], 
     ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Advances", " ", "the", " ", "Clipedia", " ", "exploration"}]}]}], ",", 
    " ", 
    RowBox[{
    "querying", " ", "Clipedia", " ", "with", " ", "multiple", " ", "modes"}],
     ",", "  ", 
    RowBox[{
    "training", " ", "a", " ", "SOM", " ", "on", " ", "the", " ", "current", 
     " ", "query", " ", "to", " ", "show", " ", "most", " ", "characteristic",
      " ", "directions"}], ",", 
    RowBox[{
    "visualizing", " ", "them", " ", "interactively", " ", "with", " ", 
     RowBox[{"ShowEncountersCompass", "."}]}]}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"NextStep", "[", 
    RowBox[{"start_", ":", "Null"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "encounters", ",", "queryElem", ",", "queryResults", ",", "vecInput", 
       ",", "somKernel", ",", "bmus", ",", "indexListSorted", ",", 
       "somResults"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"queryElem", "=", "\[IndentingNewLine]", 
       RowBox[{"If", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"$tep", "===", "0"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"$elected", "=", 
           RowBox[{"Association", "[", "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"$tack", "=", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", "start"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Last", "[", "$elected", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"somResults", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"queryResults", "=", 
          RowBox[{"QueryEnSOM", "[", 
           RowBox[{"clipedia", ",", 
            RowBox[{"queryElem", "[", 
             RowBox[{"[", "\"\<vector_ref\>\"", "]"}], "]"}], ",", 
            RowBox[{"$diviningRod", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "i"}], "]"}], "]"}], ",", "0.01", ",", " ", 
            "0.001", ",", "$earchVal", ",", "$repoFolder", ",", "False", ",", 
            RowBox[{"Flatten", "[", 
             RowBox[{"Values", "[", "$tack", "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"vecInput", "=", 
          RowBox[{"queryResults", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "5"}], "]"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"somKernel", "=", 
          RowBox[{"CreateSomGridRandomSample", "[", 
           RowBox[{"vecInput", ",", "1", ",", "$pectrum", ",", 
            RowBox[{"First", "@", 
             RowBox[{"Dimensions", "[", 
              RowBox[{"vecInput", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "True"}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"somKernel", "[", 
           RowBox[{"[", "\"\<weights\>\"", "]"}], "]"}], "=", 
          RowBox[{"Last", "@", 
           RowBox[{
            RowBox[{"BatchSOM", "[", 
             RowBox[{"somKernel", ",", "vecInput", ",", 
              RowBox[{"Length", "@", "vecInput"}], ",", "0.001", ",", "8", 
              ",", "\"\<NoStats\>\"", ",", "\"\<Invisible\>\"", ",", 
              "\"\<Exponential\>\"", ",", "\"\<EuclideanDistance\>\"", ",", 
              "\"\<GrayTones\>\"", ",", "\"\<\>\""}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "\"\<weights\>\""}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"bmus", "=", " ", 
          RowBox[{"MapIndexed", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"First", "@", "#2"}], "\[Rule]", 
              RowBox[{"First", "@", 
               RowBox[{"FindBMUs", "[", 
                RowBox[{"somKernel", ",", " ", 
                 RowBox[{"{", "#1", "}"}]}], "]"}]}]}], "&"}], ",", " ", 
            "vecInput"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"indexListSorted", "=", 
          RowBox[{"DeleteCases", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Select", "[", 
                RowBox[{"bmus", ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "cell"}], 
                  "&"}]}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"cell", ",", 
                RowBox[{"somKernel", "[", 
                 RowBox[{"\"\<dimensions\>\"", ",", "\"\<len\>\""}], "]"}]}], 
               "}"}]}], "]"}], ",", 
            RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"somResults", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"somResults", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"queryResults", "[", 
               RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
             RowBox[{"indexListSorted", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "@", 
           RowBox[{"$diviningRod", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"encounters", "=", 
       RowBox[{"RandomSample", "@", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"AddInfo", "[", 
           RowBox[{"CollateEnAssoc", "[", 
            RowBox[{"somResults", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "@", "somResults"}]}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"$tep", "=", 
       RowBox[{"$tep", "+", "1"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ShowEncountersCompass", "[", 
       RowBox[{
       "$tep", ",", "encounters", ",", "queryElem", ",", "dictReverse", ",", 
        "dictWeights", ",", "allAssoc", ",", "allFolders"}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.925366896686777*^9, 3.92536692500597*^9}, {
   3.925367043899785*^9, 3.925367095934248*^9}, 3.925367228515547*^9, {
   3.9253672822288*^9, 3.9253672897897253`*^9}, {3.92536732057178*^9, 
   3.925367326074188*^9}, {3.925367377822526*^9, 3.925367393832697*^9}, {
   3.9253681026203403`*^9, 3.9253681421634083`*^9}, {3.925368248569983*^9, 
   3.925368249377235*^9}, {3.925370617490818*^9, 3.925370618678726*^9}, {
   3.925370650433329*^9, 3.925370704510332*^9}, {3.925370738367578*^9, 
   3.925370738904665*^9}, {3.9253718138950653`*^9, 3.9253718213796043`*^9}, 
   3.925373312564695*^9, 3.925373466796411*^9, 3.925373675566041*^9, 
   3.9253805921705713`*^9, {3.925395539482519*^9, 3.925395555730473*^9}, {
   3.925395664610725*^9, 3.92539567537117*^9}, {3.925399055468052*^9, 
   3.92539905552404*^9}, 3.9253991592413073`*^9, {3.9253992220770893`*^9, 
   3.925399222889494*^9}, {3.925399393836542*^9, 3.9253993954262123`*^9}, 
   3.925400676013687*^9, 3.925447482910884*^9, 3.9254489112928667`*^9, 
   3.92544897765205*^9, {3.925449367888101*^9, 3.925449369595707*^9}, {
   3.925449724911498*^9, 3.9254497261152477`*^9}, {3.9254499282859097`*^9, 
   3.92544993101588*^9}, {3.9254583137156773`*^9, 3.9254583159538727`*^9}, {
   3.940500053564672*^9, 3.940500065614798*^9}, {3.940500111004264*^9, 
   3.940500129398736*^9}, {3.940508763929496*^9, 3.940508816470867*^9}, {
   3.9405157105543528`*^9, 3.9405157955927763`*^9}, {3.940515976993662*^9, 
   3.940515977841525*^9}, {3.9405160819845*^9, 3.940516089301528*^9}, 
   3.9405163064647512`*^9, {3.940516375183818*^9, 3.940516377091131*^9}, 
   3.9405164550118647`*^9, 3.940516569131579*^9, 3.9405172657911*^9, {
   3.94051733245634*^9, 3.940517332527423*^9}, {3.940517542547298*^9, 
   3.940517548215404*^9}, {3.940517840544114*^9, 3.940517842200817*^9}, {
   3.9405212228318033`*^9, 3.940521253501643*^9}, {3.940521288035878*^9, 
   3.9405212952802563`*^9}, {3.940521526591161*^9, 3.940521529300823*^9}, {
   3.940521645649548*^9, 3.9405216979745197`*^9}, {3.940521885848962*^9, 
   3.940521887649952*^9}, {3.940919659743779*^9, 3.940919660153124*^9}, {
   3.941139763499547*^9, 3.941139766160564*^9}, {3.941140286853364*^9, 
   3.941140287064926*^9}, {3.941140337427783*^9, 3.941140350357995*^9}, 
   3.961217655885769*^9, 3.9612245807356243`*^9, {3.9612513270158377`*^9, 
   3.96125132898564*^9}, {3.961251511429616*^9, 3.96125163156631*^9}, 
   3.96146941908603*^9, {3.9614696082332373`*^9, 3.961469619277892*^9}, 
   3.961473563084135*^9},
 CellLabel->"",ExpressionUUID->"36d2d1f2-01da-4751-b38c-267ab5433b36"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "encounters"}], " ", "list", " ", "of", " ", "encounter", 
      " ", "associations"}]}], ",", 
    RowBox[{
     RowBox[{"-", "dictReverse"}], " ", "reverse", " ", "dictionary"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "dictWeights"}], " ", "word", " ", "weights"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Pair"}], " ", "of", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"best", " ", "global", " ", "index"}], ",", 
         RowBox[{"suggestion", " ", "panels"}]}], "}"}], " ", "for", " ", 
       "images", " ", "and", " ", "text"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Compares", " ", "current", " ", "results", " ", "against", " ", 
       "guide", " ", "vectors", " ", "to", " ", "identify", " ", "the", " ", 
       "most", " ", "similar", " ", "image", " ", "and", " ", "text", " ", 
       "results"}]}]}], ",", 
    RowBox[{"ranks", " ", "top", " ", "matches"}], ",", 
    RowBox[{
    "selects", " ", "best", " ", "candidates", " ", "based", " ", "on", " ", 
     "distance", " ", "and", " ", "common", " ", "tokens"}], ",", 
    RowBox[{
    "and", " ", "prepares", " ", "guide", " ", "suggestion", " ", "panels", 
     " ", "for", " ", "simple", " ", "suggestion", " ", "or", " ", 
     "commentary"}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ConsultGuide", "[", 
    RowBox[{"encounters_", ",", "dictReverse_", ",", "dictWeights_"}], "]"}], 
   ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "imgEncounters", ",", "txtEncounters", ",", "guideVec", ",", "median", 
       ",", "distancesImg", ",", "distancesText", ",", "orderingsImg", ",", 
       "orderingsText", ",", "suggestionsImg", ",", "medianDistance", ",", 
       "scoresImg", ",", "scoresText", ",", "bestImg", ",", "bestText", ",", 
       "guidePanels", ",", "selected", ",", "guideElem", ",", 
       "comparisonsImg", ",", "comparisonsText", ",", "bestElemImg", ",", 
       "bestSelectedText", ",", "bestElemText", ",", "bestSelectedImg", ",", 
       "suggestionsText", ",", "bestImgGlobal", ",", "bestTextGlobal", ",", 
       "suggestions"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"guideVec", "=", 
       RowBox[{"Catenate", "[", 
        RowBox[{"$guideNamed", "[", 
         RowBox[{"[", 
          RowBox[{
          "2", ",", "1", ",", "\"\<eventListSorted\>\"", ",", "All", ",", 
           "All"}], "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"median", "=", 
       RowBox[{"Median", "[", 
        RowBox[{"$guideNamed", "[", 
         RowBox[{"[", 
          RowBox[{"3", ",", "All", ",", "\"\<vector_ref\>\""}], "]"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"imgEncounters", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"encounters", ",", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"encounters", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "\"\<type\>\""}], "]"}], "]"}], ",", 
           "\"\<img\>\""}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"imgEncounters", "=!=", 
         RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"scoresImg", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"CosineDistance", "[", 
             RowBox[{"median", ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "\"\<vector_ref\>\"", "]"}], "]"}]}], "]"}], 
            "&"}], "/@", "imgEncounters"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"bestImg", "=", 
          RowBox[{
           RowBox[{"Ordering", "[", "scoresImg", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"distancesImg", "=", 
          RowBox[{"CosineDistanceFast", "[", 
           RowBox[{
            RowBox[{"imgEncounters", "[", 
             RowBox[{"[", 
              RowBox[{"bestImg", ",", "\"\<vector_ref\>\""}], "]"}], "]"}], 
            ",", 
            RowBox[{"guideVec", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"orderingsImg", "=", 
          RowBox[{"Ordering", "[", "distancesImg", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"bestElemImg", "=", 
          RowBox[{"Part", "[", 
           RowBox[{
            RowBox[{"$guideNamed", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", 
            RowBox[{"orderingsImg", "[", 
             RowBox[{"[", 
              RowBox[{";;", 
               RowBox[{"UpTo", "[", "10", "]"}]}], "]"}], "]"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"comparisonsImg", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"CompareElements", "[", 
             RowBox[{
              RowBox[{"imgEncounters", "[", 
               RowBox[{"[", "bestImg", "]"}], "]"}], ",", "#", ",", 
              "dictReverse"}], "]"}], "&"}], "/@", "bestElemImg"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"bestSelectedImg", "=", 
          RowBox[{"Flatten", "[", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"comparisonsImg", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "\"\<distance\>\""}], "]"}], "]"}], ",", 
             RowBox[{"Min", "[", 
              RowBox[{"Select", "[", 
               RowBox[{
                RowBox[{"comparisonsImg", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "\"\<distance\>\""}], "]"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"#", "<", "0.7"}], "&"}]}], "]"}], "]"}]}], "]"}], 
           "]"}]}], ";", 
         RowBox[{"suggestionsImg", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "@", "bestSelectedImg"}], ">", "0"}], ",", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"GuidePanel", "[", 
               RowBox[{
                RowBox[{"bestElemImg", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"$guideNamed", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "2", ",", "1"}], "]"}], "]"}], ",", 
                RowBox[{"$guideNamed", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "2", ",", "2"}], "]"}], "]"}], ",", 
                RowBox[{"$guideNamed", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "2", ",", "3"}], "]"}], "]"}], ",", 
                RowBox[{"comparisonsImg", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "\"\<commonWords\>\""}], "]"}], "]"}]}], 
               "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "bestSelectedImg"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"bestImgGlobal", "=", 
          RowBox[{"First", "[", 
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"encounters", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "\"\<type\>\""}], "]"}], "]"}], ",", 
              "\"\<img\>\""}], "]"}], "[", 
            RowBox[{"[", "bestImg", "]"}], "]"}], "]"}]}], ";"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"suggestionsImg", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"bestImgGlobal", "=", 
          RowBox[{"{", "}"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"txtEncounters", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"encounters", ",", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"encounters", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "\"\<type\>\""}], "]"}], "]"}], ",", 
           "\"\<text\>\""}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"txtEncounters", "=!=", 
         RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"scoresText", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"CosineDistance", "[", 
             RowBox[{"median", ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "\"\<vector_ref\>\"", "]"}], "]"}]}], "]"}], 
            "&"}], "/@", "txtEncounters"}]}], ";", 
         RowBox[{"bestText", "=", 
          RowBox[{
           RowBox[{"Ordering", "[", "scoresText", "]"}], "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"distancesText", "=", 
          RowBox[{"CosineDistanceFast", "[", 
           RowBox[{
            RowBox[{"txtEncounters", "[", 
             RowBox[{"[", 
              RowBox[{"bestText", ",", "\"\<vector_ref\>\""}], "]"}], "]"}], 
            ",", 
            RowBox[{"guideVec", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"orderingsText", "=", 
          RowBox[{"Ordering", "[", "distancesText", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"bestElemText", "=", 
          RowBox[{"Part", "[", 
           RowBox[{
            RowBox[{"$guideNamed", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", 
            RowBox[{"orderingsText", "[", 
             RowBox[{"[", 
              RowBox[{";;", 
               RowBox[{"UpTo", "[", "10", "]"}]}], "]"}], "]"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"comparisonsText", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"CompareElements", "[", 
             RowBox[{
              RowBox[{"txtEncounters", "[", 
               RowBox[{"[", "bestText", "]"}], "]"}], ",", "#", ",", 
              "dictReverse"}], "]"}], "&"}], "/@", "bestElemText"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"bestSelectedText", "=", 
          RowBox[{"Flatten", "@", 
           RowBox[{"Intersection", "[", 
            RowBox[{
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{"comparisonsText", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "\"\<commonTokens\>\""}], "]"}], "]"}], 
               ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"#", ">", "0"}], "&"}], ")"}]}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{"comparisonsText", "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "\"\<distance\>\""}], "]"}], "]"}], ",", 
               RowBox[{"_", "?", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"#", "<", "0.17"}], "&"}], ")"}]}]}], "]"}]}], 
            "]"}]}]}], ";", 
         RowBox[{"suggestionsText", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "@", "bestSelectedText"}], ">", "0"}], ",", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"GuidePanel", "[", 
               RowBox[{
                RowBox[{"bestElemText", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"$guideNamed", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "2", ",", "1"}], "]"}], "]"}], ",", 
                RowBox[{"$guideNamed", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "2", ",", "2"}], "]"}], "]"}], ",", 
                RowBox[{"$guideNamed", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "2", ",", "3"}], "]"}], "]"}], ",", 
                RowBox[{"comparisonsText", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "\"\<commonWords\>\""}], "]"}], "]"}]}], 
               "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "bestSelectedText"}], "}"}]}], "]"}], ",", 
            RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"bestTextGlobal", "=", 
          RowBox[{"First", "[", 
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"encounters", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "\"\<type\>\""}], "]"}], "]"}], ",", 
              "\"\<text\>\""}], "]"}], "[", 
            RowBox[{"[", "bestText", "]"}], "]"}], "]"}]}], ";"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"suggestionsText", "=", 
          RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"bestTextGlobal", "=", 
          RowBox[{"{", "}"}]}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"bestImgGlobal", ",", "suggestionsImg"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"bestTextGlobal", ",", "suggestionsText"}], "}"}]}], 
       "}"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.941036948865074*^9, 3.9410370284417353`*^9}, {
   3.94103710112637*^9, 3.941037139496449*^9}, {3.94103733580002*^9, 
   3.941037342881019*^9}, {3.941037417069626*^9, 3.941037417163438*^9}, {
   3.941037684041307*^9, 3.941037758024214*^9}, {3.941038758783228*^9, 
   3.941038760053793*^9}, {3.941040145203487*^9, 3.941040149851293*^9}, {
   3.9410406725518827`*^9, 3.9410406918778954`*^9}, {3.941040822684018*^9, 
   3.941040833117222*^9}, {3.941040935731662*^9, 3.941040941602614*^9}, {
   3.941040972711814*^9, 3.9410409761058483`*^9}, {3.941046080201934*^9, 
   3.9410460873948107`*^9}, {3.9410488214835377`*^9, 3.941048864178369*^9}, {
   3.941049750160409*^9, 3.94104975067074*^9}, 3.941049895799712*^9, {
   3.941050147399852*^9, 3.941050156117169*^9}, {3.941150092834443*^9, 
   3.941150235124907*^9}, {3.941233441580365*^9, 3.94123344372196*^9}, {
   3.941234149254784*^9, 3.941234154739483*^9}, {3.9612514077280073`*^9, 
   3.9612514538543663`*^9}},
 CellLabel->
  "In[239]:=",ExpressionUUID->"7c9e1c56-9977-4c2a-987e-6066d0d508e7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "none"}], " ", 
       RowBox[{"(", 
        RowBox[{
        "uses", " ", "and", " ", "updates", " ", "global", " ", "variable", 
         " ", "$diviningRod"}], ")"}]}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Interactive"}], " ", "dialog", " ", "window", " ", "for",
        " ", "selecting", " ", "query", " ", "modes"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Opens", " ", "a", " ", "dynamic", " ", "dialog", " ", "with", " ", 
       "checkboxes", " ", "to", " ", "let", " ", "the", " ", "user", " ", 
       "select", " ", "which", " ", "data", " ", "types", " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"e", ".", "g", "."}], ",", "\"\<img\>\"", ",", 
         "\"\<txt\>\""}], ")"}], " ", "to", " ", "include", " ", "for", " ", 
       "the", " ", "next", " ", "Clipedia", " ", "exploration", " ", 
       "steps"}]}]}], ",", 
    RowBox[{
    "and", " ", "updates", " ", "the", " ", "$diviningRod", " ", "global", 
     " ", "variable", " ", 
     RowBox[{"accordingly", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"$diviningRod", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\"\<img\>\"", ",", "\"\<txt\>\""}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"\"\<img\>\"", ",", "\"\<txt\>\""}], "}"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"LaunchDiviningRod", "[", "]"}], ":=", "\[IndentingNewLine]", 
     RowBox[{"DynamicModule", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"items", "=", 
         RowBox[{"{", 
          RowBox[{"\"\<img\>\"", ",", "\"\<txt\>\""}], "}"}]}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"selectedItems", "=", "items"}], ";", "\[IndentingNewLine]", 
        RowBox[{"CreateDialog", "[", 
         RowBox[{
          RowBox[{"Column", "[", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
             "TextCell", "[", "\"\<Select items to include:\>\"", "]"}], ",", 
             RowBox[{"CheckboxBar", "[", 
              RowBox[{
               RowBox[{"Dynamic", "[", 
                RowBox[{"selectedItems", ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"selectedItems", "=", "#"}], ";", 
                    "\[IndentingNewLine]", 
                    RowBox[{"$diviningRod", "=", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{
                    "selectedItems", ",", "\"\<\[FilledUpTriangle]\>\""}], 
                    "]"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    "selectedItems", ",", "\"\<\[FilledUpTriangle]\>\""}], 
                    "]"}], ",", 
                    RowBox[{"DeleteCases", "[", 
                    RowBox[{"selectedItems", ",", 
                    RowBox[{
                    "\"\<\[FilledUpTriangle]\>\"", "|", 
                    "\"\<sentences\>\""}]}], "]"}], ",", 
                    RowBox[{"{", "}"}]}], "]"}]}], "}"}]}], ";"}], ")"}], 
                  "&"}]}], "]"}], ",", "items", ",", 
               RowBox[{"Enabled", "->", "True"}], ",", 
               RowBox[{"Appearance", "->", "\"\<Vertical\>\""}], ",", 
               RowBox[{"Method", "->", "\"\<Active\>\""}]}], "]"}]}], "}"}], 
           "]"}], ",", 
          RowBox[{"WindowTitle", "->", "\"\<Divining Rod\>\""}], ",", 
          RowBox[{"WindowSize", "->", 
           RowBox[{"{", 
            RowBox[{"200", ",", "80"}], "}"}]}], ",", 
          RowBox[{"WindowMargins", "->", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Automatic", ",", "50"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"Automatic", ",", "50"}], "}"}]}], "}"}]}]}], "]"}]}]}],
       "]"}]}], ";"}], "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9253793553022203`*^9, 3.9253793553085203`*^9}, {
   3.925379401170352*^9, 3.9253794492231216`*^9}, {3.9253795075465918`*^9, 
   3.925379509762404*^9}, {3.925379541590355*^9, 3.925379579382165*^9}, {
   3.925379634774395*^9, 3.9253797779676743`*^9}, {3.92537981784017*^9, 
   3.92537981805739*^9}, {3.925379878111188*^9, 3.925379894625223*^9}, {
   3.925379934150002*^9, 3.925379983739856*^9}, {3.9253800316693697`*^9, 
   3.9253800807609253`*^9}, {3.9253801200912447`*^9, 3.925380178153064*^9}, 
   3.9253802173243628`*^9, {3.925380397794672*^9, 3.925380399132636*^9}, {
   3.925380433713175*^9, 3.9253804774833937`*^9}, {3.925380509505937*^9, 
   3.925380524399932*^9}, 3.925380751484943*^9, {3.925380791346922*^9, 
   3.9253807924641647`*^9}, {3.9253809723472347`*^9, 3.925380973050332*^9}, {
   3.925398197385901*^9, 3.9253982050144587`*^9}, {3.925398241623397*^9, 
   3.925398241742708*^9}, {3.925398306941791*^9, 3.9253983443512278`*^9}, {
   3.925398437498857*^9, 3.925398442012403*^9}, {3.925398483058836*^9, 
   3.925398495632457*^9}, {3.925398536025795*^9, 3.925398649792296*^9}, {
   3.925398768447584*^9, 3.9253987712746153`*^9}, {3.925398858471527*^9, 
   3.925398912353297*^9}, {3.925398951463503*^9, 3.925398954366222*^9}, {
   3.925401010043932*^9, 3.925401030296809*^9}, {3.9254759426053753`*^9, 
   3.9254759944617033`*^9}, {3.940484959690791*^9, 3.940485012053437*^9}, {
   3.94049973752722*^9, 3.940499746213925*^9}, {3.961251374660369*^9, 
   3.9612513896377487`*^9}},
 CellLabel->
  "In[240]:=",ExpressionUUID->"94e2e284-e42b-4b59-8953-ff3a820ae8ae"]
}, Closed]],

Cell[CellGroupData[{

Cell["Helper Functions Text", "Subtitle",
 CellChangeTimes->{{3.873539554198429*^9, 3.87353956385848*^9}, {
  3.873539727707151*^9, 3.873539729825041*^9}, {3.898786755033476*^9, 
  3.89878675719049*^9}, {3.9195894698010783`*^9, 3.9195894708032336`*^9}, {
  3.961229618649158*^9, 3.961229622761003*^9}, {3.961250402198966*^9, 
  3.961250406654327*^9}, {3.961252661844652*^9, 
  3.9612526637110662`*^9}},ExpressionUUID->"b5f30fd1-7179-4f8f-b3d9-\
e681d9799da3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "string"}], " ", "input", " ", "string"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "Cleaned"}], " ", "and", " ", "filesystem"}], "-", 
       RowBox[{"safe", " ", "string"}]}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Converts", " ", "the", " ", "input", " ", "string", " ", "to", " ", 
       "lowercase"}]}]}], ",", 
    RowBox[{"replaces", " ", "spaces", " ", "with", " ", "underscores"}], ",", 
    RowBox[{"removes", " ", "diacritics"}], ",", 
    RowBox[{
     RowBox[{"and", " ", "strips", " ", "all", " ", "non"}], "-", 
     RowBox[{"alphanumeric", " ", "or", " ", 
      RowBox[{"underscore", "/", "dash"}], " ", "characters", " ", "to", " ", 
      "create", " ", "a", " ", "safe", " ", 
      RowBox[{"filename", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"MakeFileName", "[", "string_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "cleaned", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cleaned", "=", 
        RowBox[{"StringReplace", "[", 
         RowBox[{"string", ",", 
          RowBox[{"\"\< \>\"", "->", "\"\<_\>\""}]}], "]"}]}], ";", 
       RowBox[{"cleaned", "=", 
        RowBox[{"RemoveDiacritics", "@", 
         RowBox[{"ToLowerCase", "[", "cleaned", "]"}]}]}], ";", 
       RowBox[{"cleaned", "=", 
        RowBox[{"StringReplace", "[", 
         RowBox[{"cleaned", ",", 
          RowBox[{
           RowBox[{"Except", "[", 
            RowBox[{
            "Characters", "[", 
             "\"\<abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567\
89_-\>\"", "]"}], "]"}], "->", "\"\<\>\""}]}], "]"}]}], ";", 
       RowBox[{"Return", "[", "cleaned", "]"}], ";"}]}], "]"}]}], 
   "\n"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9196701926912804`*^9, 3.9196702203124137`*^9}, {
  3.919670251921262*^9, 3.9196702583510036`*^9}, {3.9612496253483763`*^9, 
  3.961249630277239*^9}},
 CellLabel->
  "In[242]:=",ExpressionUUID->"1be9f35b-60a2-43fa-b2f3-78bdd612e6da"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "text"}], " ", "input", " ", "string"}]}], ",", 
    RowBox[{
     RowBox[{"-", "minLen"}], " ", "minimum", " ", "paragraph", " ", 
     "length"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "maxLen"}], " ", "maximum", " ", "paragraph", " ", 
      "length"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "paragraphs", " ", "or", " ", 
       "subparagraphs", " ", "split", " ", "by", " ", "length", " ", "and", 
       " ", "sentence", " ", "boundaries"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Splits", " ", "input", " ", "text", " ", "into", " ", "cleaned", " ", 
       "paragraphs"}]}]}], ",", 
    RowBox[{
    "optionally", " ", "breaking", " ", "long", " ", "paragraphs", " ", 
     "into", " ", "subparagraphs", " ", "at", " ", "sentence", " ", 
     "boundaries", " ", "to", " ", "stay", " ", "within", " ", "maxLen", " ", 
     RowBox[{"limits", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"Paragraphize", "[", 
    RowBox[{"text_", ",", "minLen_", ",", "maxLen_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "paragraphsRaw", ",", "paragraphs", ",", "paragraphsSplit", ",", 
       "paragraph", ",", "breakPos", ",", "breakPointLen", ",", 
       "breakPointPos", ",", "break", ",", "breakSeq"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"paragraphsRaw", "=", 
       RowBox[{"StringSplit", "[", 
        RowBox[{"text", ",", "\"\<\\n\>\""}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"paragraphs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"StringTrim", "[", 
          RowBox[{"StringDelete", "[", 
           RowBox[{"#", ",", 
            RowBox[{"StringCases", "[", 
             RowBox[{"#", ",", 
              RowBox[{"\"\<==\>\"", "~~", " ", "___", "~~", "\"\<==\>\""}]}], 
             "]"}]}], "]"}], "]"}], "&"}], "/@", "paragraphsRaw"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"paragraphsSplit", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"paragraph", "=", 
          RowBox[{"paragraphs", "[", 
           RowBox[{"[", "p", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"StringLength", "@", "paragraph"}], "!=", "0"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"breakPos", "=", 
             RowBox[{"StringPosition", "[", 
              RowBox[{"paragraph", ",", 
               RowBox[{"\"\<.\>\"", "~~", "WhitespaceCharacter"}]}], "]"}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"Identify", " ", "how", " ", 
              RowBox[{"many", " ", ".", " ", "needed"}], " ", "to", " ", 
              "fill", " ", "subparagraph"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"breakPointLen", "=", 
             RowBox[{"Ceiling", "[", 
              RowBox[{
               RowBox[{"Length", "@", "breakPos"}], "/", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"StringLength", "@", "paragraph"}], "/", "maxLen"}], 
                ")"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
             "Identify", " ", "Positions", " ", "where", " ", "to", " ", 
              "split"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"breakPointPos", "=", 
             RowBox[{"Range", "[", 
              RowBox[{"breakPointLen", ",", 
               RowBox[{
                RowBox[{"Length", "@", "breakPos"}], "-", "1"}], ",", 
               "breakPointLen"}], "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"Create", " ", "sequence", " ", "markers"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "@", "breakPointPos"}], "!=", "0"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"break", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Part", "[", 
                   RowBox[{"breakPos", ",", "#"}], "]"}], "&"}], "/@", 
                 "breakPointPos"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"breakSeq", "=", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"i", "==", "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"break", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "}"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"break", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "-", "1"}], ",", "2"}], "]"}], "]"}], "+", 
                    "1"}], ",", 
                    RowBox[{"break", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", 
                    RowBox[{"Length", "@", "break"}]}], "}"}]}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Last", "[", "break", "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "+", "1"}], ",", 
                    RowBox[{"StringLength", "@", "paragraph"}]}], "}"}], 
                   "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "Split", " ", "Paragraphs", " ", "where", " ", "needed"}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"paragraph", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"StringTrim", "[", 
                   RowBox[{"StringTake", "[", 
                    RowBox[{"paragraph", ",", "#"}], "]"}], "]"}], "&"}], "/@",
                  "breakSeq"}]}]}], ",", "\[IndentingNewLine]", 
              RowBox[{"paragraph", "=", 
               RowBox[{"{", "paragraph", "}"}]}]}], "]"}], ";"}], ",", 
           RowBox[{
            RowBox[{"paragraph", "=", 
             RowBox[{"{", "paragraph", "}"}]}], ";"}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"paragraphsSplit", "=", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"paragraphsSplit", ",", "paragraph"}], "]"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"p", ",", "1", ",", 
          RowBox[{"Length", "@", "paragraphs"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "paragraphsSplit"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.919691233500923*^9, 3.919691377947925*^9}, {
  3.9612495999349546`*^9, 3.9612496027493258`*^9}},
 CellLabel->
  "In[243]:=",ExpressionUUID->"63280eb3-3295-4262-88a3-b8a370f5e9b0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "entry"}], " ", "association", " ", "or", " ", "list", " ",
       "of", " ", "terms", " ", "to", " ", "encode"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "dict"}], " ", "dictionary", " ", "mapping", " ", "terms", 
      " ", "to", " ", "numeric", " ", "tokens"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Association"}], " ", "or", " ", "list", " ", "with", " ",
        "numeric", " ", "tokens"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Encodes", " ", "each", " ", "entry", " ", "using", " ", "the", " ", 
       "provided", " ", "dictionary"}]}]}], ",", 
    RowBox[{"flattens", " ", "nested", " ", "lists"}], ",", 
    RowBox[{
     RowBox[{"and", " ", "removes", " ", "non"}], "-", 
     RowBox[{"string", " ", "or", " ", "non"}], "-", 
     RowBox[{"numeric", " ", "elements"}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"DictEncodeEntry", "[", 
    RowBox[{"entry_", ",", "dict_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"keys", ",", "results", ",", "result"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"AssociationQ", "[", "entry", "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"keys", "=", 
         RowBox[{"Keys", "[", "entry", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", "\[IndentingNewLine]", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"results", "=", 
             RowBox[{"Flatten", "@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"dict", "[", "#", "]"}], "&"}], "/@", 
                RowBox[{"entry", "[", 
                 RowBox[{"[", 
                  RowBox[{"keys", "[", 
                   RowBox[{"[", "k", "]"}], "]"}], "]"}], "]"}]}], "}"}]}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"keys", "[", 
              RowBox[{"[", "k", "]"}], "]"}], "->", 
             RowBox[{"DeleteCases", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"NumberQ", "[", "#", "]"}], ",", 
                    RowBox[{"StringQ", "[", "#", "]"}]}], "}"}], ",", 
                    "True"}], "]"}], ",", "#", ",", "\"\<\>\""}], "]"}], 
                 "&"}], "/@", "results"}], ",", "\"\<\>\""}], "]"}]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", 
             RowBox[{"Length", "@", "keys"}]}], "}"}]}], "]"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"result", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"results", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"dict", "[", "#", "]"}], "&"}], "/@", 
               RowBox[{"entry", "[", 
                RowBox[{"[", "e", "]"}], "]"}]}], "}"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"result", "=", 
            RowBox[{"Append", "[", 
             RowBox[{"result", ",", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"NumberQ", "[", "#", "]"}], ",", 
                    RowBox[{"StringQ", "[", "#", "]"}]}], "}"}], ",", 
                    "True"}], "]"}], ",", "#", ",", "\"\<\>\""}], "]"}], 
                  "&"}], "/@", "results"}], ",", "\"\<\>\""}], "]"}]}], 
             "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"e", ",", 
            RowBox[{"Length", "@", "entry"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "result"}]}], "]"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.898763591273342*^9, 3.898763600829914*^9}, {
  3.898763638989543*^9, 3.898763723420701*^9}, {3.898764187884275*^9, 
  3.8987642230553527`*^9}, {3.898764775731535*^9, 3.8987647839330945`*^9}, {
  3.8987650203307924`*^9, 3.89876507530715*^9}, {3.898765126991294*^9, 
  3.898765168963311*^9}, {3.8987657878693686`*^9, 3.898765816136444*^9}, {
  3.8987658619359145`*^9, 3.8987658633143754`*^9}, {3.8992056911144943`*^9, 
  3.8992057415985327`*^9}, {3.961249537515417*^9, 3.9612495848150883`*^9}},
 CellLabel->
  "In[244]:=",ExpressionUUID->"87937a11-4b3f-4f99-9e57-475ca8cd47f8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "entry"}], " ", "association", " ", "or", " ", "list", " ",
       "of", " ", "encoded", " ", "terms"}]}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "dictReverse"}], " ", "reverse", " ", "dictionary", " ", 
      "mapping", " ", "numeric", " ", "tokens", " ", "to", " ", "words"}], 
     ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Association"}], " ", "or", " ", "list", " ", "with", " ",
        "decoded", " ", "values"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Decodes", " ", "each", " ", "entry", " ", "using", " ", "the", " ", 
       "reverse", " ", "dictionary"}]}]}], ",", 
    RowBox[{
     RowBox[{
     "flattening", " ", "nested", " ", "lists", " ", "and", " ", "removing", 
      " ", "non"}], "-", 
     RowBox[{"string", " ", "or", " ", "non"}], "-", 
     RowBox[{"numeric", " ", "elements"}]}], ",", 
    RowBox[{"returning", " ", "cleaned", " ", "associations", " ", "or", " ", 
     RowBox[{"lists", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"DictDecodeEntry", "[", 
    RowBox[{"entry_", ",", "dictReverse_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"keys", ",", "results", ",", "result"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"AssociationQ", "[", "entry", "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"keys", "=", 
         RowBox[{"Keys", "[", "entry", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", "\[IndentingNewLine]", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"results", "=", 
             RowBox[{"Flatten", "@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"dictReverse", "[", "#", "]"}], "&"}], "/@", 
                RowBox[{"entry", "[", 
                 RowBox[{"[", 
                  RowBox[{"keys", "[", 
                   RowBox[{"[", "k", "]"}], "]"}], "]"}], "]"}]}], "}"}]}]}], 
            ";", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"keys", "[", 
              RowBox[{"[", "k", "]"}], "]"}], "->", 
             RowBox[{"DeleteCases", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"NumberQ", "[", "#", "]"}], ",", 
                    RowBox[{"StringQ", "[", "#", "]"}]}], "}"}], ",", 
                    "True"}], "]"}], ",", "#", ",", "\"\<\>\""}], "]"}], 
                 "&"}], "/@", "results"}], ",", "\"\<\>\""}], "]"}]}]}], ",", 
           RowBox[{"{", 
            RowBox[{"k", ",", 
             RowBox[{"Length", "@", "keys"}]}], "}"}]}], "]"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"result", "=", 
         RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"results", "=", 
            RowBox[{"Flatten", "@", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"dictReverse", "[", "#", "]"}], "&"}], "/@", 
               RowBox[{"entry", "[", 
                RowBox[{"[", "e", "]"}], "]"}]}], "}"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"result", "=", 
            RowBox[{"Append", "[", 
             RowBox[{"result", ",", 
              RowBox[{"DeleteCases", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"NumberQ", "[", "#", "]"}], ",", 
                    RowBox[{"StringQ", "[", "#", "]"}]}], "}"}], ",", 
                    "True"}], "]"}], ",", "#", ",", "\"\<\>\""}], "]"}], 
                  "&"}], "/@", "results"}], ",", "\"\<\>\""}], "]"}]}], 
             "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"e", ",", 
            RowBox[{"Length", "@", "entry"}]}], "}"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "result"}]}], "]"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.898763591273342*^9, 3.898763600829914*^9}, {
   3.898763638989543*^9, 3.898763723420701*^9}, {3.898764187884275*^9, 
   3.8987642230553527`*^9}, {3.8987642922441835`*^9, 3.898764328020875*^9}, {
   3.8987647368923326`*^9, 3.8987647608261604`*^9}, {3.8987652070731983`*^9, 
   3.8987652308883457`*^9}, {3.8987657843674765`*^9, 3.8987658180331416`*^9}, 
   3.8987658675167093`*^9, {3.8992057481988573`*^9, 3.8992057751446047`*^9}, {
   3.961249496016403*^9, 3.961249563331016*^9}},
 CellLabel->
  "In[245]:=",ExpressionUUID->"9f360a83-b7a3-4ef2-bf21-853cc855bf64"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{
       RowBox[{"-", "wordCounts"}], " ", "Association", " ", "of", " ", 
       "words"}], "-", "counts"}]}], ";", 
    RowBox[{
     RowBox[{"stemCounts", " ", "Association", " ", "of", " ", "stems"}], "-",
      "counts"}], ";", 
    RowBox[{"Output", ":", 
     RowBox[{
      RowBox[{"-", "Association"}], " ", "mapping", " ", "most", " ", 
      "common", " ", "word", " ", "per", " ", "stem", " ", "to", " ", "stem", 
      " ", "count"}]}], ";", 
    RowBox[{"Description", ":", 
     RowBox[{
     "Selects", " ", "the", " ", "most", " ", "common", " ", "word", " ", 
      "for", " ", "each", " ", "stem", " ", "and", " ", "returns", " ", "a", 
      " ", "cleaned", " ", 
      RowBox[{"association", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"BasicLemmatize", "[", 
    RowBox[{"wordCounts_", ",", "stemCounts_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"lemmas", ",", "allStems", ",", "wordStems", ",", "positions"}],
       "}"}], ",", "\n", 
     RowBox[{
      RowBox[{"lemmas", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"PickCommonestByStem", "[", 
           RowBox[{"#", ",", "wordCounts"}], "]"}], "&"}], "/@", 
         RowBox[{"Keys", "[", "stemCounts", "]"}]}], "]"}]}], ";", "\n", 
      RowBox[{"AssociationThread", "[", 
       RowBox[{"lemmas", "->", 
        RowBox[{"Values", "@", "stemCounts"}]}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8666278713779097`*^9, 3.8666279234466515`*^9}, {
   3.866627975528676*^9, 3.8666280230318613`*^9}, {3.8666292081729994`*^9, 
   3.8666292123421235`*^9}, 3.8666297714360056`*^9, {3.8666303390107117`*^9, 
   3.8666303537859297`*^9}, {3.866632543503714*^9, 3.8666326124376497`*^9}, 
   3.866632684473304*^9, 3.8666332777726107`*^9, {3.866647081376808*^9, 
   3.8666471319050856`*^9}, {3.866647165346982*^9, 3.866647196013547*^9}, {
   3.8824568693775663`*^9, 3.882456871914075*^9}, {3.9612194392210608`*^9, 
   3.961219440705553*^9}, {3.961230598189763*^9, 3.961230598565608*^9}, {
   3.961231474512412*^9, 3.961231502115596*^9}, {3.961231541527494*^9, 
   3.9612315559665537`*^9}, 3.961232777691169*^9, {3.961232874504258*^9, 
   3.961232881603787*^9}},
 CellLabel->
  "In[246]:=",ExpressionUUID->"7fb6d178-bf5c-4b12-b3ca-c892ebc6ca50"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "stem"}], " ", "single", " ", "word", " ", "stem", " ", 
      RowBox[{"(", "string", ")"}]}]}], ";", 
    RowBox[{
     RowBox[{"wordCounts", " ", "Association", " ", "of", " ", "words"}], "-",
      "counts"}], ";", 
    RowBox[{"Output", ":", 
     RowBox[{
      RowBox[{"-", "List"}], " ", "with", " ", "most", " ", "frequent", " ", 
      "word", " ", "matching", " ", "the", " ", "given", " ", "stem"}]}], ";", 
    RowBox[{"Description", ":", 
     RowBox[{
     "Finds", " ", "the", " ", "most", " ", "common", " ", "word", " ", 
      "that", " ", "matches", " ", "the", " ", "given", " ", 
      RowBox[{"stem", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"PickCommonestByStem", "[", 
    RowBox[{"stem_", ",", "wordCounts_"}], "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"Take", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"Pick", "[", 
        RowBox[{"#", ",", 
         RowBox[{
          RowBox[{"WordStem", "[", "#", "]"}], "==", "stem"}]}], "]"}], "&"}],
       "/@", 
      RowBox[{"Keys", "[", "wordCounts", "]"}]}], ",", "1"}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9612327852127542`*^9, 3.961232789505807*^9}},
 CellLabel->
  "In[247]:=",ExpressionUUID->"3d945910-909d-4cdc-9179-67ae84d91b4d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "sentenceList"}], " ", "list", " ", "of", " ", 
       "sentences", " ", "or", " ", "a", " ", "sentence", " ", "string"}]}], 
     ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "words", " ", "that", " ", 
       "are", " ", "valid", " ", "English", " ", "dictionary", " ", 
       "words"}]}]}], ",", 
    RowBox[{
     RowBox[{"with", " ", "stopwords", " ", "removed"}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Processes", " ", "input", " ", "sentences", " ", "by", " ", 
       "splitting", " ", "into", " ", "words"}]}]}], ",", 
    RowBox[{"removing", " ", "stopwords"}], ",", 
    RowBox[{
    "and", " ", "selecting", " ", "only", " ", "words", " ", "recognized", 
     " ", "by", " ", "the", " ", "English", " ", 
     RowBox[{"dictionary", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"PickCleanDictWordsFromSentences", "[", "sentenceList_", "]"}], ":=",
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Pick", "[", 
      RowBox[{"#", ",", 
       RowBox[{"DictionaryWordQ", "[", 
        RowBox[{"#", ",", 
         RowBox[{"Language", "->", "\"\<English\>\""}]}], "]"}]}], "]"}], 
     "&"}], "/@", 
    RowBox[{"DeleteStopwords", "[", 
     RowBox[{"WordsfromText", "[", "sentenceList", "]"}], 
     "]"}]}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8986774978448997`*^9, 3.8986775647646947`*^9}, {
   3.898677628157254*^9, 3.8986776724000916`*^9}, 3.8986791440882196`*^9, {
   3.898679251264384*^9, 3.8986792563622656`*^9}, {3.908875741462569*^9, 
   3.908875773090496*^9}, {3.9612494750014477`*^9, 3.961249477604344*^9}},
 CellLabel->
  "In[248]:=",ExpressionUUID->"34c9a1ed-193d-4ae1-abb2-92daa47bdead"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "sentence"}], " ", "input", " ", "string"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "words", " ", "with", " ", 
       "empty", " ", "strings", " ", "removed"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Splits", " ", "the", " ", "input", " ", "sentence", " ", "into", " ", 
       "words", " ", "by", " ", "punctuation", " ", "and", " ", "whitespace", 
       " ", "faster", " ", "than", " ", "inbuilt", " ", "function"}]}]}], ",", 
    RowBox[{
    "and", " ", "removes", " ", "any", " ", "empty", " ", "string", " ", 
     RowBox[{"entries", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"TextWordsFast", "[", "sentence_", "]"}], ":=", 
   RowBox[{"DeleteCases", "[", 
    RowBox[{
     RowBox[{"StringSplit", "[", 
      RowBox[{"sentence", ",", 
       RowBox[{"Alternatives", "@@", 
        RowBox[{"{", 
         RowBox[{"PunctuationCharacter", ",", "WhitespaceCharacter"}], 
         "}"}]}]}], "]"}], ",", "\"\<\>\""}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8973242236260805`*^9, 3.897324247219919*^9}, {
  3.8979868931839275`*^9, 3.897986899319559*^9}, {3.961249446496545*^9, 
  3.961249480254653*^9}},
 CellLabel->
  "In[249]:=",ExpressionUUID->"55ad26ed-3a2b-446d-968e-a57b09af5407"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "text"}], " ", "input", " ", "string"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "cleaned", " ", "words", " ", 
       "excluding", " ", "short", " ", "words"}]}]}], ",", "stopwords", ",", 
    RowBox[{
     RowBox[{"and", " ", "links"}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Splits", " ", "input", " ", "text", " ", "into", " ", "words"}]}]}], 
    ",", 
    RowBox[{"drops", " ", "short", " ", "words", " ", 
     RowBox[{"(", 
      RowBox[{"\[LessEqual]", 
       RowBox[{"1", " ", "character"}]}], ")"}]}], ",", 
    RowBox[{"common", " ", "and", " ", "archaic", " ", "stopwords"}], ",", 
    RowBox[{"and", " ", "any", " ", "words", " ", 
     RowBox[{"containing", "'"}], 
     RowBox[{"http", "'"}]}], ",", 
    RowBox[{"after", " ", "applying", " ", 
     RowBox[{"CleanText", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"WordsfromText", "[", "text_", "]"}], ":=", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "Turn", " ", "text", " ", "into", " ", "list", " ", "of", " ", "words"}],
      ",", " ", 
     RowBox[{
     "dropping", " ", "stopwords", " ", "and", " ", "\"\<like\>\""}]}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"Select", "[", 
    RowBox[{
     RowBox[{"StringSplit", "[", 
      RowBox[{
       RowBox[{"CleanText", "[", "text", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"PunctuationCharacter", ",", "WhitespaceCharacter"}], "}"}]}],
       "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"StringMatchQ", "[", 
         RowBox[{"#", ",", "\"\<amp\>\""}], "]"}], "==", "False"}], " ", "&&",
        " ", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"StringMatchQ", "[", 
         RowBox[{"#", ",", "\"\<re\>\""}], "]"}], "==", "False"}], " ", "&&", 
       " ", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"StringMatchQ", "[", 
         RowBox[{"#", ",", "\"\<ll\>\""}], "]"}], "==", "False"}], " ", "&&", 
       " ", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"StringMatchQ", "[", 
         RowBox[{"#", ",", "\"\<ve\>\""}], "]"}], "==", "False"}], " ", "&&", 
       " ", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"StringMatchQ", "[", 
         RowBox[{"#", ",", "\"\<thou\>\""}], "]"}], "==", "False"}], " ", "&&",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"StringMatchQ", "[", 
         RowBox[{"#", ",", "\"\<thy\>\""}], "]"}], "==", "False"}], " ", "&&",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"StringMatchQ", "[", 
         RowBox[{"#", ",", "\"\<thee\>\""}], "]"}], "==", "False"}], " ", "&&",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"StringMatchQ", "[", 
         RowBox[{"#", ",", "\"\<like\>\""}], "]"}], "==", "False"}], " ", "&&",
        "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"StringMatchQ", "[", 
         RowBox[{"#", ",", "\"\<et\>\""}], "]"}], "==", "False"}], " ", "&&", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"StringMatchQ", "[", 
         RowBox[{"#", ",", "\"\<al\>\""}], "]"}], "==", "False"}], " ", "&&", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"StringContainsQ", "[", 
         RowBox[{"#", ",", "\"\<http\>\""}], "]"}], "==", "False"}], " ", "&&",
        " ", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"StringLength", "@", "#"}], ">", "1"}]}], "&"}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.8586715291769733`*^9, {3.858744282229727*^9, 3.858744313387141*^9}, {
   3.858744347385375*^9, 3.8587443876331778`*^9}, {3.8587453798726807`*^9, 
   3.858745384439064*^9}, {3.8596242110162725`*^9, 3.8596242153537335`*^9}, 
   3.8596243649748783`*^9, {3.859889735531266*^9, 3.8598897600334654`*^9}, {
   3.8598903283437753`*^9, 3.859890335399673*^9}, {3.8599648255428724`*^9, 
   3.8599648424616075`*^9}, {3.859964878447649*^9, 3.85996487848201*^9}, {
   3.859964919723381*^9, 3.859964970097618*^9}, {3.8599650134128375`*^9, 
   3.859965107094345*^9}, {3.859965338924697*^9, 3.8599653575021253`*^9}, {
   3.859965498791048*^9, 3.8599655589886637`*^9}, {3.859965591522863*^9, 
   3.859965710138015*^9}, {3.8599669249464283`*^9, 3.859966938816934*^9}, 
   3.8599670013428164`*^9, {3.859967078174818*^9, 3.8599671307609158`*^9}, 
   3.859970570445038*^9, 3.8599833889165792`*^9, {3.860419308917619*^9, 
   3.860419324562298*^9}, {3.8604193594605856`*^9, 3.8604193978940506`*^9}, {
   3.860419545761531*^9, 3.860419588428836*^9}, {3.8604196232483873`*^9, 
   3.8604196491148806`*^9}, {3.864649177118921*^9, 3.8646491845797725`*^9}, {
   3.8647308672809095`*^9, 3.8647308755767336`*^9}, {3.882449041597864*^9, 
   3.8824490425935793`*^9}, {3.8844125262735023`*^9, 
   3.8844125281474266`*^9}, {3.8844129229476347`*^9, 
   3.8844129257214127`*^9}, {3.884414485994214*^9, 3.884414513842045*^9}, {
   3.884414578735817*^9, 3.8844145965639477`*^9}, {3.8844146853322077`*^9, 
   3.884414773123226*^9}, {3.884415568085493*^9, 3.8844155708758755`*^9}, {
   3.8844156645575743`*^9, 3.884415734371061*^9}, {3.88441588868552*^9, 
   3.8844159002308865`*^9}, {3.961230444595874*^9, 3.961230452708001*^9}, {
   3.961249392616946*^9, 3.9612494314597263`*^9}},
 CellLabel->
  "In[250]:=",ExpressionUUID->"113e5b04-264a-42f5-b034-87c002c1dad3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "text"}], " ", "input", " ", "string"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Cleaned"}], " ", "string", " ", "with", " ", 
       "diacritics", " ", "removed"}]}]}], ",", "lowercased", ",", 
    RowBox[{"non", "-", 
     RowBox[{"alphabetic", " ", "characters", " ", "filtered"}]}], ",", 
    RowBox[{
     RowBox[{"and", " ", "whitespace", " ", "normalized"}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Cleans", " ", "input", " ", "text", " ", "by", " ", "removing", " ", 
       "diacritics"}]}]}], ",", 
    RowBox[{
    "keeping", " ", "only", " ", "letters", " ", "and", " ", "select", " ", 
     "characters"}], ",", 
    RowBox[{"converting", " ", "to", " ", "lowercase"}], ",", 
    RowBox[{
    "and", " ", "collapsing", " ", "multiple", " ", "spaces", " ", "into", 
     " ", 
     RowBox[{"one", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CleanText", "[", "text_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"char", ",", "httplinks", ",", "textCleaned"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"char", "=", 
       RowBox[{"Characters", "[", 
        RowBox[{"RemoveDiacritics", "[", "text", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"textCleaned", "=", "\[IndentingNewLine]", 
       RowBox[{"ToLowerCase", "[", 
        RowBox[{"StringJoin", "[", 
         RowBox[{"Cases", "[", 
          RowBox[{"char", ",", " ", 
           RowBox[{
            RowBox[{"Alternatives", "@@", 
             RowBox[{"Alphabet", "[", "]"}]}], "|", 
            RowBox[{"Alternatives", "@@", 
             RowBox[{"ToUpperCase", "@", 
              RowBox[{"Alphabet", "[", "]"}]}]}], "|", "\"\<\n\>\"", "|", 
            "\"\< \>\"", "|", "\"\<\[CloseCurlyQuote]\>\"", "|", "\"\<'\>\"", 
            "|", "\"\<-\>\""}]}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"StringReplace", "[", 
       RowBox[{"textCleaned", ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\"\< \>\"", "~~", 
           RowBox[{"\"\< \>\"", ".."}]}], "->", "\"\< \>\""}], "}"}]}], 
       "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9612493706012573`*^9, 3.961249373196208*^9}},
 CellLabel->
  "In[251]:=",ExpressionUUID->"e022ed31-fc13-4691-a4e4-8b3e8bc54cd3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "text"}], " ", "input", " ", "string"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Cleaned"}], " ", "string", " ", "with", " ", 
       "URLs"}]}]}], ",", 
    RowBox[{"line", " ", "breaks"}], ",", 
    RowBox[{"hyphen", " ", "line", " ", "breaks"}], ",", 
    RowBox[{"unknown", " ", "glyphs"}], ",", 
    RowBox[{
     RowBox[{"and", " ", "extra", " ", "spaces", " ", "removed"}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Simplifies", " ", "text", " ", "by", " ", "removing", " ", 
       "URLs"}]}]}], ",", 
    RowBox[{"merging", " ", "lines"}], ",", 
    RowBox[{"removing", " ", "soft", " ", "hyphen", " ", "breaks"}], ",", 
    RowBox[{
    "and", " ", "collapsing", " ", "multiple", " ", "spaces", " ", "into", 
     " ", "a", " ", "single", " ", "space", " ", "for", " ", "cleaner", " ", 
     RowBox[{"processing", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CleanTextSimple", "[", "text_", "]"}], ":=", 
   RowBox[{"StringReplace", "[", 
    RowBox[{
     RowBox[{"StringReplace", "[", 
      RowBox[{"text", ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Shortest", "[", 
           RowBox[{"\"\<http\>\"", "~~", "___", "~~", "\"\< \>\""}], "]"}], 
          "->", "\"\<\>\""}], ",", 
         RowBox[{"\"\<\\n\>\"", "->", "\"\< \>\""}], ",", 
         RowBox[{
          RowBox[{"\"\<\\n\>\"", "~~", "\"\<\\n\>\""}], "->", "\"\<\\n\>\""}],
          ",", 
         RowBox[{"\"\<-\\n\>\"", "->", "\"\<\>\""}], ",", 
         RowBox[{"\"\<\.02\>\"", "->", "\"\<\>\""}], ",", 
         RowBox[{"\"\<\[UnknownGlyph]\>\"", "->", "\"\<\>\""}]}], "}"}]}], 
      "]"}], ",", 
     RowBox[{
      RowBox[{"\"\< \>\"", "~~", 
       RowBox[{"\"\< \>\"", ".."}]}], "->", "\"\< \>\""}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8971514050678377`*^9, 3.897151692074156*^9}, {
  3.897151722647626*^9, 3.89715177972756*^9}, {3.8971585587533937`*^9, 
  3.8971585892009325`*^9}, {3.8971586381698093`*^9, 3.897158654301543*^9}, {
  3.961250283220117*^9, 3.9612502959786587`*^9}},
 CellLabel->
  "In[252]:=",ExpressionUUID->"170128e4-7e00-4b01-966f-1643e29669fe"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "dirtyString"}], " ", "input", " ", "string", " ", "or", 
       " ", "expression"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "String"}], " ", "with", " ", "emoticons", " ", "removed",
        " ", "and", " ", "whitespace", " ", "trimmed"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{"Converts", " ", "input", " ", "to", " ", "string"}]}]}], ",", 
    RowBox[{"removes", " ", "any", " ", "emoticon", " ", "patterns"}], ",", 
    RowBox[{
    "trims", " ", "leading", " ", "and", " ", "trailing", " ", "spaces"}], 
    ",", 
    RowBox[{"and", " ", "returns", " ", "the", " ", "cleaned", " ", 
     RowBox[{"string", ".", 
      RowBox[{"Note", ":", 
       RowBox[{
       "the", " ", "DeleteCases", " ", "step", " ", "on", " ", "a", " ", 
        "string", " ", "has", " ", "no", " ", "effect", " ", "and", " ", 
        "can", " ", "be", " ", "removed", " ", "for", " ", 
        RowBox[{"clarity", "."}]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"CleanupString", "[", "dirtyString_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "result", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Remove", " ", "non"}], "-", 
       RowBox[{"string", " ", "elements"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"result", "=", 
       RowBox[{"ToString", "@", "dirtyString"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"result", "=", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{"result", ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"StringQ", "[", "#", "]"}]}], "&"}], ")"}]}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"result", "=", 
       RowBox[{"StringDelete", "[", 
        RowBox[{"result", ",", 
         RowBox[{"TextCases", "[", 
          RowBox[{"result", ",", "\"\<Emoticon\>\""}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"result", "=", 
       RowBox[{"StringTrim", "[", "result", "]"}]}], ";", 
      "\[IndentingNewLine]", "result"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8976784716202497`*^9, 3.897678482028698*^9}, {
   3.8976785814952183`*^9, 3.8976785931985273`*^9}, {3.8977291974151087`*^9, 
   3.897729242807627*^9}, {3.8977292912916136`*^9, 3.8977292936067266`*^9}, {
   3.897729534470559*^9, 3.897729546511258*^9}, {3.8977296841109934`*^9, 
   3.897729716926572*^9}, {3.8977297961565723`*^9, 3.8977298300061874`*^9}, {
   3.897729862676346*^9, 3.8977298732388353`*^9}, {3.8979200736421137`*^9, 
   3.8979200743915863`*^9}, {3.8979201672235713`*^9, 
   3.8979201689585714`*^9}, {3.897920637968278*^9, 3.897920696481103*^9}, {
   3.897973737163396*^9, 3.8979737384079065`*^9}, {3.897977192543251*^9, 
   3.897977195360806*^9}, {3.8979774504684663`*^9, 3.8979774541611567`*^9}, {
   3.8979783378367543`*^9, 3.8979783436401124`*^9}, {3.897978498149242*^9, 
   3.8979785040955825`*^9}, {3.8979786171749177`*^9, 3.897978618688425*^9}, {
   3.89797871480543*^9, 3.897978716240079*^9}, {3.8979789038696384`*^9, 
   3.897978909327732*^9}, {3.897979856229692*^9, 3.8979798579440255`*^9}, {
   3.897980084197816*^9, 3.8979800856807075`*^9}, {3.8979802785426054`*^9, 
   3.8979802825121155`*^9}, {3.897980428367154*^9, 3.897980430112994*^9}, {
   3.897984443992441*^9, 3.8979844458735337`*^9}, {3.897985076997661*^9, 
   3.8979850779452267`*^9}, {3.8979886143920465`*^9, 3.897988615985808*^9}, {
   3.89798879840656*^9, 3.8979887985535803`*^9}, {3.8979888588140273`*^9, 
   3.897988864385317*^9}, 3.8979889606073627`*^9, 3.897989006110366*^9, {
   3.8979892819187803`*^9, 3.8979892825772333`*^9}, {3.8980791353581324`*^9, 
   3.8980791392304597`*^9}, {3.8997539392469187`*^9, 
   3.8997539398132887`*^9}, {3.9612503712292557`*^9, 3.961250374149473*^9}},
 CellLabel->
  "In[253]:=",ExpressionUUID->"6833b156-9d15-4c96-95b4-6b3056262deb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "sentence"}], " ", "input", " ", "string"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Integer"}], " ", "count", " ", "of", " ", "English", " ",
        "dictionary", " ", "words", " ", "in", " ", "the", " ", 
       "sentence"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Splits", " ", "the", " ", "input", " ", "sentence", " ", "into", " ", 
       "words"}]}]}], ",", 
    RowBox[{"removes", " ", "numeric", " ", "tokens"}], ",", 
    RowBox[{
    "checks", " ", "each", " ", "word", " ", "against", " ", "the", " ", 
     "English", " ", "dictionary"}], ",", 
    RowBox[{
    "and", " ", "returns", " ", "the", " ", "count", " ", "of", " ", "valid", 
     " ", "dictionary", " ", 
     RowBox[{"words", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"DictWordCount", "[", "sentence_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "words", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"words", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Pick", "[", 
          RowBox[{"#", ",", 
           RowBox[{
            RowBox[{"DigitQ", "[", "#", "]"}], "==", "False"}]}], "]"}], 
         "&"}], "/@", 
        RowBox[{"TextWordsFast", "[", "sentence", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Count", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"DictionaryWordQ", "[", 
           RowBox[{"#", ",", 
            RowBox[{"Language", "->", "\"\<English\>\""}]}], "]"}], "&"}], "/@",
          "words"}], ",", "True"}], "]"}]}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8637932028776083`*^9, 3.8637932611006365`*^9}, {
  3.8637947258331585`*^9, 3.863794760614162*^9}, {3.8973239016570625`*^9, 
  3.8973239434879365`*^9}, {3.897324262933507*^9, 3.897324266119738*^9}, {
  3.908877785094677*^9, 3.908877805921939*^9}, {3.9612502358655167`*^9, 
  3.961250242938108*^9}},
 CellLabel->
  "In[254]:=",ExpressionUUID->"770c88d7-8915-4cd2-bceb-6979faad3602"]
}, Closed]],

Cell[CellGroupData[{

Cell["Helper Functions Wikipedia", "Subtitle",
 CellChangeTimes->{{3.873539554198429*^9, 3.87353956385848*^9}, {
  3.873539727707151*^9, 3.873539729825041*^9}, {3.898786755033476*^9, 
  3.89878675719049*^9}, {3.9195250564585123`*^9, 3.919525058078289*^9}, {
  3.96122961641267*^9, 3.961229617341092*^9}, {3.9612526416987667`*^9, 
  3.9612526596837482`*^9}},ExpressionUUID->"2593f6a9-6bb7-48b7-ab5f-\
0c95a00148a1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Input", ":", 
     RowBox[{
      RowBox[{"-", "titles"}], " ", "list", " ", "of", " ", "Wikipedia", " ", 
      "page", " ", "titles"}]}], ",", 
    RowBox[{
     RowBox[{"-", "place"}], " ", "string", " ", "indicating", " ", "data", 
     " ", "source"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "type"}], " ", "string", " ", "indicating", " ", "entry", 
      " ", "type"}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "List"}], " ", "of", " ", "associations", " ", "with", 
       " ", "pageID"}]}]}], ",", "pageTitle", ",", "source", ",", 
    RowBox[{"and", " ", "type"}], ",", 
    RowBox[{
     RowBox[{
      RowBox[{"excluding", " ", "entries", " ", "with", " ", "non"}], "-", 
      RowBox[{"string", " ", "values"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Retrieves", " ", "Wikipedia", " ", "page", " ", "IDs", " ", "for", " ",
        "a", " ", "list", " ", "of", " ", "titles"}]}]}], ",", 
    RowBox[{
    "constructs", " ", "metadata", " ", "associations", " ", "for", " ", 
     "each"}], ",", 
    RowBox[{
    "and", " ", "removes", " ", "any", " ", "incomplete", " ", "or", " ", 
     "invalid", " ", 
     RowBox[{"entries", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"MetadataFromWikiTitles", "[", 
    RowBox[{"titles_", ",", "place_", ",", "type_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"ids", ",", "data"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"ids", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"WikipediaData", "[", 
             RowBox[{
              RowBox[{"titles", "[", 
               RowBox[{"[", "i", "]"}], "]"}], ",", "\"\<PageID\>\""}], "]"}],
             ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "@", "titles"}]}], "}"}]}], "]"}]}], ";"}], 
        ",", 
        RowBox[{"\"\<Collecting data for \>\"", "<>", 
         RowBox[{"ToString", "@", "i"}], "<>", "\"\< of \>\"", "<>", 
         RowBox[{"ToString", "@", 
          RowBox[{"Length", "@", "titles"}]}], "<>", "\"\< pages\>\""}]}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"data", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Association", "[", 
          RowBox[{
           RowBox[{"\"\<pageID\>\"", "->", 
            RowBox[{"ids", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ",", 
           RowBox[{"\"\<pageTitle\>\"", "->", 
            RowBox[{"titles", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], ",", 
           RowBox[{"\"\<source\>\"", "->", "place"}], ",", 
           RowBox[{"\"\<type\>\"", "->", "type"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", 
           RowBox[{"Length", "@", "ids"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Delete", "[", 
       RowBox[{"data", ",", 
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"AllTrue", "[", 
             RowBox[{
              RowBox[{"Values", "[", "#", "]"}], ",", "StringQ"}], "]"}], 
            "&"}], "/@", "data"}], ",", "False"}], "]"}]}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.91966900505661*^9, 3.919669216845251*^9}, {
  3.9196692742071548`*^9, 3.9196692877786875`*^9}, {3.919669466598303*^9, 
  3.9196694694027243`*^9}, {3.91966968117839*^9, 3.919669683122235*^9}, {
  3.9196714527647*^9, 3.9196714633420057`*^9}, {3.919671517594611*^9, 
  3.9196715244080496`*^9}, {3.96124966499603*^9, 3.961249666885312*^9}},
 CellLabel->
  "In[255]:=",ExpressionUUID->"d5f451bc-6ea6-4a17-80c9-0793d3addf54"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "params"}], " ", "association", " ", "or", " ", "list", 
       " ", "of", " ", "query", " ", "parameters"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "JSON"}], " ", "response", " ", "from", " ", "the", " ", 
       "Wikipedia", " ", "API"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Builds", " ", "a", " ", "full", " ", "URL", " ", "with", " ", "given", 
       " ", "parameters"}]}]}], ",", 
    RowBox[{
    "sends", " ", "an", " ", "HTTP", " ", "request", " ", "to", " ", "the", 
     " ", "Wikipedia", " ", "API"}], ",", 
    RowBox[{
    "and", " ", "returns", " ", "the", " ", "parsed", " ", "JSON", " ", 
     RowBox[{"response", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"apiUrl", "=", "\"\<https://en.wikipedia.org/w/api.php\>\""}], 
    ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "Function", " ", "to", " ", "perform", " ", "the", " ", "API", " ", 
     "request"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"performRequest", "[", "params_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"fullUrl", ",", "response"}], "}"}], ",", 
       RowBox[{
        RowBox[{"fullUrl", "=", 
         RowBox[{"URLBuild", "[", 
          RowBox[{"apiUrl", ",", "params"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"response", "=", 
         RowBox[{"Import", "[", 
          RowBox[{"fullUrl", ",", "\"\<JSON\>\""}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "response", "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "Function", " ", "to", " ", "fetch", " ", "all", " ", "backlinks", " ", 
     "with", " ", "manual", " ", "handling", " ", "of", " ", "continuation"}],
     "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"fetchAllBacklinks", "[", "title_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"initialParams", ",", "response", ",", "pageIDs", ",", 
         RowBox[{"allPageIDs", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"continueParam", "=", 
          RowBox[{"{", "}"}]}]}], "}"}], ",", 
       RowBox[{
        RowBox[{"initialParams", "=", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"\"\<action\>\"", "->", "\"\<query\>\""}], ",", 
           RowBox[{"\"\<format\>\"", "->", "\"\<json\>\""}], ",", 
           RowBox[{"\"\<list\>\"", "->", "\"\<backlinks\>\""}], ",", 
           RowBox[{"\"\<bltitle\>\"", "->", "title"}], ",", 
           RowBox[{"\"\<bllimit\>\"", "->", "\"\<500\>\""}], ",", 
           RowBox[{"\"\<blnamespace\>\"", "->", "\"\<0\>\""}]}], "}"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"While", "[", 
         RowBox[{"True", ",", 
          RowBox[{
           RowBox[{"response", "=", 
            RowBox[{"performRequest", "[", 
             RowBox[{"Join", "[", 
              RowBox[{"initialParams", ",", "continueParam"}], "]"}], "]"}]}],
            ";", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"response", "===", "$Failed"}], ",", 
             RowBox[{"Break", "[", "]"}]}], "]"}], ";", 
           RowBox[{"(*", 
            RowBox[{"Error", " ", "check"}], "*)"}], 
           RowBox[{"pageIDs", "=", 
            RowBox[{"\"\<pageid\>\"", "/.", " ", 
             RowBox[{"(", 
              RowBox[{"\"\<backlinks\>\"", "/.", " ", 
               RowBox[{"(", 
                RowBox[{"\"\<query\>\"", "/.", " ", "response"}], ")"}]}], 
              ")"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"allPageIDs", "=", 
            RowBox[{"Join", "[", 
             RowBox[{"allPageIDs", ",", "pageIDs"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"!", 
              RowBox[{"KeyExistsQ", "[", 
               RowBox[{"response", ",", "\"\<continue\>\""}], "]"}]}], ",", 
             RowBox[{"Break", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"continueParam", "=", 
            RowBox[{"Normal", "[", 
             RowBox[{"\"\<continue\>\"", "/.", " ", "response"}], "]"}]}], 
           ";"}]}], "]"}], ";", "\[IndentingNewLine]", "allPageIDs"}]}], 
      "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.909232618298855*^9, 3.9092326183012457`*^9}, {
  3.909234805259877*^9, 3.909234805861032*^9}, {3.909235464950397*^9, 
  3.909235473912002*^9}, {3.909235509495194*^9, 3.909235509809301*^9}, {
  3.961249644865408*^9, 3.961249651153957*^9}},
 CellLabel->
  "In[256]:=",ExpressionUUID->"afd0d194-1282-4e86-9f91-d627c316a1be"]
}, Closed]],

Cell[CellGroupData[{

Cell["Helper Functions Setup", "Subtitle",
 CellChangeTimes->{{3.898063417685889*^9, 3.8980634241293945`*^9}, {
  3.898063455525037*^9, 3.898063469740698*^9}, {3.8980689923009634`*^9, 
  3.8980689967895722`*^9}, {3.8998064357255993`*^9, 3.89980643994103*^9}, {
  3.8998067303640494`*^9, 3.8998067392798367`*^9}, {3.904204443063366*^9, 
  3.9042044469781103`*^9}, {3.961252653351315*^9, 
  3.961252670830482*^9}},ExpressionUUID->"ec56749a-742d-49a9-b63f-\
84e3e46520c5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "repoFolder"}], " ", "base", " ", "repository", " ", 
       "folder", " ", "path"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Loads"}], " ", "global", " ", "variables", " ", "and", 
       " ", "prints", " ", "status", " ", "message"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{"Loads", " ", "all", " ", "necessary", " ", "functions"}]}]}], 
    ",", "classifiers", ",", "dictionaries", ",", "models", ",", 
    RowBox[{
    "and", " ", "SOM", " ", "structures", " ", "from", " ", "the", " ", 
     "specified", " ", "repository", " ", "folder"}], ",", 
    RowBox[{"sets", " ", "global", " ", "variables"}], ",", 
    RowBox[{"monitors", " ", "loading", " ", "progress"}], ",", 
    RowBox[{
    "and", " ", "checks", " ", "that", " ", "all", " ", "required", " ", 
     "expressions", " ", "were", " ", "loaded", " ", 
     RowBox[{"successfully", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"LoadClipediaSetup", "[", "repoFolder_", "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"status", ",", "inputs"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"status", "=", "\"\<\>\""}], ";", "\[IndentingNewLine]", 
      RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"imgFolder", "=", 
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{"repoFolder", ",", "\"\<data\>\"", ",", "\"\<img\>\""}], 
            "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"textFolder", "=", 
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{"repoFolder", ",", "\"\<data\>\"", ",", "\"\<text\>\""}], 
            "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"status", "=", "\"\<Loading functions (1/3)\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"refClassifier", "=", 
          RowBox[{"Import", "[", 
           RowBox[{
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{
              "repoFolder", ",", "\"\<code\>\"", ",", "\"\<functions\>\"", 
               ",", "\"\<220704_refClassifier.wxf\>\""}], "}"}], "]"}], ",", 
            RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"iconClassifier", "=", 
          RowBox[{"Import", "[", 
           RowBox[{
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{
              "repoFolder", ",", "\"\<code\>\"", ",", "\"\<functions\>\"", 
               ",", "\"\<240317_wikiIconClassifier.wxf\>\""}], "}"}], "]"}], 
            ",", 
            RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"flagClassifier", "=", 
          RowBox[{"Import", "[", 
           RowBox[{
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{
              "repoFolder", ",", "\"\<code\>\"", ",", "\"\<functions\>\"", 
               ",", "\"\<240317_wikiFlagClassifier.wxf\>\""}], "}"}], "]"}], 
            ",", 
            RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"status", "=", "\"\<Loading dictionaries (2/3)\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dict", "=", 
          RowBox[{"Import", "[", 
           RowBox[{
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{
              "repoFolder", ",", "\"\<code\>\"", ",", "\"\<dictionaries\>\"", 
               ",", "\"\<230724_dictFull.wxf\>\""}], "}"}], "]"}], ",", 
            RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dictReverse", "=", 
          RowBox[{"Import", "[", 
           RowBox[{
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{
              "repoFolder", ",", "\"\<code\>\"", ",", "\"\<dictionaries\>\"", 
               ",", "\"\<230724_dictFullReverse.wxf\>\""}], "}"}], "]"}], ",", 
            RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"dictWeights", "=", 
          RowBox[{"Import", "[", 
           RowBox[{
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{
              "repoFolder", ",", "\"\<code\>\"", ",", "\"\<dictionaries\>\"", 
               ",", "\"\<231026_dictWeights.wxf\>\""}], "}"}], "]"}], ",", 
            RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"$idTitleIndex", "=", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"FileExistsQ", "[", "#", "]"}], ",", 
              RowBox[{"Import", "[", "#", "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"Join", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Import", "[", 
                 RowBox[{
                  RowBox[{"FileNameJoin", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    "repoFolder", ",", "\"\<data\>\"", ",", "\"\<indices\>\"",
                     ",", "\"\<idTitleIndex_1.wxf\>\""}], "}"}], "]"}], ",", 
                  RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{"Import", "[", 
                 RowBox[{
                  RowBox[{"FileNameJoin", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    "repoFolder", ",", "\"\<data\>\"", ",", "\"\<indices\>\"",
                     ",", "\"\<idTitleIndex_2.wxf\>\""}], "}"}], "]"}], ",", 
                  RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{"Import", "[", 
                 RowBox[{
                  RowBox[{"FileNameJoin", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    "repoFolder", ",", "\"\<data\>\"", ",", "\"\<indices\>\"",
                     ",", "\"\<idTitleIndex_3.wxf\>\""}], "}"}], "]"}], ",", 
                  RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}]}],
                "]"}]}], "]"}], "&"}], "@", 
           RowBox[{"FileNameJoin", "[", 
            RowBox[{"{", 
             RowBox[{
             "repoFolder", ",", "\"\<data\>\"", ",", "\"\<indices\>\"", ",", 
              "\"\<idTitleIndex.wxf\>\""}], "}"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"$imgHashIndex", "=", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"FileExistsQ", "[", "#", "]"}], ",", 
              RowBox[{"Import", "[", "#", "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"Join", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Import", "[", 
                 RowBox[{
                  RowBox[{"FileNameJoin", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    "repoFolder", ",", "\"\<data\>\"", ",", "\"\<indices\>\"",
                     ",", "\"\<imgHashIndex_1.wxf\>\""}], "}"}], "]"}], ",", 
                  RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{"Import", "[", 
                 RowBox[{
                  RowBox[{"FileNameJoin", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    "repoFolder", ",", "\"\<data\>\"", ",", "\"\<indices\>\"",
                     ",", "\"\<imgHashIndex_2.wxf\>\""}], "}"}], "]"}], ",", 
                  RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}], 
                ",", "\[IndentingNewLine]", 
                RowBox[{"Import", "[", 
                 RowBox[{
                  RowBox[{"FileNameJoin", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    "repoFolder", ",", "\"\<data\>\"", ",", "\"\<indices\>\"",
                     ",", "\"\<imgHashIndex_3.wxf\>\""}], "}"}], "]"}], ",", 
                  RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}]}],
                "]"}]}], "]"}], "&"}], "@", 
           RowBox[{"FileNameJoin", "[", 
            RowBox[{"{", 
             RowBox[{
             "repoFolder", ",", "\"\<data\>\"", ",", "\"\<indices\>\"", ",", 
              "\"\<imgHashIndex.wxf\>\""}], "}"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"status", "=", "\"\<Loading models (3/3)\>\""}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"textModel", "=", 
          RowBox[{"Import", "[", 
           RowBox[{
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{
              "repoFolder", ",", "\"\<code\>\"", ",", "\"\<models\>\"", ",", 
               "\"\<OpenCLIP_fe_textViT-B32.wxf\>\""}], "}"}], "]"}], ",", 
            RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"imgModel", "=", 
          RowBox[{"Import", "[", 
           RowBox[{
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{
              "repoFolder", ",", "\"\<code\>\"", ",", "\"\<models\>\"", ",", 
               "\"\<OpenCLIP_fe_imgViT-B32.wxf\>\""}], "}"}], "]"}], ",", 
            RowBox[{"IncludeMetaInformation", "->", "None"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"clipedia", "=", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"DirectoryQ", "[", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{
               "repoFolder", ",", "\"\<soms\>\"", ",", "\"\<240805\>\""}], 
               "}"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{"Import", "[", 
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{
                 "repoFolder", ",", "\"\<soms\>\"", ",", "\"\<240805\>\"", 
                  ",", "\"\<globalSom.wxf\>\""}], "}"}], "]"}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Association", "[", 
               RowBox[{"\"\<soms\>\"", "->", 
                RowBox[{"Join", "[", 
                 RowBox[{
                  RowBox[{"Import", "[", 
                   RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "repoFolder", ",", "\"\<soms\>\"", ",", "\"\<240805\>\"", 
                    ",", "\"\<localSoms_0-512.wxf\>\""}], "}"}], "]"}], "]"}],
                   ",", "\[IndentingNewLine]", 
                  RowBox[{"Import", "[", 
                   RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    "repoFolder", ",", "\"\<soms\>\"", ",", "\"\<240805\>\"", 
                    ",", "\"\<localSoms_513-1024.wxf\>\""}], "}"}], "]"}], 
                   "]"}]}], "]"}]}], "]"}]}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Import", "[", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{
               "repoFolder", ",", "\"\<soms\>\"", ",", "\"\<som.wxf\>\""}], 
               "}"}], "]"}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
        ",", "status"}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"inputs", "=", 
       RowBox[{"{", 
        RowBox[{
        "refClassifier", ",", "iconClassifier", ",", "flagClassifier", ",", 
         "dict", ",", "dictReverse", ",", "dictWeights", ",", "clipedia", ",",
          "$idTitleIndex", ",", "imgModel", ",", "textModel"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"AnyTrue", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ByteCount", "[", "#", "]"}], "&"}], "/@", "inputs"}], 
          ",", 
          RowBox[{
           RowBox[{"#", "<", "100"}], "&"}]}], "]"}], ",", 
        RowBox[{
        "Print", "[", "\"\<Not all necessary dependencies found.\>\"", "]"}], 
        ",", 
        RowBox[{
        "Print", "[", "\"\<Everything seems to have loaded correctly.\>\"", 
         "]"}]}], "]"}], ";"}]}], "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.899441192492708*^9, {3.8994436685847836`*^9, 3.8994436963609657`*^9}, {
   3.8994438410488176`*^9, 3.899443849840599*^9}, 3.8994447865042105`*^9, 
   3.899956502039536*^9, {3.899956563772621*^9, 3.899956578345902*^9}, {
   3.899984163386012*^9, 3.89998417513667*^9}, 3.899984533106001*^9, {
   3.90420244747628*^9, 3.904202448549857*^9}, {3.904202495296566*^9, 
   3.90420251327172*^9}, {3.904202604146509*^9, 3.904202605857449*^9}, {
   3.9042027420636387`*^9, 3.9042027513458548`*^9}, {3.9042028983095627`*^9, 
   3.9042029399866257`*^9}, {3.904202991412375*^9, 3.904203029785606*^9}, {
   3.904203100887692*^9, 3.9042031182621527`*^9}, {3.904203216352214*^9, 
   3.9042032218308496`*^9}, {3.904203493147544*^9, 3.904203922613688*^9}, {
   3.9042039561445837`*^9, 3.904204005253192*^9}, {3.9042150435711613`*^9, 
   3.904215043742423*^9}, {3.904221743258103*^9, 3.904221750190971*^9}, {
   3.904304085625057*^9, 3.9043040958036413`*^9}, {3.9046413502705803`*^9, 
   3.904641388552191*^9}, {3.904641443362884*^9, 3.904641446363988*^9}, {
   3.907262394175229*^9, 3.907262394336375*^9}, {3.9075811528313284`*^9, 
   3.907581163173117*^9}, {3.90758530751924*^9, 3.9075854972863483`*^9}, {
   3.9075855863906417`*^9, 3.9075856696589923`*^9}, {3.907587767233144*^9, 
   3.907587782032865*^9}, 3.9075883612044783`*^9, {3.919524196722929*^9, 
   3.9195242477446995`*^9}, {3.919525455780429*^9, 3.9195254561360006`*^9}, {
   3.919665775955868*^9, 3.9196657780046034`*^9}, {3.9196883035327907`*^9, 
   3.919688316934601*^9}, {3.919700150552641*^9, 3.919700196566946*^9}, {
   3.919856944985797*^9, 3.919856962563909*^9}, {3.919857097963443*^9, 
   3.9198571255984097`*^9}, {3.919869695162841*^9, 3.9198696995436473`*^9}, {
   3.9354740042075653`*^9, 3.93547401974186*^9}, {3.935638251615601*^9, 
   3.935638284649413*^9}, {3.935639006854259*^9, 3.935639020209313*^9}, {
   3.935639313501583*^9, 3.935639315531384*^9}, {3.935677041092618*^9, 
   3.935677077530903*^9}, {3.93572296625848*^9, 3.935722972071745*^9}, {
   3.9360866036842413`*^9, 3.9360866155857887`*^9}, 3.936158406044553*^9, 
   3.936260443047882*^9, {3.9378837846683197`*^9, 3.937883858252007*^9}, {
   3.93788391470951*^9, 3.937883963545931*^9}, {3.9378841382162333`*^9, 
   3.937884147934505*^9}, {3.938017761106761*^9, 3.938017764607584*^9}, {
   3.940414352233798*^9, 3.940414352408947*^9}, {3.94142715931583*^9, 
   3.9414271716352863`*^9}, {3.961216450079549*^9, 3.961216450529674*^9}, {
   3.961216574141068*^9, 3.961216577256065*^9}, {3.9612170978231487`*^9, 
   3.961217431688951*^9}, {3.9612176558878813`*^9, 3.961217655920927*^9}, {
   3.961250451942721*^9, 3.961250454597875*^9}, {3.961253244846977*^9, 
   3.961253314867258*^9}, {3.9612533910576468`*^9, 3.961253391109803*^9}, 
   3.961254129887195*^9, {3.961321234679759*^9, 3.9613213031678534`*^9}, {
   3.9613215197241173`*^9, 3.961321528169724*^9}, {3.96142889069349*^9, 
   3.961428891037108*^9}, {3.9614289881428947`*^9, 3.9614290618427677`*^9}, 
   3.961429220318572*^9, {3.961429254092585*^9, 3.961429254398934*^9}, 
   3.961465735458331*^9, {3.961468705352562*^9, 3.961468790606041*^9}, {
   3.961469395808495*^9, 3.961469402149268*^9}, {3.961469582017775*^9, 
   3.961469587240777*^9}, 3.961473205213065*^9, {3.961473235605064*^9, 
   3.961473236776928*^9}},
 CellLabel->"",ExpressionUUID->"6e53bfe4-0bf1-4969-97eb-1d9e1691b74f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"CLIPedia", " ", "requires", " ", "OpenCLIP", " ", "to", " ", 
     RowBox[{"work", ".", " ", "This"}], " ", "function", " ", "download", 
     " ", "the", " ", "OpenCLIP", " ", "models", " ", "from", " ", "the", " ",
      "Wolfram", " ", "Net", " ", 
     RowBox[{"Repository", ".", " ", "By"}], " ", "using", " ", "it"}], ",", 
    " ", 
    RowBox[{"you", " ", "accept", " ", 
     RowBox[{"OpenClip", "'"}], "s", " ", "license", " ", "and", " ", 
     RowBox[{"terms", ".", " ", "OpenCLIP"}], " ", "was", " ", "published", 
     " ", "with", " ", "a", " ", "paper", " ", "by", " ", 
     RowBox[{"M", ".", "Cherti"}]}], ",", 
    RowBox[{"R", ".", "Beaumont"}], ",", 
    RowBox[{"R", ".", "Wightman"}], ",", 
    RowBox[{"M", ".", "Wortsman"}], ",", 
    RowBox[{"G", ".", "Ilharco"}], ",", 
    RowBox[{"C", ".", "Gordon"}], ",", 
    RowBox[{"C", ".", "Schuhmann"}], ",", 
    RowBox[{"L", ".", "Schmidt"}], ",", 
    RowBox[{"J", ".", "Jitsev"}], ",", 
    RowBox[{
    "\"\<Reproducible Scaling Laws for Contrastive Language\[Dash]Image \
Learning,\>\"", " ", 
     RowBox[{"arXiv", ":", 
      RowBox[{"2212.07143", " ", 
       RowBox[{
        RowBox[{"(", "2022", ")"}], "."}]}]}]}]}], "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Input", ":", 
      RowBox[{
       RowBox[{"-", "repoFolder"}], " ", "base", " ", "repository", " ", 
       "folder", " ", "path"}]}], ";", 
     RowBox[{"Output", ":", 
      RowBox[{
       RowBox[{"-", "Downloads"}], " ", "and", " ", "saves", " ", "OpenCLIP", 
       " ", "image", " ", "and", " ", "text", " ", "models", " ", "to", " ", 
       "local", " ", "files", " ", "if", " ", "not", " ", "already", " ", 
       "present"}]}], ";", 
     RowBox[{"Description", ":", 
      RowBox[{
      "Checks", " ", "for", " ", "the", " ", "presence", " ", "of", " ", 
       "OpenCLIP", " ", "image", " ", "and", " ", "text", " ", "feature", " ",
        "extractor", " ", "models", " ", "in", " ", "the", " ", "repository", 
       " ", "folder"}]}], ";", 
     RowBox[{"if", " ", "missing"}]}], ",", 
    RowBox[{
     RowBox[{
     "downloads", " ", "them", " ", "using", " ", "NetModel", " ", "and", " ",
       "exports", " ", "them", " ", 
      RowBox[{"as", ".", "wxf"}], " ", "files"}], ";", 
     RowBox[{
     "prints", " ", "status", " ", "messages", " ", "indicating", " ", 
      "success", " ", "or", " ", 
      RowBox[{"failure", "."}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"DownloadCLIP", "[", "repoFolder_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"imgModelPath", ",", "txtModelPath"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"imgModelPath", "=", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{
         "$repoFolder", ",", "\"\<code\>\"", ",", "\"\<models\>\"", ",", 
          "\"\<OpenCLIP_fe_imgViT-B32.wxf\>\""}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"txtModelPath", "=", "\[IndentingNewLine]", 
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{
         "$repoFolder", ",", "\"\<code\>\"", ",", "\"\<models\>\"", ",", 
          "\"\<OpenCLIP_fe_textViT-B32.wxf\>\""}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FileExistsQ", "[", "imgModelPath", "]"}], "&&", 
         RowBox[{"FileExistsQ", "[", "txtModelPath", "]"}]}], ",", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<OpenCLIP models already downloaded at: \>\"", "<>", 
          RowBox[{"FileNameJoin", "[", 
           RowBox[{"{", 
            RowBox[{
            "repoFolder", ",", "\"\<code\>\"", ",", "\"\<models\>\""}], "}"}],
            "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Quiet", "@", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"FileExistsQ", "[", "imgModelPath", "]"}]}], ",", 
            RowBox[{"Export", "[", 
             RowBox[{"imgModelPath", ",", 
              RowBox[{"NetModel", "[", 
               RowBox[{"{", 
                RowBox[{
                "\"\<OpenCLIP Multi-domain Feature Extractor Trained on \
LAION-2B Data\>\"", ",", 
                 RowBox[{"\"\<InputDomain\>\"", "->", "\"\<Image\>\""}], ",", 
                 RowBox[{"\"\<Architecture\>\"", "->", "\"\<ViT-B/32\>\""}]}],
                 "}"}], "]"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Quiet", "@", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"!", 
             RowBox[{"FileExistsQ", "[", "txtModelPath", "]"}]}], ",", 
            RowBox[{"Export", "[", 
             RowBox[{"txtModelPath", ",", 
              RowBox[{"NetModel", "[", 
               RowBox[{"{", 
                RowBox[{
                "\"\<OpenCLIP Multi-domain Feature Extractor Trained on \
LAION-2B Data\>\"", ",", 
                 RowBox[{"\"\<InputDomain\>\"", "->", "\"\<Text\>\""}], ",", 
                 RowBox[{"\"\<Architecture\>\"", "->", "\"\<ViT-B/32\>\""}]}],
                 "}"}], "]"}]}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"FileExistsQ", "[", "imgModelPath", "]"}], "&&", 
            RowBox[{"FileExistsQ", "[", "txtModelPath", "]"}]}], ",", 
           RowBox[{"Print", "[", 
            RowBox[{"\"\<OpenCLIP model files downloaded to: \>\"", "<>", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{
               "repoFolder", ",", "\"\<code\>\"", ",", "\"\<models\>\""}], 
               "}"}], "]"}]}], "]"}], ",", 
           RowBox[{
           "Print", "[", 
            "\"\<There was a problem downloading. Please check your internet \
connection or download manually.\>\"", "]"}]}], "]"}]}]}], "]"}]}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.9613221924127293`*^9, 3.961322227381443*^9}, {
   3.961322301214973*^9, 3.961322556303977*^9}, 3.9613226219291477`*^9, {
   3.9613231424432993`*^9, 3.9613231436823072`*^9}, {3.961323201519827*^9, 
   3.9613232419726973`*^9}, {3.961323389822466*^9, 3.9613233902789507`*^9}, 
   3.961323438336255*^9, {3.961323504318699*^9, 3.961323617081801*^9}, {
   3.9613240498166857`*^9, 3.961324147308041*^9}},
 CellLabel->
  "In[133]:=",ExpressionUUID->"d3414f19-a7dd-46d0-ab0e-7b1576854d8d"]
}, Closed]]
}, Open  ]]
},
WindowSize->{1118, 998},
WindowMargins->{{290, Automatic}, {Automatic, 0}},
Visible->True,
FrontEndVersion->"13.2 for Mac OS X ARM (64-bit) (January 30, 2023)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"dfc2e30a-b56d-4caa-a7b9-9361fc7a253b"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 236, 5, 30, "Input",ExpressionUUID->"482df6d1-6718-4995-83cd-83f6b39aaf6e"],
Cell[CellGroupData[{
Cell[819, 29, 1024, 16, 162, "Subtitle",ExpressionUUID->"1c7df667-3ad4-415a-bca4-612f59ef41f7"],
Cell[1846, 47, 891, 14, 104, "Text",ExpressionUUID->"b1691db3-b98d-4e99-94cd-dc9182a0b0d3"]
}, Open  ]],
Cell[CellGroupData[{
Cell[2774, 66, 238, 5, 98, "Title",ExpressionUUID->"9816041d-7eea-4fca-ba1b-6851b1373bc7"],
Cell[3015, 73, 175, 3, 30, "Input",ExpressionUUID->"3f0b3048-b73a-4be4-9941-16ae5a07ab58"],
Cell[CellGroupData[{
Cell[3215, 80, 218, 4, 53, "Subtitle",ExpressionUUID->"0f4777f8-7495-4237-8c01-3ebb7d0374c2"],
Cell[3436, 86, 3555, 88, 70, "Input",ExpressionUUID->"e6de6d9e-4a15-4682-9603-9588fe2a8cd9",
 InitializationCell->True],
Cell[6994, 176, 6608, 159, 70, "Input",ExpressionUUID->"e29c5b91-4016-4420-8681-62b31c4606c5",
 InitializationCell->True],
Cell[13605, 337, 2501, 59, 70, "Code",ExpressionUUID->"f22eacac-6f2d-402c-97ca-2b6fa2227c6f",
 CellID->1455332261],
Cell[16109, 398, 1318, 37, 70, "Input",ExpressionUUID->"40138036-9f5e-4781-a93c-201476f420cd",
 InitializationCell->True],
Cell[17430, 437, 1728, 48, 70, "Input",ExpressionUUID->"a4429225-38ff-4b50-be44-95af04474eb0",
 InitializationCell->True],
Cell[19161, 487, 2900, 66, 70, "Input",ExpressionUUID->"9415f2a2-fe80-4ded-a006-e14d5dd97aa4",
 InitializationCell->True],
Cell[22064, 555, 4128, 96, 70, "Input",ExpressionUUID->"91c517a3-170b-48bb-a45a-b3a2bc37f80f",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[26229, 656, 217, 4, 53, "Subtitle",ExpressionUUID->"566d8e90-1ae4-48d2-8dc2-b750e5361f06"],
Cell[26449, 662, 4736, 103, 70, "Input",ExpressionUUID->"3a10b1e4-5254-4dc0-a1e1-39b8c82b01ca",
 InitializationCell->True],
Cell[31188, 767, 2765, 74, 70, "Input",ExpressionUUID->"db400bc0-e6aa-4438-8935-df57ac71c151",
 InitializationCell->True],
Cell[33956, 843, 7316, 173, 70, "Input",ExpressionUUID->"4d950cc4-6ad2-4885-a479-b005b19dbfe7",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[41309, 1021, 222, 4, 53, "Subtitle",ExpressionUUID->"ebeba433-7b44-474f-83b9-a1b40c702a03"],
Cell[41534, 1027, 7571, 157, 70, "Code",ExpressionUUID->"986a9ceb-b980-46b8-b8a9-ba94d902d917",
 CellID->95479515],
Cell[49108, 1186, 2887, 69, 70, "Input",ExpressionUUID->"bc215893-f1c7-47dc-93b1-7c782e6b41ee",
 InitializationCell->True],
Cell[51998, 1257, 2893, 75, 70, "Input",ExpressionUUID->"e2c880a9-b33c-44bd-b370-1e0de18a8bb0",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[54928, 1337, 261, 4, 53, "Subtitle",ExpressionUUID->"ea2036d9-9454-4c64-8ed5-fe4426ceca3d"],
Cell[55192, 1343, 45532, 803, 1960, "Input",ExpressionUUID->"4a21cd9d-ef0a-427a-a954-57c2c4c3eeed",
 InitializationCell->True],
Cell[100727, 2148, 19405, 433, 1202, "Input",ExpressionUUID->"fb2b1856-844a-46bb-89c7-acc90ed9a60b",
 InitializationCell->True],
Cell[120135, 2583, 5864, 125, 320, "Input",ExpressionUUID->"3e2cf556-e508-4eb4-a1c0-dc2504b140fa",
 InitializationCell->True],
Cell[126002, 2710, 5022, 117, 404, "Input",ExpressionUUID->"6bf72eb1-6675-4ae3-9f3f-177d162e2d4b",
 InitializationCell->True],
Cell[131027, 2829, 1997, 49, 215, "Input",ExpressionUUID->"76dad8ef-02fb-4308-a4d9-e9ecaa1d2322",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[133061, 2883, 512, 8, 53, "Subtitle",ExpressionUUID->"36dd3c16-138c-4de3-ab14-7d943003004e"],
Cell[133576, 2893, 3667, 79, 70, "Input",ExpressionUUID->"51722cd8-2f5d-4ff0-990b-1909748813ff",
 InitializationCell->True],
Cell[137246, 2974, 7963, 187, 70, "Input",ExpressionUUID->"ad191eaa-0b2a-492c-bcae-be3bdf357203",
 InitializationCell->True],
Cell[145212, 3163, 11337, 272, 70, "Input",ExpressionUUID->"75983b54-f498-4135-916b-77f6a95e922e",
 InitializationCell->True],
Cell[156552, 3437, 2179, 49, 70, "Input",ExpressionUUID->"2e449c93-dc59-4375-8964-a4ab8fd2960b",
 InitializationCell->True],
Cell[158734, 3488, 1873, 48, 70, "Input",ExpressionUUID->"f09b31f3-fb2f-4a8a-934d-f4dcb9f601d4",
 InitializationCell->True],
Cell[160610, 3538, 2942, 67, 70, "Input",ExpressionUUID->"ed9edec8-4433-48cb-8395-b81222e19b2b",
 InitializationCell->True],
Cell[163555, 3607, 2237, 51, 70, "Input",ExpressionUUID->"08feac52-0c92-4395-baa0-b352a5014115",
 InitializationCell->True],
Cell[165795, 3660, 2957, 75, 70, "Input",ExpressionUUID->"4d7113a8-254f-4f0d-9a1e-6412dca02be0",
 InitializationCell->True],
Cell[168755, 3737, 6438, 142, 404, "Input",ExpressionUUID->"9f1cb144-05e0-4a7c-9a96-097542286d28",
 InitializationCell->True],
Cell[175196, 3881, 5728, 131, 404, "Input",ExpressionUUID->"36fea079-717e-4605-b34d-1954e275b5b8",
 InitializationCell->True],
Cell[180927, 4014, 1780, 45, 173, "Input",ExpressionUUID->"b70f523c-048d-4d8c-8e7f-a3c9c1afcd31",
 InitializationCell->True],
Cell[182710, 4061, 18207, 374, 1244, "Input",ExpressionUUID->"beec4477-1423-4a7e-97a3-160f6886b834",
 InitializationCell->True],
Cell[200920, 4437, 11553, 242, 887, "Input",ExpressionUUID->"05dff5bc-13ef-4408-a9b2-966ce8582710",
 InitializationCell->True],
Cell[212476, 4681, 11182, 224, 845, "Input",ExpressionUUID->"5866b1ad-db6d-4ad9-be88-536dd6588e09",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[223695, 4910, 610, 9, 53, "Subtitle",ExpressionUUID->"a4e8bd8a-5bf1-4b55-b322-b3147c6bda2c"],
Cell[224308, 4921, 7320, 170, 70, "Input",ExpressionUUID->"ca0d19b1-0937-4386-a37c-4a774131741a",
 InitializationCell->True],
Cell[231631, 5093, 9050, 172, 70, "Input",ExpressionUUID->"f896f793-7880-4dd9-88f1-b7aba50b26ec",
 InitializationCell->True],
Cell[240684, 5267, 2566, 63, 70, "Input",ExpressionUUID->"cd2b3f03-4ca5-4fde-b4e1-76fbdfeb1243",
 InitializationCell->True],
Cell[243253, 5332, 4195, 100, 70, "Input",ExpressionUUID->"053264ad-b44f-446a-8641-f0e8d17257db",
 InitializationCell->True],
Cell[247451, 5434, 22313, 445, 70, "Input",ExpressionUUID->"7d3de4ea-7fb0-472f-83ec-8cf38aae2099",
 InitializationCell->True],
Cell[269767, 5881, 8631, 175, 70, "Input",ExpressionUUID->"89ef853a-ed78-4ba0-8617-ba4475bfa404",
 InitializationCell->True],
Cell[278401, 6058, 1927, 47, 70, "Input",ExpressionUUID->"f0995df0-3e09-469f-9a04-98b9cfcc4260",
 InitializationCell->True],
Cell[280331, 6107, 2657, 63, 70, "Input",ExpressionUUID->"fc6e308d-9018-4b11-b36b-79145bcbee91",
 InitializationCell->True],
Cell[282991, 6172, 2674, 73, 70, "Input",ExpressionUUID->"51205d91-41ad-4e60-804d-b761f35a4c91",
 InitializationCell->True],
Cell[285668, 6247, 16762, 365, 70, "Input",ExpressionUUID->"67cd78cc-0cc8-41c3-93eb-e4e1c5e286d2",
 InitializationCell->True],
Cell[302433, 6614, 6738, 154, 70, "Input",ExpressionUUID->"d4618021-f5ec-4e98-aabc-0c6d64bf1448",
 InitializationCell->True],
Cell[309174, 6770, 10954, 240, 70, "Input",ExpressionUUID->"0e36cd06-3af1-4d43-9edd-37cb7edec16b",
 InitializationCell->True],
Cell[320131, 7012, 4569, 109, 70, "Input",ExpressionUUID->"cd076f0e-8317-4605-8ea8-50105a470764",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[324737, 7126, 453, 7, 53, "Subtitle",ExpressionUUID->"0e86fa5b-a1c6-46f6-819e-1351a2e1380a"],
Cell[325193, 7135, 9737, 217, 70, "Input",ExpressionUUID->"ddaa96a3-662b-41b0-9d02-835e4d6d487c",
 InitializationCell->True],
Cell[334933, 7354, 14249, 316, 70, "Input",ExpressionUUID->"dc5ea0fc-14da-4b29-9448-314d7153714b",
 InitializationCell->True],
Cell[349185, 7672, 6474, 158, 70, "Input",ExpressionUUID->"0b754e4d-eb57-4482-9411-6eb2567a03c6",
 InitializationCell->True],
Cell[355662, 7832, 6748, 166, 70, "Input",ExpressionUUID->"dd8fa3d0-400b-4664-ae58-13c12dd673c4",
 InitializationCell->True],
Cell[362413, 8000, 14028, 303, 70, "Input",ExpressionUUID->"b46acbc7-c364-4ea5-a695-c750d2abbffe",
 InitializationCell->True],
Cell[376444, 8305, 6628, 153, 70, "Input",ExpressionUUID->"116a798a-81f6-41af-801e-31979c51db79",
 InitializationCell->True],
Cell[383075, 8460, 5427, 134, 70, "Input",ExpressionUUID->"2281332b-7d71-4235-9993-7e992aa1932e",
 InitializationCell->True],
Cell[388505, 8596, 5524, 126, 70, "Input",ExpressionUUID->"ce8974a7-9ea9-4c19-a2f9-6a9bf3d069ff",
 InitializationCell->True],
Cell[394032, 8724, 3759, 92, 70, "Input",ExpressionUUID->"5acdff82-528c-4117-9c33-3bedaf398ab3",
 InitializationCell->True],
Cell[397794, 8818, 15766, 357, 70, "Input",ExpressionUUID->"0a5de72f-6436-4a25-91df-7e9e7a069443",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[413597, 9180, 500, 8, 53, "Subtitle",ExpressionUUID->"d24e0b33-073f-4155-b5d8-dc2db54f697a"],
Cell[414100, 9190, 6540, 151, 70, "Input",ExpressionUUID->"04c25102-e016-4adc-bca5-8c32508fa183",
 InitializationCell->True],
Cell[420643, 9343, 2667, 71, 70, "Input",ExpressionUUID->"37ae6f86-8428-4b37-9f8e-7e8ffc49e1b9",
 InitializationCell->True],
Cell[423313, 9416, 8305, 201, 70, "Input",ExpressionUUID->"a45ba830-beb7-4c4c-9dee-f03919a69fc1",
 InitializationCell->True],
Cell[431621, 9619, 4292, 99, 70, "Input",ExpressionUUID->"8c26f5a9-72ed-408f-bcab-f208d1300d54",
 InitializationCell->True],
Cell[435916, 9720, 9752, 195, 70, "Input",ExpressionUUID->"310ebe06-0433-404f-b7db-06b7391dcc58",
 InitializationCell->True],
Cell[445671, 9917, 4370, 103, 70, "Input",ExpressionUUID->"78111f3e-923f-4d50-8c66-69a224290c2b",
 InitializationCell->True],
Cell[450044, 10022, 5376, 130, 70, "Input",ExpressionUUID->"1b9afccb-20ef-4f6b-bed8-78fa5075a413",
 InitializationCell->True],
Cell[455423, 10154, 29595, 652, 70, "Input",ExpressionUUID->"c4ce68cb-640b-481a-af97-60174112c648",
 InitializationCell->True],
Cell[485021, 10808, 16606, 355, 70, "Input",ExpressionUUID->"de31b112-d3a6-45bc-8f4f-c4f5d4a485f4",
 InitializationCell->True],
Cell[501630, 11165, 2289, 47, 70, "Input",ExpressionUUID->"fa5da9f5-d303-4dce-9fbd-a5a71a4f7077",
 InitializationCell->True],
Cell[503922, 11214, 8689, 186, 70, "Input",ExpressionUUID->"66e64c4e-980e-4b17-987b-32a68dec5e35",
 InitializationCell->True],
Cell[512614, 11402, 10565, 237, 70, "Input",ExpressionUUID->"28166257-5dd6-4f08-adb7-68dd9d7e30a2",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[523216, 11644, 349, 6, 53, "Subtitle",ExpressionUUID->"1dfc312e-4cf7-4e92-8d36-cff0bf158471"],
Cell[523568, 11652, 18401, 421, 70, "Input",ExpressionUUID->"dbded075-4854-4d0c-b56a-de84cbd5ae98",
 InitializationCell->True],
Cell[541972, 12075, 1876, 46, 70, "Input",ExpressionUUID->"fafcf83f-a539-4e5f-b2d3-8eaff34938dc",
 InitializationCell->True],
Cell[543851, 12123, 4012, 99, 70, "Input",ExpressionUUID->"14340338-57f8-4464-a369-21952262bf17",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[547900, 12227, 397, 6, 53, "Subtitle",ExpressionUUID->"a97a9735-6f27-435c-9d3d-c5db93033e70"],
Cell[548300, 12235, 3607, 83, 70, "Input",ExpressionUUID->"300ecba4-99b6-435e-bd95-0059a8446291",
 InitializationCell->True],
Cell[551910, 12320, 21810, 451, 70, "Input",ExpressionUUID->"ba6c253a-bb1c-4a73-8830-dabf08a310ea",
 InitializationCell->True],
Cell[573723, 12773, 10173, 241, 70, "Input",ExpressionUUID->"b403a686-5244-4a31-80bf-a40a9a2475c2",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[583933, 13019, 509, 8, 53, "Subtitle",ExpressionUUID->"2f89e428-7fc9-461b-a072-58272af224fe"],
Cell[584445, 13029, 6022, 138, 70, "Input",ExpressionUUID->"b24e93b9-6166-4a32-9b9e-c51f1392f919",
 InitializationCell->True],
Cell[590470, 13169, 22781, 450, 70, "Input",ExpressionUUID->"56d5bac3-df60-447d-8608-90d85468f4bf",
 InitializationCell->True],
Cell[613254, 13621, 9603, 203, 70, "Input",ExpressionUUID->"36d2d1f2-01da-4751-b38c-267ab5433b36",
 InitializationCell->True],
Cell[622860, 13826, 14601, 336, 70, "Input",ExpressionUUID->"7c9e1c56-9977-4c2a-987e-6066d0d508e7",
 InitializationCell->True],
Cell[637464, 14164, 5897, 129, 70, "Input",ExpressionUUID->"94e2e284-e42b-4b59-8953-ff3a820ae8ae",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[643398, 14298, 459, 7, 53, "Subtitle",ExpressionUUID->"b5f30fd1-7179-4f8f-b3d9-e681d9799da3"],
Cell[643860, 14307, 2261, 56, 70, "Input",ExpressionUUID->"1be9f35b-60a2-43fa-b2f3-78bdd612e6da",
 InitializationCell->True],
Cell[646124, 14365, 7689, 179, 70, "Input",ExpressionUUID->"63280eb3-3295-4262-88a3-b8a370f5e9b0",
 InitializationCell->True],
Cell[653816, 14546, 5200, 124, 70, "Input",ExpressionUUID->"87937a11-4b3f-4f99-9e57-475ca8cd47f8",
 InitializationCell->True],
Cell[659019, 14672, 5343, 128, 70, "Input",ExpressionUUID->"9f360a83-b7a3-4ef2-bf21-853cc855bf64",
 InitializationCell->True],
Cell[664365, 14802, 2527, 57, 70, "Input",ExpressionUUID->"7fb6d178-bf5c-4b12-b3ca-c892ebc6ca50",
 InitializationCell->True],
Cell[666895, 14861, 1460, 38, 70, "Input",ExpressionUUID->"3d945910-909d-4cdc-9179-67ae84d91b4d",
 InitializationCell->True],
Cell[668358, 14901, 1928, 47, 70, "Input",ExpressionUUID->"34c9a1ed-193d-4ae1-abb2-92daa47bdead",
 InitializationCell->True],
Cell[670289, 14950, 1505, 36, 70, "Input",ExpressionUUID->"55ad26ed-3a2b-446d-968e-a57b09af5407",
 InitializationCell->True],
Cell[671797, 14988, 5584, 123, 70, "Input",ExpressionUUID->"113e5b04-264a-42f5-b034-87c002c1dad3",
 InitializationCell->True],
Cell[677384, 15113, 2576, 65, 70, "Input",ExpressionUUID->"e022ed31-fc13-4691-a4e4-8b3e8bc54cd3",
 InitializationCell->True],
Cell[679963, 15180, 2380, 58, 70, "Input",ExpressionUUID->"170128e4-7e00-4b01-966f-1643e29669fe",
 InitializationCell->True],
Cell[682346, 15240, 4149, 83, 70, "Input",ExpressionUUID->"6833b156-9d15-4c96-95b4-6b3056262deb",
 InitializationCell->True],
Cell[686498, 15325, 2237, 57, 70, "Input",ExpressionUUID->"770c88d7-8915-4cd2-bceb-6979faad3602",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[688772, 15387, 414, 6, 53, "Subtitle",ExpressionUUID->"2593f6a9-6bb7-48b7-ab5f-0c95a00148a1"],
Cell[689189, 15395, 3957, 99, 70, "Input",ExpressionUUID->"d5f451bc-6ea6-4a17-80c9-0793d3addf54",
 InitializationCell->True],
Cell[693149, 15496, 4996, 119, 70, "Input",ExpressionUUID->"afd0d194-1282-4e86-9f91-d627c316a1be",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[698182, 15620, 469, 7, 53, "Subtitle",ExpressionUUID->"ec56749a-742d-49a9-b63f-84e3e46520c5"],
Cell[698654, 15629, 16409, 335, 70, "Input",ExpressionUUID->"6e53bfe4-0bf1-4969-97eb-1d9e1691b74f",
 InitializationCell->True],
Cell[715066, 15966, 6672, 151, 70, "Input",ExpressionUUID->"d3414f19-a7dd-46d0-ab0e-7b1576854d8d",
 InitializationCell->True]
}, Closed]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)

